{"version":3,"file":"dexie-observable.js","sources":["../src/utils.js","../src/override-create-transaction.js","../src/wakeup-observers.js","../src/change_types.js","../src/hooks/creating.js","../src/hooks/updating.js","../src/hooks/deleting.js","../src/hooks/crud-monitor.js","../src/on-storage.js","../src/override-open.js","../src/intercomm.js","../src/override-parse-stores-spec.js","../src/delete-old-changes.js","../src/Dexie.Observable.js"],"sourcesContent":["export function nop() {}\n\nexport function promisableChain(f1, f2) {\n  if (f1 === nop) return f2;\n  return function() {\n    var res = f1.apply(this, arguments);\n    if (res && typeof res.then === 'function') {\n      var thiz = this, args = arguments;\n      return res.then(function() {\n        return f2.apply(thiz, args);\n      });\n    }\n    return f2.apply(this, arguments);\n  };\n}\n\nexport function createUUID() {\n  // Decent solution from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n  var d = Date.now();\n  var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c === 'x' ? r : (r & 0x7 | 0x8)).toString(16);\n  });\n  return uuid;\n}\n","export default function initOverrideCreateTransaction(db, wakeupObservers) {\n  return function overrideCreateTransaction(origFunc) {\n    return function (mode, storenames, dbschema, parent) {\n      if (db.dynamicallyOpened()) return origFunc.apply(this, arguments); // Don't observe dynamically opened databases.\n      var addChanges = false;\n      if (mode === 'readwrite' && storenames.some(function (storeName) {\n            return dbschema[storeName] && dbschema[storeName].observable;\n          })) {\n        // At least one included store is a observable store. Make sure to also include the _changes store.\n        addChanges = true;\n        storenames = storenames.slice(0); // Clone\n        if (storenames.indexOf(\"_changes\") === -1)\n          storenames.push(\"_changes\"); // Otherwise, firefox will hang... (I've reported the bug to Mozilla@Bugzilla)\n      }\n      // Call original db._createTransaction()\n      var trans = origFunc.call(this, mode, storenames, dbschema, parent);\n      // If this transaction is bound to any observable table, make sure to add changes when transaction completes.\n      if (addChanges) {\n        trans._lastWrittenRevision = 0;\n        trans.on('complete', function () {\n          if (trans._lastWrittenRevision) {\n            // Changes were written in this transaction.\n            if (!parent) {\n              // This is root-level transaction, i.e. a physical commit has happened.\n              // Delay-trigger a wakeup call:\n              if (wakeupObservers.timeoutHandle) clearTimeout(wakeupObservers.timeoutHandle);\n              wakeupObservers.timeoutHandle = setTimeout(function () {\n                delete wakeupObservers.timeoutHandle;\n                wakeupObservers(trans._lastWrittenRevision);\n              }, 25);\n            } else {\n              // This is just a virtual commit of a sub transaction.\n              // Wait with waking up observers until root transaction has committed.\n              // Make sure to mark root transaction so that it will wakeup observers upon commit.\n              var rootTransaction = (function findRootTransaction(trans) {\n                return trans.parent ? findRootTransaction(trans.parent) : trans;\n              })(parent);\n              rootTransaction._lastWrittenRevision = Math.max(\n                  trans._lastWrittenRevision,\n                  rootTransaction.lastWrittenRevision || 0);\n            }\n          }\n        });\n        // Derive \"source\" property from parent transaction by default\n        if (trans.parent && trans.parent.source) trans.source = trans.parent.source;\n      }\n      return trans;\n    };\n  };\n}\n","import Dexie from 'dexie';\n\nexport default function initWakeupObservers(db, Observable, localStorage) {\n  return function wakeupObservers(lastWrittenRevision) {\n    // Make sure Observable.latestRevision[db.name] is still below our value, now when some time has elapsed and other db instances in same window possibly could have made changes too.\n    if (Observable.latestRevision[db.name] < lastWrittenRevision) {\n      // Set the static property lastRevision[db.name] to the revision of the last written change.\n      Observable.latestRevision[db.name] = lastWrittenRevision;\n      // Wakeup ourselves, and any other db instances on this window:\n      Dexie.ignoreTransaction(function () {\n        Observable.on('latestRevisionIncremented').fire(db.name, lastWrittenRevision);\n      });\n      // Observable.on.latestRevisionIncremented will only wakeup db's in current window.\n      // We need a storage event to wakeup other windwos.\n      // Since indexedDB lacks storage events, let's use the storage event from WebStorage just for\n      // the purpose to wakeup db instances in other windows.\n      if (localStorage) localStorage.setItem('Dexie.Observable/latestRevision/' + db.name, lastWrittenRevision); // In IE, this will also wakeup our own window. However, onLatestRevisionIncremented will work around this by only running once per revision id.\n    }\n  };\n}\n","// Change Types\nexport const CREATE = 1;\nexport const UPDATE = 2;\nexport const DELETE = 3;\n","import Dexie from 'dexie';\n\nimport {CREATE} from '../change_types';\n\nexport default function initCreatingHook(db, table) {\n  return function creatingHook(primKey, obj, trans) {\n    /// <param name=\"trans\" type=\"db.Transaction\"></param>\n    var rv = undefined;\n    if (primKey === undefined && table.schema.primKey.uuid) {\n      primKey = rv = Dexie.Observable.createUUID();\n      if (table.schema.primKey.keyPath) {\n        Dexie.setByKeyPath(obj, table.schema.primKey.keyPath, primKey);\n      }\n    }\n\n    var change = {\n      source: trans.source || null, // If a \"source\" is marked on the transaction, store it. Useful for observers that want to ignore their own changes.\n      table: table.name,\n      key: primKey === undefined ? null : primKey,\n      type: CREATE,\n      obj: obj\n    };\n\n    var promise = db._changes.add(change).then(function (rev) {\n      trans._lastWrittenRevision = Math.max(trans._lastWrittenRevision, rev);\n      return rev;\n    });\n\n    // Wait for onsuccess so that we have the primKey if it is auto-incremented and update the change item if so.\n    this.onsuccess = function (resultKey) {\n      if (primKey != resultKey)\n        promise._then(function () {\n          change.key = resultKey;\n          db._changes.put(change);\n        });\n    };\n\n    this.onerror = function () {\n      // If the main operation fails, make sure to regret the change\n      promise._then(function (rev) {\n        // Will only happen if app code catches the main operation error to prohibit transaction from aborting.\n        db._changes.delete(rev);\n      });\n    };\n\n    return rv;\n  };\n}\n","import Dexie from 'dexie';\n\nimport {UPDATE} from '../change_types';\n\nexport default function initUpdatingHook(db, tableName) {\n  return function updatingHook(mods, primKey, oldObj, trans) {\n    /// <param name=\"trans\" type=\"db.Transaction\"></param>\n    // mods may contain property paths with undefined as value if the property\n    // is being deleted. Since we cannot persist undefined we need to act\n    // like those changes is setting the value to null instead.\n    var modsWithoutUndefined = {};\n    // As of current Dexie version (1.0.3) hook may be called even if it wouldn't really change.\n    // Therefore we may do that kind of optimization here - to not add change entries if\n    // there's nothing to change.\n    var anythingChanged = false;\n    var newObj = Dexie.deepClone(oldObj);\n    for (var propPath in mods) {\n      var mod = mods[propPath];\n      if (typeof mod === 'undefined') {\n        Dexie.delByKeyPath(newObj, propPath);\n        modsWithoutUndefined[propPath] = null; // Null is as close we could come to deleting a property when not allowing undefined.\n        anythingChanged = true;\n      } else {\n        var currentValue = Dexie.getByKeyPath(oldObj, propPath);\n        if (mod !== currentValue && JSON.stringify(mod) !== JSON.stringify(currentValue)) {\n          Dexie.setByKeyPath(newObj, propPath, mod);\n          modsWithoutUndefined[propPath] = mod;\n          anythingChanged = true;\n        }\n      }\n    }\n    if (anythingChanged) {\n      var change = {\n        source: trans.source || null, // If a \"source\" is marked on the transaction, store it. Useful for observers that want to ignore their own changes.\n        table: tableName,\n        key: primKey,\n        type: UPDATE,\n        mods: modsWithoutUndefined,\n        oldObj: oldObj,\n        obj: newObj\n      };\n      var promise = db._changes.add(change); // Just so we get the correct revision order of the update...\n      this.onsuccess = function () {\n        promise._then(function (rev) {\n          trans._lastWrittenRevision = Math.max(trans._lastWrittenRevision, rev);\n        });\n      };\n      this.onerror = function () {\n        // If the main operation fails, make sure to regret the change.\n        promise._then(function (rev) {\n          // Will only happen if app code catches the main operation error to prohibit transaction from aborting.\n          db._changes.delete(rev);\n        });\n      };\n    }\n  };\n}\n","import {DELETE} from '../change_types';\n\nexport default function initDeletingHook(db, tableName) {\n  return function deletingHook(primKey, obj, trans) {\n    /// <param name=\"trans\" type=\"db.Transaction\"></param>\n    var promise = db._changes.add({\n      source: trans.source || null, // If a \"source\" is marked on the transaction, store it. Useful for observers that want to ignore their own changes.\n      table: tableName,\n      key: primKey,\n      type: DELETE,\n      oldObj: obj\n    }).then(function (rev) {\n      trans._lastWrittenRevision = Math.max(trans._lastWrittenRevision, rev);\n      return rev;\n    })\n        .catch((e) => {\n          console.log(obj)\n          console.log(e.stack)\n        })\n    this.onerror = function () {\n      // If the main operation fails, make sure to regret the change.\n      // Using _then because if promise is already fullfilled, the standard then() would\n      // do setTimeout() and we would loose the transaction.\n      promise._then(function (rev) {\n        // Will only happen if app code catches the main operation error to prohibit transaction from aborting.\n        db._changes.delete(rev);\n      });\n    };\n  };\n}\n","import initCreatingHook from './creating';\nimport initUpdatingHook from './updating';\nimport initDeletingHook from './deleting';\n\nexport default function initCrudMonitor(db) {\n//\n// The Creating/Updating/Deleting hook will make sure any change is stored to the changes table\n//\n  return function crudMonitor(table) {\n    /// <param name=\"table\" type=\"db.Table\"></param>\n    if (table.hook._observing) return;\n    table.hook._observing = true;\n\n    const tableName = table.name;\n    table.hook('creating').subscribe(initCreatingHook(db, table));\n\n    table.hook('updating').subscribe(initUpdatingHook(db, tableName));\n\n    table.hook('deleting').subscribe(initDeletingHook(db, tableName));\n  };\n}\n","import Dexie from 'dexie';\n\nexport default function initOnStorage(Observable) {\n  return function onStorage(event) {\n    // We use the onstorage event to trigger onLatestRevisionIncremented since we will wake up when other windows modify the DB as well!\n    if (event.key && event.key.indexOf(\"Dexie.Observable/\") === 0) { // For example \"Dexie.Observable/latestRevision/FriendsDB\"\n      var parts = event.key.split('/');\n      var prop = parts[1];\n      var dbname = parts[2];\n      if (prop === 'latestRevision') {\n        var rev = parseInt(event.newValue, 10);\n        if (!isNaN(rev) && rev > Observable.latestRevision[dbname]) {\n          Observable.latestRevision[dbname] = rev;\n          Dexie.ignoreTransaction(function () {\n            Observable.on('latestRevisionIncremented').fire(dbname, rev);\n          });\n        }\n      } else if (prop.indexOf(\"deadnode:\") === 0) {\n        var nodeID = parseInt(prop.split(':')[1], 10);\n        if (event.newValue) {\n          Observable.on.suicideNurseCall.fire(dbname, nodeID);\n        }\n      } else if (prop === 'intercomm') {\n        if (event.newValue) {\n          Observable.on.intercomm.fire(dbname);\n        }\n      }\n    }\n  };\n}\n","export default function initOverrideOpen(db, SyncNode, crudMonitor) {\n  return function overrideOpen(origOpen) {\n    return function () {\n      //\n      // Make sure to subscribe to \"creating\", \"updating\" and \"deleting\" hooks for all observable tables that were created in the stores() method.\n      //\n      Object.keys(db._allTables).forEach(tableName => {\n        let table = db._allTables[tableName];\n        if (table.schema.observable) {\n          crudMonitor(table);\n        }\n        if (table.name === \"_syncNodes\") {\n          table.mapToClass(SyncNode);\n        }\n      });\n      return origOpen.apply(this, arguments);\n    }\n  };\n}\n","import Dexie from 'dexie';\n\nconst Promise = Dexie.Promise;\n\nexport default function initIntercomm(db, Observable, SyncNode, mySyncNode, localStorage) {\n//\n// Intercommunication between nodes\n//\n// Enable inter-process communication between browser windows using localStorage storage event (is registered in Dexie.Observable)\n\n  var requestsWaitingForReply = {};\n\n  /**\n   * @param {string} type Type of message\n   * @param message Message to send\n   * @param {number} destinationNode ID of destination node\n   * @param {{wantReply: boolean, isFailure: boolean, requestId: number}} options If {wantReply: true}, the returned promise will complete with the reply from remote. Otherwise it will complete when message has been successfully sent.</param>\n   */\n  db.observable.sendMessage = function (type, message, destinationNode, options) {\n    /// <param name=\"type\" type=\"String\">Type of message</param>\n    /// <param name=\"message\">Message to send</param>\n    /// <param name=\"destinationNode\" type=\"Number\">ID of destination node</param>\n    /// <param name=\"options\" type=\"Object\" optional=\"true\">{wantReply: Boolean, isFailure: Boolean, requestId: Number}. If wantReply, the returned promise will complete with the reply from remote. Otherwise it will complete when message has been successfully sent.</param>\n    options = options || {};\n    if (!mySyncNode.node)\n      return options.wantReply ?\n          Promise.reject(new Dexie.DatabaseClosedError()) :\n          Promise.resolve(); // If caller doesn't want a reply, it won't catch errors either.\n\n    var msg = {message: message, destinationNode: destinationNode, sender: mySyncNode.node.id, type: type};\n    Dexie.extend(msg, options); // wantReply: wantReply, success: !isFailure, requestId: ...\n    return Dexie.ignoreTransaction(()=> {\n      var tables = [\"_intercomm\"];\n      if (options.wantReply) tables.push(\"_syncNodes\"); // If caller wants a reply, include \"_syncNodes\" in transaction to check that there's a receiver there. Otherwise, new master will get it.\n      var promise = db.transaction('rw', tables, () => {\n        if (options.wantReply) {\n          // Check that there is a receiver there to take the request.\n          return db._syncNodes.where('id').equals(destinationNode).count(receiverAlive => {\n            if (receiverAlive)\n              return db._intercomm.add(msg);\n            else // If we couldn't find a node -> send to master\n              return db._syncNodes.where('isMaster').above(0).first(function (masterNode) {\n                msg.destinationNode = masterNode.id;\n                return db._intercomm.add(msg)\n              });\n          });\n        } else {\n          // If caller doesn't need a response, we don't have to make sure that it gets one.\n          return db._intercomm.add(msg);\n        }\n      }).then(messageId => {\n        var rv = null;\n        if (options.wantReply) {\n          rv = new Promise(function (resolve, reject) {\n            requestsWaitingForReply[messageId.toString()] = {resolve: resolve, reject: reject};\n          });\n        }\n        if (localStorage) {\n          localStorage.setItem(\"Dexie.Observable/intercomm/\" + db.name, messageId.toString());\n        }\n        Observable.on.intercomm.fire(db.name);\n        return rv;\n      });\n\n      if (!options.wantReply) {\n        promise.catch(()=> {\n        });\n        return;\n      } else {\n        // Forward rejection to caller if it waits for reply.\n        return promise;\n      }\n    });\n  };\n\n  // Send a message to all local _syncNodes\n  db.observable.broadcastMessage = function (type, message, bIncludeSelf) {\n    if (!mySyncNode.node) return;\n    var mySyncNodeId = mySyncNode.node.id;\n    Dexie.ignoreTransaction(()=> {\n      db._syncNodes.toArray(nodes => {\n        return Promise.all(nodes\n            .filter(node => node.type === 'local' && (bIncludeSelf || node.id !== mySyncNodeId))\n            .map(node => db.observable.sendMessage(type, message, node.id)));\n      }).catch(()=> {\n      });\n    });\n  };\n\n  function consumeIntercommMessages() {\n    // Check if we got messages:\n    if (!mySyncNode.node) return Promise.reject(new Dexie.DatabaseClosedError());\n\n    return Dexie.ignoreTransaction(()=> {\n      return db.transaction('rw', '_intercomm', function() {\n        return db._intercomm.where({destinationNode: mySyncNode.node.id}).toArray(messages => {\n          messages.forEach(msg => consumeMessage(msg));\n          return db._intercomm.where('id').anyOf(messages.map(msg => msg.id)).delete();\n        });\n      });\n    });\n  }\n\n  function consumeMessage(msg) {\n    if (msg.type === 'response') {\n      // This is a response. Lookup pending request and fulfill its promise.\n      var request = requestsWaitingForReply[msg.requestId.toString()];\n      if (request) {\n        if (msg.isFailure) {\n          request.reject(msg.message.error);\n        } else {\n          request.resolve(msg.message.result);\n        }\n        delete requestsWaitingForReply[msg.requestId.toString()];\n      }\n    } else {\n      // This is a message or request. Fire the event and add an API for the subscriber to use if reply is requested\n      msg.resolve = function (result) {\n        db.observable.sendMessage('response', {result: result}, msg.sender, {requestId: msg.id});\n      };\n      msg.reject = function (error) {\n        db.observable.sendMessage('response', {error: error.toString()}, msg.sender, {isFailure: true, requestId: msg.id});\n      };\n      db.on.message.fire(msg);\n    }\n  }\n\n  // Listener for 'intercomm' events\n  // Gets fired when we get a 'storage' event from local storage or when sendMessage is called\n  // 'storage' is used to communicate between tabs (sendMessage changes the localStorage to trigger the event)\n  // sendMessage is used to communicate in the same tab and to trigger a storage event\n  function onIntercomm(dbname) {\n    // When storage event trigger us to check\n    if (dbname === db.name) {\n      consumeIntercommMessages().catch('DatabaseClosedError', ()=> {});\n    }\n  }\n\n  return {\n    onIntercomm,\n    consumeIntercommMessages\n  };\n}\n","export default function overrideParseStoresSpec(origFunc) {\n  return function(stores, dbSchema) {\n    // Create the _changes and _syncNodes tables\n    stores[\"_changes\"] = \"++rev\";\n    stores[\"_syncNodes\"] = \"++id,myRevision,lastHeartBeat,&url,isMaster,type,status\";\n    stores[\"_intercomm\"] = \"++id,destinationNode\";\n    stores[\"_uncommittedChanges\"] = \"++id,node\"; // For remote syncing when server returns a partial result.\n    // Call default implementation. Will populate the dbSchema structures.\n    origFunc.call(this, stores, dbSchema);\n    // Allow UUID primary keys using $$ prefix on primary key or indexes\n    Object.keys(dbSchema).forEach(function(tableName) {\n      var schema = dbSchema[tableName];\n      if (schema.primKey.name.indexOf('$$') === 0) {\n        schema.primKey.uuid = true;\n        schema.primKey.name = schema.primKey.name.substr(2);\n        schema.primKey.keyPath = schema.primKey.keyPath.substr(2);\n      }\n    });\n    // Now mark all observable tables\n    Object.keys(dbSchema).forEach(function(tableName) {\n      // Marked observable tables with \"observable\" in their TableSchema.\n      if (tableName.indexOf('_') !== 0 && tableName.indexOf('$') !== 0) {\n        dbSchema[tableName].observable = true;\n      }\n    });\n  };\n}\n","import Dexie from 'dexie';\n\nexport default function deleteOldChanges(db) {\n  // This is a background job and should never be done within\n  // a caller's transaction. Use Dexie.ignoreTransaction() to ensure that.\n  // We should not return the Promise but catch it ourselves instead.\n\n  // To prohibit starving the database we want to lock transactions as short as possible\n  // and since we're not in a hurry, we could do this job in chunks and reschedule a\n  // continuation every 500 ms.\n  const CHUNK_SIZE = 100;\n\n  Dexie.ignoreTransaction(()=>{\n    return db._syncNodes.orderBy(\"myRevision\").first(oldestNode => {\n      return db._changes\n          .where(\"rev\").below(oldestNode.myRevision)\n          .limit(CHUNK_SIZE)\n          .primaryKeys();\n    }).then(keysToDelete => {\n      if (keysToDelete.length === 0) return; // Done.\n      return db._changes.bulkDelete(keysToDelete).then(()=> {\n        // If not done garbage collecting, reschedule a continuation of it until done.\n        if (keysToDelete.length === CHUNK_SIZE) {\n          // Limit reached. Changes are there are more job to do. Schedule again:\n          setTimeout(() => db.isOpen() && deleteOldChanges(db), 500);\n        }\n      });\n    });\n  }).catch(()=>{\n    // The operation is not crucial. A failure could almost only be due to that database has been closed.\n    // No need to log this.\n  });\n}\n","/* ========================================================================== \n *                           dexie-observable.js\n * ==========================================================================\n *\n * Dexie addon for observing database changes not just on local db instance\n * but also on other instances, tabs and windows.\n *\n * Comprises a base framework for dexie-syncable.js\n *\n * By David Fahlander, david.fahlander@gmail.com,\n *    Nikolas Poniros, https://github.com/nponiros\n *\n * ==========================================================================\n *\n * Version {version}, {date}\n *\n * https://dexie.org\n *\n * Apache License Version 2.0, January 2004, http://www.apache.org/licenses/\n * \n */\nimport Dexie from 'dexie';\nimport { nop, promisableChain, createUUID } from './utils';\n\nimport initOverrideCreateTransaction from './override-create-transaction';\nimport initWakeupObservers from './wakeup-observers';\nimport initCrudMonitor from './hooks/crud-monitor';\nimport initOnStorage from './on-storage';\nimport initOverrideOpen from './override-open';\nimport initIntercomm from './intercomm';\n\nimport overrideParseStoresSpec from './override-parse-stores-spec';\n\nimport deleteOldChanges from './delete-old-changes';\n\nvar global = self;\n\n/** class DatabaseChange\n    *\n    *  Object contained by the _changes table.\n    */\nvar DatabaseChange = Dexie.defineClass({\n    rev: Number, // Auto-incremented primary key\n    source: String, // Optional source creating the change. Set if transaction.source was set when doing the operation.\n    table: String, // Table name\n    key: Object, // Primary key. Any type.\n    type: Number, // 1 = CREATE, 2 = UPDATE, 3 = DELETE\n    obj: Object, // CREATE: obj contains the object created.\n    mods: Object, // UPDATE: mods contains the modifications made to the object.\n    oldObj: Object // DELETE: oldObj contains the object deleted. UPDATE: oldObj contains the old object before updates applied.\n});\n\n// Import some usable helper functions\nvar override = Dexie.override;\nvar Promise = Dexie.Promise;\nvar browserIsShuttingDown = false;\n\n/** Dexie addon for change tracking and real-time observation.\n * \n * @param {Dexie} db \n */\nfunction Observable(db) {\n    if (!/^(3|4)\\./.test(Dexie.version))\n        throw new Error(`Missing dexie version 3.x or 4.x`);\n    if (db.observable) {\n        if (db.observable.version !== \"{version}\") throw new Error(`Mixed versions of dexie-observable`);\n        return; // Addon already active.\n    }\n\n    var NODE_TIMEOUT = 20000, // 20 seconds before local db instances are timed out. This is so that old changes can be deleted when not needed and to garbage collect old _syncNodes objects.\n        HIBERNATE_GRACE_PERIOD = 20000, // 20 seconds\n        // LOCAL_POLL: The time to wait before polling local db for changes and cleaning up old nodes. \n        // Polling for changes is a fallback only needed in certain circomstances (when the onstorage event doesnt reach all listeners - when different browser windows doesnt share the same process)\n        LOCAL_POLL = 500, // 500 ms. In real-world there will be this value + the time it takes to poll(). A small value is needed in Workers where we cannot rely on storage event.\n        HEARTBEAT_INTERVAL = NODE_TIMEOUT - 5000;\n\n    var localStorage = Observable.localStorageImpl;\n\n    /** class SyncNode\n        *\n        * Object contained in the _syncNodes table.\n        */\n    var SyncNode = Dexie.defineClass({\n        //id: Number,\n        myRevision: Number,\n        type: String, // \"local\" or \"remote\"\n        lastHeartBeat: Number,\n        deleteTimeStamp: Number, // In case lastHeartBeat is too old, a value of now + HIBERNATE_GRACE_PERIOD will be set here. If reached before node wakes up, node will be deleted.\n        url: String, // Only applicable for \"remote\" nodes. Only used in Dexie.Syncable.\n        isMaster: Number, // 1 if true. Not using Boolean because it's not possible to index Booleans in IE implementation of IDB.\n\n        // Below properties should be extended in Dexie.Syncable. Not here. They apply to remote nodes only (type == \"remote\"):\n        syncProtocol: String, // Tells which implementation of ISyncProtocol to use for remote syncing. \n        syncContext: null,\n        syncOptions: Object,\n        connected: false, // FIXTHIS: Remove! Replace with status.\n        status: Number,\n        appliedRemoteRevision: null,\n        remoteBaseRevisions: [{ local: Number, remote: null }],\n        dbUploadState: {\n            tablesToUpload: [String],\n            currentTable: String,\n            currentKey: null,\n            localBaseRevision: Number\n        }\n    });\n\n    db.observable = {version: \"{version}\"};\n    db.observable.SyncNode = SyncNode;\n\n    const wakeupObservers = initWakeupObservers(db, Observable, localStorage);\n    const overrideCreateTransaction = initOverrideCreateTransaction(db, wakeupObservers);\n    const crudMonitor = initCrudMonitor(db);\n    const overrideOpen = initOverrideOpen(db, SyncNode, crudMonitor);\n\n    var mySyncNode = {node: null};\n\n    const intercomm = initIntercomm(db, Observable, SyncNode, mySyncNode, localStorage);\n    const onIntercomm = intercomm.onIntercomm;\n    const consumeIntercommMessages = intercomm.consumeIntercommMessages;\n\n    // Allow other addons to access the local sync node. May be needed by Dexie.Syncable.\n    Object.defineProperty(db, \"_localSyncNode\", {\n        get: function() { return mySyncNode.node; }\n    });\n\n    var pollHandle = null,\n        heartbeatHandle = null;\n\n    if (Dexie.fake) {\n        // This code will never run.\n        // It's here just to enable auto-complete in visual studio - helps a lot when writing code.\n        db.version(1).stores({\n            _syncNodes: \"++id,myRevision,lastHeartBeat\",\n            _changes: \"++rev\",\n            _intercomm: \"++id,destinationNode\",\n            _uncommittedChanges: \"++id,node\"\n        });\n        db._syncNodes.mapToClass(SyncNode);\n        db._changes.mapToClass(DatabaseChange);\n        mySyncNode.node = new SyncNode({\n            myRevision: 0,\n            type: \"local\",\n            lastHeartBeat: Date.now(),\n            deleteTimeStamp: null\n        });\n    }\n\n    //\n    // Override parsing the stores to add \"_changes\" and \"_syncNodes\" tables.\n    // It also adds UUID support for the primary key and sets tables as observable tables.\n    //\n    db.Version.prototype._parseStoresSpec = override(db.Version.prototype._parseStoresSpec, overrideParseStoresSpec);\n\n    // changes event on db:\n    db.on.addEventType({\n        changes: 'asap',\n        cleanup: [promisableChain, nop], // fire (nodesTable, changesTable, trans). Hook called when cleaning up nodes. Subscribers may return a Promise to to more stuff. May do additional stuff if local sync node is master.\n        message: 'asap'\n    });\n\n    //\n    // Override transaction creation to always include the \"_changes\" store when any observable store is involved.\n    //\n    db._createTransaction = override(db._createTransaction, overrideCreateTransaction);\n\n    // If Observable.latestRevsion[db.name] is undefined, set it to 0 so that comparing against it always works.\n    // You might think that it will always be undefined before this call, but in case another Dexie instance in the same\n    // window with the same database name has been created already, this static property will already be set correctly.\n    Observable.latestRevision[db.name] = Observable.latestRevision[db.name] || 0;\n\n    //\n    // Override open to setup hooks for db changes and map the _syncNodes table to class\n    //\n    db.open = override(db.open, overrideOpen);\n\n    db.close = override(db.close, function(origClose) {\n        return function () {\n            if (db.dynamicallyOpened()) return origClose.apply(this, arguments); // Don't observe dynamically opened databases.\n            // Teardown our framework.\n            if (wakeupObservers.timeoutHandle) {\n                clearTimeout(wakeupObservers.timeoutHandle);\n                delete wakeupObservers.timeoutHandle;\n            }\n            Observable.on('latestRevisionIncremented').unsubscribe(onLatestRevisionIncremented);\n            Observable.on('suicideNurseCall').unsubscribe(onSuicide);\n            Observable.on('intercomm').unsubscribe(onIntercomm);\n            Observable.on('beforeunload').unsubscribe(onBeforeUnload);\n            // Inform other db instances in same window that we are dying:\n            if (mySyncNode.node && mySyncNode.node.id) {\n                Observable.on.suicideNurseCall.fire(db.name, mySyncNode.node.id);\n                // Inform other windows as well:\n                if (localStorage) {\n                    localStorage.setItem('Dexie.Observable/deadnode:' + mySyncNode.node.id.toString() + '/' + db.name, \"dead\"); // In IE, this will also wakeup our own window. cleanup() may trigger twice per other db instance. But that doesnt to anything.\n                }\n                mySyncNode.node.deleteTimeStamp = 1; // One millisecond after 1970. Makes it occur in the past but still keeps it truthy.\n                mySyncNode.node.lastHeartBeat = 0;\n                db._syncNodes.put(mySyncNode.node); // This async operation may be cancelled since the browser is closing down now.\n                mySyncNode.node = null;\n            }\n\n            if (pollHandle) clearTimeout(pollHandle);\n            pollHandle = null;\n            if (heartbeatHandle) clearTimeout(heartbeatHandle);\n            heartbeatHandle = null;\n            return origClose.apply(this, arguments);\n        };\n    });\n\n    // Override Dexie.delete() in order to delete Observable.latestRevision[db.name].\n    db.delete = override(db.delete, function(origDelete) {\n        return function() {\n            return origDelete.apply(this, arguments).then(function(result) {\n                // Reset Observable.latestRevision[db.name]\n                Observable.latestRevision[db.name] = 0;\n                return result;\n            });\n        };\n    });\n\n    // When db opens, make sure to start monitor any changes before other db operations will start.\n    db.on(\"ready\", function startObserving() {\n        if (db.dynamicallyOpened()) return db; // Don't observe dynamically opened databases.\n        \n        return db.table(\"_changes\").orderBy(\"rev\").last(function(lastChange) {\n            // Since startObserving() is called before database open() method, this will be the first database operation enqueued to db.\n            // Therefore we know that the retrieved value will be This query will\n            var latestRevision = (lastChange ? lastChange.rev : 0);\n            mySyncNode.node = new SyncNode({\n                myRevision: latestRevision,\n                type: \"local\",\n                lastHeartBeat: Date.now(),\n                deleteTimeStamp: null,\n                isMaster: 0\n            });\n            if (Observable.latestRevision[db.name] < latestRevision) {\n                // Side track . For correctness whenever setting Observable.latestRevision[db.name] we must make sure the event is fired if increased:\n                // There are other db instances in same window that hasnt yet been informed about a new revision\n                Observable.latestRevision[db.name] = latestRevision;\n                Dexie.ignoreTransaction(function() {\n                    Observable.on.latestRevisionIncremented.fire(latestRevision);\n                });\n            }\n            // Add new sync node or if this is a reopening of the database after a close() call, update it.\n            return db._syncNodes.put(mySyncNode.node).then(Dexie.ignoreTransaction(() => {\n                // By default, this node will become master unless we discover an existing, up-to-date master\n                var mySyncNodeShouldBecomeMaster = 1;\n                return db._syncNodes.orderBy('isMaster').reverse().modify(existingNode => {\n                    if (existingNode.isMaster) {\n                        if (existingNode.lastHeartBeat < Date.now() - NODE_TIMEOUT) {\n                            // Existing master record is out-of-date; demote it\n                            existingNode.isMaster = 0;\n                        } else {\n                            // An existing up-to-date master record exists, so it will remain master\n                            mySyncNodeShouldBecomeMaster = 0;\n                        }\n                    }\n\n                    // The local node reference may be unassigned at any point by a database close() operation\n                    if (!mySyncNode.node) return;\n\n                    // Assign the local node state\n                    // This is guaranteed to apply *after* any existing master records have been inspected, due to the orderBy clause\n                    if (existingNode.id === mySyncNode.node.id) {\n                        existingNode.isMaster = mySyncNode.node.isMaster = mySyncNodeShouldBecomeMaster;\n                    }\n                });\n            })).then(() => {\n                Observable.on('latestRevisionIncremented', onLatestRevisionIncremented); // Wakeup when a new revision is available.\n                Observable.on('beforeunload', onBeforeUnload);\n                Observable.on('suicideNurseCall', onSuicide);\n                Observable.on('intercomm', onIntercomm);\n                // Start polling for changes and do cleanups:\n                pollHandle = setTimeout(poll, LOCAL_POLL);\n                // Start heartbeat\n                heartbeatHandle = setTimeout(heartbeat, HEARTBEAT_INTERVAL);\n            }).then(function () {\n                cleanup();\n            });\n        });\n    }, true); // True means the on(ready) event will survive a db reopening (db.close() / db.open()).\n\n    var handledRevision = 0;\n\n    function onLatestRevisionIncremented(dbname, latestRevision) {\n        if (dbname === db.name) {\n            if (handledRevision >= latestRevision) return; // Make sure to only run once per revision. (Workaround for IE triggering storage event on same window)\n            handledRevision = latestRevision;\n            Dexie.vip(function() {\n                readChanges(latestRevision).catch('DatabaseClosedError', ()=>{\n                    // Handle database closed error gracefully while reading changes.\n                    // Don't trigger 'unhandledrejection'.\n                    // Even though we intercept the close() method, it might be called when in the middle of\n                    // reading changes and then that flow will cancel with DatabaseClosedError.\n                });\n            });\n        }\n    }\n\n    function readChanges(latestRevision, recursion, wasPartial) {\n        // Whenever changes are read, fire db.on(\"changes\") with the array of changes. Eventually, limit the array to 1000 entries or so (an entire database is\n        // downloaded from server AFTER we are initiated. For example, if first sync call fails, then after a while we get reconnected. However, that scenario\n        // should be handled in case database is totally empty we should fail if sync is not available)\n        if (!recursion && readChanges.ongoingOperation) {\n            // We are already reading changes. Prohibit a parallell execution of this which would lead to duplicate trigging of 'changes' event.\n            // Instead, the callback in toArray() will always check Observable.latestRevision[db.name] to see if it has changed and if so, re-launch readChanges().\n            // The caller should get the Promise instance from the ongoing operation so that the then() method will resolve when operation is finished.\n            return readChanges.ongoingOperation;\n        }\n\n        var partial = false;\n        var ourSyncNode = mySyncNode.node; // Because mySyncNode can suddenly be set to null on database close, and worse, can be set to a new value if database is reopened.\n        if (!ourSyncNode) {\n            return Promise.reject(new Dexie.DatabaseClosedError());\n        }\n        var LIMIT = 1000;\n        var promise = db._changes.where(\"rev\").above(ourSyncNode.myRevision).limit(LIMIT).toArray(function (changes) {\n            if (changes.length > 0) {\n                var lastChange = changes[changes.length - 1];\n                partial = (changes.length === LIMIT);\n                db.on('changes').fire(changes, partial);\n                ourSyncNode.myRevision = lastChange.rev;\n            } else if (wasPartial) {\n                // No more changes, BUT since we have triggered on('changes') with partial = true,\n                // we HAVE TO trigger changes again with empty list and partial = false\n                db.on('changes').fire([], false);\n            }\n\n            let ourNodeStillExists = false;\n            return db._syncNodes.where(':id').equals(ourSyncNode.id).modify(syncNode => {\n                ourNodeStillExists = true;\n                syncNode.lastHeartBeat = Date.now(); // Update heart beat (not nescessary, but why not!)\n                syncNode.deleteTimeStamp = null; // Reset \"deleteTimeStamp\" flag if it was there.\n                syncNode.myRevision = Math.max(syncNode.myRevision, ourSyncNode.myRevision);\n            }).then(()=>ourNodeStillExists);\n        }).then(ourNodeStillExists =>{\n            if (!ourNodeStillExists) {\n                // My node has been deleted. We must have been lazy and got removed by another node.\n                if (browserIsShuttingDown) {\n                    throw new Error(\"Browser is shutting down\");\n                } else {\n                    db.close();\n                    console.error(\"Out of sync\"); // TODO: What to do? Reload the page?\n                    if (global.location) global.location.reload(true);\n                    throw new Error(\"Out of sync\"); // Will make current promise reject\n                }\n            }\n\n            // Check if more changes have come since we started reading changes in the first place. If so, relaunch readChanges and let the ongoing promise not\n            // resolve until all changes have been read.\n            if (partial || Observable.latestRevision[db.name] > ourSyncNode.myRevision) {\n                // Either there were more than 1000 changes or additional changes where added while we were reading these changes,\n                // In either case, call readChanges() again until we're done.\n                return readChanges(Observable.latestRevision[db.name], (recursion || 0) + 1, partial);\n            }\n\n        }).finally(function() {\n            delete readChanges.ongoingOperation;\n        });\n\n        if (!recursion) {\n            readChanges.ongoingOperation = promise;\n        }\n        return promise;\n    }\n\n    /**\n     * The reason we need heartbeat in parallell with poll() is due to the risk of long-running\n     * transactions while syncing changes from server to client in Dexie.Syncable. That transaction will\n     * include _changes (which will block readChanges()) but not _syncNodes. So this heartbeat will go on\n     * during that changes are being applied and update our lastHeartBeat property while poll() is waiting.\n     * When cleanup() (who also is blocked by the sync) wakes up, it won't kill the master node because this\n     * heartbeat job will have updated the master node's heartbeat during the long-running sync transaction.\n     * \n     * If we did not have this heartbeat, and a server send lots of changes that took more than NODE_TIMEOUT\n     * (20 seconds), another node waking up after the sync would kill the master node and take over because\n     * it would believe it was dead.\n     */\n    function heartbeat() {\n        heartbeatHandle = null;\n        var currentInstance = mySyncNode.node && mySyncNode.node.id;\n        if (!currentInstance) return;\n        db.transaction('rw!', db._syncNodes, ()=>{\n            db._syncNodes.where({id: currentInstance}).first(ourSyncNode => {\n                if (!ourSyncNode) {\n                    // We do not exist anymore. Call db.close() to teardown polls etc.\n                    if (db.isOpen()) db.close();\n                    return;\n                }\n                ourSyncNode.lastHeartBeat = Date.now();\n                ourSyncNode.deleteTimeStamp = null; // Reset \"deleteTimeStamp\" flag if it was there.\n                return db._syncNodes.put(ourSyncNode);\n            });\n        }).catch('DatabaseClosedError', () => {\n            // Ignore silently\n        }).finally(() => {\n            if (mySyncNode.node && mySyncNode.node.id === currentInstance && db.isOpen()) {\n                heartbeatHandle = setTimeout(heartbeat, HEARTBEAT_INTERVAL);\n            }\n        });\n    }\n\n    function poll() {\n        pollHandle = null;\n        var currentInstance = mySyncNode.node && mySyncNode.node.id;\n        if (!currentInstance) return;\n        Dexie.vip(function() { // VIP ourselves. Otherwise we might not be able to consume intercomm messages from master node before database has finished opening. This would make DB stall forever. Cannot rely on storage-event since it may not always work in some browsers of different processes.\n            readChanges(Observable.latestRevision[db.name]).then(cleanup).then(consumeIntercommMessages)\n            .catch('DatabaseClosedError', ()=>{\n                // Handle database closed error gracefully while reading changes.\n                // Don't trigger 'unhandledrejection'.\n                // Even though we intercept the close() method, it might be called when in the middle of\n                // reading changes and then that flow will cancel with DatabaseClosedError.\n            })\n            .finally(function() {\n                // Poll again in given interval:\n                if (mySyncNode.node && mySyncNode.node.id === currentInstance && db.isOpen()) {\n                    pollHandle = setTimeout(poll, LOCAL_POLL);\n                }\n            });\n        });\n    }\n\n    \n    function cleanup() {\n        var ourSyncNode = mySyncNode.node;\n        if (!ourSyncNode) return Promise.reject(new Dexie.DatabaseClosedError());\n        return db.transaction('rw', '_syncNodes', '_changes', '_intercomm', function() {\n            // Cleanup dead local nodes that has no heartbeat for over a minute\n            // Dont do the following:\n            //nodes.where(\"lastHeartBeat\").below(Date.now() - NODE_TIMEOUT).and(function (node) { return node.type == \"local\"; }).delete();\n            // Because client may have been in hybernate mode and recently woken up. That would lead to deletion of all nodes.\n            // Instead, we should mark any old nodes for deletion in a minute or so. If they still dont wakeup after that minute we could consider them dead.\n            var weBecameMaster = false;\n            db._syncNodes.where(\"lastHeartBeat\").below(Date.now() - NODE_TIMEOUT).filter(node => node.type === 'local').modify(function(node) {\n                if (node.deleteTimeStamp && node.deleteTimeStamp < Date.now()) {\n                    // Delete the node.\n                    delete this.value;\n                    // Cleanup localStorage \"deadnode:\" entry for this node (localStorage API was used to wakeup other windows (onstorage event) - an event type missing in indexedDB.)\n                    if (localStorage) {\n                        localStorage.removeItem('Dexie.Observable/deadnode:' + node.id + '/' + db.name);\n                    }\n                    // Check if we are deleting a master node\n                    if (node.isMaster) {\n                        // The node we are deleting is master. We must take over that role.\n                        // OK to call nodes.update(). No need to call Dexie.vip() because nodes is opened in existing transaction!\n                        db._syncNodes.update(ourSyncNode, { isMaster: 1 });\n                        weBecameMaster = true;\n                    }\n                    // Cleanup intercomm messages destinated to the node being deleted.\n                    // Those that waits for reply should be redirected to us.\n                    db._intercomm.where({destinationNode: node.id}).modify(function(msg) {\n                        if (msg.wantReply)\n                            msg.destinationNode = ourSyncNode.id;\n                        else\n                            // Delete the message from DB and if someone is waiting for reply, let ourselved answer the request.\n                            delete this.value;\n                    });\n                } else if (!node.deleteTimeStamp) {\n                    // Mark the node for deletion\n                    node.deleteTimeStamp = Date.now() + HIBERNATE_GRACE_PERIOD;\n                }\n            }).then(function() {\n                // Cleanup old revisions that no node is interested of.\n                Observable.deleteOldChanges(db);\n                return db.on(\"cleanup\").fire(weBecameMaster);\n            });\n        });\n    }\n\n    function onBeforeUnload() {\n        // Mark our own sync node for deletion.\n        if (!mySyncNode.node) return;\n        browserIsShuttingDown = true;\n        mySyncNode.node.deleteTimeStamp = 1; // One millisecond after 1970. Makes it occur in the past but still keeps it truthy.\n        mySyncNode.node.lastHeartBeat = 0;\n        db._syncNodes.put(mySyncNode.node); // This async operation may be cancelled since the browser is closing down now.\n        Observable.wereTheOneDying = true; // If other nodes in same window wakes up by this call, make sure they dont start taking over mastership and stuff...\n        // Inform other windows that we're gone, so that they may take over our role if needed. Setting localStorage item below will trigger Observable.onStorage, which will trigger onSuicie() below:\n        if (localStorage) {\n            localStorage.setItem('Dexie.Observable/deadnode:' + mySyncNode.node.id.toString() + '/' + db.name, \"dead\"); // In IE, this will also wakeup our own window. However, that is doublechecked in nursecall subscriber below.\n        }\n    }\n\n    function onSuicide(dbname, nodeID) {\n        if (dbname === db.name && !Observable.wereTheOneDying) {\n            // Make sure it's dead indeed. Second bullet. Why? Because it has marked itself for deletion in the onbeforeunload event, which is fired just before window dies.\n            // It's own call to put() may have been cancelled.\n            // Note also that in IE, this event may be called twice, but that doesnt harm!\n            Dexie.vip(function() {\n                db._syncNodes.update(nodeID, { deleteTimeStamp: 1, lastHeartBeat: 0 }).then(cleanup);\n            });\n        }\n    }\n\n}\n\n//\n// Static properties and methods\n// \n\nObservable.version = \"{version}\";\nObservable.latestRevision = {}; // Latest revision PER DATABASE. Example: Observable.latestRevision.FriendsDB = 37;\nObservable.on = Dexie.Events(null, \"latestRevisionIncremented\", \"suicideNurseCall\", \"intercomm\", \"beforeunload\"); // fire(dbname, value);\nObservable.createUUID = createUUID;\n\nObservable.deleteOldChanges = deleteOldChanges;\n\nObservable._onStorage = initOnStorage(Observable);\n\nObservable._onBeforeUnload = function() {\n    Observable.on.beforeunload.fire();\n};\n\ntry {\n    Observable.localStorageImpl = global.localStorage;\n} catch (ex){}\n\n//\n// Map window events to static events in Dexie.Observable:\n//\nif (global?.addEventListener) {\n    global.addEventListener(\"storage\", Observable._onStorage);\n    global.addEventListener(\"beforeunload\", Observable._onBeforeUnload);\n}\n\nif (Dexie.Observable) {\n    if (Dexie.Observable.version !== \"{version}\") {\n        throw new Error (`Mixed versions of dexie-observable`);\n    }\n} else {\n    // Register addon:\n    Dexie.Observable = Observable;\n    Dexie.addons.push(Observable);\n}\n\nexport default Dexie.Observable;\n"],"names":["Promise"],"mappings":"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"}