{"version":3,"file":"dexie-yield.js","sources":["../C:/Users/David/Documents/GitHub/dexie-es6/addons/dexie-yield/src/dexie-yield.js"],"sourcesContent":["ï»¿\r\nimport Dexie from 'dexie';\r\n\nexport function async(generatorFn) {\n    return function () {\n        return iterate(generatorFn.apply(this, arguments));\n    }\n}\n\nexport function spawn(generatorFn, promiseImpl) {\n    return iterate(generatorFn());\n}\n\nexport function iterate (iterable) {\n    var callNext = result => iterable.next(result),\n        doThrow = error => iterable.throw(error),\n        onSuccess = step(callNext),\n        onError = step(doThrow);\n\n    function step(getNext) {\n        return val => {\n            var next = getNext(val),\n                value = next.value;\n\n            return next.done ? value :\n                (!value || typeof value.then !== 'function' ?\n                    Array.isArray(value) ? awaitAll(value, 0) : onSuccess(value) :\n                    value.then(onSuccess, onError));\n        }\n    }\n\n    function awaitAll (values, i) {\n        if (i === values.length) return onSuccess(values);\n        var value = values[i];\n        return value.constructor && typeof value.constructor.all == 'function' ?\n            value.constructor.all(values).then(onSuccess, onError) :\n            awaitAll (values, i + 1);\r\n    }\n\n    return step(callNext)();\n}\n\nDexie.addons.push(function (db) {\n    //\n    // Adjust db.transaction() to handle iterable functions as async without explicitely having to write async() around the transaction scope func:\n    //  db.transaction('rw', db.friends, async(function*(){})); - not needed.\n    //  db.transaction('rw', db.friends, function*(){}); // prettier.\n    //\n    db.transaction = Dexie.override(db.transaction, function (origDbTransaction) {\n        return function () {\n            var scopeFunc = arguments[arguments.length - 1];\n\n            function proxyScope() {\n                var rv = scopeFunc.apply(this, arguments);\n                if (!rv.next || !rv.throw) return rv; // Not an iterable\n                return iterate(rv);\n            }\n\n            proxyScope.toString = function () {\n                return scopeFunc.toString(); // Because original db.transaction may use fn.toString() when error occur.\n            }\n            arguments[arguments.length - 1] = proxyScope;\n            return origDbTransaction.apply(this, arguments);\n        }\n    });\n});\n"],"names":[],"mappings":";;;;;;;;IAGO,SAAS,KAAK,CAAC,WAAW,EAAE;QAC/B,OAAO,YAAY;YACf,OAAO,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;;;;IAInD,SAAS,KAAK,CAAC,WAAW,EAAE,WAAW,EAAE;QAC5C,OAAO,OAAO,CAAC,WAAW,EAAE,CAAC;;;IAG1B,SAAS,OAAO,EAAE,QAAQ,EAAE;QAC/B,IAAI,QAAQ,GAAG,MAAM,IAAI,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC;YAC1C,OAAO,GAAG,KAAK,IAAI,QAAQ,CAAC,KAAK,CAAC,KAAK,CAAC;YACxC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAC;YAC1B,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;;QAE3B,SAAS,IAAI,CAAC,OAAO,EAAE;YACnB,OAAO,GAAG,IAAI;gBACV,IAAI,IAAI,GAAG,OAAO,CAAC,GAAG,CAAC;oBACnB,KAAK,GAAG,IAAI,CAAC,KAAK;;gBAEtB,OAAO,IAAI,CAAC,IAAI,GAAG,KAAK;oBACpB,CAAC,CAAC,KAAK,IAAI,OAAO,KAAK,CAAC,IAAI,KAAK,UAAU;wBACvC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC,GAAG,SAAS,CAAC,KAAK,CAAC;wBAC5D,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;;;;QAI/C,SAAS,QAAQ,EAAE,MAAM,EAAE,CAAC,EAAE;YAC1B,IAAI,CAAC,KAAK,MAAM,CAAC,MAAM,EAAE,OAAO,SAAS,CAAC,MAAM,CAAC;YACjD,IAAI,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC;YACrB,OAAO,KAAK,CAAC,WAAW,IAAI,OAAO,KAAK,CAAC,WAAW,CAAC,GAAG,IAAI,UAAU;gBAClE,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC;gBACtD,QAAQ,EAAE,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;;;QAGjC,OAAO,IAAI,CAAC,QAAQ,CAAC,EAAE;;;IAG3B,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,EAAE,EAAE;;;;;;QAM5B,EAAE,CAAC,WAAW,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,WAAW,EAAE,UAAU,iBAAiB,EAAE;YACzE,OAAO,YAAY;gBACf,IAAI,SAAS,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;;gBAE/C,SAAS,UAAU,GAAG;oBAClB,IAAI,EAAE,GAAG,SAAS,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC;oBACzC,IAAI,CAAC,EAAE,CAAC,IAAI,IAAI,CAAC,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,CAAC;oBACrC,OAAO,OAAO,CAAC,EAAE,CAAC;;;gBAGtB,UAAU,CAAC,QAAQ,GAAG,YAAY;oBAC9B,OAAO,SAAS,CAAC,QAAQ,EAAE,CAAC;;gBAEhC,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,GAAG,UAAU;gBAC5C,OAAO,iBAAiB,CAAC,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC;;SAEtD,CAAC;KACL,CAAC,;;;;,;;"}