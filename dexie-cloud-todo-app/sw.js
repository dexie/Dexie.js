var Ec=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Md(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Vl={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Ec,function(){var n=function(s,a){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,p){u.__proto__=p}||function(u,p){for(var y in p)Object.prototype.hasOwnProperty.call(p,y)&&(u[y]=p[y])})(s,a)},r=function(){return(r=Object.assign||function(s){for(var a,u=1,p=arguments.length;u<p;u++)for(var y in a=arguments[u])Object.prototype.hasOwnProperty.call(a,y)&&(s[y]=a[y]);return s}).apply(this,arguments)};function i(s,a,u){for(var p,y=0,v=a.length;y<v;y++)!p&&y in a||((p=p||Array.prototype.slice.call(a,0,y))[y]=a[y]);return s.concat(p||Array.prototype.slice.call(a))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ec,c=Object.keys,l=Array.isArray;function f(s,a){return typeof a!="object"||c(a).forEach(function(u){s[u]=a[u]}),s}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var h=Object.getPrototypeOf,d={}.hasOwnProperty;function g(s,a){return d.call(s,a)}function m(s,a){typeof a=="function"&&(a=a(h(s))),(typeof Reflect>"u"?c:Reflect.ownKeys)(a).forEach(function(u){w(s,u,a[u])})}var b=Object.defineProperty;function w(s,a,u,p){b(s,a,f(u&&g(u,"get")&&typeof u.get=="function"?{get:u.get,set:u.set,configurable:!0}:{value:u,configurable:!0,writable:!0},p))}function E(s){return{from:function(a){return s.prototype=Object.create(a.prototype),w(s.prototype,"constructor",s),{extend:m.bind(null,s.prototype)}}}}var j=Object.getOwnPropertyDescriptor,F=[].slice;function B(s,a,u){return F.call(s,a,u)}function L(s,a){return a(s)}function G(s){if(!s)throw new Error("Assertion Failed")}function ne(s){o.setImmediate?setImmediate(s):setTimeout(s,0)}function Z(s,a){if(typeof a=="string"&&g(s,a))return s[a];if(!a)return s;if(typeof a!="string"){for(var u=[],p=0,y=a.length;p<y;++p){var v=Z(s,a[p]);u.push(v)}return u}var k=a.indexOf(".");if(k!==-1){var S=s[a.substr(0,k)];return S==null?void 0:Z(S,a.substr(k+1))}}function oe(s,a,u){if(s&&a!==void 0&&!("isFrozen"in Object&&Object.isFrozen(s)))if(typeof a!="string"&&"length"in a){G(typeof u!="string"&&"length"in u);for(var p=0,y=a.length;p<y;++p)oe(s,a[p],u[p])}else{var v,k,S=a.indexOf(".");S!==-1?(v=a.substr(0,S),(k=a.substr(S+1))===""?u===void 0?l(s)&&!isNaN(parseInt(v))?s.splice(v,1):delete s[v]:s[v]=u:oe(S=!(S=s[v])||!g(s,v)?s[v]={}:S,k,u)):u===void 0?l(s)&&!isNaN(parseInt(a))?s.splice(a,1):delete s[a]:s[a]=u}}function Re(s){var a,u={};for(a in s)g(s,a)&&(u[a]=s[a]);return u}var de=[].concat;function De(s){return de.apply([],s)}var xn="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(De([8,16,32,64].map(function(s){return["Int","Uint","Float"].map(function(a){return a+s+"Array"})}))).filter(function(s){return o[s]}),H=new Set(xn.map(function(s){return o[s]})),he=null;function me(s){return he=new WeakMap,s=function a(u){if(!u||typeof u!="object")return u;var p=he.get(u);if(p)return p;if(l(u)){p=[],he.set(u,p);for(var y=0,v=u.length;y<v;++y)p.push(a(u[y]))}else if(H.has(u.constructor))p=u;else{var k,S=h(u);for(k in p=S===Object.prototype?{}:Object.create(S),he.set(u,p),u)g(u,k)&&(p[k]=a(u[k]))}return p}(s),he=null,s}var we={}.toString;function ke(s){return we.call(s).slice(8,-1)}var z=typeof Symbol<"u"?Symbol.iterator:"@@iterator",re=typeof z=="symbol"?function(s){var a;return s!=null&&(a=s[z])&&a.apply(s)}:function(){return null};function ie(s,a){return a=s.indexOf(a),0<=a&&s.splice(a,1),0<=a}var ge={};function be(s){var a,u,p,y;if(arguments.length===1){if(l(s))return s.slice();if(this===ge&&typeof s=="string")return[s];if(y=re(s)){for(u=[];!(p=y.next()).done;)u.push(p.value);return u}if(s==null)return[s];if(typeof(a=s.length)!="number")return[s];for(u=new Array(a);a--;)u[a]=s[a];return u}for(a=arguments.length,u=new Array(a);a--;)u[a]=arguments[a];return u}var ue=typeof Symbol<"u"?function(s){return s[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},kr=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Et=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(kr),ae={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ae(s,a){this.name=s,this.message=a}function st(s,a){return s+". Errors: "+Object.keys(a).map(function(u){return a[u].toString()}).filter(function(u,p,y){return y.indexOf(u)===p}).join(`
`)}function Je(s,a,u,p){this.failures=a,this.failedKeys=p,this.successCount=u,this.message=st(s,a)}function Ke(s,a){this.name="BulkError",this.failures=Object.keys(a).map(function(u){return a[u]}),this.failuresByPos=a,this.message=st(s,this.failures)}E(Ae).from(Error).extend({toString:function(){return this.name+": "+this.message}}),E(Je).from(Ae),E(Ke).from(Ae);var ot=Et.reduce(function(s,a){return s[a]=a+"Error",s},{}),Ve=Ae,ee=Et.reduce(function(s,a){var u=a+"Error";function p(y,v){this.name=u,y?typeof y=="string"?(this.message="".concat(y).concat(v?`
 `+v:""),this.inner=v||null):typeof y=="object"&&(this.message="".concat(y.name," ").concat(y.message),this.inner=y):(this.message=ae[a]||u,this.inner=null)}return E(p).from(Ve),s[a]=p,s},{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var Le=kr.reduce(function(s,a){return s[a+"Error"]=ee[a],s},{}),qe=Et.reduce(function(s,a){return["Syntax","Type","Range"].indexOf(a)===-1&&(s[a+"Error"]=ee[a]),s},{});function ce(){}function _e(s){return s}function Ie(s,a){return s==null||s===_e?a:function(u){return a(s(u))}}function Pe(s,a){return function(){s.apply(this,arguments),a.apply(this,arguments)}}function mt(s,a){return s===ce?a:function(){var u=s.apply(this,arguments);u!==void 0&&(arguments[0]=u);var p=this.onsuccess,y=this.onerror;this.onsuccess=null,this.onerror=null;var v=a.apply(this,arguments);return p&&(this.onsuccess=this.onsuccess?Pe(p,this.onsuccess):p),y&&(this.onerror=this.onerror?Pe(y,this.onerror):y),v!==void 0?v:u}}function Sn(s,a){return s===ce?a:function(){s.apply(this,arguments);var u=this.onsuccess,p=this.onerror;this.onsuccess=this.onerror=null,a.apply(this,arguments),u&&(this.onsuccess=this.onsuccess?Pe(u,this.onsuccess):u),p&&(this.onerror=this.onerror?Pe(p,this.onerror):p)}}function Rt(s,a){return s===ce?a:function(u){var p=s.apply(this,arguments);f(u,p);var y=this.onsuccess,v=this.onerror;return this.onsuccess=null,this.onerror=null,u=a.apply(this,arguments),y&&(this.onsuccess=this.onsuccess?Pe(y,this.onsuccess):y),v&&(this.onerror=this.onerror?Pe(v,this.onerror):v),p===void 0?u===void 0?void 0:u:f(p,u)}}function dd(s,a){return s===ce?a:function(){return a.apply(this,arguments)!==!1&&s.apply(this,arguments)}}function Fs(s,a){return s===ce?a:function(){var u=s.apply(this,arguments);if(u&&typeof u.then=="function"){for(var p=this,y=arguments.length,v=new Array(y);y--;)v[y]=arguments[y];return u.then(function(){return a.apply(p,v)})}return a.apply(this,arguments)}}qe.ModifyError=Je,qe.DexieError=Ae,qe.BulkError=Ke;var Pt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Wa(s){Pt=s}var _r={},Ha=100,xn=typeof Promise>"u"?[]:function(){var s=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[s,h(s),s];var a=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[a,h(a),s]}(),kr=xn[0],Et=xn[1],xn=xn[2],Et=Et&&Et.then,En=kr&&kr.constructor,$s=!!xn,Sr=function(s,a){xr.push([s,a]),yi&&(queueMicrotask(pd),yi=!1)},qs=!0,yi=!0,Cn=[],gi=[],Vs=_e,sn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ce,pgp:!1,env:{},finalize:ce},se=sn,xr=[],In=0,mi=[];function X(s){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var a=this._PSD=se;if(typeof s!="function"){if(s!==_r)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Hs(this,this._value))}this._state=null,this._value=null,++a.ref,function u(p,y){try{y(function(v){if(p._state===null){if(v===p)throw new TypeError("A promise cannot be resolved with itself.");var k=p._lib&&$n();v&&typeof v.then=="function"?u(p,function(S,C){v instanceof X?v._then(S,C):v.then(S,C)}):(p._state=!0,p._value=v,Ya(p)),k&&qn()}},Hs.bind(null,p))}catch(v){Hs(p,v)}}(this,s)}var Ws={get:function(){var s=se,a=_i;function u(p,y){var v=this,k=!s.global&&(s!==se||a!==_i),S=k&&!an(),C=new X(function(O,D){zs(v,new za(Ja(p,s,k,S),Ja(y,s,k,S),O,D,s))});return this._consoleTask&&(C._consoleTask=this._consoleTask),C}return u.prototype=_r,u},set:function(s){w(this,"then",s&&s.prototype===_r?Ws:{get:function(){return s},set:Ws.set})}};function za(s,a,u,p,y){this.onFulfilled=typeof s=="function"?s:null,this.onRejected=typeof a=="function"?a:null,this.resolve=u,this.reject=p,this.psd=y}function Hs(s,a){var u,p;gi.push(a),s._state===null&&(u=s._lib&&$n(),a=Vs(a),s._state=!1,s._value=a,p=s,Cn.some(function(y){return y._value===p._value})||Cn.push(p),Ya(s),u&&qn())}function Ya(s){var a=s._listeners;s._listeners=[];for(var u=0,p=a.length;u<p;++u)zs(s,a[u]);var y=s._PSD;--y.ref||y.finalize(),In===0&&(++In,Sr(function(){--In==0&&Ys()},[]))}function zs(s,a){if(s._state!==null){var u=s._state?a.onFulfilled:a.onRejected;if(u===null)return(s._state?a.resolve:a.reject)(s._value);++a.psd.ref,++In,Sr(hd,[u,s,a])}else s._listeners.push(a)}function hd(s,a,u){try{var p,y=a._value;!a._state&&gi.length&&(gi=[]),p=Pt&&a._consoleTask?a._consoleTask.run(function(){return s(y)}):s(y),a._state||gi.indexOf(y)!==-1||function(v){for(var k=Cn.length;k;)if(Cn[--k]._value===v._value)return Cn.splice(k,1)}(a),u.resolve(p)}catch(v){u.reject(v)}finally{--In==0&&Ys(),--u.psd.ref||u.psd.finalize()}}function pd(){On(sn,function(){$n()&&qn()})}function $n(){var s=qs;return yi=qs=!1,s}function qn(){var s,a,u;do for(;0<xr.length;)for(s=xr,xr=[],u=s.length,a=0;a<u;++a){var p=s[a];p[0].apply(null,p[1])}while(0<xr.length);yi=qs=!0}function Ys(){var s=Cn;Cn=[],s.forEach(function(p){p._PSD.onunhandled.call(null,p._value,p)});for(var a=mi.slice(0),u=a.length;u;)a[--u]()}function vi(s){return new X(_r,!1,s)}function Me(s,a){var u=se;return function(){var p=$n(),y=se;try{return cn(u,!0),s.apply(this,arguments)}catch(v){a&&a(v)}finally{cn(y,!1),p&&qn()}}}m(X.prototype,{then:Ws,_then:function(s,a){zs(this,new za(null,null,s,a,se))},catch:function(s){if(arguments.length===1)return this.then(null,s);var a=s,u=arguments[1];return typeof a=="function"?this.then(null,function(p){return(p instanceof a?u:vi)(p)}):this.then(null,function(p){return(p&&p.name===a?u:vi)(p)})},finally:function(s){return this.then(function(a){return X.resolve(s()).then(function(){return a})},function(a){return X.resolve(s()).then(function(){return vi(a)})})},timeout:function(s,a){var u=this;return s<1/0?new X(function(p,y){var v=setTimeout(function(){return y(new ee.Timeout(a))},s);u.then(p,y).finally(clearTimeout.bind(null,v))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&w(X.prototype,Symbol.toStringTag,"Dexie.Promise"),sn.env=Ga(),m(X,{all:function(){var s=be.apply(null,arguments).map(ki);return new X(function(a,u){s.length===0&&a([]);var p=s.length;s.forEach(function(y,v){return X.resolve(y).then(function(k){s[v]=k,--p||a(s)},u)})})},resolve:function(s){return s instanceof X?s:s&&typeof s.then=="function"?new X(function(a,u){s.then(a,u)}):new X(_r,!0,s)},reject:vi,race:function(){var s=be.apply(null,arguments).map(ki);return new X(function(a,u){s.map(function(p){return X.resolve(p).then(a,u)})})},PSD:{get:function(){return se},set:function(s){return se=s}},totalEchoes:{get:function(){return _i}},newPSD:on,usePSD:On,scheduler:{get:function(){return Sr},set:function(s){Sr=s}},rejectionMapper:{get:function(){return Vs},set:function(s){Vs=s}},follow:function(s,a){return new X(function(u,p){return on(function(y,v){var k=se;k.unhandleds=[],k.onunhandled=v,k.finalize=Pe(function(){var S,C=this;S=function(){C.unhandleds.length===0?y():v(C.unhandleds[0])},mi.push(function O(){S(),mi.splice(mi.indexOf(O),1)}),++In,Sr(function(){--In==0&&Ys()},[])},k.finalize),s()},a,u,p)})}}),En&&(En.allSettled&&w(X,"allSettled",function(){var s=be.apply(null,arguments).map(ki);return new X(function(a){s.length===0&&a([]);var u=s.length,p=new Array(u);s.forEach(function(y,v){return X.resolve(y).then(function(k){return p[v]={status:"fulfilled",value:k}},function(k){return p[v]={status:"rejected",reason:k}}).then(function(){return--u||a(p)})})})}),En.any&&typeof AggregateError<"u"&&w(X,"any",function(){var s=be.apply(null,arguments).map(ki);return new X(function(a,u){s.length===0&&u(new AggregateError([]));var p=s.length,y=new Array(p);s.forEach(function(v,k){return X.resolve(v).then(function(S){return a(S)},function(S){y[k]=S,--p||u(new AggregateError(y))})})})}),En.withResolvers&&(X.withResolvers=En.withResolvers));var Xe={awaits:0,echoes:0,id:0},yd=0,bi=[],wi=0,_i=0,gd=0;function on(s,a,u,p){var y=se,v=Object.create(y);return v.parent=y,v.ref=0,v.global=!1,v.id=++gd,sn.env,v.env=$s?{Promise:X,PromiseProp:{value:X,configurable:!0,writable:!0},all:X.all,race:X.race,allSettled:X.allSettled,any:X.any,resolve:X.resolve,reject:X.reject}:{},a&&f(v,a),++y.ref,v.finalize=function(){--this.parent.ref||this.parent.finalize()},p=On(v,s,u,p),v.ref===0&&v.finalize(),p}function Vn(){return Xe.id||(Xe.id=++yd),++Xe.awaits,Xe.echoes+=Ha,Xe.id}function an(){return!!Xe.awaits&&(--Xe.awaits==0&&(Xe.id=0),Xe.echoes=Xe.awaits*Ha,!0)}function ki(s){return Xe.echoes&&s&&s.constructor===En?(Vn(),s.then(function(a){return an(),a},function(a){return an(),Fe(a)})):s}function md(){var s=bi[bi.length-1];bi.pop(),cn(s,!1)}function cn(s,a){var u,p=se;(a?!Xe.echoes||wi++&&s===se:!wi||--wi&&s===se)||queueMicrotask(a?(function(y){++_i,Xe.echoes&&--Xe.echoes!=0||(Xe.echoes=Xe.awaits=Xe.id=0),bi.push(se),cn(y,!0)}).bind(null,s):md),s!==se&&(se=s,p===sn&&(sn.env=Ga()),$s&&(u=sn.env.Promise,a=s.env,(p.global||s.global)&&(Object.defineProperty(o,"Promise",a.PromiseProp),u.all=a.all,u.race=a.race,u.resolve=a.resolve,u.reject=a.reject,a.allSettled&&(u.allSettled=a.allSettled),a.any&&(u.any=a.any))))}function Ga(){var s=o.Promise;return $s?{Promise:s,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:s.all,race:s.race,allSettled:s.allSettled,any:s.any,resolve:s.resolve,reject:s.reject}:{}}function On(s,a,u,p,y){var v=se;try{return cn(s,!0),a(u,p,y)}finally{cn(v,!1)}}function Ja(s,a,u,p){return typeof s!="function"?s:function(){var y=se;u&&Vn(),cn(a,!0);try{return s.apply(this,arguments)}finally{cn(y,!1),p&&queueMicrotask(an)}}}function Gs(s){Promise===En&&Xe.echoes===0?wi===0?s():enqueueNativeMicroTask(s):setTimeout(s,0)}(""+Et).indexOf("[native code]")===-1&&(Vn=an=ce);var Fe=X.reject,An="￿",Wt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Xa="String expected.",Wn=[],Si="__dbnames",Js="readonly",Xs="readwrite";function Dn(s,a){return s?a?function(){return s.apply(this,arguments)&&a.apply(this,arguments)}:s:a}var Qa={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function xi(s){return typeof s!="string"||/\./.test(s)?function(a){return a}:function(a){return a[s]===void 0&&s in a&&delete(a=me(a))[s],a}}function Za(){throw ee.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Se(s,a){try{var u=ec(s),p=ec(a);if(u!==p)return u==="Array"?1:p==="Array"?-1:u==="binary"?1:p==="binary"?-1:u==="string"?1:p==="string"?-1:u==="Date"?1:p!=="Date"?NaN:-1;switch(u){case"number":case"Date":case"string":return a<s?1:s<a?-1:0;case"binary":return function(y,v){for(var k=y.length,S=v.length,C=k<S?k:S,O=0;O<C;++O)if(y[O]!==v[O])return y[O]<v[O]?-1:1;return k===S?0:k<S?-1:1}(tc(s),tc(a));case"Array":return function(y,v){for(var k=y.length,S=v.length,C=k<S?k:S,O=0;O<C;++O){var D=Se(y[O],v[O]);if(D!==0)return D}return k===S?0:k<S?-1:1}(s,a)}}catch{}return NaN}function ec(s){var a=typeof s;return a!="object"?a:ArrayBuffer.isView(s)?"binary":(s=ke(s),s==="ArrayBuffer"?"binary":s)}function tc(s){return s instanceof Uint8Array?s:ArrayBuffer.isView(s)?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s)}function Ei(s,a,u){var p=s.schema.yProps;return p?(a&&0<u.numFailures&&(a=a.filter(function(y,v){return!u.failures[v]})),Promise.all(p.map(function(y){return y=y.updatesTable,a?s.db.table(y).where("k").anyOf(a).delete():s.db.table(y).clear()})).then(function(){return u})):u}var nc=(Ne.prototype._trans=function(s,a,u){var p=this._tx||se.trans,y=this.name,v=Pt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(s==="readonly"?"read":"write"," ").concat(this.name));function k(O,D,x){if(!x.schema[y])throw new ee.NotFound("Table "+y+" not part of transaction");return a(x.idbtrans,x)}var S=$n();try{var C=p&&p.db._novip===this.db._novip?p===se.trans?p._promise(s,k,u):on(function(){return p._promise(s,k,u)},{trans:p,transless:se.transless||se}):function O(D,x,P,I){if(D.idbdb&&(D._state.openComplete||se.letThrough||D._vip)){var A=D._createTransaction(x,P,D._dbSchema);try{A.create(),D._state.PR1398_maxLoop=3}catch(R){return R.name===ot.InvalidState&&D.isOpen()&&0<--D._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),D.close({disableAutoOpen:!1}),D.open().then(function(){return O(D,x,P,I)})):Fe(R)}return A._promise(x,function(R,T){return on(function(){return se.trans=A,I(R,T,A)})}).then(function(R){if(x==="readwrite")try{A.idbtrans.commit()}catch{}return x==="readonly"?R:A._completion.then(function(){return R})})}if(D._state.openComplete)return Fe(new ee.DatabaseClosed(D._state.dbOpenError));if(!D._state.isBeingOpened){if(!D._state.autoOpen)return Fe(new ee.DatabaseClosed);D.open().catch(ce)}return D._state.dbReadyPromise.then(function(){return O(D,x,P,I)})}(this.db,s,[this.name],k);return v&&(C._consoleTask=v,C=C.catch(function(O){return console.trace(O),Fe(O)})),C}finally{S&&qn()}},Ne.prototype.get=function(s,a){var u=this;return s&&s.constructor===Object?this.where(s).first(a):s==null?Fe(new ee.Type("Invalid argument to Table.get()")):this._trans("readonly",function(p){return u.core.get({trans:p,key:s}).then(function(y){return u.hook.reading.fire(y)})}).then(a)},Ne.prototype.where=function(s){if(typeof s=="string")return new this.db.WhereClause(this,s);if(l(s))return new this.db.WhereClause(this,"[".concat(s.join("+"),"]"));var a=c(s);if(a.length===1)return this.where(a[0]).equals(s[a[0]]);var u=this.schema.indexes.concat(this.schema.primKey).filter(function(S){if(S.compound&&a.every(function(O){return 0<=S.keyPath.indexOf(O)})){for(var C=0;C<a.length;++C)if(a.indexOf(S.keyPath[C])===-1)return!1;return!0}return!1}).sort(function(S,C){return S.keyPath.length-C.keyPath.length})[0];if(u&&this.db._maxKey!==An){var v=u.keyPath.slice(0,a.length);return this.where(v).equals(v.map(function(C){return s[C]}))}!u&&Pt&&console.warn("The query ".concat(JSON.stringify(s)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(a.join("+"),"]"));var p=this.schema.idxByName;function y(S,C){return Se(S,C)===0}var k=a.reduce(function(x,C){var O=x[0],D=x[1],x=p[C],P=s[C];return[O||x,O||!x?Dn(D,x&&x.multi?function(I){return I=Z(I,C),l(I)&&I.some(function(A){return y(P,A)})}:function(I){return y(P,Z(I,C))}):D]},[null,null]),v=k[0],k=k[1];return v?this.where(v.name).equals(s[v.keyPath]).filter(k):u?this.filter(k):this.where(a).equals("")},Ne.prototype.filter=function(s){return this.toCollection().and(s)},Ne.prototype.count=function(s){return this.toCollection().count(s)},Ne.prototype.offset=function(s){return this.toCollection().offset(s)},Ne.prototype.limit=function(s){return this.toCollection().limit(s)},Ne.prototype.each=function(s){return this.toCollection().each(s)},Ne.prototype.toArray=function(s){return this.toCollection().toArray(s)},Ne.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Ne.prototype.orderBy=function(s){return new this.db.Collection(new this.db.WhereClause(this,l(s)?"[".concat(s.join("+"),"]"):s))},Ne.prototype.reverse=function(){return this.toCollection().reverse()},Ne.prototype.mapToClass=function(s){var a,u=this.db,p=this.name;function y(){return a!==null&&a.apply(this,arguments)||this}(this.schema.mappedClass=s).prototype instanceof Za&&(function(C,O){if(typeof O!="function"&&O!==null)throw new TypeError("Class extends value "+String(O)+" is not a constructor or null");function D(){this.constructor=C}n(C,O),C.prototype=O===null?Object.create(O):(D.prototype=O.prototype,new D)}(y,a=s),Object.defineProperty(y.prototype,"db",{get:function(){return u},enumerable:!1,configurable:!0}),y.prototype.table=function(){return p},s=y);for(var v=new Set,k=s.prototype;k;k=h(k))Object.getOwnPropertyNames(k).forEach(function(C){return v.add(C)});function S(C){if(!C)return C;var O,D=Object.create(s.prototype);for(O in C)if(!v.has(O))try{D[O]=C[O]}catch{}return D}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=S,this.hook("reading",S),s},Ne.prototype.defineClass=function(){return this.mapToClass(function(s){f(this,s)})},Ne.prototype.add=function(s,a){var u=this,p=this.schema.primKey,y=p.auto,v=p.keyPath,k=s;return v&&y&&(k=xi(v)(s)),this._trans("readwrite",function(S){return u.core.mutate({trans:S,type:"add",keys:a!=null?[a]:null,values:[k]})}).then(function(S){return S.numFailures?X.reject(S.failures[0]):S.lastResult}).then(function(S){if(v)try{oe(s,v,S)}catch{}return S})},Ne.prototype.update=function(s,a){return typeof s!="object"||l(s)?this.where(":id").equals(s).modify(a):(s=Z(s,this.schema.primKey.keyPath),s===void 0?Fe(new ee.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(s).modify(a))},Ne.prototype.put=function(s,a){var u=this,p=this.schema.primKey,y=p.auto,v=p.keyPath,k=s;return v&&y&&(k=xi(v)(s)),this._trans("readwrite",function(S){return u.core.mutate({trans:S,type:"put",values:[k],keys:a!=null?[a]:null})}).then(function(S){return S.numFailures?X.reject(S.failures[0]):S.lastResult}).then(function(S){if(v)try{oe(s,v,S)}catch{}return S})},Ne.prototype.delete=function(s){var a=this;return this._trans("readwrite",function(u){return a.core.mutate({trans:u,type:"delete",keys:[s]}).then(function(p){return Ei(a,[s],p)}).then(function(p){return p.numFailures?X.reject(p.failures[0]):void 0})})},Ne.prototype.clear=function(){var s=this;return this._trans("readwrite",function(a){return s.core.mutate({trans:a,type:"deleteRange",range:Qa}).then(function(u){return Ei(s,null,u)})}).then(function(a){return a.numFailures?X.reject(a.failures[0]):void 0})},Ne.prototype.bulkGet=function(s){var a=this;return this._trans("readonly",function(u){return a.core.getMany({keys:s,trans:u}).then(function(p){return p.map(function(y){return a.hook.reading.fire(y)})})})},Ne.prototype.bulkAdd=function(s,a,u){var p=this,y=Array.isArray(a)?a:void 0,v=(u=u||(y?void 0:a))?u.allKeys:void 0;return this._trans("readwrite",function(k){var O=p.schema.primKey,S=O.auto,O=O.keyPath;if(O&&y)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(y&&y.length!==s.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var C=s.length,O=O&&S?s.map(xi(O)):s;return p.core.mutate({trans:k,type:"add",keys:y,values:O,wantResults:v}).then(function(A){var x=A.numFailures,P=A.results,I=A.lastResult,A=A.failures;if(x===0)return v?P:I;throw new Ke("".concat(p.name,".bulkAdd(): ").concat(x," of ").concat(C," operations failed"),A)})})},Ne.prototype.bulkPut=function(s,a,u){var p=this,y=Array.isArray(a)?a:void 0,v=(u=u||(y?void 0:a))?u.allKeys:void 0;return this._trans("readwrite",function(k){var O=p.schema.primKey,S=O.auto,O=O.keyPath;if(O&&y)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(y&&y.length!==s.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var C=s.length,O=O&&S?s.map(xi(O)):s;return p.core.mutate({trans:k,type:"put",keys:y,values:O,wantResults:v}).then(function(A){var x=A.numFailures,P=A.results,I=A.lastResult,A=A.failures;if(x===0)return v?P:I;throw new Ke("".concat(p.name,".bulkPut(): ").concat(x," of ").concat(C," operations failed"),A)})})},Ne.prototype.bulkUpdate=function(s){var a=this,u=this.core,p=s.map(function(k){return k.key}),y=s.map(function(k){return k.changes}),v=[];return this._trans("readwrite",function(k){return u.getMany({trans:k,keys:p,cache:"clone"}).then(function(S){var C=[],O=[];s.forEach(function(x,P){var I=x.key,A=x.changes,R=S[P];if(R){for(var T=0,U=Object.keys(A);T<U.length;T++){var N=U[T],M=A[N];if(N===a.schema.primKey.keyPath){if(Se(M,I)!==0)throw new ee.Constraint("Cannot update primary key in bulkUpdate()")}else oe(R,N,M)}v.push(P),C.push(I),O.push(R)}});var D=C.length;return u.mutate({trans:k,type:"put",keys:C,values:O,updates:{keys:p,changeSpecs:y}}).then(function(x){var P=x.numFailures,I=x.failures;if(P===0)return D;for(var A=0,R=Object.keys(I);A<R.length;A++){var T,U=R[A],N=v[Number(U)];N!=null&&(T=I[U],delete I[U],I[N]=T)}throw new Ke("".concat(a.name,".bulkUpdate(): ").concat(P," of ").concat(D," operations failed"),I)})})})},Ne.prototype.bulkDelete=function(s){var a=this,u=s.length;return this._trans("readwrite",function(p){return a.core.mutate({trans:p,type:"delete",keys:s}).then(function(y){return Ei(a,s,y)})}).then(function(k){var y=k.numFailures,v=k.lastResult,k=k.failures;if(y===0)return v;throw new Ke("".concat(a.name,".bulkDelete(): ").concat(y," of ").concat(u," operations failed"),k)})},Ne);function Ne(){}function Er(s){function a(k,S){if(S){for(var C=arguments.length,O=new Array(C-1);--C;)O[C-1]=arguments[C];return u[k].subscribe.apply(null,O),s}if(typeof k=="string")return u[k]}var u={};a.addEventType=v;for(var p=1,y=arguments.length;p<y;++p)v(arguments[p]);return a;function v(k,S,C){if(typeof k!="object"){var O;S=S||dd;var D={subscribers:[],fire:C=C||ce,subscribe:function(x){D.subscribers.indexOf(x)===-1&&(D.subscribers.push(x),D.fire=S(D.fire,x))},unsubscribe:function(x){D.subscribers=D.subscribers.filter(function(P){return P!==x}),D.fire=D.subscribers.reduce(S,C)}};return u[k]=a[k]=D}c(O=k).forEach(function(x){var P=O[x];if(l(P))v(x,O[x][0],O[x][1]);else{if(P!=="asap")throw new ee.InvalidArgument("Invalid event config");var I=v(x,_e,function(){for(var A=arguments.length,R=new Array(A);A--;)R[A]=arguments[A];I.subscribers.forEach(function(T){ne(function(){T.apply(null,R)})})})}})}}function Cr(s,a){return E(a).from({prototype:s}),a}function Hn(s,a){return!(s.filter||s.algorithm||s.or)&&(a?s.justLimit:!s.replayFilter)}function Qs(s,a){s.filter=Dn(s.filter,a)}function Zs(s,a,u){var p=s.replayFilter;s.replayFilter=p?function(){return Dn(p(),a())}:a,s.justLimit=u&&!p}function Ci(s,a){if(s.isPrimKey)return a.primaryKey;var u=a.getIndexByKeyPath(s.index);if(!u)throw new ee.Schema("KeyPath "+s.index+" on object store "+a.name+" is not indexed");return u}function rc(s,a,u){var p=Ci(s,a.schema);return a.openCursor({trans:u,values:!s.keysOnly,reverse:s.dir==="prev",unique:!!s.unique,query:{index:p,range:s.range}})}function Ii(s,a,u,p){var y=s.replayFilter?Dn(s.filter,s.replayFilter()):s.filter;if(s.or){var v={},k=function(S,C,O){var D,x;y&&!y(C,O,function(P){return C.stop(P)},function(P){return C.fail(P)})||((x=""+(D=C.primaryKey))=="[object ArrayBuffer]"&&(x=""+new Uint8Array(D)),g(v,x)||(v[x]=!0,a(S,C,O)))};return Promise.all([s.or._iterate(k,u),ic(rc(s,p,u),s.algorithm,k,!s.keysOnly&&s.valueMapper)])}return ic(rc(s,p,u),Dn(s.algorithm,y),a,!s.keysOnly&&s.valueMapper)}function ic(s,a,u,p){var y=Me(p?function(v,k,S){return u(p(v),k,S)}:u);return s.then(function(v){if(v)return v.start(function(){var k=function(){return v.continue()};a&&!a(v,function(S){return k=S},function(S){v.stop(S),k=ce},function(S){v.fail(S),k=ce})||y(v.value,v,function(S){return k=S}),k()})})}var Ir=(sc.prototype.execute=function(s){var a=this["@@propmod"];if(a.add!==void 0){var u=a.add;if(l(u))return i(i([],l(s)?s:[],!0),u).sort();if(typeof u=="number")return(Number(s)||0)+u;if(typeof u=="bigint")try{return BigInt(s)+u}catch{return BigInt(0)+u}throw new TypeError("Invalid term ".concat(u))}if(a.remove!==void 0){var p=a.remove;if(l(p))return l(s)?s.filter(function(y){return!p.includes(y)}).sort():[];if(typeof p=="number")return Number(s)-p;if(typeof p=="bigint")try{return BigInt(s)-p}catch{return BigInt(0)-p}throw new TypeError("Invalid subtrahend ".concat(p))}return u=(u=a.replacePrefix)===null||u===void 0?void 0:u[0],u&&typeof s=="string"&&s.startsWith(u)?a.replacePrefix[1]+s.substring(u.length):s},sc);function sc(s){this["@@propmod"]=s}var vd=(Oe.prototype._read=function(s,a){var u=this._ctx;return u.error?u.table._trans(null,Fe.bind(null,u.error)):u.table._trans("readonly",s).then(a)},Oe.prototype._write=function(s){var a=this._ctx;return a.error?a.table._trans(null,Fe.bind(null,a.error)):a.table._trans("readwrite",s,"locked")},Oe.prototype._addAlgorithm=function(s){var a=this._ctx;a.algorithm=Dn(a.algorithm,s)},Oe.prototype._iterate=function(s,a){return Ii(this._ctx,s,a,this._ctx.table.core)},Oe.prototype.clone=function(s){var a=Object.create(this.constructor.prototype),u=Object.create(this._ctx);return s&&f(u,s),a._ctx=u,a},Oe.prototype.raw=function(){return this._ctx.valueMapper=null,this},Oe.prototype.each=function(s){var a=this._ctx;return this._read(function(u){return Ii(a,s,u,a.table.core)})},Oe.prototype.count=function(s){var a=this;return this._read(function(u){var p=a._ctx,y=p.table.core;if(Hn(p,!0))return y.count({trans:u,query:{index:Ci(p,y.schema),range:p.range}}).then(function(k){return Math.min(k,p.limit)});var v=0;return Ii(p,function(){return++v,!1},u,y).then(function(){return v})}).then(s)},Oe.prototype.sortBy=function(s,a){var u=s.split(".").reverse(),p=u[0],y=u.length-1;function v(C,O){return O?v(C[u[O]],O-1):C[p]}var k=this._ctx.dir==="next"?1:-1;function S(C,O){return Se(v(C,y),v(O,y))*k}return this.toArray(function(C){return C.sort(S)}).then(a)},Oe.prototype.toArray=function(s){var a=this;return this._read(function(u){var p=a._ctx;if(p.dir==="next"&&Hn(p,!0)&&0<p.limit){var y=p.valueMapper,v=Ci(p,p.table.core.schema);return p.table.core.query({trans:u,limit:p.limit,values:!0,query:{index:v,range:p.range}}).then(function(S){return S=S.result,y?S.map(y):S})}var k=[];return Ii(p,function(S){return k.push(S)},u,p.table.core).then(function(){return k})},s)},Oe.prototype.offset=function(s){var a=this._ctx;return s<=0||(a.offset+=s,Hn(a)?Zs(a,function(){var u=s;return function(p,y){return u===0||(u===1?--u:y(function(){p.advance(u),u=0}),!1)}}):Zs(a,function(){var u=s;return function(){return--u<0}})),this},Oe.prototype.limit=function(s){return this._ctx.limit=Math.min(this._ctx.limit,s),Zs(this._ctx,function(){var a=s;return function(u,p,y){return--a<=0&&p(y),0<=a}},!0),this},Oe.prototype.until=function(s,a){return Qs(this._ctx,function(u,p,y){return!s(u.value)||(p(y),a)}),this},Oe.prototype.first=function(s){return this.limit(1).toArray(function(a){return a[0]}).then(s)},Oe.prototype.last=function(s){return this.reverse().first(s)},Oe.prototype.filter=function(s){var a;return Qs(this._ctx,function(u){return s(u.value)}),(a=this._ctx).isMatch=Dn(a.isMatch,s),this},Oe.prototype.and=function(s){return this.filter(s)},Oe.prototype.or=function(s){return new this.db.WhereClause(this._ctx.table,s,this)},Oe.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Oe.prototype.desc=function(){return this.reverse()},Oe.prototype.eachKey=function(s){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(u,p){s(p.key,p)})},Oe.prototype.eachUniqueKey=function(s){return this._ctx.unique="unique",this.eachKey(s)},Oe.prototype.eachPrimaryKey=function(s){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(u,p){s(p.primaryKey,p)})},Oe.prototype.keys=function(s){var a=this._ctx;a.keysOnly=!a.isMatch;var u=[];return this.each(function(p,y){u.push(y.key)}).then(function(){return u}).then(s)},Oe.prototype.primaryKeys=function(s){var a=this._ctx;if(a.dir==="next"&&Hn(a,!0)&&0<a.limit)return this._read(function(p){var y=Ci(a,a.table.core.schema);return a.table.core.query({trans:p,values:!1,limit:a.limit,query:{index:y,range:a.range}})}).then(function(p){return p.result}).then(s);a.keysOnly=!a.isMatch;var u=[];return this.each(function(p,y){u.push(y.primaryKey)}).then(function(){return u}).then(s)},Oe.prototype.uniqueKeys=function(s){return this._ctx.unique="unique",this.keys(s)},Oe.prototype.firstKey=function(s){return this.limit(1).keys(function(a){return a[0]}).then(s)},Oe.prototype.lastKey=function(s){return this.reverse().firstKey(s)},Oe.prototype.distinct=function(){var s=this._ctx,s=s.index&&s.table.schema.idxByName[s.index];if(!s||!s.multi)return this;var a={};return Qs(this._ctx,function(y){var p=y.primaryKey.toString(),y=g(a,p);return a[p]=!0,!y}),this},Oe.prototype.modify=function(s){var a=this,u=this._ctx;return this._write(function(p){var y,v,k;k=typeof s=="function"?s:(y=c(s),v=y.length,function(U){for(var N=!1,M=0;M<v;++M){var K=y[M],$=s[K],W=Z(U,K);$ instanceof Ir?(oe(U,K,$.execute(W)),N=!0):W!==$&&(oe(U,K,$),N=!0)}return N});var S=u.table.core,x=S.schema.primaryKey,C=x.outbound,O=x.extractKey,D=200,x=a.db._options.modifyChunkSize;x&&(D=typeof x=="object"?x[S.name]||x["*"]||200:x);function P(U,K){var M=K.failures,K=K.numFailures;A+=U-K;for(var $=0,W=c(M);$<W.length;$++){var q=W[$];I.push(M[q])}}var I=[],A=0,R=[],T=s===oc;return a.clone().primaryKeys().then(function(U){function N(K){var $=Math.min(D,U.length-K),W=U.slice(K,K+$);return(T?Promise.resolve([]):S.getMany({trans:p,keys:W,cache:"immutable"})).then(function(q){var V=[],J=[],Y=C?[]:null,Q=T?W:[];if(!T)for(var pe=0;pe<$;++pe){var xe=q[pe],fe={value:me(xe),primKey:U[K+pe]};k.call(fe,fe.value,fe)!==!1&&(fe.value==null?Q.push(U[K+pe]):C||Se(O(xe),O(fe.value))===0?(J.push(fe.value),C&&Y.push(U[K+pe])):(Q.push(U[K+pe]),V.push(fe.value)))}return Promise.resolve(0<V.length&&S.mutate({trans:p,type:"add",values:V}).then(function(Be){for(var le in Be.failures)Q.splice(parseInt(le),1);P(V.length,Be)})).then(function(){return(0<J.length||M&&typeof s=="object")&&S.mutate({trans:p,type:"put",keys:Y,values:J,criteria:M,changeSpec:typeof s!="function"&&s,isAdditionalChunk:0<K}).then(function(Be){return P(J.length,Be)})}).then(function(){return(0<Q.length||M&&T)&&S.mutate({trans:p,type:"delete",keys:Q,criteria:M,isAdditionalChunk:0<K}).then(function(Be){return Ei(u.table,Q,Be)}).then(function(Be){return P(Q.length,Be)})}).then(function(){return U.length>K+$&&N(K+D)})})}var M=Hn(u)&&u.limit===1/0&&(typeof s!="function"||T)&&{index:u.index,range:u.range};return N(0).then(function(){if(0<I.length)throw new Je("Error modifying one or more objects",I,A,R);return U.length})})})},Oe.prototype.delete=function(){var s=this._ctx,a=s.range;return!Hn(s)||s.table.schema.yProps||!s.isPrimKey&&a.type!==3?this.modify(oc):this._write(function(u){var p=s.table.core.schema.primaryKey,y=a;return s.table.core.count({trans:u,query:{index:p,range:y}}).then(function(v){return s.table.core.mutate({trans:u,type:"deleteRange",range:y}).then(function(C){var S=C.failures,C=C.numFailures;if(C)throw new Je("Could not delete some values",Object.keys(S).map(function(O){return S[O]}),v-C);return v-C})})})},Oe);function Oe(){}var oc=function(s,a){return a.value=null};function bd(s,a){return s<a?-1:s===a?0:1}function wd(s,a){return a<s?-1:s===a?0:1}function vt(s,a,u){return s=s instanceof cc?new s.Collection(s):s,s._ctx.error=new(u||TypeError)(a),s}function zn(s){return new s.Collection(s,function(){return ac("")}).limit(0)}function Oi(s,a,u,p){var y,v,k,S,C,O,D,x=u.length;if(!u.every(function(A){return typeof A=="string"}))return vt(s,Xa);function P(A){y=A==="next"?function(T){return T.toUpperCase()}:function(T){return T.toLowerCase()},v=A==="next"?function(T){return T.toLowerCase()}:function(T){return T.toUpperCase()},k=A==="next"?bd:wd;var R=u.map(function(T){return{lower:v(T),upper:y(T)}}).sort(function(T,U){return k(T.lower,U.lower)});S=R.map(function(T){return T.upper}),C=R.map(function(T){return T.lower}),D=(O=A)==="next"?"":p}P("next"),s=new s.Collection(s,function(){return ln(S[0],C[x-1]+p)}),s._ondirectionchange=function(A){P(A)};var I=0;return s._addAlgorithm(function(A,R,T){var U=A.key;if(typeof U!="string")return!1;var N=v(U);if(a(N,C,I))return!0;for(var M=null,K=I;K<x;++K){var $=function(W,q,V,J,Y,Q){for(var pe=Math.min(W.length,J.length),xe=-1,fe=0;fe<pe;++fe){var Be=q[fe];if(Be!==J[fe])return Y(W[fe],V[fe])<0?W.substr(0,fe)+V[fe]+V.substr(fe+1):Y(W[fe],J[fe])<0?W.substr(0,fe)+J[fe]+V.substr(fe+1):0<=xe?W.substr(0,xe)+q[xe]+V.substr(xe+1):null;Y(W[fe],Be)<0&&(xe=fe)}return pe<J.length&&Q==="next"?W+V.substr(W.length):pe<W.length&&Q==="prev"?W.substr(0,V.length):xe<0?null:W.substr(0,xe)+J[xe]+V.substr(xe+1)}(U,N,S[K],C[K],k,O);$===null&&M===null?I=K+1:(M===null||0<k(M,$))&&(M=$)}return R(M!==null?function(){A.continue(M+D)}:T),!1}),s}function ln(s,a,u,p){return{type:2,lower:s,upper:a,lowerOpen:u,upperOpen:p}}function ac(s){return{type:1,lower:s,upper:s}}var cc=(Object.defineProperty(Qe.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Qe.prototype.between=function(s,a,u,p){u=u!==!1,p=p===!0;try{return 0<this._cmp(s,a)||this._cmp(s,a)===0&&(u||p)&&(!u||!p)?zn(this):new this.Collection(this,function(){return ln(s,a,!u,!p)})}catch{return vt(this,Wt)}},Qe.prototype.equals=function(s){return s==null?vt(this,Wt):new this.Collection(this,function(){return ac(s)})},Qe.prototype.above=function(s){return s==null?vt(this,Wt):new this.Collection(this,function(){return ln(s,void 0,!0)})},Qe.prototype.aboveOrEqual=function(s){return s==null?vt(this,Wt):new this.Collection(this,function(){return ln(s,void 0,!1)})},Qe.prototype.below=function(s){return s==null?vt(this,Wt):new this.Collection(this,function(){return ln(void 0,s,!1,!0)})},Qe.prototype.belowOrEqual=function(s){return s==null?vt(this,Wt):new this.Collection(this,function(){return ln(void 0,s)})},Qe.prototype.startsWith=function(s){return typeof s!="string"?vt(this,Xa):this.between(s,s+An,!0,!0)},Qe.prototype.startsWithIgnoreCase=function(s){return s===""?this.startsWith(s):Oi(this,function(a,u){return a.indexOf(u[0])===0},[s],An)},Qe.prototype.equalsIgnoreCase=function(s){return Oi(this,function(a,u){return a===u[0]},[s],"")},Qe.prototype.anyOfIgnoreCase=function(){var s=be.apply(ge,arguments);return s.length===0?zn(this):Oi(this,function(a,u){return u.indexOf(a)!==-1},s,"")},Qe.prototype.startsWithAnyOfIgnoreCase=function(){var s=be.apply(ge,arguments);return s.length===0?zn(this):Oi(this,function(a,u){return u.some(function(p){return a.indexOf(p)===0})},s,An)},Qe.prototype.anyOf=function(){var s=this,a=be.apply(ge,arguments),u=this._cmp;try{a.sort(u)}catch{return vt(this,Wt)}if(a.length===0)return zn(this);var p=new this.Collection(this,function(){return ln(a[0],a[a.length-1])});p._ondirectionchange=function(v){u=v==="next"?s._ascending:s._descending,a.sort(u)};var y=0;return p._addAlgorithm(function(v,k,S){for(var C=v.key;0<u(C,a[y]);)if(++y===a.length)return k(S),!1;return u(C,a[y])===0||(k(function(){v.continue(a[y])}),!1)}),p},Qe.prototype.notEqual=function(s){return this.inAnyRange([[-1/0,s],[s,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Qe.prototype.noneOf=function(){var s=be.apply(ge,arguments);if(s.length===0)return new this.Collection(this);try{s.sort(this._ascending)}catch{return vt(this,Wt)}var a=s.reduce(function(u,p){return u?u.concat([[u[u.length-1][1],p]]):[[-1/0,p]]},null);return a.push([s[s.length-1],this.db._maxKey]),this.inAnyRange(a,{includeLowers:!1,includeUppers:!1})},Qe.prototype.inAnyRange=function(U,a){var u=this,p=this._cmp,y=this._ascending,v=this._descending,k=this._min,S=this._max;if(U.length===0)return zn(this);if(!U.every(function(N){return N[0]!==void 0&&N[1]!==void 0&&y(N[0],N[1])<=0}))return vt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);var C=!a||a.includeLowers!==!1,O=a&&a.includeUppers===!0,D,x=y;function P(N,M){return x(N[0],M[0])}try{(D=U.reduce(function(N,M){for(var K=0,$=N.length;K<$;++K){var W=N[K];if(p(M[0],W[1])<0&&0<p(M[1],W[0])){W[0]=k(W[0],M[0]),W[1]=S(W[1],M[1]);break}}return K===$&&N.push(M),N},[])).sort(P)}catch{return vt(this,Wt)}var I=0,A=O?function(N){return 0<y(N,D[I][1])}:function(N){return 0<=y(N,D[I][1])},R=C?function(N){return 0<v(N,D[I][0])}:function(N){return 0<=v(N,D[I][0])},T=A,U=new this.Collection(this,function(){return ln(D[0][0],D[D.length-1][1],!C,!O)});return U._ondirectionchange=function(N){x=N==="next"?(T=A,y):(T=R,v),D.sort(P)},U._addAlgorithm(function(N,M,K){for(var $,W=N.key;T(W);)if(++I===D.length)return M(K),!1;return!A($=W)&&!R($)||(u._cmp(W,D[I][1])===0||u._cmp(W,D[I][0])===0||M(function(){x===y?N.continue(D[I][0]):N.continue(D[I][1])}),!1)}),U},Qe.prototype.startsWithAnyOf=function(){var s=be.apply(ge,arguments);return s.every(function(a){return typeof a=="string"})?s.length===0?zn(this):this.inAnyRange(s.map(function(a){return[a,a+An]})):vt(this,"startsWithAnyOf() only works with strings")},Qe);function Qe(){}function Ut(s){return Me(function(a){return Or(a),s(a.target.error),!1})}function Or(s){s.stopPropagation&&s.stopPropagation(),s.preventDefault&&s.preventDefault()}var Ar="storagemutated",eo="x-storagemutated-1",un=Er(null,Ar),_d=(jt.prototype._lock=function(){return G(!se.global),++this._reculock,this._reculock!==1||se.global||(se.lockOwnerFor=this),this},jt.prototype._unlock=function(){if(G(!se.global),--this._reculock==0)for(se.global||(se.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var s=this._blockedFuncs.shift();try{On(s[1],s[0])}catch{}}return this},jt.prototype._locked=function(){return this._reculock&&se.lockOwnerFor!==this},jt.prototype.create=function(s){var a=this;if(!this.mode)return this;var u=this.db.idbdb,p=this.db._state.dbOpenError;if(G(!this.idbtrans),!s&&!u)switch(p&&p.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(p);case"MissingAPIError":throw new ee.MissingAPI(p.message,p);default:throw new ee.OpenFailed(p)}if(!this.active)throw new ee.TransactionInactive;return G(this._completion._state===null),(s=this.idbtrans=s||(this.db.core||u).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Me(function(y){Or(y),a._reject(s.error)}),s.onabort=Me(function(y){Or(y),a.active&&a._reject(new ee.Abort(s.error)),a.active=!1,a.on("abort").fire(y)}),s.oncomplete=Me(function(){a.active=!1,a._resolve(),"mutatedParts"in s&&un.storagemutated.fire(s.mutatedParts)}),this},jt.prototype._promise=function(s,a,u){var p=this;if(s==="readwrite"&&this.mode!=="readwrite")return Fe(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return Fe(new ee.TransactionInactive);if(this._locked())return new X(function(v,k){p._blockedFuncs.push([function(){p._promise(s,a,u).then(v,k)},se])});if(u)return on(function(){var v=new X(function(k,S){p._lock();var C=a(k,S,p);C&&C.then&&C.then(k,S)});return v.finally(function(){return p._unlock()}),v._lib=!0,v});var y=new X(function(v,k){var S=a(v,k,p);S&&S.then&&S.then(v,k)});return y._lib=!0,y},jt.prototype._root=function(){return this.parent?this.parent._root():this},jt.prototype.waitFor=function(s){var a,u=this._root(),p=X.resolve(s);u._waitingFor?u._waitingFor=u._waitingFor.then(function(){return p}):(u._waitingFor=p,u._waitingQueue=[],a=u.idbtrans.objectStore(u.storeNames[0]),function v(){for(++u._spinCount;u._waitingQueue.length;)u._waitingQueue.shift()();u._waitingFor&&(a.get(-1/0).onsuccess=v)}());var y=u._waitingFor;return new X(function(v,k){p.then(function(S){return u._waitingQueue.push(Me(v.bind(null,S)))},function(S){return u._waitingQueue.push(Me(k.bind(null,S)))}).finally(function(){u._waitingFor===y&&(u._waitingFor=null)})})},jt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))},jt.prototype.table=function(s){var a=this._memoizedTables||(this._memoizedTables={});if(g(a,s))return a[s];var u=this.schema[s];if(!u)throw new ee.NotFound("Table "+s+" not part of transaction");return u=new this.db.Table(s,u,this),u.core=this.db.core.table(s),a[s]=u},jt);function jt(){}function to(s,a,u,p,y,v,k,S){return{name:s,keyPath:a,unique:u,multi:p,auto:y,compound:v,src:(u&&!k?"&":"")+(p?"*":"")+(y?"++":"")+lc(a),type:S}}function lc(s){return typeof s=="string"?s:s?"["+[].join.call(s,"+")+"]":""}function no(s,a,u){return{name:s,primKey:a,indexes:u,mappedClass:null,idxByName:(p=function(y){return[y.name,y]},u.reduce(function(y,v,k){return k=p(v,k),k&&(y[k[0]]=k[1]),y},{}))};var p}var Dr=function(s){try{return s.only([[]]),Dr=function(){return[[]]},[[]]}catch{return Dr=function(){return An},An}};function ro(s){return s==null?function(){}:typeof s=="string"?(a=s).split(".").length===1?function(u){return u[a]}:function(u){return Z(u,a)}:function(u){return Z(u,s)};var a}function uc(s){return[].slice.call(s)}var kd=0;function Tr(s){return s==null?":id":typeof s=="string"?s:"[".concat(s.join("+"),"]")}function Sd(s,a,C){function p(T){if(T.type===3)return null;if(T.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var I=T.lower,A=T.upper,R=T.lowerOpen,T=T.upperOpen;return I===void 0?A===void 0?null:a.upperBound(A,!!T):A===void 0?a.lowerBound(I,!!R):a.bound(I,A,!!R,!!T)}function y(P){var I,A=P.name;return{name:A,schema:P,mutate:function(R){var T=R.trans,U=R.type,N=R.keys,M=R.values,K=R.range;return new Promise(function($,W){$=Me($);var q=T.objectStore(A),V=q.keyPath==null,J=U==="put"||U==="add";if(!J&&U!=="delete"&&U!=="deleteRange")throw new Error("Invalid operation type: "+U);var Y,Q=(N||M||{length:1}).length;if(N&&M&&N.length!==M.length)throw new Error("Given keys array must have same length as given values array.");if(Q===0)return $({numFailures:0,failures:{},results:[],lastResult:void 0});function pe(ht){++Be,Or(ht)}var xe=[],fe=[],Be=0;if(U==="deleteRange"){if(K.type===4)return $({numFailures:Be,failures:fe,results:[],lastResult:void 0});K.type===3?xe.push(Y=q.clear()):xe.push(Y=q.delete(p(K)))}else{var V=J?V?[M,N]:[M,null]:[N,null],le=V[0],ct=V[1];if(J)for(var lt=0;lt<Q;++lt)xe.push(Y=ct&&ct[lt]!==void 0?q[U](le[lt],ct[lt]):q[U](le[lt])),Y.onerror=pe;else for(lt=0;lt<Q;++lt)xe.push(Y=q[U](le[lt])),Y.onerror=pe}function Bi(ht){ht=ht.target.result,xe.forEach(function(Pn,ko){return Pn.error!=null&&(fe[ko]=Pn.error)}),$({numFailures:Be,failures:fe,results:U==="delete"?N:xe.map(function(Pn){return Pn.result}),lastResult:ht})}Y.onerror=function(ht){pe(ht),Bi(ht)},Y.onsuccess=Bi})},getMany:function(R){var T=R.trans,U=R.keys;return new Promise(function(N,M){N=Me(N);for(var K,$=T.objectStore(A),W=U.length,q=new Array(W),V=0,J=0,Y=function(xe){xe=xe.target,q[xe._pos]=xe.result,++J===V&&N(q)},Q=Ut(M),pe=0;pe<W;++pe)U[pe]!=null&&((K=$.get(U[pe]))._pos=pe,K.onsuccess=Y,K.onerror=Q,++V);V===0&&N(q)})},get:function(R){var T=R.trans,U=R.key;return new Promise(function(N,M){N=Me(N);var K=T.objectStore(A).get(U);K.onsuccess=function($){return N($.target.result)},K.onerror=Ut(M)})},query:(I=O,function(R){return new Promise(function(T,U){T=Me(T);var N,M,K,V=R.trans,$=R.values,W=R.limit,Y=R.query,q=W===1/0?void 0:W,J=Y.index,Y=Y.range,V=V.objectStore(A),J=J.isPrimaryKey?V:V.index(J.name),Y=p(Y);if(W===0)return T({result:[]});I?((q=$?J.getAll(Y,q):J.getAllKeys(Y,q)).onsuccess=function(Q){return T({result:Q.target.result})},q.onerror=Ut(U)):(N=0,M=!$&&"openKeyCursor"in J?J.openKeyCursor(Y):J.openCursor(Y),K=[],M.onsuccess=function(Q){var pe=M.result;return pe?(K.push($?pe.value:pe.primaryKey),++N===W?T({result:K}):void pe.continue()):T({result:K})},M.onerror=Ut(U))})}),openCursor:function(R){var T=R.trans,U=R.values,N=R.query,M=R.reverse,K=R.unique;return new Promise(function($,W){$=Me($);var J=N.index,q=N.range,V=T.objectStore(A),V=J.isPrimaryKey?V:V.index(J.name),J=M?K?"prevunique":"prev":K?"nextunique":"next",Y=!U&&"openKeyCursor"in V?V.openKeyCursor(p(q),J):V.openCursor(p(q),J);Y.onerror=Ut(W),Y.onsuccess=Me(function(Q){var pe,xe,fe,Be,le=Y.result;le?(le.___id=++kd,le.done=!1,pe=le.continue.bind(le),xe=(xe=le.continuePrimaryKey)&&xe.bind(le),fe=le.advance.bind(le),Be=function(){throw new Error("Cursor not stopped")},le.trans=T,le.stop=le.continue=le.continuePrimaryKey=le.advance=function(){throw new Error("Cursor not started")},le.fail=Me(W),le.next=function(){var ct=this,lt=1;return this.start(function(){return lt--?ct.continue():ct.stop()}).then(function(){return ct})},le.start=function(ct){function lt(){if(Y.result)try{ct()}catch(ht){le.fail(ht)}else le.done=!0,le.start=function(){throw new Error("Cursor behind last entry")},le.stop()}var Bi=new Promise(function(ht,Pn){ht=Me(ht),Y.onerror=Ut(Pn),le.fail=Pn,le.stop=function(ko){le.stop=le.continue=le.continuePrimaryKey=le.advance=Be,ht(ko)}});return Y.onsuccess=Me(function(ht){Y.onsuccess=lt,lt()}),le.continue=pe,le.continuePrimaryKey=xe,le.advance=fe,lt(),Bi},$(le)):$(null)},W)})},count:function(R){var T=R.query,U=R.trans,N=T.index,M=T.range;return new Promise(function(K,$){var W=U.objectStore(A),q=N.isPrimaryKey?W:W.index(N.name),W=p(M),q=W?q.count(W):q.count();q.onsuccess=Me(function(V){return K(V.target.result)}),q.onerror=Ut($)})}}}var v,k,S,D=(k=C,S=uc((v=s).objectStoreNames),{schema:{name:v.name,tables:S.map(function(P){return k.objectStore(P)}).map(function(P){var I=P.keyPath,T=P.autoIncrement,A=l(I),R={},T={name:P.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:I==null,compound:A,keyPath:I,autoIncrement:T,unique:!0,extractKey:ro(I)},indexes:uc(P.indexNames).map(function(U){return P.index(U)}).map(function(K){var N=K.name,M=K.unique,$=K.multiEntry,K=K.keyPath,$={name:N,compound:l(K),keyPath:K,unique:M,multiEntry:$,extractKey:ro(K)};return R[Tr(K)]=$}),getIndexByKeyPath:function(U){return R[Tr(U)]}};return R[":id"]=T.primaryKey,I!=null&&(R[Tr(I)]=T.primaryKey),T})},hasGetAll:0<S.length&&"getAll"in k.objectStore(S[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),C=D.schema,O=D.hasGetAll,D=C.tables.map(y),x={};return D.forEach(function(P){return x[P.name]=P}),{stack:"dbcore",transaction:s.transaction.bind(s),table:function(P){if(!x[P])throw new Error("Table '".concat(P,"' not found"));return x[P]},MIN_KEY:-1/0,MAX_KEY:Dr(a),schema:C}}function xd(s,a,u,p){var y=u.IDBKeyRange;return u.indexedDB,{dbcore:(p=Sd(a,y,p),s.dbcore.reduce(function(v,k){return k=k.create,r(r({},v),k(v))},p))}}function Ai(s,p){var u=p.db,p=xd(s._middlewares,u,s._deps,p);s.core=p.dbcore,s.tables.forEach(function(y){var v=y.name;s.core.schema.tables.some(function(k){return k.name===v})&&(y.core=s.core.table(v),s[v]instanceof s.Table&&(s[v].core=y.core))})}function Di(s,a,u,p){u.forEach(function(y){var v=p[y];a.forEach(function(k){var S=function C(O,D){return j(O,D)||(O=h(O))&&C(O,D)}(k,y);(!S||"value"in S&&S.value===void 0)&&(k===s.Transaction.prototype||k instanceof s.Transaction?w(k,y,{get:function(){return this.table(y)},set:function(C){b(this,y,{value:C,writable:!0,configurable:!0,enumerable:!0})}}):k[y]=new s.Table(y,v))})})}function io(s,a){a.forEach(function(u){for(var p in u)u[p]instanceof s.Table&&delete u[p]})}function Ed(s,a){return s._cfg.version-a._cfg.version}function Cd(s,a,u,p){var y=s._dbSchema;u.objectStoreNames.contains("$meta")&&!y.$meta&&(y.$meta=no("$meta",dc("")[0],[]),s._storeNames.push("$meta"));var v=s._createTransaction("readwrite",s._storeNames,y);v.create(u),v._completion.catch(p);var k=v._reject.bind(v),S=se.transless||se;on(function(){return se.trans=v,se.transless=S,a!==0?(Ai(s,u),O=a,((C=v).storeNames.includes("$meta")?C.table("$meta").get("version").then(function(D){return D??O}):X.resolve(O)).then(function(D){return P=D,I=v,A=u,R=[],D=(x=s)._versions,T=x._dbSchema=Ri(0,x.idbdb,A),(D=D.filter(function(U){return U._cfg.version>=P})).length!==0?(D.forEach(function(U){R.push(function(){var N=T,M=U._cfg.dbschema;Pi(x,N,A),Pi(x,M,A),T=x._dbSchema=M;var K=so(N,M);K.add.forEach(function(J){oo(A,J[0],J[1].primKey,J[1].indexes)}),K.change.forEach(function(J){if(J.recreate)throw new ee.Upgrade("Not yet support for changing primary key");var Y=A.objectStore(J.name);J.add.forEach(function(Q){return Ti(Y,Q)}),J.change.forEach(function(Q){Y.deleteIndex(Q.name),Ti(Y,Q)}),J.del.forEach(function(Q){return Y.deleteIndex(Q)})});var $=U._cfg.contentUpgrade;if($&&U._cfg.version>P){Ai(x,A),I._memoizedTables={};var W=Re(M);K.del.forEach(function(J){W[J]=N[J]}),io(x,[x.Transaction.prototype]),Di(x,[x.Transaction.prototype],c(W),W),I.schema=W;var q,V=ue($);return V&&Vn(),K=X.follow(function(){var J;(q=$(I))&&V&&(J=an.bind(null,null),q.then(J,J))}),q&&typeof q.then=="function"?X.resolve(q):K.then(function(){return q})}}),R.push(function(N){var M,K,$=U._cfg.dbschema;M=$,K=N,[].slice.call(K.db.objectStoreNames).forEach(function(W){return M[W]==null&&K.db.deleteObjectStore(W)}),io(x,[x.Transaction.prototype]),Di(x,[x.Transaction.prototype],x._storeNames,x._dbSchema),I.schema=x._dbSchema}),R.push(function(N){x.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(x.idbdb.version/10)===U._cfg.version?(x.idbdb.deleteObjectStore("$meta"),delete x._dbSchema.$meta,x._storeNames=x._storeNames.filter(function(M){return M!=="$meta"})):N.objectStore("$meta").put(U._cfg.version,"version"))})}),function U(){return R.length?X.resolve(R.shift()(I.idbtrans)).then(U):X.resolve()}().then(function(){fc(T,A)})):X.resolve();var x,P,I,A,R,T}).catch(k)):(c(y).forEach(function(D){oo(u,D,y[D].primKey,y[D].indexes)}),Ai(s,u),void X.follow(function(){return s.on.populate.fire(v)}).catch(k));var C,O})}function Id(s,a){fc(s._dbSchema,a),a.db.version%10!=0||a.objectStoreNames.contains("$meta")||a.db.createObjectStore("$meta").add(Math.ceil(a.db.version/10-1),"version");var u=Ri(0,s.idbdb,a);Pi(s,s._dbSchema,a);for(var p=0,y=so(u,s._dbSchema).change;p<y.length;p++){var v=function(k){if(k.change.length||k.recreate)return console.warn("Unable to patch indexes of table ".concat(k.name," because it has changes on the type of index or primary key.")),{value:void 0};var S=a.objectStore(k.name);k.add.forEach(function(C){Pt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(k.name,".").concat(C.src)),Ti(S,C)})}(y[p]);if(typeof v=="object")return v.value}}function so(s,a){var u,p={del:[],add:[],change:[]};for(u in s)a[u]||p.del.push(u);for(u in a){var y=s[u],v=a[u];if(y){var k={name:u,def:v,recreate:!1,del:[],add:[],change:[]};if(""+(y.primKey.keyPath||"")!=""+(v.primKey.keyPath||"")||y.primKey.auto!==v.primKey.auto)k.recreate=!0,p.change.push(k);else{var S=y.idxByName,C=v.idxByName,O=void 0;for(O in S)C[O]||k.del.push(O);for(O in C){var D=S[O],x=C[O];D?D.src!==x.src&&k.change.push(x):k.add.push(x)}(0<k.del.length||0<k.add.length||0<k.change.length)&&p.change.push(k)}}else p.add.push([u,v])}return p}function oo(s,a,u,p){var y=s.db.createObjectStore(a,u.keyPath?{keyPath:u.keyPath,autoIncrement:u.auto}:{autoIncrement:u.auto});return p.forEach(function(v){return Ti(y,v)}),y}function fc(s,a){c(s).forEach(function(u){a.db.objectStoreNames.contains(u)||(Pt&&console.debug("Dexie: Creating missing table",u),oo(a,u,s[u].primKey,s[u].indexes))})}function Ti(s,a){s.createIndex(a.name,a.keyPath,{unique:a.unique,multiEntry:a.multi})}function Ri(s,a,u){var p={};return B(a.objectStoreNames,0).forEach(function(y){for(var v=u.objectStore(y),k=to(lc(O=v.keyPath),O||"",!0,!1,!!v.autoIncrement,O&&typeof O!="string",!0),S=[],C=0;C<v.indexNames.length;++C){var D=v.index(v.indexNames[C]),O=D.keyPath,D=to(D.name,O,!!D.unique,!!D.multiEntry,!1,O&&typeof O!="string",!1);S.push(D)}p[y]=no(y,k,S)}),p}function Pi(s,a,u){for(var p=u.db.objectStoreNames,y=0;y<p.length;++y){var v=p[y],k=u.objectStore(v);s._hasGetAll="getAll"in k;for(var S=0;S<k.indexNames.length;++S){var C=k.indexNames[S],O=k.index(C).keyPath,D=typeof O=="string"?O:"["+B(O).join("+")+"]";!a[v]||(O=a[v].idxByName[D])&&(O.name=C,delete a[v].idxByName[D],a[v].idxByName[C]=O)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(s._hasGetAll=!1)}function dc(s){return s.split(",").map(function(a,u){var v=a.split(":"),p=(y=v[1])===null||y===void 0?void 0:y.trim(),y=(a=v[0].trim()).replace(/([&*]|\+\+)/g,""),v=/^\[/.test(y)?y.match(/^\[(.*)\]$/)[1].split("+"):y;return to(y,v||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),l(v),u===0,p)})}var Od=(Yn.prototype._createTableSchema=no,Yn.prototype._parseIndexSyntax=dc,Yn.prototype._parseStoresSpec=function(s,a){var u=this;c(s).forEach(function(p){if(s[p]!==null){var y=u._parseIndexSyntax(s[p]),v=y.shift();if(!v)throw new ee.Schema("Invalid schema for table "+p+": "+s[p]);if(v.unique=!0,v.multi)throw new ee.Schema("Primary key cannot be multiEntry*");y.forEach(function(k){if(k.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!k.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")}),y=u._createTableSchema(p,v,y),a[p]=y}})},Yn.prototype.stores=function(u){var a=this.db;this._cfg.storesSource=this._cfg.storesSource?f(this._cfg.storesSource,u):u;var u=a._versions,p={},y={};return u.forEach(function(v){f(p,v._cfg.storesSource),y=v._cfg.dbschema={},v._parseStoresSpec(p,y)}),a._dbSchema=y,io(a,[a._allTables,a,a.Transaction.prototype]),Di(a,[a._allTables,a,a.Transaction.prototype,this._cfg.tables],c(y),y),a._storeNames=c(y),this},Yn.prototype.upgrade=function(s){return this._cfg.contentUpgrade=Fs(this._cfg.contentUpgrade||ce,s),this},Yn);function Yn(){}function ao(s,a){var u=s._dbNamesDB;return u||(u=s._dbNamesDB=new Ht(Si,{addons:[],indexedDB:s,IDBKeyRange:a})).version(1).stores({dbnames:"name"}),u.table("dbnames")}function co(s){return s&&typeof s.databases=="function"}function lo(s){return on(function(){return se.letThrough=!0,s()})}function uo(s){return!("from"in s)}var at=function(s,a){if(!this){var u=new at;return s&&"d"in s&&f(u,s),u}f(this,arguments.length?{d:1,from:s,to:1<arguments.length?a:s}:{d:0})};function Rr(s,a,u){var p=Se(a,u);if(!isNaN(p)){if(0<p)throw RangeError();if(uo(s))return f(s,{from:a,to:u,d:1});var y=s.l,p=s.r;if(Se(u,s.from)<0)return y?Rr(y,a,u):s.l={from:a,to:u,d:1,l:null,r:null},pc(s);if(0<Se(a,s.to))return p?Rr(p,a,u):s.r={from:a,to:u,d:1,l:null,r:null},pc(s);Se(a,s.from)<0&&(s.from=a,s.l=null,s.d=p?p.d+1:1),0<Se(u,s.to)&&(s.to=u,s.r=null,s.d=s.l?s.l.d+1:1),u=!s.r,y&&!s.l&&Pr(s,y),p&&u&&Pr(s,p)}}function Pr(s,a){uo(a)||function u(p,C){var v=C.from,k=C.to,S=C.l,C=C.r;Rr(p,v,k),S&&u(p,S),C&&u(p,C)}(s,a)}function hc(s,a){var u=Ui(a),p=u.next();if(p.done)return!1;for(var y=p.value,v=Ui(s),k=v.next(y.from),S=k.value;!p.done&&!k.done;){if(Se(S.from,y.to)<=0&&0<=Se(S.to,y.from))return!0;Se(y.from,S.from)<0?y=(p=u.next(S.from)).value:S=(k=v.next(y.from)).value}return!1}function Ui(s){var a=uo(s)?null:{s:0,n:s};return{next:function(u){for(var p=0<arguments.length;a;)switch(a.s){case 0:if(a.s=1,p)for(;a.n.l&&Se(u,a.n.from)<0;)a={up:a,n:a.n.l,s:1};else for(;a.n.l;)a={up:a,n:a.n.l,s:1};case 1:if(a.s=2,!p||Se(u,a.n.to)<=0)return{value:a.n,done:!1};case 2:if(a.n.r){a.s=3,a={up:a,n:a.n.r,s:0};continue}case 3:a=a.up}return{done:!0}}}}function pc(s){var a,u,p=(((a=s.r)===null||a===void 0?void 0:a.d)||0)-(((u=s.l)===null||u===void 0?void 0:u.d)||0),y=1<p?"r":p<-1?"l":"";y&&(a=y=="r"?"l":"r",u=r({},s),p=s[y],s.from=p.from,s.to=p.to,s[y]=p[y],u[y]=p[a],(s[a]=u).d=yc(u)),s.d=yc(s)}function yc(u){var a=u.r,u=u.l;return(a?u?Math.max(a.d,u.d):a.d:u?u.d:0)+1}function ji(s,a){return c(a).forEach(function(u){s[u]?Pr(s[u],a[u]):s[u]=function p(y){var v,k,S={};for(v in y)g(y,v)&&(k=y[v],S[v]=!k||typeof k!="object"||H.has(k.constructor)?k:p(k));return S}(a[u])}),s}function fo(s,a){return s.all||a.all||Object.keys(s).some(function(u){return a[u]&&hc(a[u],s[u])})}m(at.prototype,((Et={add:function(s){return Pr(this,s),this},addKey:function(s){return Rr(this,s,s),this},addKeys:function(s){var a=this;return s.forEach(function(u){return Rr(a,u,u)}),this},hasKey:function(s){var a=Ui(this).next(s).value;return a&&Se(a.from,s)<=0&&0<=Se(a.to,s)}})[z]=function(){return Ui(this)},Et));var Tn={},ho={},po=!1;function Li(s){ji(ho,s),po||(po=!0,setTimeout(function(){po=!1,yo(ho,!(ho={}))},0))}function yo(s,a){a===void 0&&(a=!1);var u=new Set;if(s.all)for(var p=0,y=Object.values(Tn);p<y.length;p++)gc(k=y[p],s,u,a);else for(var v in s){var k,S=/^idb\:\/\/(.*)\/(.*)\//.exec(v);S&&(v=S[1],S=S[2],(k=Tn["idb://".concat(v,"/").concat(S)])&&gc(k,s,u,a))}u.forEach(function(C){return C()})}function gc(s,a,u,p){for(var y=[],v=0,k=Object.entries(s.queries.query);v<k.length;v++){for(var S=k[v],C=S[0],O=[],D=0,x=S[1];D<x.length;D++){var P=x[D];fo(a,P.obsSet)?P.subscribers.forEach(function(T){return u.add(T)}):p&&O.push(P)}p&&y.push([C,O])}if(p)for(var I=0,A=y;I<A.length;I++){var R=A[I],C=R[0],O=R[1];s.queries.query[C]=O}}function Ad(s){var a=s._state,u=s._deps.indexedDB;if(a.isBeingOpened||s.idbdb)return a.dbReadyPromise.then(function(){return a.dbOpenError?Fe(a.dbOpenError):s});a.isBeingOpened=!0,a.dbOpenError=null,a.openComplete=!1;var p=a.openCanceller,y=Math.round(10*s.verno),v=!1;function k(){if(a.openCanceller!==p)throw new ee.DatabaseClosed("db.open() was cancelled")}function S(){return new X(function(P,I){if(k(),!u)throw new ee.MissingAPI;var A=s.name,R=a.autoSchema||!y?u.open(A):u.open(A,y);if(!R)throw new ee.MissingAPI;R.onerror=Ut(I),R.onblocked=Me(s._fireOnBlocked),R.onupgradeneeded=Me(function(T){var U;D=R.transaction,a.autoSchema&&!s._options.allowEmptyDB?(R.onerror=Or,D.abort(),R.result.close(),(U=u.deleteDatabase(A)).onsuccess=U.onerror=Me(function(){I(new ee.NoSuchDatabase("Database ".concat(A," doesnt exist")))})):(D.onerror=Ut(I),T=T.oldVersion>Math.pow(2,62)?0:T.oldVersion,x=T<1,s.idbdb=R.result,v&&Id(s,D),Cd(s,T/10,D,I))},I),R.onsuccess=Me(function(){D=null;var T,U,N,M,K,$=s.idbdb=R.result,W=B($.objectStoreNames);if(0<W.length)try{var q=$.transaction((M=W).length===1?M[0]:M,"readonly");if(a.autoSchema)U=$,N=q,(T=s).verno=U.version/10,N=T._dbSchema=Ri(0,U,N),T._storeNames=B(U.objectStoreNames,0),Di(T,[T._allTables],c(N),N);else if(Pi(s,s._dbSchema,q),((K=so(Ri(0,(K=s).idbdb,q),K._dbSchema)).add.length||K.change.some(function(V){return V.add.length||V.change.length}))&&!v)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),$.close(),y=$.version+1,v=!0,P(S());Ai(s,q)}catch{}Wn.push(s),$.onversionchange=Me(function(V){a.vcFired=!0,s.on("versionchange").fire(V)}),$.onclose=Me(function(V){s.on("close").fire(V)}),x&&(K=s._deps,q=A,$=K.indexedDB,K=K.IDBKeyRange,co($)||q===Si||ao($,K).put({name:q}).catch(ce)),P()},I)}).catch(function(P){switch(P==null?void 0:P.name){case"UnknownError":if(0<a.PR1398_maxLoop)return a.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),S();break;case"VersionError":if(0<y)return y=0,S()}return X.reject(P)})}var C,O=a.dbReadyResolve,D=null,x=!1;return X.race([p,(typeof navigator>"u"?X.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(P){function I(){return indexedDB.databases().finally(P)}C=setInterval(I,100),I()}).finally(function(){return clearInterval(C)}):Promise.resolve()).then(S)]).then(function(){return k(),a.onReadyBeingFired=[],X.resolve(lo(function(){return s.on.ready.fire(s.vip)})).then(function P(){if(0<a.onReadyBeingFired.length){var I=a.onReadyBeingFired.reduce(Fs,ce);return a.onReadyBeingFired=[],X.resolve(lo(function(){return I(s.vip)})).then(P)}})}).finally(function(){a.openCanceller===p&&(a.onReadyBeingFired=null,a.isBeingOpened=!1)}).catch(function(P){a.dbOpenError=P;try{D&&D.abort()}catch{}return p===a.openCanceller&&s._close(),Fe(P)}).finally(function(){a.openComplete=!0,O()}).then(function(){var P;return x&&(P={},s.tables.forEach(function(I){I.schema.indexes.forEach(function(A){A.name&&(P["idb://".concat(s.name,"/").concat(I.name,"/").concat(A.name)]=new at(-1/0,[[[]]]))}),P["idb://".concat(s.name,"/").concat(I.name,"/")]=P["idb://".concat(s.name,"/").concat(I.name,"/:dels")]=new at(-1/0,[[[]]])}),un(Ar).fire(P),yo(P,!0)),s})}function go(s){function a(v){return s.next(v)}var u=y(a),p=y(function(v){return s.throw(v)});function y(v){return function(C){var S=v(C),C=S.value;return S.done?C:C&&typeof C.then=="function"?C.then(u,p):l(C)?Promise.all(C).then(u,p):u(C)}}return y(a)()}function Ni(s,a,u){for(var p=l(s)?s.slice():[s],y=0;y<u;++y)p.push(a);return p}var Dd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(s){return r(r({},s),{table:function(a){var u=s.table(a),p=u.schema,y={},v=[];function k(x,P,I){var A=Tr(x),R=y[A]=y[A]||[],T=x==null?0:typeof x=="string"?1:x.length,U=0<P,U=r(r({},I),{name:U?"".concat(A,"(virtual-from:").concat(I.name,")"):I.name,lowLevelIndex:I,isVirtual:U,keyTail:P,keyLength:T,extractKey:ro(x),unique:!U&&I.unique});return R.push(U),U.isPrimaryKey||v.push(U),1<T&&k(T===2?x[0]:x.slice(0,T-1),P+1,I),R.sort(function(N,M){return N.keyTail-M.keyTail}),U}a=k(p.primaryKey.keyPath,0,p.primaryKey),y[":id"]=[a];for(var S=0,C=p.indexes;S<C.length;S++){var O=C[S];k(O.keyPath,0,O)}function D(x){var P,I=x.query.index;return I.isVirtual?r(r({},x),{query:{index:I.lowLevelIndex,range:(P=x.query.range,I=I.keyTail,{type:P.type===1?2:P.type,lower:Ni(P.lower,P.lowerOpen?s.MAX_KEY:s.MIN_KEY,I),lowerOpen:!0,upper:Ni(P.upper,P.upperOpen?s.MIN_KEY:s.MAX_KEY,I),upperOpen:!0})}}):x}return r(r({},u),{schema:r(r({},p),{primaryKey:a,indexes:v,getIndexByKeyPath:function(x){return(x=y[Tr(x)])&&x[0]}}),count:function(x){return u.count(D(x))},query:function(x){return u.query(D(x))},openCursor:function(x){var P=x.query.index,I=P.keyTail,A=P.isVirtual,R=P.keyLength;return A?u.openCursor(D(x)).then(function(U){return U&&T(U)}):u.openCursor(x);function T(U){return Object.create(U,{continue:{value:function(N){N!=null?U.continue(Ni(N,x.reverse?s.MAX_KEY:s.MIN_KEY,I)):x.unique?U.continue(U.key.slice(0,R).concat(x.reverse?s.MIN_KEY:s.MAX_KEY,I)):U.continue()}},continuePrimaryKey:{value:function(N,M){U.continuePrimaryKey(Ni(N,s.MAX_KEY,I),M)}},primaryKey:{get:function(){return U.primaryKey}},key:{get:function(){var N=U.key;return R===1?N[0]:N.slice(0,R)}},value:{get:function(){return U.value}}})}}})}})}};function mo(s,a,u,p){return u=u||{},p=p||"",c(s).forEach(function(y){var v,k,S;g(a,y)?(v=s[y],k=a[y],typeof v=="object"&&typeof k=="object"&&v&&k?(S=ke(v))!==ke(k)?u[p+y]=a[y]:S==="Object"?mo(v,k,u,p+y+"."):v!==k&&(u[p+y]=a[y]):v!==k&&(u[p+y]=a[y])):u[p+y]=void 0}),c(a).forEach(function(y){g(s,y)||(u[p+y]=a[y])}),u}function vo(s,a){return a.type==="delete"?a.keys:a.keys||a.values.map(s.extractKey)}var Td={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(s){return r(r({},s),{table:function(a){var u=s.table(a),p=u.schema.primaryKey;return r(r({},u),{mutate:function(y){var v=se.trans,k=v.table(a).hook,S=k.deleting,C=k.creating,O=k.updating;switch(y.type){case"add":if(C.fire===ce)break;return v._promise("readwrite",function(){return D(y)},!0);case"put":if(C.fire===ce&&O.fire===ce)break;return v._promise("readwrite",function(){return D(y)},!0);case"delete":if(S.fire===ce)break;return v._promise("readwrite",function(){return D(y)},!0);case"deleteRange":if(S.fire===ce)break;return v._promise("readwrite",function(){return function x(P,I,A){return u.query({trans:P,values:!1,query:{index:p,range:I},limit:A}).then(function(R){var T=R.result;return D({type:"delete",keys:T,trans:P}).then(function(U){return 0<U.numFailures?Promise.reject(U.failures[0]):T.length<A?{failures:[],numFailures:0,lastResult:void 0}:x(P,r(r({},I),{lower:T[T.length-1],lowerOpen:!0}),A)})})}(y.trans,y.range,1e4)},!0)}return u.mutate(y);function D(x){var P,I,A,R=se.trans,T=x.keys||vo(p,x);if(!T)throw new Error("Keys missing");return(x=x.type==="add"||x.type==="put"?r(r({},x),{keys:T}):r({},x)).type!=="delete"&&(x.values=i([],x.values)),x.keys&&(x.keys=i([],x.keys)),P=u,A=T,((I=x).type==="add"?Promise.resolve([]):P.getMany({trans:I.trans,keys:A,cache:"immutable"})).then(function(U){var N=T.map(function(M,K){var $,W,q,V=U[K],J={onerror:null,onsuccess:null};return x.type==="delete"?S.fire.call(J,M,V,R):x.type==="add"||V===void 0?($=C.fire.call(J,M,x.values[K],R),M==null&&$!=null&&(x.keys[K]=M=$,p.outbound||oe(x.values[K],p.keyPath,M))):($=mo(V,x.values[K]),(W=O.fire.call(J,$,M,V,R))&&(q=x.values[K],Object.keys(W).forEach(function(Y){g(q,Y)?q[Y]=W[Y]:oe(q,Y,W[Y])}))),J});return u.mutate(x).then(function(M){for(var K=M.failures,$=M.results,W=M.numFailures,M=M.lastResult,q=0;q<T.length;++q){var V=($||T)[q],J=N[q];V==null?J.onerror&&J.onerror(K[q]):J.onsuccess&&J.onsuccess(x.type==="put"&&U[q]?x.values[q]:V)}return{failures:K,results:$,numFailures:W,lastResult:M}}).catch(function(M){return N.forEach(function(K){return K.onerror&&K.onerror(M)}),Promise.reject(M)})})}}})}})}};function mc(s,a,u){try{if(!a||a.keys.length<s.length)return null;for(var p=[],y=0,v=0;y<a.keys.length&&v<s.length;++y)Se(a.keys[y],s[v])===0&&(p.push(u?me(a.values[y]):a.values[y]),++v);return p.length===s.length?p:null}catch{return null}}var Rd={stack:"dbcore",level:-1,create:function(s){return{table:function(a){var u=s.table(a);return r(r({},u),{getMany:function(p){if(!p.cache)return u.getMany(p);var y=mc(p.keys,p.trans._cache,p.cache==="clone");return y?X.resolve(y):u.getMany(p).then(function(v){return p.trans._cache={keys:p.keys,values:p.cache==="clone"?me(v):v},v})},mutate:function(p){return p.type!=="add"&&(p.trans._cache=null),u.mutate(p)}})}}}};function vc(s,a){return s.trans.mode==="readonly"&&!!s.subscr&&!s.trans.explicit&&s.trans.db._options.cache!=="disabled"&&!a.schema.primaryKey.outbound}function bc(s,a){switch(s){case"query":return a.values&&!a.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Pd={stack:"dbcore",level:0,name:"Observability",create:function(s){var a=s.schema.name,u=new at(s.MIN_KEY,s.MAX_KEY);return r(r({},s),{transaction:function(p,y,v){if(se.subscr&&y!=="readonly")throw new ee.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(se.querier));return s.transaction(p,y,v)},table:function(p){var y=s.table(p),v=y.schema,k=v.primaryKey,x=v.indexes,S=k.extractKey,C=k.outbound,O=k.autoIncrement&&x.filter(function(I){return I.compound&&I.keyPath.includes(k.keyPath)}),D=r(r({},y),{mutate:function(I){function A(Y){return Y="idb://".concat(a,"/").concat(p,"/").concat(Y),M[Y]||(M[Y]=new at)}var R,T,U,N=I.trans,M=I.mutatedParts||(I.mutatedParts={}),K=A(""),$=A(":dels"),W=I.type,J=I.type==="deleteRange"?[I.range]:I.type==="delete"?[I.keys]:I.values.length<50?[vo(k,I).filter(function(Y){return Y}),I.values]:[],q=J[0],V=J[1],J=I.trans._cache;return l(q)?(K.addKeys(q),(J=W==="delete"||q.length===V.length?mc(q,J):null)||$.addKeys(q),(J||V)&&(R=A,T=J,U=V,v.indexes.forEach(function(Y){var Q=R(Y.name||"");function pe(fe){return fe!=null?Y.extractKey(fe):null}function xe(fe){return Y.multiEntry&&l(fe)?fe.forEach(function(Be){return Q.addKey(Be)}):Q.addKey(fe)}(T||U).forEach(function(fe,ct){var le=T&&pe(T[ct]),ct=U&&pe(U[ct]);Se(le,ct)!==0&&(le!=null&&xe(le),ct!=null&&xe(ct))})}))):q?(V={from:(V=q.lower)!==null&&V!==void 0?V:s.MIN_KEY,to:(V=q.upper)!==null&&V!==void 0?V:s.MAX_KEY},$.add(V),K.add(V)):(K.add(u),$.add(u),v.indexes.forEach(function(Y){return A(Y.name).add(u)})),y.mutate(I).then(function(Y){return!q||I.type!=="add"&&I.type!=="put"||(K.addKeys(Y.results),O&&O.forEach(function(Q){for(var pe=I.values.map(function(le){return Q.extractKey(le)}),xe=Q.keyPath.findIndex(function(le){return le===k.keyPath}),fe=0,Be=Y.results.length;fe<Be;++fe)pe[fe][xe]=Y.results[fe];A(Q.name).addKeys(pe)})),N.mutatedParts=ji(N.mutatedParts||{},M),Y})}}),x=function(A){var R=A.query,A=R.index,R=R.range;return[A,new at((A=R.lower)!==null&&A!==void 0?A:s.MIN_KEY,(R=R.upper)!==null&&R!==void 0?R:s.MAX_KEY)]},P={get:function(I){return[k,new at(I.key)]},getMany:function(I){return[k,new at().addKeys(I.keys)]},count:x,query:x,openCursor:x};return c(P).forEach(function(I){D[I]=function(A){var R=se.subscr,T=!!R,U=vc(se,y)&&bc(I,A)?A.obsSet={}:R;if(T){var N=function(V){return V="idb://".concat(a,"/").concat(p,"/").concat(V),U[V]||(U[V]=new at)},M=N(""),K=N(":dels"),R=P[I](A),T=R[0],R=R[1];if((I==="query"&&T.isPrimaryKey&&!A.values?K:N(T.name||"")).add(R),!T.isPrimaryKey){if(I!=="count"){var $=I==="query"&&C&&A.values&&y.query(r(r({},A),{values:!1}));return y[I].apply(this,arguments).then(function(V){if(I==="query"){if(C&&A.values)return $.then(function(pe){return pe=pe.result,M.addKeys(pe),V});var J=A.values?V.result.map(S):V.result;(A.values?M:K).addKeys(J)}else if(I==="openCursor"){var Y=V,Q=A.values;return Y&&Object.create(Y,{key:{get:function(){return K.addKey(Y.primaryKey),Y.key}},primaryKey:{get:function(){var pe=Y.primaryKey;return K.addKey(pe),pe}},value:{get:function(){return Q&&M.addKey(Y.primaryKey),Y.value}}})}return V})}K.add(u)}}return y[I].apply(this,arguments)}}),D}})}};function wc(s,a,u){if(u.numFailures===0)return a;if(a.type==="deleteRange")return null;var p=a.keys?a.keys.length:"values"in a&&a.values?a.values.length:1;return u.numFailures===p?null:(a=r({},a),l(a.keys)&&(a.keys=a.keys.filter(function(y,v){return!(v in u.failures)})),"values"in a&&l(a.values)&&(a.values=a.values.filter(function(y,v){return!(v in u.failures)})),a)}function bo(s,a){return u=s,((p=a).lower===void 0||(p.lowerOpen?0<Se(u,p.lower):0<=Se(u,p.lower)))&&(s=s,(a=a).upper===void 0||(a.upperOpen?Se(s,a.upper)<0:Se(s,a.upper)<=0));var u,p}function _c(s,a,P,p,y,v){if(!P||P.length===0)return s;var k=a.query.index,S=k.multiEntry,C=a.query.range,O=p.schema.primaryKey.extractKey,D=k.extractKey,x=(k.lowLevelIndex||k).extractKey,P=P.reduce(function(I,A){var R=I,T=[];if(A.type==="add"||A.type==="put")for(var U=new at,N=A.values.length-1;0<=N;--N){var M,K=A.values[N],$=O(K);U.hasKey($)||(M=D(K),(S&&l(M)?M.some(function(Y){return bo(Y,C)}):bo(M,C))&&(U.addKey($),T.push(K)))}switch(A.type){case"add":var W=new at().addKeys(a.values?I.map(function(Q){return O(Q)}):I),R=I.concat(a.values?T.filter(function(Q){return Q=O(Q),!W.hasKey(Q)&&(W.addKey(Q),!0)}):T.map(function(Q){return O(Q)}).filter(function(Q){return!W.hasKey(Q)&&(W.addKey(Q),!0)}));break;case"put":var q=new at().addKeys(A.values.map(function(Q){return O(Q)}));R=I.filter(function(Q){return!q.hasKey(a.values?O(Q):Q)}).concat(a.values?T:T.map(function(Q){return O(Q)}));break;case"delete":var V=new at().addKeys(A.keys);R=I.filter(function(Q){return!V.hasKey(a.values?O(Q):Q)});break;case"deleteRange":var J=A.range;R=I.filter(function(Q){return!bo(O(Q),J)})}return R},s);return P===s?s:(P.sort(function(I,A){return Se(x(I),x(A))||Se(O(I),O(A))}),a.limit&&a.limit<1/0&&(P.length>a.limit?P.length=a.limit:s.length===a.limit&&P.length<a.limit&&(y.dirty=!0)),v?Object.freeze(P):P)}function kc(s,a){return Se(s.lower,a.lower)===0&&Se(s.upper,a.upper)===0&&!!s.lowerOpen==!!a.lowerOpen&&!!s.upperOpen==!!a.upperOpen}function Ud(s,a){return function(u,p,y,v){if(u===void 0)return p!==void 0?-1:0;if(p===void 0)return 1;if((p=Se(u,p))===0){if(y&&v)return 0;if(y)return 1;if(v)return-1}return p}(s.lower,a.lower,s.lowerOpen,a.lowerOpen)<=0&&0<=function(u,p,y,v){if(u===void 0)return p!==void 0?1:0;if(p===void 0)return-1;if((p=Se(u,p))===0){if(y&&v)return 0;if(y)return-1;if(v)return 1}return p}(s.upper,a.upper,s.upperOpen,a.upperOpen)}function jd(s,a,u,p){s.subscribers.add(u),p.addEventListener("abort",function(){var y,v;s.subscribers.delete(u),s.subscribers.size===0&&(y=s,v=a,setTimeout(function(){y.subscribers.size===0&&ie(v,y)},3e3))})}var Ld={stack:"dbcore",level:0,name:"Cache",create:function(s){var a=s.schema.name;return r(r({},s),{transaction:function(u,p,y){var v,k,S=s.transaction(u,p,y);return p==="readwrite"&&(k=(v=new AbortController).signal,y=function(C){return function(){if(v.abort(),p==="readwrite"){for(var O=new Set,D=0,x=u;D<x.length;D++){var P=x[D],I=Tn["idb://".concat(a,"/").concat(P)];if(I){var A=s.table(P),R=I.optimisticOps.filter(function(Q){return Q.trans===S});if(S._explicit&&C&&S.mutatedParts)for(var T=0,U=Object.values(I.queries.query);T<U.length;T++)for(var N=0,M=(W=U[T]).slice();N<M.length;N++)fo((q=M[N]).obsSet,S.mutatedParts)&&(ie(W,q),q.subscribers.forEach(function(Q){return O.add(Q)}));else if(0<R.length){I.optimisticOps=I.optimisticOps.filter(function(Q){return Q.trans!==S});for(var K=0,$=Object.values(I.queries.query);K<$.length;K++)for(var W,q,V,J=0,Y=(W=$[K]).slice();J<Y.length;J++)(q=Y[J]).res!=null&&S.mutatedParts&&(C&&!q.dirty?(V=Object.isFrozen(q.res),V=_c(q.res,q.req,R,A,q,V),q.dirty?(ie(W,q),q.subscribers.forEach(function(Q){return O.add(Q)})):V!==q.res&&(q.res=V,q.promise=X.resolve({result:V}))):(q.dirty&&ie(W,q),q.subscribers.forEach(function(Q){return O.add(Q)})))}}}O.forEach(function(Q){return Q()})}}},S.addEventListener("abort",y(!1),{signal:k}),S.addEventListener("error",y(!1),{signal:k}),S.addEventListener("complete",y(!0),{signal:k})),S},table:function(u){var p=s.table(u),y=p.schema.primaryKey;return r(r({},p),{mutate:function(v){var k=se.trans;if(y.outbound||k.db._options.cache==="disabled"||k.explicit||k.idbtrans.mode!=="readwrite")return p.mutate(v);var S=Tn["idb://".concat(a,"/").concat(u)];return S?(k=p.mutate(v),v.type!=="add"&&v.type!=="put"||!(50<=v.values.length||vo(y,v).some(function(C){return C==null}))?(S.optimisticOps.push(v),v.mutatedParts&&Li(v.mutatedParts),k.then(function(C){0<C.numFailures&&(ie(S.optimisticOps,v),(C=wc(0,v,C))&&S.optimisticOps.push(C),v.mutatedParts&&Li(v.mutatedParts))}),k.catch(function(){ie(S.optimisticOps,v),v.mutatedParts&&Li(v.mutatedParts)})):k.then(function(C){var O=wc(0,r(r({},v),{values:v.values.map(function(D,x){var P;return C.failures[x]?D:(D=(P=y.keyPath)!==null&&P!==void 0&&P.includes(".")?me(D):r({},D),oe(D,y.keyPath,C.results[x]),D)})}),C);S.optimisticOps.push(O),queueMicrotask(function(){return v.mutatedParts&&Li(v.mutatedParts)})}),k):p.mutate(v)},query:function(v){if(!vc(se,p)||!bc("query",v))return p.query(v);var k=((O=se.trans)===null||O===void 0?void 0:O.db._options.cache)==="immutable",x=se,S=x.requery,C=x.signal,O=function(A,R,T,U){var N=Tn["idb://".concat(A,"/").concat(R)];if(!N)return[];if(!(R=N.queries[T]))return[null,!1,N,null];var M=R[(U.query?U.query.index.name:null)||""];if(!M)return[null,!1,N,null];switch(T){case"query":var K=M.find(function($){return $.req.limit===U.limit&&$.req.values===U.values&&kc($.req.query.range,U.query.range)});return K?[K,!0,N,M]:[M.find(function($){return("limit"in $.req?$.req.limit:1/0)>=U.limit&&(!U.values||$.req.values)&&Ud($.req.query.range,U.query.range)}),!1,N,M];case"count":return K=M.find(function($){return kc($.req.query.range,U.query.range)}),[K,!!K,N,M]}}(a,u,"query",v),D=O[0],x=O[1],P=O[2],I=O[3];return D&&x?D.obsSet=v.obsSet:(x=p.query(v).then(function(A){var R=A.result;if(D&&(D.res=R),k){for(var T=0,U=R.length;T<U;++T)Object.freeze(R[T]);Object.freeze(R)}else A.result=me(R);return A}).catch(function(A){return I&&D&&ie(I,D),Promise.reject(A)}),D={obsSet:v.obsSet,promise:x,subscribers:new Set,type:"query",req:v,dirty:!1},I?I.push(D):(I=[D],(P=P||(Tn["idb://".concat(a,"/").concat(u)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[v.query.index.name||""]=I)),jd(D,I,S,C),D.promise.then(function(A){return{result:_c(A.result,v,P==null?void 0:P.optimisticOps,p,D,k)}})}})}})}};function Mi(s,a){return new Proxy(s,{get:function(u,p,y){return p==="db"?a:Reflect.get(u,p,y)}})}var Ht=($e.prototype.version=function(s){if(isNaN(s)||s<.1)throw new ee.Type("Given version is not a positive number");if(s=Math.round(10*s)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,s);var a=this._versions,u=a.filter(function(p){return p._cfg.version===s})[0];return u||(u=new this.Version(s),a.push(u),a.sort(Ed),u.stores({}),this._state.autoSchema=!1,u)},$e.prototype._whenReady=function(s){var a=this;return this.idbdb&&(this._state.openComplete||se.letThrough||this._vip)?s():new X(function(u,p){if(a._state.openComplete)return p(new ee.DatabaseClosed(a._state.dbOpenError));if(!a._state.isBeingOpened){if(!a._state.autoOpen)return void p(new ee.DatabaseClosed);a.open().catch(ce)}a._state.dbReadyPromise.then(u,p)}).then(s)},$e.prototype.use=function(s){var a=s.stack,u=s.create,p=s.level,y=s.name;return y&&this.unuse({stack:a,name:y}),s=this._middlewares[a]||(this._middlewares[a]=[]),s.push({stack:a,create:u,level:p??10,name:y}),s.sort(function(v,k){return v.level-k.level}),this},$e.prototype.unuse=function(s){var a=s.stack,u=s.name,p=s.create;return a&&this._middlewares[a]&&(this._middlewares[a]=this._middlewares[a].filter(function(y){return p?y.create!==p:!!u&&y.name!==u})),this},$e.prototype.open=function(){var s=this;return On(sn,function(){return Ad(s)})},$e.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var s=this._state,a=Wn.indexOf(this);if(0<=a&&Wn.splice(a,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}s.isBeingOpened||(s.dbReadyPromise=new X(function(u){s.dbReadyResolve=u}),s.openCanceller=new X(function(u,p){s.cancelOpen=p}))},$e.prototype.close=function(u){var a=(u===void 0?{disableAutoOpen:!0}:u).disableAutoOpen,u=this._state;a?(u.isBeingOpened&&u.cancelOpen(new ee.DatabaseClosed),this._close(),u.autoOpen=!1,u.dbOpenError=new ee.DatabaseClosed):(this._close(),u.autoOpen=this._options.autoOpen||u.isBeingOpened,u.openComplete=!1,u.dbOpenError=null)},$e.prototype.delete=function(s){var a=this;s===void 0&&(s={disableAutoOpen:!0});var u=0<arguments.length&&typeof arguments[0]!="object",p=this._state;return new X(function(y,v){function k(){a.close(s);var S=a._deps.indexedDB.deleteDatabase(a.name);S.onsuccess=Me(function(){var C,O,D;C=a._deps,O=a.name,D=C.indexedDB,C=C.IDBKeyRange,co(D)||O===Si||ao(D,C).delete(O).catch(ce),y()}),S.onerror=Ut(v),S.onblocked=a._fireOnBlocked}if(u)throw new ee.InvalidArgument("Invalid closeOptions argument to db.delete()");p.isBeingOpened?p.dbReadyPromise.then(k):k()})},$e.prototype.backendDB=function(){return this.idbdb},$e.prototype.isOpen=function(){return this.idbdb!==null},$e.prototype.hasBeenClosed=function(){var s=this._state.dbOpenError;return s&&s.name==="DatabaseClosed"},$e.prototype.hasFailed=function(){return this._state.dbOpenError!==null},$e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty($e.prototype,"tables",{get:function(){var s=this;return c(this._allTables).map(function(a){return s._allTables[a]})},enumerable:!1,configurable:!0}),$e.prototype.transaction=function(){var s=(function(a,u,p){var y=arguments.length;if(y<2)throw new ee.InvalidArgument("Too few arguments");for(var v=new Array(y-1);--y;)v[y-1]=arguments[y];return p=v.pop(),[a,De(v),p]}).apply(this,arguments);return this._transaction.apply(this,s)},$e.prototype._transaction=function(s,a,u){var p=this,y=se.trans;y&&y.db===this&&s.indexOf("!")===-1||(y=null);var v,k,S=s.indexOf("?")!==-1;s=s.replace("!","").replace("?","");try{if(k=a.map(function(O){if(O=O instanceof p.Table?O.name:O,typeof O!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return O}),s=="r"||s===Js)v=Js;else{if(s!="rw"&&s!=Xs)throw new ee.InvalidArgument("Invalid transaction mode: "+s);v=Xs}if(y){if(y.mode===Js&&v===Xs){if(!S)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");y=null}y&&k.forEach(function(O){if(y&&y.storeNames.indexOf(O)===-1){if(!S)throw new ee.SubTransaction("Table "+O+" not included in parent transaction.");y=null}}),S&&y&&!y.active&&(y=null)}}catch(O){return y?y._promise(null,function(D,x){x(O)}):Fe(O)}var C=(function O(D,x,P,I,A){return X.resolve().then(function(){var R=se.transless||se,T=D._createTransaction(x,P,D._dbSchema,I);if(T.explicit=!0,R={trans:T,transless:R},I)T.idbtrans=I.idbtrans;else try{T.create(),T.idbtrans._explicit=!0,D._state.PR1398_maxLoop=3}catch(M){return M.name===ot.InvalidState&&D.isOpen()&&0<--D._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),D.close({disableAutoOpen:!1}),D.open().then(function(){return O(D,x,P,null,A)})):Fe(M)}var U,N=ue(A);return N&&Vn(),R=X.follow(function(){var M;(U=A.call(T,T))&&(N?(M=an.bind(null,null),U.then(M,M)):typeof U.next=="function"&&typeof U.throw=="function"&&(U=go(U)))},R),(U&&typeof U.then=="function"?X.resolve(U).then(function(M){return T.active?M:Fe(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):R.then(function(){return U})).then(function(M){return I&&T._resolve(),T._completion.then(function(){return M})}).catch(function(M){return T._reject(M),Fe(M)})})}).bind(null,this,v,k,y,u);return y?y._promise(v,C,"lock"):se.trans?On(se.transless,function(){return p._whenReady(C)}):this._whenReady(C)},$e.prototype.table=function(s){if(!g(this._allTables,s))throw new ee.InvalidTable("Table ".concat(s," does not exist"));return this._allTables[s]},$e);function $e(s,a){var u=this;this._middlewares={},this.verno=0;var p=$e.dependencies;this._options=a=r({addons:$e.addons,autoOpen:!0,indexedDB:p.indexedDB,IDBKeyRange:p.IDBKeyRange,cache:"cloned"},a),this._deps={indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange},p=a.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var y,v,k,S,C,O={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ce,dbReadyPromise:null,cancelOpen:ce,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:a.autoOpen};O.dbReadyPromise=new X(function(x){O.dbReadyResolve=x}),O.openCanceller=new X(function(x,P){O.cancelOpen=P}),this._state=O,this.name=s,this.on=Er(this,"populate","blocked","versionchange","close",{ready:[Fs,ce]}),this.once=function(x,P){var I=function(){for(var A=[],R=0;R<arguments.length;R++)A[R]=arguments[R];u.on(x).unsubscribe(I),P.apply(u,A)};return u.on(x,I)},this.on.ready.subscribe=L(this.on.ready.subscribe,function(x){return function(P,I){$e.vip(function(){var A,R=u._state;R.openComplete?(R.dbOpenError||X.resolve().then(P),I&&x(P)):R.onReadyBeingFired?(R.onReadyBeingFired.push(P),I&&x(P)):(x(P),A=u,I||x(function T(){A.on.ready.unsubscribe(P),A.on.ready.unsubscribe(T)}))})}}),this.Collection=(y=this,Cr(vd.prototype,function(U,T){this.db=y;var I=Qa,A=null;if(T)try{I=T()}catch(N){A=N}var R=U._ctx,T=R.table,U=T.hook.reading.fire;this._ctx={table:T,index:R.index,isPrimKey:!R.index||T.schema.primKey.keyPath&&R.index===T.schema.primKey.name,range:I,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:A,or:R.or,valueMapper:U!==_e?U:null}})),this.Table=(v=this,Cr(nc.prototype,function(x,P,I){this.db=v,this._tx=I,this.name=x,this.schema=P,this.hook=v._allTables[x]?v._allTables[x].hook:Er(null,{creating:[mt,ce],reading:[Ie,_e],updating:[Rt,ce],deleting:[Sn,ce]})})),this.Transaction=(k=this,Cr(_d.prototype,function(x,P,I,A,R){var T=this;x!=="readonly"&&P.forEach(function(U){U=(U=I[U])===null||U===void 0?void 0:U.yProps,U&&(P=P.concat(U.map(function(N){return N.updatesTable})))}),this.db=k,this.mode=x,this.storeNames=P,this.schema=I,this.chromeTransactionDurability=A,this.idbtrans=null,this.on=Er(this,"complete","error","abort"),this.parent=R||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new X(function(U,N){T._resolve=U,T._reject=N}),this._completion.then(function(){T.active=!1,T.on.complete.fire()},function(U){var N=T.active;return T.active=!1,T.on.error.fire(U),T.parent?T.parent._reject(U):N&&T.idbtrans&&T.idbtrans.abort(),Fe(U)})})),this.Version=(S=this,Cr(Od.prototype,function(x){this.db=S,this._cfg={version:x,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(C=this,Cr(cc.prototype,function(x,P,I){if(this.db=C,this._ctx={table:x,index:P===":id"?null:P,or:I},this._cmp=this._ascending=Se,this._descending=function(A,R){return Se(R,A)},this._max=function(A,R){return 0<Se(A,R)?A:R},this._min=function(A,R){return Se(A,R)<0?A:R},this._IDBKeyRange=C._deps.IDBKeyRange,!this._IDBKeyRange)throw new ee.MissingAPI})),this.on("versionchange",function(x){0<x.newVersion?console.warn("Another connection wants to upgrade database '".concat(u.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(u.name,"'. Closing db now to resume the delete request.")),u.close({disableAutoOpen:!1})}),this.on("blocked",function(x){!x.newVersion||x.newVersion<x.oldVersion?console.warn("Dexie.delete('".concat(u.name,"') was blocked")):console.warn("Upgrade '".concat(u.name,"' blocked by other connection holding version ").concat(x.oldVersion/10))}),this._maxKey=Dr(a.IDBKeyRange),this._createTransaction=function(x,P,I,A){return new u.Transaction(x,P,I,u._options.chromeTransactionDurability,A)},this._fireOnBlocked=function(x){u.on("blocked").fire(x),Wn.filter(function(P){return P.name===u.name&&P!==u&&!P._state.vcFired}).map(function(P){return P.on("versionchange").fire(x)})},this.use(Rd),this.use(Ld),this.use(Pd),this.use(Dd),this.use(Td);var D=new Proxy(this,{get:function(x,P,I){if(P==="_vip")return!0;if(P==="table")return function(R){return Mi(u.table(R),D)};var A=Reflect.get(x,P,I);return A instanceof nc?Mi(A,D):P==="tables"?A.map(function(R){return Mi(R,D)}):P==="_createTransaction"?function(){return Mi(A.apply(this,arguments),D)}:A}});this.vip=D,p.forEach(function(x){return x(u)})}var Ki,Et=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Nd=(wo.prototype.subscribe=function(s,a,u){return this._subscribe(s&&typeof s!="function"?s:{next:s,error:a,complete:u})},wo.prototype[Et]=function(){return this},wo);function wo(s){this._subscribe=s}try{Ki={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{Ki={indexedDB:null,IDBKeyRange:null}}function Sc(s){var a,u=!1,p=new Nd(function(y){var v=ue(s),k,S=!1,C={},O={},D={get closed(){return S},unsubscribe:function(){S||(S=!0,k&&k.abort(),x&&un.storagemutated.unsubscribe(I))}};y.start&&y.start(D);var x=!1,P=function(){return Gs(A)},I=function(R){ji(C,R),fo(O,C)&&P()},A=function(){var R,T,U;!S&&Ki.indexedDB&&(C={},R={},k&&k.abort(),k=new AbortController,U=function(N){var M=$n();try{v&&Vn();var K=on(s,N);return K=v?K.finally(an):K}finally{M&&qn()}}(T={subscr:R,signal:k.signal,requery:P,querier:s,trans:null}),Promise.resolve(U).then(function(N){u=!0,a=N,S||T.signal.aborted||(C={},function(M){for(var K in M)if(g(M,K))return;return 1}(O=R)||x||(un(Ar,I),x=!0),Gs(function(){return!S&&y.next&&y.next(N)}))},function(N){u=!1,["DatabaseClosedError","AbortError"].includes(N==null?void 0:N.name)||S||Gs(function(){S||y.error&&y.error(N)})}))};return setTimeout(P,0),D});return p.hasValue=function(){return u},p.getValue=function(){return a},p}var Rn=Ht;function _o(s){var a=fn;try{fn=!0,un.storagemutated.fire(s),yo(s,!0)}finally{fn=a}}m(Rn,r(r({},qe),{delete:function(s){return new Rn(s,{addons:[]}).delete()},exists:function(s){return new Rn(s,{addons:[]}).open().then(function(a){return a.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(s){try{return a=Rn.dependencies,u=a.indexedDB,a=a.IDBKeyRange,(co(u)?Promise.resolve(u.databases()).then(function(p){return p.map(function(y){return y.name}).filter(function(y){return y!==Si})}):ao(u,a).toCollection().primaryKeys()).then(s)}catch{return Fe(new ee.MissingAPI)}var a,u},defineClass:function(){return function(s){f(this,s)}},ignoreTransaction:function(s){return se.trans?On(se.transless,s):s()},vip:lo,async:function(s){return function(){try{var a=go(s.apply(this,arguments));return a&&typeof a.then=="function"?a:X.resolve(a)}catch(u){return Fe(u)}}},spawn:function(s,a,u){try{var p=go(s.apply(u,a||[]));return p&&typeof p.then=="function"?p:X.resolve(p)}catch(y){return Fe(y)}},currentTransaction:{get:function(){return se.trans||null}},waitFor:function(s,a){return a=X.resolve(typeof s=="function"?Rn.ignoreTransaction(s):s).timeout(a||6e4),se.trans?se.trans.waitFor(a):a},Promise:X,debug:{get:function(){return Pt},set:function(s){Wa(s)}},derive:E,extend:f,props:m,override:L,Events:Er,on:un,liveQuery:Sc,extendObservabilitySet:ji,getByKeyPath:Z,setByKeyPath:oe,delByKeyPath:function(s,a){typeof a=="string"?oe(s,a,void 0):"length"in a&&[].map.call(a,function(u){oe(s,u,void 0)})},shallowClone:Re,deepClone:me,getObjectDiff:mo,cmp:Se,asap:ne,minKey:-1/0,addons:[],connections:Wn,errnames:ot,dependencies:Ki,cache:Tn,semVer:"4.2.0",version:"4.2.0".split(".").map(function(s){return parseInt(s)}).reduce(function(s,a,u){return s+a/Math.pow(10,2*u)})})),Rn.maxKey=Dr(Rn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(un(Ar,function(s){fn||(s=new CustomEvent(eo,{detail:s}),fn=!0,dispatchEvent(s),fn=!1)}),addEventListener(eo,function(s){s=s.detail,fn||_o(s)}));var Gn,fn=!1,xc=function(){};return typeof BroadcastChannel<"u"&&((xc=function(){(Gn=new BroadcastChannel(eo)).onmessage=function(s){return s.data&&_o(s.data)}})(),typeof Gn.unref=="function"&&Gn.unref(),un(Ar,function(s){fn||Gn.postMessage(s)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(s){if(!Ht.disableBfCache&&s.persisted){Pt&&console.debug("Dexie: handling persisted pagehide"),Gn!=null&&Gn.close();for(var a=0,u=Wn;a<u.length;a++)u[a].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(s){!Ht.disableBfCache&&s.persisted&&(Pt&&console.debug("Dexie: handling persisted pageshow"),xc(),_o({all:new at(-1/0,[[]])}))})),X.rejectionMapper=function(s,a){return!s||s instanceof Ae||s instanceof TypeError||s instanceof SyntaxError||!s.name||!Le[s.name]?s:(a=new Le[s.name](a||s.message,s),"stack"in s&&w(a,"stack",{get:function(){return this.inner.stack}}),a)},Wa(Pt),r(Ht,Object.freeze({__proto__:null,Dexie:Ht,liveQuery:Sc,Entity:Za,cmp:Se,PropModification:Ir,replacePrefix:function(s,a){return new Ir({replacePrefix:[s,a]})},add:function(s){return new Ir({add:s})},remove:function(s){return new Ir({remove:s})},default:Ht,RangeSet:at,mergeRanges:Pr,rangesOverlap:hc}),{default:Ht}),Ht})})(Vl);var Kd=Vl.exports;const Ho=Md(Kd),Cc=Symbol.for("Dexie"),Ee=globalThis[Cc]||(globalThis[Cc]=Ho);if(Ho.semVer!==Ee.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Ho.semVer} and ${Ee.semVer}`);const{liveQuery:yn,mergeRanges:fv,rangesOverlap:dv,RangeSet:Bd,cmp:xs,Entity:hv,PropModification:Ic,replacePrefix:pv,add:yv,remove:gv,DexieYProvider:mv}=Ee;var zo=function(t,e){return zo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},zo(t,e)};function en(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");zo(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function Fd(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(d){try{h(r.next(d))}catch(g){c(g)}}function f(d){try{h(r.throw(d))}catch(g){c(g)}}function h(d){d.done?o(d.value):i(d.value).then(l,f)}h((r=r.apply(t,[])).next())})}function Wl(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(h){return function(d){return f([h,d])}}function f(h){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=h[0]&2?i.return:h[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,h[1])).done)return o;switch(i=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return n.label++,{value:h[1],done:!1};case 5:n.label++,i=h[1],h=[0];continue;case 7:h=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){n=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){n.label=h[1];break}if(h[0]===6&&n.label<o[1]){n.label=o[1],o=h;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(h);break}o[2]&&n.ops.pop(),n.trys.pop();continue}h=e.call(t,n)}catch(d){h=[6,d],i=0}finally{r=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function rr(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ln(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],c;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){c={error:l}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(c)throw c.error}}return o}function ir(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}function Zn(t){return this instanceof Zn?(this.v=t,this):new Zn(t)}function $d(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,o=[];return i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i;function c(m){r[m]&&(i[m]=function(b){return new Promise(function(w,E){o.push([m,b,w,E])>1||l(m,b)})})}function l(m,b){try{f(r[m](b))}catch(w){g(o[0][3],w)}}function f(m){m.value instanceof Zn?Promise.resolve(m.value.v).then(h,d):g(o[0][2],m)}function h(m){l("next",m)}function d(m){l("throw",m)}function g(m,b){m(b),o.shift(),o.length&&l(o[0][0],o[0][1])}}function qd(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof rr=="function"?rr(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(c){return new Promise(function(l,f){c=t[o](c),i(l,f,c.done,c.value)})}}function i(o,c,l,f){Promise.resolve(f).then(function(h){o({value:h,done:l})},c)}}function Te(t){return typeof t=="function"}function wa(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var So=wa(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function as(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var dr=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,o;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var l=rr(c),f=l.next();!f.done;f=l.next()){var h=f.value;h.remove(this)}}catch(E){e={error:E}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}else c.remove(this);var d=this.initialTeardown;if(Te(d))try{d()}catch(E){o=E instanceof So?E.errors:[E]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var m=rr(g),b=m.next();!b.done;b=m.next()){var w=b.value;try{Oc(w)}catch(E){o=o??[],E instanceof So?o=ir(ir([],Ln(o)),Ln(E.errors)):o.push(E)}}}catch(E){r={error:E}}finally{try{b&&!b.done&&(i=m.return)&&i.call(m)}finally{if(r)throw r.error}}}if(o)throw new So(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Oc(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&as(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&as(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),Hl=dr.EMPTY;function zl(t){return t instanceof dr||t&&"closed"in t&&Te(t.remove)&&Te(t.add)&&Te(t.unsubscribe)}function Oc(t){Te(t)?t():t.unsubscribe()}var Vd={Promise:void 0},Wd={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,ir([t,e],Ln(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Yl(t){Wd.setTimeout(function(){throw t})}function Ac(){}function Qi(t){t()}var _a=function(t){en(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,zl(n)&&n.add(r)):r.destination=Yd,r}return e.create=function(n,r,i){return new sr(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(dr),Hd=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Fi(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Fi(r)}else Fi(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Fi(n)}},t}(),sr=function(t){en(e,t);function e(n,r,i){var o=t.call(this)||this,c;return Te(n)||!n?c={next:n??void 0,error:r??void 0,complete:i??void 0}:c=n,o.destination=new Hd(c),o}return e}(_a);function Fi(t){Yl(t)}function zd(t){throw t}var Yd={closed:!0,next:Ac,error:zd,complete:Ac},ka=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function hr(t){return t}function Gd(t){return t.length===0?hr:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var Ye=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,o=Xd(e)?e:new sr(e,n,r);return Qi(function(){var c=i,l=c.operator,f=c.source;o.add(l?l.call(o,f):f?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=Dc(n),new n(function(i,o){var c=new sr({next:function(l){try{e(l)}catch(f){o(f),c.unsubscribe()}},error:o,complete:i});r.subscribe(c)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[ka]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Gd(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Dc(e),new e(function(r,i){var o;n.subscribe(function(c){return o=c},function(c){return i(c)},function(){return r(o)})})},t.create=function(e){return new t(e)},t}();function Dc(t){var e;return(e=t??Vd.Promise)!==null&&e!==void 0?e:Promise}function Jd(t){return t&&Te(t.next)&&Te(t.error)&&Te(t.complete)}function Xd(t){return t&&t instanceof _a||Jd(t)&&zl(t)}function Qd(t){return Te(t==null?void 0:t.lift)}function xt(t){return function(e){if(Qd(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function St(t,e,n,r,i){return new Zd(t,e,n,r,i)}var Zd=function(t){en(e,t);function e(n,r,i,o,c,l){var f=t.call(this,n)||this;return f.onFinalize=c,f.shouldUnsubscribe=l,f._next=r?function(h){try{r(h)}catch(d){n.error(d)}}:t.prototype._next,f._error=o?function(h){try{o(h)}catch(d){n.error(d)}finally{this.unsubscribe()}}:t.prototype._error,f._complete=i?function(){try{i()}catch(h){n.error(h)}finally{this.unsubscribe()}}:t.prototype._complete,f}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(_a),eh=wa(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Nn=function(t){en(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new Tc(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new eh},e.prototype.next=function(n){var r=this;Qi(function(){var i,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var c=rr(r.currentObservers),l=c.next();!l.done;l=c.next()){var f=l.value;f.next(n)}}catch(h){i={error:h}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;Qi(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;Qi(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,o=i.hasError,c=i.isStopped,l=i.observers;return o||c?Hl:(this.currentObservers=null,l.push(n),new dr(function(){r.currentObservers=null,as(l,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,o=r.thrownError,c=r.isStopped;i?n.error(o):c&&n.complete()},e.prototype.asObservable=function(){var n=new Ye;return n.source=this,n},e.create=function(n,r){return new Tc(n,r)},e}(Ye),Tc=function(t){en(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:Hl},e}(Nn),Tt=function(t){en(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,o=n._value;if(r)throw i;return this._throwIfClosed(),o},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(Nn),th={now:function(){return Date.now()}},nh=function(t){en(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(dr),Rc={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,ir([t,e],Ln(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},rh=function(t){en(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){if(r===void 0&&(r=0),this.closed)return this;this.state=n;var i=this.id,o=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(o,i,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),Rc.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;Rc.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,o;try{this.work(n)}catch(c){i=!0,o=c||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,as(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(nh),Pc=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=th.now,t}(),ih=function(t){en(e,t);function e(n,r){r===void 0&&(r=Pc.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i._scheduled=void 0,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(Pc),Sa=new ih(rh),sh=Sa,Gl=new Ye(function(t){return t.complete()});function Jl(t){return t&&Te(t.schedule)}function xa(t){return t[t.length-1]}function oh(t){return Te(xa(t))?t.pop():void 0}function ai(t){return Jl(xa(t))?t.pop():void 0}function ah(t,e){return typeof xa(t)=="number"?t.pop():e}var Ea=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function Xl(t){return Te(t==null?void 0:t.then)}function Ql(t){return Te(t[ka])}function Zl(t){return Symbol.asyncIterator&&Te(t==null?void 0:t[Symbol.asyncIterator])}function eu(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function ch(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var tu=ch();function nu(t){return Te(t==null?void 0:t[tu])}function ru(t){return $d(this,arguments,function(){var n,r,i,o;return Wl(this,function(c){switch(c.label){case 0:n=t.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,Zn(n.read())];case 3:return r=c.sent(),i=r.value,o=r.done,o?[4,Zn(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,Zn(i)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function iu(t){return Te(t==null?void 0:t.getReader)}function Vt(t){if(t instanceof Ye)return t;if(t!=null){if(Ql(t))return lh(t);if(Ea(t))return uh(t);if(Xl(t))return fh(t);if(Zl(t))return su(t);if(nu(t))return dh(t);if(iu(t))return hh(t)}throw eu(t)}function lh(t){return new Ye(function(e){var n=t[ka]();if(Te(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function uh(t){return new Ye(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function fh(t){return new Ye(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Yl)})}function dh(t){return new Ye(function(e){var n,r;try{for(var i=rr(t),o=i.next();!o.done;o=i.next()){var c=o.value;if(e.next(c),e.closed)return}}catch(l){n={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function su(t){return new Ye(function(e){ph(t,e).catch(function(n){return e.error(n)})})}function hh(t){return su(ru(t))}function ph(t,e){var n,r,i,o;return Fd(this,void 0,void 0,function(){var c,l;return Wl(this,function(f){switch(f.label){case 0:f.trys.push([0,5,6,11]),n=qd(t),f.label=1;case 1:return[4,n.next()];case 2:if(r=f.sent(),!!r.done)return[3,4];if(c=r.value,e.next(c),e.closed)return[2];f.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=f.sent(),i={error:l},[3,11];case 6:return f.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:f.sent(),f.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function gn(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(o),!i)return o}function ou(t,e){return e===void 0&&(e=0),xt(function(n,r){n.subscribe(St(r,function(i){return gn(r,t,function(){return r.next(i)},e)},function(){return gn(r,t,function(){return r.complete()},e)},function(i){return gn(r,t,function(){return r.error(i)},e)}))})}function au(t,e){return e===void 0&&(e=0),xt(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function yh(t,e){return Vt(t).pipe(au(e),ou(e))}function gh(t,e){return Vt(t).pipe(au(e),ou(e))}function mh(t,e){return new Ye(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function vh(t,e){return new Ye(function(n){var r;return gn(n,e,function(){r=t[tu](),gn(n,e,function(){var i,o,c;try{i=r.next(),o=i.value,c=i.done}catch(l){n.error(l);return}c?n.complete():n.next(o)},0,!0)}),function(){return Te(r==null?void 0:r.return)&&r.return()}})}function cu(t,e){if(!t)throw new Error("Iterable cannot be null");return new Ye(function(n){gn(n,e,function(){var r=t[Symbol.asyncIterator]();gn(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function bh(t,e){return cu(ru(t),e)}function wh(t,e){if(t!=null){if(Ql(t))return yh(t,e);if(Ea(t))return mh(t,e);if(Xl(t))return gh(t,e);if(Zl(t))return cu(t,e);if(nu(t))return vh(t,e);if(iu(t))return bh(t,e)}throw eu(t)}function _t(t,e){return e?wh(t,e):Vt(t)}function Xt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ai(t);return _t(t,n)}function Uc(t,e){var n=Te(t)?t:function(){return t},r=function(i){return i.error(n())};return new Ye(r)}var _h=wa(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function Un(t,e){return new Promise(function(n,r){var i=new sr({next:function(o){n(o),i.unsubscribe()},error:r,complete:function(){r(new _h)}});t.subscribe(i)})}function kh(t){return t instanceof Date&&!isNaN(t)}function bt(t,e){return xt(function(n,r){var i=0;n.subscribe(St(r,function(o){r.next(t.call(e,o,i++))}))})}var Sh=Array.isArray;function xh(t,e){return Sh(e)?t.apply(void 0,ir([],Ln(e))):t(e)}function lu(t){return bt(function(e){return xh(t,e)})}var Eh=Array.isArray,Ch=Object.getPrototypeOf,Ih=Object.prototype,Oh=Object.keys;function Ah(t){if(t.length===1){var e=t[0];if(Eh(e))return{args:e,keys:null};if(Dh(e)){var n=Oh(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function Dh(t){return t&&typeof t=="object"&&Ch(t)===Ih}function Th(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function Xr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ai(t),r=oh(t),i=Ah(t),o=i.args,c=i.keys;if(o.length===0)return _t([],n);var l=new Ye(Rh(o,n,c?function(f){return Th(c,f)}:hr));return r?l.pipe(lu(r)):l}function Rh(t,e,n){return n===void 0&&(n=hr),function(r){jc(e,function(){for(var i=t.length,o=new Array(i),c=i,l=i,f=function(d){jc(e,function(){var g=_t(t[d],e),m=!1;g.subscribe(St(r,function(b){o[d]=b,m||(m=!0,l--),l||r.next(n(o.slice()))},function(){--c||r.complete()}))},r)},h=0;h<i;h++)f(h)},r)}}function jc(t,e,n){t?gn(n,t,e):e()}function Ph(t,e,n,r,i,o,c,l){var f=[],h=0,d=0,g=!1,m=function(){g&&!f.length&&!h&&e.complete()},b=function(E){return h<r?w(E):f.push(E)},w=function(E){h++;var j=!1;Vt(n(E,d++)).subscribe(St(e,function(F){e.next(F)},function(){j=!0},void 0,function(){if(j)try{h--;for(var F=function(){var B=f.shift();c||w(B)};f.length&&h<r;)F();m()}catch(B){e.error(B)}}))};return t.subscribe(St(e,b,function(){g=!0,m()})),function(){}}function ci(t,e,n){return n===void 0&&(n=1/0),Te(e)?ci(function(r,i){return bt(function(o,c){return e(r,o,i,c)})(Vt(t(r,i)))},n):(typeof e=="number"&&(n=e),xt(function(r,i){return Ph(r,i,t,n)}))}function uu(t){return t===void 0&&(t=1/0),ci(hr,t)}function Uh(){return uu(1)}function Lc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Uh()(_t(t,ai(t)))}var jh=["addListener","removeListener"],Lh=["addEventListener","removeEventListener"],Nh=["on","off"];function Kt(t,e,n,r){if(Te(n)&&(r=n,n=void 0),r)return Kt(t,e,n).pipe(lu(r));var i=Ln(Bh(t)?Lh.map(function(l){return function(f){return t[l](e,f,n)}}):Mh(t)?jh.map(Nc(t,e)):Kh(t)?Nh.map(Nc(t,e)):[],2),o=i[0],c=i[1];if(!o&&Ea(t))return ci(function(l){return Kt(l,e,n)})(Vt(t));if(!o)throw new TypeError("Invalid event target");return new Ye(function(l){var f=function(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];return l.next(1<h.length?h:h[0])};return o(f),function(){return c(f)}})}function Nc(t,e){return function(n){return function(r){return t[n](e,r)}}}function Mh(t){return Te(t.addListener)&&Te(t.removeListener)}function Kh(t){return Te(t.on)&&Te(t.off)}function Bh(t){return Te(t.addEventListener)&&Te(t.removeEventListener)}function fu(t,e,n){t===void 0&&(t=0),n===void 0&&(n=sh);var r=-1;return e!=null&&(Jl(e)?n=e:r=e),new Ye(function(i){var o=kh(t)?+t-n.now():t;o<0&&(o=0);var c=0;return n.schedule(function(){i.closed||(i.next(c++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function Es(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ai(t),r=ah(t,1/0),i=t;return i.length?i.length===1?Vt(i[0]):uu(r)(_t(i,n)):Gl}function Ct(t,e){return xt(function(n,r){var i=0;n.subscribe(St(r,function(o){return t.call(e,o,i++)&&r.next(o)}))})}function Yo(t){return xt(function(e,n){var r=null,i=!1,o;r=e.subscribe(St(n,void 0,void 0,function(c){o=Vt(t(c,Yo(t)(e))),r?(r.unsubscribe(),r=null,o.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(n))})}function Mc(t,e){return e===void 0&&(e=Sa),xt(function(n,r){var i=null,o=null,c=null,l=function(){if(i){i.unsubscribe(),i=null;var h=o;o=null,r.next(h)}};function f(){var h=c+t,d=e.now();if(d<h){i=this.schedule(void 0,h-d),r.add(i);return}l()}n.subscribe(St(r,function(h){o=h,c=e.now(),i||(i=e.schedule(f,t),r.add(i))},function(){l(),r.complete()},void 0,function(){o=i=null}))})}function Xn(t){return t<=0?function(){return Gl}:xt(function(e,n){var r=0;e.subscribe(St(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function Fh(t){return bt(function(){return t})}function $h(t,e){return ci(function(n,r){return t(n,r).pipe(Xn(1),Fh(n))})}function du(t,e){e===void 0&&(e=Sa);var n=fu(t,e);return $h(function(){return n})}function hu(t,e){return e===void 0&&(e=hr),t=t??qh,xt(function(n,r){var i,o=!0;n.subscribe(St(r,function(c){var l=e(c);(o||!t(i,l))&&(o=!1,i=l,r.next(c))}))})}function qh(t,e){return t===e}function Vh(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new Nn}:e,r=t.resetOnError,i=r===void 0?!0:r,o=t.resetOnComplete,c=o===void 0?!0:o,l=t.resetOnRefCountZero,f=l===void 0?!0:l;return function(h){var d,g,m,b=0,w=!1,E=!1,j=function(){g==null||g.unsubscribe(),g=void 0},F=function(){j(),d=m=void 0,w=E=!1},B=function(){var L=d;F(),L==null||L.unsubscribe()};return xt(function(L,G){b++,!E&&!w&&j();var ne=m=m??n();G.add(function(){b--,b===0&&!E&&!w&&(g=xo(B,f))}),ne.subscribe(G),!d&&b>0&&(d=new sr({next:function(Z){return ne.next(Z)},error:function(Z){E=!0,j(),g=xo(F,i,Z),ne.error(Z)},complete:function(){w=!0,j(),g=xo(F,c),ne.complete()}}),Vt(L).subscribe(d))})(h)}}function xo(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(e===!0){t();return}if(e!==!1){var i=new sr({next:function(){i.unsubscribe(),t()}});return e.apply(void 0,ir([],Ln(n))).subscribe(i)}}function Kc(t){return Ct(function(e,n){return t<=n})}function pu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ai(t);return xt(function(r,i){(n?Lc(t,r,n):Lc(t,r)).subscribe(i)})}function ut(t,e){return xt(function(n,r){var i=null,o=0,c=!1,l=function(){return c&&!i&&r.complete()};n.subscribe(St(r,function(f){i==null||i.unsubscribe();var h=0,d=o++;Vt(t(f,d)).subscribe(i=St(r,function(g){return r.next(e?e(f,g,d,h++):g)},function(){i=null,l()}))},function(){c=!0,l()}))})}function Go(t,e,n){var r=Te(t)||e||n?{next:t,error:e,complete:n}:t;return r?xt(function(i,o){var c;(c=r.subscribe)===null||c===void 0||c.call(r);var l=!0;i.subscribe(St(o,function(f){var h;(h=r.next)===null||h===void 0||h.call(r,f),o.next(f)},function(){var f;l=!1,(f=r.complete)===null||f===void 0||f.call(r),o.complete()},function(f){var h;l=!1,(h=r.error)===null||h===void 0||h.call(r,f),o.error(f)},function(){var f,h;l&&((f=r.unsubscribe)===null||f===void 0||f.call(r)),(h=r.finalize)===null||h===void 0||h.call(r)}))}):hr}const Zt=Math.floor,Zi=Math.abs,yu=(t,e)=>t<e?t:e,pr=(t,e)=>t>e?t:e,gu=t=>t!==0?t<0:1/t<0,Bc=1,Fc=2,Eo=4,Co=8,Qr=32,Qt=64,kt=128,Cs=31,Jo=63,jn=127,Wh=2147483647,mu=Number.MAX_SAFE_INTEGER,Hh=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Zt(t)===t),Mn=()=>new Set,Io=t=>t[t.length-1],zh=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},wn=Array.from,Yh=Array.isArray,Gh=t=>t.toLowerCase(),Jh=/^\s*/g,Xh=t=>t.replace(Jh,""),Qh=/([A-Z])/g,$c=(t,e)=>Xh(t.replace(Qh,n=>`${e}${Gh(n)}`)),Zh=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},Zr=typeof TextEncoder<"u"?new TextEncoder:null,ep=t=>Zr.encode(t),tp=Zr?ep:Zh;let $r=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});$r&&$r.decode(new Uint8Array).length===1&&($r=null);class yr{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const gr=()=>new yr,np=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},wt=t=>{const e=new Uint8Array(np(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},rp=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(pr(n,e)*2),t.cpos=0)},Ze=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},Xo=Ze,ye=(t,e)=>{for(;e>jn;)Ze(t,kt|jn&e),e=Zt(e/128);Ze(t,jn&e)},Ca=(t,e)=>{const n=gu(e);for(n&&(e=-e),Ze(t,(e>Jo?kt:0)|(n?Qt:0)|Jo&e),e=Zt(e/64);e>0;)Ze(t,(e>jn?kt:0)|jn&e),e=Zt(e/128)},Qo=new Uint8Array(3e4),ip=Qo.length/3,sp=(t,e)=>{if(e.length<ip){const n=Zr.encodeInto(e,Qo).written||0;ye(t,n);for(let r=0;r<n;r++)Ze(t,Qo[r])}else tt(t,tp(e))},op=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;ye(t,r);for(let i=0;i<r;i++)Ze(t,n.codePointAt(i))},It=Zr&&Zr.encodeInto?sp:op,ap=(t,e)=>li(t,wt(e)),li=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=yu(n-r,e.length),o=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,o>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(pr(n*2,o)),t.cbuf.set(e.subarray(i)),t.cpos=o)},tt=(t,e)=>{ye(t,e.byteLength),li(t,e)},Is=(t,e)=>{rp(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},cp=(t,e)=>Is(t,4).setFloat32(0,e,!1),lp=(t,e)=>Is(t,8).setFloat64(0,e,!1),up=(t,e)=>Is(t,8).setBigInt64(0,e,!1),qc=(t,e)=>Is(t,8).setBigUint64(0,e,!1),Vc=new DataView(new ArrayBuffer(4)),fp=t=>(Vc.setFloat32(0,t),Vc.getFloat32(0)===t),mn=(t,e)=>{switch(typeof e){case"string":Ze(t,119),It(t,e);break;case"number":Hh(e)&&Zi(e)<=Wh?(Ze(t,125),Ca(t,e)):fp(e)?(Ze(t,124),cp(t,e)):(Ze(t,123),lp(t,e));break;case"bigint":Ze(t,122),up(t,e);break;case"object":if(e===null)Ze(t,126);else if(Yh(e)){Ze(t,117),ye(t,e.length);for(let n=0;n<e.length;n++)mn(t,e[n])}else if(e instanceof Uint8Array)Ze(t,116),tt(t,e);else{Ze(t,118);const n=Object.keys(e);ye(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];It(t,i),mn(t,e[i])}}break;case"boolean":Ze(t,e?120:121);break;default:Ze(t,127)}};class Wc extends yr{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ye(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const Hc=t=>{t.count>0&&(Ca(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ye(t.encoder,t.count-2))};class es{constructor(){this.encoder=new yr,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Hc(this),this.count=1,this.s=e)}toUint8Array(){return Hc(this),wt(this.encoder)}}const zc=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Ca(t.encoder,e),t.count>1&&ye(t.encoder,t.count-2)}};class Oo{constructor(){this.encoder=new yr,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(zc(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return zc(this),wt(this.encoder)}}class dp{constructor(){this.sarr=[],this.s="",this.lensE=new es}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new yr;return this.sarr.push(this.s),this.s="",It(e,this.sarr.join("")),li(e,this.lensE.toUint8Array()),wt(e)}}const _n=t=>new Error(t),Bt=()=>{throw _n("Method unimplemented")},Ft=()=>{throw _n("Unexpected case")},vu=_n("Unexpected end of array"),bu=_n("Integer out of Range");class mr{constructor(e){this.arr=e,this.pos=0}}const ui=t=>new mr(t),wu=t=>t.pos!==t.arr.length,hp=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},nt=t=>hp(t,Ue(t)),or=t=>t.arr[t.pos++],Ue=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&jn)*n,n*=128,i<kt)return e;if(e>mu)throw bu}throw vu},Ia=t=>{let e=t.arr[t.pos++],n=e&Jo,r=64;const i=(e&Qt)>0?-1:1;if(!(e&kt))return i*n;const o=t.arr.length;for(;t.pos<o;){if(e=t.arr[t.pos++],n=n+(e&jn)*r,r*=128,e<kt)return i*n;if(n>mu)throw bu}throw vu},pp=t=>{let e=Ue(t);if(e===0)return"";{let n=String.fromCodePoint(or(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(or(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},yp=t=>$r.decode(nt(t)),Ot=$r?yp:pp,Os=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},gp=t=>Os(t,4).getFloat32(0,!1),mp=t=>Os(t,8).getFloat64(0,!1),vp=t=>Os(t,8).getBigInt64(0,!1),Yc=t=>Os(t,8).getBigUint64(0,!1),bp=[t=>{},t=>null,Ia,gp,mp,vp,t=>!1,t=>!0,Ot,t=>{const e=Ue(t),n={};for(let r=0;r<e;r++){const i=Ot(t);n[i]=vn(t)}return n},t=>{const e=Ue(t),n=[];for(let r=0;r<e;r++)n.push(vn(t));return n},nt],vn=t=>bp[127-or(t)](t);class Gc extends mr{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),wu(this)?this.count=Ue(this)+1:this.count=-1),this.count--,this.s}}class ts extends mr{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Ia(this);const e=gu(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ue(this)+2)}return this.count--,this.s}}class Ao extends mr{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Ia(this),n=e&1;this.diff=Zt(e/2),this.count=1,n&&(this.count=Ue(this)+2)}return this.s+=this.diff,this.count--,this.s}}class wp{constructor(e){this.decoder=new ts(e),this.str=Ot(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const yt=()=>new Map,Zo=t=>{const e=yt();return t.forEach((n,r)=>{e.set(r,n)}),e},tn=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},_p=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},kp=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1};class Sp{constructor(){this._observers=yt()}on(e,n){return tn(this._observers,e,Mn).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return wn((this._observers.get(e)||yt()).values()).forEach(r=>r(...n))}destroy(){this._observers=yt()}}class xp{constructor(){this._observers=yt()}on(e,n){tn(this._observers,e,Mn).add(n)}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return wn((this._observers.get(e)||yt()).values()).forEach(r=>r(...n))}destroy(){this._observers=yt()}}const Ep=crypto.getRandomValues.bind(crypto),_u=()=>Ep(new Uint32Array(1))[0],Cp="10000000-1000-4000-8000"+-1e11,Ip=()=>Cp.replace(/[018]/g,t=>(t^_u()&15>>t/4).toString(16)),cs=Date.now,Jc=t=>new Promise(t);Promise.all.bind(Promise);const Xc=t=>t===void 0?null:t;class Op{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let ku=new Op,Ap=!0;try{typeof localStorage<"u"&&localStorage&&(ku=localStorage,Ap=!1)}catch{}const Dp=ku,Tp=Object.assign,Su=Object.keys,Rp=(t,e)=>{for(const n in t)e(t[n],n)},Qc=t=>Su(t).length,Zc=t=>Su(t).length,Pp=t=>{for(const e in t)return!1;return!0},Up=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},xu=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),jp=(t,e)=>t===e||Zc(t)===Zc(e)&&Up(t,(n,r)=>(n!==void 0||xu(e,r))&&e[r]===n),Lp=Object.freeze,Eu=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Eu(t[e])}return Lp(t)},Oa=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Oa(t,e,n+1)}},Np=(t,e)=>t===e,qr=(t,e)=>{if(t==null||e==null)return Np(t,e);if(t.constructor!==e.constructor)return!1;if(t===e)return!0;switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:{if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break}case Set:{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break}case Map:{if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!qr(t.get(n),e.get(n)))return!1;break}case Object:if(Qc(t)!==Qc(e))return!1;for(const n in t)if(!xu(t,n)||!qr(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!qr(t[n],e[n]))return!1;break;default:return!1}return!0},Mp=(t,e)=>e.includes(t);var Cu={};const ei=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Lt;const Kp=()=>{if(Lt===void 0)if(ei){Lt=yt();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Lt.set(e,""),e=r):e!==null&&(Lt.set(e,r),e=null)}e!==null&&Lt.set(e,"")}else typeof location=="object"?(Lt=yt(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Lt.set(`--${$c(e,"-")}`,n),Lt.set(`-${$c(e,"-")}`,n)}})):Lt=yt();return Lt},ea=t=>Kp().has(t),ls=t=>Xc(ei?Cu[t.toUpperCase().replaceAll("-","_")]:Dp.getItem(t)),Iu=t=>ea("--"+t)||ls(t)!==null;Iu("production");const Bp=ei&&Mp(Cu.FORCE_COLOR,["true","1","2"]),Fp=Bp||!ea("--no-colors")&&!Iu("no-color")&&(!ei||process.stdout.isTTY)&&(!ei||ea("--color")||ls("COLORTERM")!==null||(ls("TERM")||"").includes("color"));class $p{constructor(e,n){this.left=e,this.right=n}}const zt=(t,e)=>new $p(t,e);typeof DOMParser<"u"&&new DOMParser;const qp=t=>_p(t,(e,n)=>`${n}:${e};`).join(""),nn=Symbol,Ou=nn(),Au=nn(),Vp=nn(),Wp=nn(),Hp=nn(),Du=nn(),zp=nn(),Aa=nn(),Yp=nn(),Gp=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const o=t[r];if(o===void 0)break;if(o.constructor===String||o.constructor===Number)e.push(o);else if(o.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const o=t[r];o instanceof Symbol||n.push(o)}return n},Jp={[Ou]:zt("font-weight","bold"),[Au]:zt("font-weight","normal"),[Vp]:zt("color","blue"),[Hp]:zt("color","green"),[Wp]:zt("color","grey"),[Du]:zt("color","red"),[zp]:zt("color","purple"),[Aa]:zt("color","orange"),[Yp]:zt("color","black")},Xp=t=>{var c;t.length===1&&((c=t[0])==null?void 0:c.constructor)===Function&&(t=t[0]());const e=[],n=[],r=yt();let i=[],o=0;for(;o<t.length;o++){const l=t[o],f=Jp[l];if(f!==void 0)r.set(f.left,f.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){const h=qp(r);o>0||h.length>0?(e.push("%c"+l),n.push(h)):e.push(l)}else break}}for(o>0&&(i=n,i.unshift(e.join("")));o<t.length;o++){const l=t[o];l instanceof Symbol||i.push(l)}return i},Tu=Fp?Xp:Gp,Qp=(...t)=>{console.log(...Tu(t)),Ru.forEach(e=>e.print(t))},Zp=(...t)=>{console.warn(...Tu(t)),t.unshift(Aa),Ru.forEach(e=>e.print(t))},Ru=Mn(),Pu=t=>({[Symbol.iterator](){return this},next:t}),ey=(t,e)=>Pu(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Do=(t,e)=>Pu(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Uu{constructor(e,n){this.clock=e,this.len=n}}class As{constructor(){this.clients=new Map}}const ju=(t,e,n)=>e.clients.forEach((r,i)=>{const o=t.doc.store.clients.get(i);if(o!=null){const c=o[o.length-1],l=c.id.clock+c.length;for(let f=0,h=r[f];f<r.length&&h.clock<l;h=r[++f])Vu(t,o,h.clock,h.len,n)}}),ty=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Zt((n+r)/2),o=t[i],c=o.clock;if(c<=e){if(e<c+o.len)return i;n=i+1}else r=i-1}return null},Lu=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&ty(n,e.clock)!==null},Da=t=>{t.clients.forEach(e=>{e.sort((i,o)=>i.clock-o.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],o=e[n];i.clock+i.len>=o.clock?i.len=pr(i.len,o.clock+o.len-i.clock):(r<n&&(e[r]=o),r++)}e.length=r})},ny=t=>{const e=new As;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const o=r.slice();for(let c=n+1;c<t.length;c++)zh(o,t[c].clients.get(i)||[]);e.clients.set(i,o)}});return Da(e),e},us=(t,e,n,r)=>{tn(t.clients,e,()=>[]).push(new Uu(n,r))},Ta=(t,e)=>{ye(t.restEncoder,e.clients.size),wn(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),ye(t.restEncoder,n);const i=r.length;ye(t.restEncoder,i);for(let o=0;o<i;o++){const c=r[o];t.writeDsClock(c.clock),t.writeDsLen(c.len)}})},ry=t=>{const e=new As,n=Ue(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Ue(t.restDecoder),o=Ue(t.restDecoder);if(o>0){const c=tn(e.clients,i,()=>[]);for(let l=0;l<o;l++)c.push(new Uu(t.readDsClock(),t.readDsLen()))}}return e},el=(t,e,n)=>{const r=new As,i=Ue(t.restDecoder);for(let o=0;o<i;o++){t.resetDsCurVal();const c=Ue(t.restDecoder),l=Ue(t.restDecoder),f=n.clients.get(c)||[],h=et(n,c);for(let d=0;d<l;d++){const g=t.readDsClock(),m=g+t.readDsLen();if(g<h){h<m&&us(r,c,h,m-h);let b=$t(f,g),w=f[b];for(!w.deleted&&w.id.clock<g&&(f.splice(b+1,0,ms(e,w,g-w.id.clock)),b++);b<f.length&&(w=f[b++],w.id.clock<m);)w.deleted||(m<w.id.clock+w.length&&f.splice(b,0,ms(e,w,m-w.id.clock)),w.delete(e))}else us(r,c,g,m-g)}}if(r.clients.size>0){const o=new Ds;return ye(o.restEncoder,0),Ta(o,r),o.toUint8Array()}return null},Nu=_u;class vr extends Sp{constructor({guid:e=Ip(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:o=null,autoLoad:c=!1,shouldLoad:l=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Nu(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new $u,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=c,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Jc(h=>{this.on("load",()=>{this.isLoaded=!0,h(this)})});const f=()=>Jc(h=>{const d=g=>{(g===void 0||g===!0)&&(this.off("sync",d),h())};this.on("sync",d)});this.on("sync",h=>{h===!1&&this.isSynced&&(this.whenSynced=f()),this.isSynced=h===void 0||h===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=f()}load(){const e=this._item;e!==null&&!this.shouldLoad&&je(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(wn(this.subdocs).map(e=>e.guid))}transact(e,n=null){return je(this,e,n)}get(e,n=it){const r=tn(this.share,e,()=>{const o=new n;return o._integrate(this,null),o}),i=r.constructor;if(n!==it&&i!==n)if(i===it){const o=new n;o._map=r._map,r._map.forEach(c=>{for(;c!==null;c=c.left)c.parent=o}),o._start=r._start;for(let c=o._start;c!==null;c=c.right)c.parent=o;return o._length=r._length,this.share.set(e,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,tr)}getText(e=""){return this.get(e,cr)}getMap(e=""){return this.get(e,ar)}getXmlElement(e=""){return this.get(e,lr)}getXmlFragment(e=""){return this.get(e,Kn)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,wn(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new vr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,je(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class iy{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ue(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ue(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class ti extends iy{constructor(e){super(e),this.keys=[],Ue(e),this.keyClockDecoder=new Ao(nt(e)),this.clientDecoder=new ts(nt(e)),this.leftClockDecoder=new Ao(nt(e)),this.rightClockDecoder=new Ao(nt(e)),this.infoDecoder=new Gc(nt(e),or),this.stringDecoder=new wp(nt(e)),this.parentInfoDecoder=new Gc(nt(e),or),this.typeRefDecoder=new ts(nt(e)),this.lenDecoder=new ts(nt(e))}readLeftID(){return new er(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new er(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return vn(this.restDecoder)}readBuf(){return nt(this.restDecoder)}readJSON(){return vn(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class sy{constructor(){this.restEncoder=gr()}toUint8Array(){return wt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ye(this.restEncoder,e)}writeDsLen(e){ye(this.restEncoder,e)}}class oy extends sy{writeLeftID(e){ye(this.restEncoder,e.client),ye(this.restEncoder,e.clock)}writeRightID(e){ye(this.restEncoder,e.client),ye(this.restEncoder,e.clock)}writeClient(e){ye(this.restEncoder,e)}writeInfo(e){Xo(this.restEncoder,e)}writeString(e){It(this.restEncoder,e)}writeParentInfo(e){ye(this.restEncoder,e?1:0)}writeTypeRef(e){ye(this.restEncoder,e)}writeLen(e){ye(this.restEncoder,e)}writeAny(e){mn(this.restEncoder,e)}writeBuf(e){tt(this.restEncoder,e)}writeJSON(e){It(this.restEncoder,JSON.stringify(e))}writeKey(e){It(this.restEncoder,e)}}class Mu{constructor(){this.restEncoder=gr(),this.dsCurrVal=0}toUint8Array(){return wt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,ye(this.restEncoder,n)}writeDsLen(e){e===0&&Ft(),ye(this.restEncoder,e-1),this.dsCurrVal+=e}}class Ds extends Mu{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Oo,this.clientEncoder=new es,this.leftClockEncoder=new Oo,this.rightClockEncoder=new Oo,this.infoEncoder=new Wc(Xo),this.stringEncoder=new dp,this.parentInfoEncoder=new Wc(Xo),this.typeRefEncoder=new es,this.lenEncoder=new es}toUint8Array(){const e=gr();return ye(e,0),tt(e,this.keyClockEncoder.toUint8Array()),tt(e,this.clientEncoder.toUint8Array()),tt(e,this.leftClockEncoder.toUint8Array()),tt(e,this.rightClockEncoder.toUint8Array()),tt(e,wt(this.infoEncoder)),tt(e,this.stringEncoder.toUint8Array()),tt(e,wt(this.parentInfoEncoder)),tt(e,this.typeRefEncoder.toUint8Array()),tt(e,this.lenEncoder.toUint8Array()),li(e,wt(this.restEncoder)),wt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){mn(this.restEncoder,e)}writeBuf(e){tt(this.restEncoder,e)}writeJSON(e){mn(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const ay=(t,e,n,r)=>{r=pr(r,e[0].id.clock);const i=$t(e,r);ye(t.restEncoder,e.length-i),t.writeClient(n),ye(t.restEncoder,r);const o=e[i];o.write(t,r-o.id.clock);for(let c=i+1;c<e.length;c++)e[c].write(t,0)},Ku=(t,e,n)=>{const r=new Map;n.forEach((i,o)=>{et(e,o)>i&&r.set(o,i)}),Ra(e).forEach((i,o)=>{n.has(o)||r.set(o,0)}),ye(t.restEncoder,r.size),wn(r.entries()).sort((i,o)=>o[0]-i[0]).forEach(([i,o])=>{ay(t,e.clients.get(i),i,o)})},cy=(t,e)=>{const n=yt(),r=Ue(t.restDecoder);for(let i=0;i<r;i++){const o=Ue(t.restDecoder),c=new Array(o),l=t.readClient();let f=Ue(t.restDecoder);n.set(l,{i:0,refs:c});for(let h=0;h<o;h++){const d=t.readInfo();switch(Cs&d){case 0:{const g=t.readLen();c[h]=new At(Ce(l,f),g),f+=g;break}case 10:{const g=Ue(t.restDecoder);c[h]=new Dt(Ce(l,f),g),f+=g;break}default:{const g=(d&(Qt|kt))===0,m=new ze(Ce(l,f),null,(d&kt)===kt?t.readLeftID():null,null,(d&Qt)===Qt?t.readRightID():null,g?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,g&&(d&Qr)===Qr?t.readString():null,df(t,d));c[h]=m,f+=m.length}}}}return n},ly=(t,e,n)=>{const r=[];let i=wn(n.keys()).sort((b,w)=>b-w);if(i.length===0)return null;const o=()=>{if(i.length===0)return null;let b=n.get(i[i.length-1]);for(;b.refs.length===b.i;)if(i.pop(),i.length>0)b=n.get(i[i.length-1]);else return null;return b};let c=o();if(c===null)return null;const l=new $u,f=new Map,h=(b,w)=>{const E=f.get(b);(E==null||E>w)&&f.set(b,w)};let d=c.refs[c.i++];const g=new Map,m=()=>{for(const b of r){const w=b.id.client,E=n.get(w);E?(E.i--,l.clients.set(w,E.refs.slice(E.i)),n.delete(w),E.i=0,E.refs=[]):l.clients.set(w,[b]),i=i.filter(j=>j!==w)}r.length=0};for(;;){if(d.constructor!==Dt){const w=tn(g,d.id.client,()=>et(e,d.id.client))-d.id.clock;if(w<0)r.push(d),h(d.id.client,d.id.clock-1),m();else{const E=d.getMissing(t,e);if(E!==null){r.push(d);const j=n.get(E)||{refs:[],i:0};if(j.refs.length===j.i)h(E,et(e,E)),m();else{d=j.refs[j.i++];continue}}else(w===0||w<d.length)&&(d.integrate(t,w),g.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(c!==null&&c.i<c.refs.length)d=c.refs[c.i++];else{if(c=o(),c===null)break;d=c.refs[c.i++]}}if(l.clients.size>0){const b=new Ds;return Ku(b,l,new Map),ye(b.restEncoder,0),{missing:f,update:b.toUint8Array()}}return null},uy=(t,e)=>Ku(t,e.doc.store,e.beforeState),fy=(t,e,n,r=new ti(t))=>je(e,i=>{i.local=!1;let o=!1;const c=i.doc,l=c.store,f=cy(r,c),h=ly(i,l,f),d=l.pendingStructs;if(d){for(const[m,b]of d.missing)if(b<et(l,m)){o=!0;break}if(h){for(const[m,b]of h.missing){const w=d.missing.get(m);(w==null||w>b)&&d.missing.set(m,b)}d.update=fs([d.update,h.update])}}else l.pendingStructs=h;const g=el(r,i,l);if(l.pendingDs){const m=new ti(ui(l.pendingDs));Ue(m.restDecoder);const b=el(m,i,l);g&&b?l.pendingDs=fs([g,b]):l.pendingDs=g||b}else l.pendingDs=g;if(o){const m=l.pendingStructs.update;l.pendingStructs=null,Bu(i.doc,m)}},n,!1),Bu=(t,e,n,r=ti)=>{const i=ui(e);fy(i,t,n,new r(i))};class dy{constructor(){this.l=[]}}const tl=()=>new dy,nl=(t,e)=>t.l.push(e),rl=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Fu=(t,e,n)=>Oa(t.l,[e,n]);class er{constructor(e,n){this.client=e,this.clock=n}}const $i=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Ce=(t,e)=>new er(t,e),hy=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Ft()},Qn=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Lu(e.ds,t.id),ta=(t,e)=>{const n=tn(t.meta,ta,Mn),r=t.doc.store;n.has(e)||(e.sv.forEach((i,o)=>{i<et(r,o)&&kn(t,Ce(o,i))}),ju(t,e.ds,i=>{}),n.add(e))};class $u{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ra=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},et=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},qu=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Ft()}n.push(e)},$t=(t,e)=>{let n=0,r=t.length-1,i=t[r],o=i.id.clock;if(o===e)return r;let c=Zt(e/(o+i.length-1)*r);for(;n<=r;){if(i=t[c],o=i.id.clock,o<=e){if(e<o+i.length)return c;n=c+1}else r=c-1;c=Zt((n+r)/2)}throw Ft()},py=(t,e)=>{const n=t.clients.get(e.client);return n[$t(n,e.clock)]},To=py,na=(t,e,n)=>{const r=$t(e,n),i=e[r];return i.id.clock<n&&i instanceof ze?(e.splice(r+1,0,ms(t,i,n-i.id.clock)),r+1):r},kn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[na(t,n,e.clock)]},il=(t,e,n)=>{const r=e.clients.get(n.client),i=$t(r,n.clock),o=r[i];return n.clock!==o.id.clock+o.length-1&&o.constructor!==At&&r.splice(i+1,0,ms(t,o,n.clock-o.id.clock+1)),o},yy=(t,e,n)=>{const r=t.clients.get(e.id.client);r[$t(r,e.id.clock)]=n},Vu=(t,e,n,r,i)=>{if(r===0)return;const o=n+r;let c=na(t,e,n),l;do l=e[c++],o<l.id.clock+l.length&&na(t,e,o),i(l);while(c<e.length&&e[c].id.clock<o)};class gy{constructor(e,n,r){this.doc=e,this.deleteSet=new As,this.beforeState=Ra(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const sl=(t,e)=>e.deleteSet.clients.size===0&&!kp(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(Da(e.deleteSet),uy(t,e),Ta(t,e.deleteSet),!0),ol=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&tn(t.changed,e,Mn).add(n)},ns=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof ze&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const o=e-i;return o&&t.splice(e+1-o,o),o},my=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const o=e.clients.get(r);for(let c=i.length-1;c>=0;c--){const l=i[c],f=l.clock+l.len;for(let h=$t(o,l.clock),d=o[h];h<o.length&&d.id.clock<f;d=o[++h]){const g=o[h];if(l.clock+l.len<=g.id.clock)break;g instanceof ze&&g.deleted&&!g.keep&&n(g)&&g.gc(e,!1)}}}},vy=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let o=n.length-1;o>=0;o--){const c=n[o],l=yu(i.length-1,1+$t(i,c.clock+c.len-1));for(let f=l,h=i[f];f>0&&h.id.clock>=c.clock;h=i[f])f-=1+ns(i,f)}})},Wu=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,o=n.deleteSet,c=n._mergeStructs;try{Da(o),n.afterState=Ra(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const l=[];n.changed.forEach((f,h)=>l.push(()=>{(h._item===null||!h._item.deleted)&&h._callObserver(n,f)})),l.push(()=>{n.changedParentTypes.forEach((f,h)=>{h._dEH.l.length>0&&(h._item===null||!h._item.deleted)&&(f=f.filter(d=>d.target._item===null||!d.target._item.deleted),f.forEach(d=>{d.currentTarget=h,d._path=null}),f.sort((d,g)=>d.path.length-g.path.length),Fu(h._dEH,f,n))})}),l.push(()=>r.emit("afterTransaction",[n,r])),Oa(l,[]),n._needFormattingCleanup&&Ly(n)}finally{r.gc&&my(o,i,r.gcFilter),vy(o,i),n.afterState.forEach((d,g)=>{const m=n.beforeState.get(g)||0;if(m!==d){const b=i.clients.get(g),w=pr($t(b,m),1);for(let E=b.length-1;E>=w;)E-=1+ns(b,E)}});for(let d=c.length-1;d>=0;d--){const{client:g,clock:m}=c[d].id,b=i.clients.get(g),w=$t(b,m);w+1<b.length&&ns(b,w+1)>1||w>0&&ns(b,w)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Qp(Aa,Ou,"[yjs] ",Au,Du,"Changed the client-id because another client seems to be using it."),r.clientID=Nu()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const d=new oy;sl(d,n)&&r.emit("update",[d.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const d=new Ds;sl(d,n)&&r.emit("updateV2",[d.toUint8Array(),n.origin,r,n])}const{subdocsAdded:l,subdocsLoaded:f,subdocsRemoved:h}=n;(l.size>0||h.size>0||f.size>0)&&(l.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),h.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:f,added:l,removed:h},r,n]),h.forEach(d=>d.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):Wu(t,e+1)}}},je=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let o=!1,c=null;t._transaction===null&&(o=!0,t._transaction=new gy(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{c=e(t._transaction)}finally{if(o){const l=t._transaction===i[0];t._transaction=null,l&&Wu(i,0)}}return c};function*by(t){const e=Ue(t.restDecoder);for(let n=0;n<e;n++){const r=Ue(t.restDecoder),i=t.readClient();let o=Ue(t.restDecoder);for(let c=0;c<r;c++){const l=t.readInfo();if(l===10){const f=Ue(t.restDecoder);yield new Dt(Ce(i,o),f),o+=f}else if(Cs&l){const f=(l&(Qt|kt))===0,h=new ze(Ce(i,o),null,(l&kt)===kt?t.readLeftID():null,null,(l&Qt)===Qt?t.readRightID():null,f?t.readParentInfo()?t.readString():t.readLeftID():null,f&&(l&Qr)===Qr?t.readString():null,df(t,l));yield h,o+=h.length}else{const f=t.readLen();yield new At(Ce(i,o),f),o+=f}}}}class Hu{constructor(e,n){this.gen=by(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Dt);return this.curr}}class wy{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const zu=(t,e=Mu,n=ti)=>{const r=new e,i=new Hu(new n(ui(t)),!1);let o=i.curr;if(o!==null){let c=0,l=o.id.client,f=o.id.clock!==0,h=f?0:o.id.clock+o.length;for(;o!==null;o=i.next())l!==o.id.client&&(h!==0&&(c++,ye(r.restEncoder,l),ye(r.restEncoder,h)),l=o.id.client,h=0,f=o.id.clock!==0),o.constructor===Dt&&(f=!0),f||(h=o.id.clock+o.length);h!==0&&(c++,ye(r.restEncoder,l),ye(r.restEncoder,h));const d=gr();return ye(d,c),ap(d,r.restEncoder),r.restEncoder=d,r.toUint8Array()}else return ye(r.restEncoder,0),r.toUint8Array()},_y=(t,e)=>{if(t.constructor===At){const{client:n,clock:r}=t.id;return new At(Ce(n,r+e),t.length-e)}else if(t.constructor===Dt){const{client:n,clock:r}=t.id;return new Dt(Ce(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new ze(Ce(r,i+e),null,Ce(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},fs=(t,e=ti,n=Ds)=>{if(t.length===1)return t[0];const r=t.map(d=>new e(ui(d)));let i=r.map(d=>new Hu(d,!0)),o=null;const c=new n,l=new wy(c);for(;i=i.filter(m=>m.curr!==null),i.sort((m,b)=>{if(m.curr.id.client===b.curr.id.client){const w=m.curr.id.clock-b.curr.id.clock;return w===0?m.curr.constructor===b.curr.constructor?0:m.curr.constructor===Dt?1:-1:w}else return b.curr.id.client-m.curr.id.client}),i.length!==0;){const d=i[0],g=d.curr.id.client;if(o!==null){let m=d.curr,b=!1;for(;m!==null&&m.id.clock+m.length<=o.struct.id.clock+o.struct.length&&m.id.client>=o.struct.id.client;)m=d.next(),b=!0;if(m===null||m.id.client!==g||b&&m.id.clock>o.struct.id.clock+o.struct.length)continue;if(g!==o.struct.id.client)Ur(l,o.struct,o.offset),o={struct:m,offset:0},d.next();else if(o.struct.id.clock+o.struct.length<m.id.clock)if(o.struct.constructor===Dt)o.struct.length=m.id.clock+m.length-o.struct.id.clock;else{Ur(l,o.struct,o.offset);const w=m.id.clock-o.struct.id.clock-o.struct.length;o={struct:new Dt(Ce(g,o.struct.id.clock+o.struct.length),w),offset:0}}else{const w=o.struct.id.clock+o.struct.length-m.id.clock;w>0&&(o.struct.constructor===Dt?o.struct.length-=w:m=_y(m,w)),o.struct.mergeWith(m)||(Ur(l,o.struct,o.offset),o={struct:m,offset:0},d.next())}}else o={struct:d.curr,offset:0},d.next();for(let m=d.curr;m!==null&&m.id.client===g&&m.id.clock===o.struct.id.clock+o.struct.length&&m.constructor!==Dt;m=d.next())Ur(l,o.struct,o.offset),o={struct:m,offset:0}}o!==null&&(Ur(l,o.struct,o.offset),o=null),ky(l);const f=r.map(d=>ry(d)),h=ny(f);return Ta(c,h),c.toUint8Array()},Yu=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:wt(t.encoder.restEncoder)}),t.encoder.restEncoder=gr(),t.written=0)},Ur=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&Yu(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ye(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},ky=t=>{Yu(t);const e=t.encoder.restEncoder;ye(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];ye(e,r.written),li(e,r.restEncoder)}},al="You must not compute changes after the event-handler fired.";class Ts{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Sy(this.currentTarget,this.target))}deletes(e){return Lu(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw _n(al);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const o=n._map.get(i);let c,l;if(this.adds(o)){let f=o.left;for(;f!==null&&this.adds(f);)f=f.left;if(this.deletes(o))if(f!==null&&this.deletes(f))c="delete",l=Io(f.content.getContent());else return;else f!==null&&this.deletes(f)?(c="update",l=Io(f.content.getContent())):(c="add",l=void 0)}else if(this.deletes(o))c="delete",l=Io(o.content.getContent());else return;e.set(i,{action:c,oldValue:l})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw _n(al);const n=this.target,r=Mn(),i=Mn(),o=[];if(e={added:r,deleted:i,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let l=null;const f=()=>{l&&o.push(l)};for(let h=n._start;h!==null;h=h.right)h.deleted?this.deletes(h)&&!this.adds(h)&&((l===null||l.delete===void 0)&&(f(),l={delete:0}),l.delete+=h.length,i.add(h)):this.adds(h)?((l===null||l.insert===void 0)&&(f(),l={insert:[]}),l.insert=l.insert.concat(h.content.getContent()),r.add(h)):((l===null||l.retain===void 0)&&(f(),l={retain:0}),l.retain+=h.length);l!==null&&l.retain===void 0&&f()}this._changes=e}return e}}const Sy=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},dt=()=>{Zp("Invalid access: Add Yjs type to a document before reading data.")},Gu=80;let Pa=0;class xy{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Pa++}}const Ey=t=>{t.timestamp=Pa++},Ju=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Pa++},Cy=(t,e,n)=>{if(t.length>=Gu){const r=t.reduce((i,o)=>i.timestamp<o.timestamp?i:o);return Ju(r,e,n),r}else{const r=new xy(e,n);return t.push(r),r}},Rs=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((o,c)=>Zi(e-o.index)<Zi(e-c.index)?o:c);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,Ey(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Zi(n.index-i)<r.parent.length/Gu?(Ju(n,r,i),n):Cy(t._searchMarker,r,i)},ni=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let o=i.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(i.index-=o.length);if(o===null||o.marker===!0){t.splice(r,1);continue}i.p=o,o.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=pr(e,i.index+n))}},Ps=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;tn(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;Fu(r._eH,n,e)};class it{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=tl(),this._dEH=tl(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Bt()}clone(){throw Bt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){nl(this._eH,e)}observeDeep(e){nl(this._dEH,e)}unobserve(e){rl(this._eH,e)}unobserveDeep(e){rl(this._dEH,e)}toJSON(){}}const Xu=(t,e,n)=>{t.doc??dt(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let o=t._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){const c=o.content.getContent();if(c.length<=e)e-=c.length;else{for(let l=e;l<c.length&&r>0;l++)i.push(c[l]),r--;e=0}}o=o.right}return i},Qu=t=>{t.doc??dt();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},ri=(t,e)=>{let n=0,r=t._start;for(t.doc??dt();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let o=0;o<i.length;o++)e(i[o],n++,t)}r=r.right}},Zu=(t,e)=>{const n=[];return ri(t,(r,i)=>{n.push(e(r,i,t))}),n},Iy=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},ef=(t,e)=>{t.doc??dt();const n=Rs(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},ds=(t,e,n,r)=>{let i=n;const o=t.doc,c=o.clientID,l=o.store,f=n===null?e._start:n.right;let h=[];const d=()=>{h.length>0&&(i=new ze(Ce(c,et(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new Bn(h)),i.integrate(t,0),h=[])};r.forEach(g=>{if(g===null)h.push(g);else switch(g.constructor){case Number:case Object:case Boolean:case Array:case String:h.push(g);break;default:switch(d(),g.constructor){case Uint8Array:case ArrayBuffer:i=new ze(Ce(c,et(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new fi(new Uint8Array(g))),i.integrate(t,0);break;case vr:i=new ze(Ce(c,et(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new di(g)),i.integrate(t,0);break;default:if(g instanceof it)i=new ze(Ce(c,et(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new rn(g)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},tf=()=>_n("Length exceeded!"),nf=(t,e,n,r)=>{if(n>e._length)throw tf();if(n===0)return e._searchMarker&&ni(e._searchMarker,n,r.length),ds(t,e,null,r);const i=n,o=Rs(e,n);let c=e._start;for(o!==null&&(c=o.p,n-=o.index,n===0&&(c=c.prev,n+=c&&c.countable&&!c.deleted?c.length:0));c!==null;c=c.right)if(!c.deleted&&c.countable){if(n<=c.length){n<c.length&&kn(t,Ce(c.id.client,c.id.clock+n));break}n-=c.length}return e._searchMarker&&ni(e._searchMarker,i,r.length),ds(t,e,c,r)},Oy=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((o,c)=>c.index>o.index?c:o,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return ds(t,e,i,n)},rf=(t,e,n,r)=>{if(r===0)return;const i=n,o=r,c=Rs(e,n);let l=e._start;for(c!==null&&(l=c.p,n-=c.index);l!==null&&n>0;l=l.right)!l.deleted&&l.countable&&(n<l.length&&kn(t,Ce(l.id.client,l.id.clock+n)),n-=l.length);for(;r>0&&l!==null;)l.deleted||(r<l.length&&kn(t,Ce(l.id.client,l.id.clock+r)),l.delete(t),r-=l.length),l=l.right;if(r>0)throw tf();e._searchMarker&&ni(e._searchMarker,i,-o+r)},hs=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Ua=(t,e,n,r)=>{const i=e._map.get(n)||null,o=t.doc,c=o.clientID;let l;if(r==null)l=new Bn([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:l=new Bn([r]);break;case Uint8Array:l=new fi(r);break;case vr:l=new di(r);break;default:if(r instanceof it)l=new rn(r);else throw new Error("Unexpected content type")}new ze(Ce(c,et(o.store,c)),i,i&&i.lastId,null,null,e,n,l).integrate(t,0)},ja=(t,e)=>{t.doc??dt();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},sf=t=>{const e={};return t.doc??dt(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},of=(t,e)=>{t.doc??dt();const n=t._map.get(e);return n!==void 0&&!n.deleted},Ay=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let o=r;for(;o!==null&&(!e.sv.has(o.id.client)||o.id.clock>=(e.sv.get(o.id.client)||0));)o=o.left;o!==null&&Qn(o,e)&&(n[i]=o.content.getContent()[o.length-1])}),n},qi=t=>(t.doc??dt(),ey(t._map.entries(),e=>!e[1].deleted));class Dy extends Ts{}class tr extends it{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new tr;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new tr}clone(){const e=new tr;return e.insert(0,this.toArray().map(n=>n instanceof it?n.clone():n)),e}get length(){return this.doc??dt(),this._length}_callObserver(e,n){super._callObserver(e,n),Ps(this,e,new Dy(this,e))}insert(e,n){this.doc!==null?je(this.doc,r=>{nf(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?je(this.doc,n=>{Oy(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?je(this.doc,r=>{rf(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return ef(this,e)}toArray(){return Qu(this)}slice(e=0,n=this.length){return Xu(this,e,n)}toJSON(){return this.map(e=>e instanceof it?e.toJSON():e)}map(e){return Zu(this,e)}forEach(e){ri(this,e)}[Symbol.iterator](){return Iy(this)}_write(e){e.writeTypeRef(tg)}}const Ty=t=>new tr;class Ry extends Ts{constructor(e,n,r){super(e,n),this.keysChanged=r}}class ar extends it{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new ar}clone(){const e=new ar;return this.forEach((n,r)=>{e.set(r,n instanceof it?n.clone():n)}),e}_callObserver(e,n){Ps(this,e,new Ry(this,e,n))}toJSON(){this.doc??dt();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof it?i.toJSON():i}}),e}get size(){return[...qi(this)].length}keys(){return Do(qi(this),e=>e[0])}values(){return Do(qi(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Do(qi(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??dt(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?je(this.doc,n=>{hs(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?je(this.doc,r=>{Ua(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return ja(this,e)}has(e){return of(this,e)}clear(){this.doc!==null?je(this.doc,e=>{this.forEach(function(n,r,i){hs(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(ng)}}const Py=t=>new ar,dn=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&jp(t,e);class ra{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Ft(),this.right.content.constructor){case Ge:this.right.deleted||br(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const cl=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Ge:e.right.deleted||br(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&kn(t,Ce(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Vi=(t,e,n,r)=>{const i=new Map,o=r?Rs(e,n):null;if(o){const c=new ra(o.p.left,o.p,o.index,i);return cl(t,c,n-o.index)}else{const c=new ra(null,e._start,0,i);return cl(t,c,n)}},af=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ge&&dn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,o=i.clientID;r.forEach((c,l)=>{const f=n.left,h=n.right,d=new ze(Ce(o,et(i.store,o)),f,f&&f.lastId,h,h&&h.id,e,null,new Ge(l,c));d.integrate(t,0),n.right=d,n.forward()})},br=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},cf=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Ge&&dn(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},lf=(t,e,n,r)=>{const i=t.doc,o=i.clientID,c=new Map;for(const l in r){const f=r[l],h=n.currentAttributes.get(l)??null;if(!dn(h,f)){c.set(l,h);const{left:d,right:g}=n;n.right=new ze(Ce(o,et(i.store,o)),d,d&&d.lastId,g,g&&g.id,e,null,new Ge(l,f)),n.right.integrate(t,0),n.forward()}}return c},Ro=(t,e,n,r,i)=>{n.currentAttributes.forEach((m,b)=>{i[b]===void 0&&(i[b]=null)});const o=t.doc,c=o.clientID;cf(n,i);const l=lf(t,e,n,i),f=r.constructor===String?new qt(r):r instanceof it?new rn(r):new Fn(r);let{left:h,right:d,index:g}=n;e._searchMarker&&ni(e._searchMarker,n.index,f.getLength()),d=new ze(Ce(c,et(o.store,c)),h,h&&h.lastId,d,d&&d.id,e,null,f),d.integrate(t,0),n.right=d,n.index=g,n.forward(),af(t,e,n,l)},ll=(t,e,n,r,i)=>{const o=t.doc,c=o.clientID;cf(n,i);const l=lf(t,e,n,i);e:for(;n.right!==null&&(r>0||l.size>0&&(n.right.deleted||n.right.content.constructor===Ge));){if(!n.right.deleted)switch(n.right.content.constructor){case Ge:{const{key:f,value:h}=n.right.content,d=i[f];if(d!==void 0){if(dn(d,h))l.delete(f);else{if(r===0)break e;l.set(f,h)}n.right.delete(t)}else n.currentAttributes.set(f,h);break}default:r<n.right.length&&kn(t,Ce(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let f="";for(;r>0;r--)f+=`
`;n.right=new ze(Ce(c,et(o.store,c)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new qt(f)),n.right.integrate(t,0),n.forward()}af(t,e,n,l)},uf=(t,e,n,r,i)=>{let o=e;const c=yt();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===Ge){const h=o.content;c.set(h.key,h)}o=o.right}let l=0,f=!1;for(;e!==o;){if(n===e&&(f=!0),!e.deleted){const h=e.content;switch(h.constructor){case Ge:{const{key:d,value:g}=h,m=r.get(d)??null;(c.get(d)!==h||m===g)&&(e.delete(t),l++,!f&&(i.get(d)??null)===g&&m!==g&&(m===null?i.delete(d):i.set(d,m))),!f&&!e.deleted&&br(i,h);break}}}e=e.right}return l},Uy=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Ge){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},jy=t=>{let e=0;return je(t.doc,n=>{let r=t._start,i=t._start,o=yt();const c=Zo(o);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ge:br(c,i.content);break;default:e+=uf(n,r,i,o,c),o=Zo(c),r=i;break}i=i.right}}),e},Ly=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const o=t.beforeState.get(r)||0;i!==o&&Vu(t,n.store.clients.get(r),o,i,c=>{!c.deleted&&c.content.constructor===Ge&&c.constructor!==At&&e.add(c.parent)})}je(n,r=>{ju(t,t.deleteSet,i=>{if(i instanceof At||!i.parent._hasFormatting||e.has(i.parent))return;const o=i.parent;i.content.constructor===Ge?e.add(o):Uy(r,i)});for(const i of e)jy(i)})},ul=(t,e,n)=>{const r=n,i=Zo(e.currentAttributes),o=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case rn:case Fn:case qt:n<e.right.length&&kn(t,Ce(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}o&&uf(t,o,e.right,i,e.currentAttributes);const c=(e.left||e.right).parent;return c._searchMarker&&ni(c._searchMarker,e.index,-r+n),e};class Ny extends Ts{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];je(e,r=>{const i=new Map,o=new Map;let c=this.target._start,l=null;const f={};let h="",d=0,g=0;const m=()=>{if(l!==null){let b=null;switch(l){case"delete":g>0&&(b={delete:g}),g=0;break;case"insert":(typeof h=="object"||h.length>0)&&(b={insert:h},i.size>0&&(b.attributes={},i.forEach((w,E)=>{w!==null&&(b.attributes[E]=w)}))),h="";break;case"retain":d>0&&(b={retain:d},Pp(f)||(b.attributes=Tp({},f))),d=0;break}b&&n.push(b),l=null}};for(;c!==null;){switch(c.content.constructor){case rn:case Fn:this.adds(c)?this.deletes(c)||(m(),l="insert",h=c.content.getContent()[0],m()):this.deletes(c)?(l!=="delete"&&(m(),l="delete"),g+=1):c.deleted||(l!=="retain"&&(m(),l="retain"),d+=1);break;case qt:this.adds(c)?this.deletes(c)||(l!=="insert"&&(m(),l="insert"),h+=c.content.str):this.deletes(c)?(l!=="delete"&&(m(),l="delete"),g+=c.length):c.deleted||(l!=="retain"&&(m(),l="retain"),d+=c.length);break;case Ge:{const{key:b,value:w}=c.content;if(this.adds(c)){if(!this.deletes(c)){const E=i.get(b)??null;dn(E,w)?w!==null&&c.delete(r):(l==="retain"&&m(),dn(w,o.get(b)??null)?delete f[b]:f[b]=w)}}else if(this.deletes(c)){o.set(b,w);const E=i.get(b)??null;dn(E,w)||(l==="retain"&&m(),f[b]=E)}else if(!c.deleted){o.set(b,w);const E=f[b];E!==void 0&&(dn(E,w)?E!==null&&c.delete(r):(l==="retain"&&m(),w===null?delete f[b]:f[b]=w))}c.deleted||(l==="insert"&&m(),br(i,c.content));break}}c=c.right}for(m();n.length>0;){const b=n[n.length-1];if(b.retain!==void 0&&b.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class cr extends it{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??dt(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new cr}clone(){const e=new cr;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new Ny(this,e,n);Ps(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??dt();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===qt&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?je(this.doc,r=>{const i=new ra(null,this._start,0,new Map);for(let o=0;o<e.length;o++){const c=e[o];if(c.insert!==void 0){const l=!n&&typeof c.insert=="string"&&o===e.length-1&&i.right===null&&c.insert.slice(-1)===`
`?c.insert.slice(0,-1):c.insert;(typeof l!="string"||l.length>0)&&Ro(r,this,i,l,c.attributes||{})}else c.retain!==void 0?ll(r,this,i,c.retain,c.attributes||{}):c.delete!==void 0&&ul(r,i,c.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??dt();const i=[],o=new Map,c=this.doc;let l="",f=this._start;function h(){if(l.length>0){const g={};let m=!1;o.forEach((w,E)=>{m=!0,g[E]=w});const b={insert:l};m&&(b.attributes=g),i.push(b),l=""}}const d=()=>{for(;f!==null;){if(Qn(f,e)||n!==void 0&&Qn(f,n))switch(f.content.constructor){case qt:{const g=o.get("ychange");e!==void 0&&!Qn(f,e)?(g===void 0||g.user!==f.id.client||g.type!=="removed")&&(h(),o.set("ychange",r?r("removed",f.id):{type:"removed"})):n!==void 0&&!Qn(f,n)?(g===void 0||g.user!==f.id.client||g.type!=="added")&&(h(),o.set("ychange",r?r("added",f.id):{type:"added"})):g!==void 0&&(h(),o.delete("ychange")),l+=f.content.str;break}case rn:case Fn:{h();const g={insert:f.content.getContent()[0]};if(o.size>0){const m={};g.attributes=m,o.forEach((b,w)=>{m[w]=b})}i.push(g);break}case Ge:Qn(f,e)&&(h(),br(o,f.content));break}f=f.right}h()};return e||n?je(c,g=>{e&&ta(g,e),n&&ta(g,n),d()},"cleanup"):d(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?je(i,o=>{const c=Vi(o,this,e,!r);r||(r={},c.currentAttributes.forEach((l,f)=>{r[f]=l})),Ro(o,this,c,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?je(i,o=>{const c=Vi(o,this,e,!r);Ro(o,this,c,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?je(r,i=>{ul(i,Vi(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?je(i,o=>{const c=Vi(o,this,e,!1);c.right!==null&&ll(o,this,c,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?je(this.doc,n=>{hs(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?je(this.doc,r=>{Ua(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return ja(this,e)}getAttributes(){return sf(this)}_write(e){e.writeTypeRef(rg)}}const My=t=>new cr;class Po{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??dt()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===lr||n.constructor===Kn)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Kn extends it{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Kn}clone(){const e=new Kn;return e.insert(0,this.toArray().map(n=>n instanceof it?n.clone():n)),e}get length(){return this.doc??dt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Po(this,e)}querySelector(e){e=e.toUpperCase();const r=new Po(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),wn(new Po(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Ps(this,e,new Fy(this,n,e))}toString(){return Zu(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),ri(this,o=>{i.insertBefore(o.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?je(this.doc,r=>{nf(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)je(this.doc,r=>{const i=e&&e instanceof it?e._item:e;ds(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(o=>o===e)+1;if(i===0&&e!==null)throw _n("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?je(this.doc,r=>{rf(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return Qu(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return ef(this,e)}slice(e=0,n=this.length){return Xu(this,e,n)}forEach(e){ri(this,e)}_write(e){e.writeTypeRef(sg)}}const Ky=t=>new Kn;class lr extends Kn{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new lr(this.nodeName)}clone(){const e=new lr(this.nodeName),n=this.getAttributes();return Rp(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof it?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const l in e)r.push(l);r.sort();const i=r.length;for(let l=0;l<i;l++){const f=r[l];n.push(f+'="'+e[f]+'"')}const o=this.nodeName.toLocaleLowerCase(),c=n.length>0?" "+n.join(" "):"";return`<${o}${c}>${super.toString()}</${o}>`}removeAttribute(e){this.doc!==null?je(this.doc,n=>{hs(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?je(this.doc,r=>{Ua(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return ja(this,e)}hasAttribute(e){return of(this,e)}getAttributes(e){return e?Ay(this,e):sf(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),o=this.getAttributes();for(const c in o){const l=o[c];typeof l=="string"&&i.setAttribute(c,l)}return ri(this,c=>{i.appendChild(c.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(ig),e.writeKey(this.nodeName)}}const By=t=>new lr(t.readKey());class Fy extends Ts{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class ps extends ar{constructor(e){super(),this.hookName=e}_copy(){return new ps(this.hookName)}clone(){const e=new ps(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let o;return i!==void 0?o=i.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(e){e.writeTypeRef(og),e.writeKey(this.hookName)}}const $y=t=>new ps(t.readKey());class ys extends cr{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new ys}clone(){const e=new ys;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const o=[];for(const c in e.attributes[i])o.push({key:c,value:e.attributes[i][c]});o.sort((c,l)=>c.key<l.key?-1:1),n.push({nodeName:i,attrs:o})}n.sort((i,o)=>i.nodeName<o.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const o=n[i];r+=`<${o.nodeName}`;for(let c=0;c<o.attrs.length;c++){const l=o.attrs[c];r+=` ${l.key}="${l.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(ag)}}const qy=t=>new ys;class La{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Bt()}mergeWith(e){return!1}write(e,n,r){throw Bt()}integrate(e,n){throw Bt()}}const Vy=0;class At extends La{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),qu(e.doc.store,this)}write(e,n){e.writeInfo(Vy),e.writeLen(this.length-n)}getMissing(e,n){return null}}class fi{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new fi(this.content)}splice(e){throw Bt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const Wy=t=>new fi(t.readBuf());class ii{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ii(this.len)}splice(e){const n=new ii(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){us(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const Hy=t=>new ii(t.readLen()),ff=(t,e)=>new vr({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class di{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new di(ff(this.doc.guid,this.opts))}splice(e){throw Bt()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const zy=t=>new di(ff(t.readString(),t.readAny()));class Fn{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Fn(this.embed)}splice(e){throw Bt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const Yy=t=>new Fn(t.readJSON());class Ge{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ge(this.key,this.value)}splice(e){throw Bt()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Gy=t=>new Ge(t.readKey(),t.readJSON());class gs{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new gs(this.arr)}splice(e){const n=new gs(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const o=this.arr[i];e.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const Jy=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new gs(n)},Xy=ls("node_env")==="development";class Bn{constructor(e){this.arr=e,Xy&&Eu(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Bn(this.arr)}splice(e){const n=new Bn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const o=this.arr[i];e.writeAny(o)}}getRef(){return 8}}const Qy=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Bn(n)};class qt{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new qt(this.str)}splice(e){const n=new qt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Zy=t=>new qt(t.readString()),eg=[Ty,Py,My,By,Ky,$y,qy],tg=0,ng=1,rg=2,ig=3,sg=4,og=5,ag=6;class rn{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new rn(this.type._copy())}splice(e){throw Bt()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const cg=t=>new rn(eg[t.readTypeRef()](t)),ms=(t,e,n)=>{const{client:r,clock:i}=e.id,o=new ze(Ce(r,i+n),e,Ce(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&o.markDeleted(),e.keep&&(o.keep=!0),e.redone!==null&&(o.redone=Ce(e.redone.client,e.redone.clock+n)),e.right=o,o.right!==null&&(o.right.left=o),t._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),e.length=n,o};class ze extends La{constructor(e,n,r,i,o,c,l,f){super(e,f.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=o,this.parent=c,this.parentSub=l,this.redone=null,this.content=f,this.info=this.content.isCountable()?Fc:0}set marker(e){(this.info&Co)>0!==e&&(this.info^=Co)}get marker(){return(this.info&Co)>0}get keep(){return(this.info&Bc)>0}set keep(e){this.keep!==e&&(this.info^=Bc)}get countable(){return(this.info&Fc)>0}get deleted(){return(this.info&Eo)>0}set deleted(e){this.deleted!==e&&(this.info^=Eo)}markDeleted(){this.info|=Eo}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=et(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=et(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===er&&this.id.client!==this.parent.client&&this.parent.clock>=et(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=il(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=kn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===At||this.right&&this.right.constructor===At)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ze?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ze&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===er){const r=To(n,this.parent);r.constructor===At?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=il(e,e.doc.store,Ce(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const o=new Set,c=new Set;for(;i!==null&&i!==this.right;){if(c.add(i),o.add(i),$i(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,o.clear();else if($i(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&c.has(To(e.doc.store,i.origin)))o.has(To(e.doc.store,i.origin))||(r=i,o.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),qu(e.doc.store,this),this.content.integrate(e,this),ol(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new At(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ce(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&$i(e.origin,this.lastId)&&this.right===e&&$i(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),us(e.deleteSet,this.id.client,this.id.clock,this.length),ol(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Ft();this.content.gc(e),n?yy(e,this,new At(this.id,this.length)):this.content=new ii(this.length)}write(e,n){const r=n>0?Ce(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,o=this.parentSub,c=this.content.getRef()&Cs|(r===null?0:kt)|(i===null?0:Qt)|(o===null?0:Qr);if(e.writeInfo(c),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const l=this.parent;if(l._item!==void 0){const f=l._item;if(f===null){const h=hy(l);e.writeParentInfo(!0),e.writeString(h)}else e.writeParentInfo(!1),e.writeLeftID(f.id)}else l.constructor===String?(e.writeParentInfo(!0),e.writeString(l)):l.constructor===er?(e.writeParentInfo(!1),e.writeLeftID(l)):Ft();o!==null&&e.writeString(o)}this.content.write(e,n)}}const df=(t,e)=>lg[e&Cs](t),lg=[()=>{Ft()},Hy,Jy,Wy,Zy,Yy,Gy,cg,Qy,zy,()=>{Ft()}],ug=10;class Dt extends La{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Ft()}write(e,n){e.writeInfo(ug),ye(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const hf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},pf="__ $YJS$ __";hf[pf]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");hf[pf]=!0;const Uo=new FinalizationRegistry(({cache:t,key:e})=>{delete t[e]});function yf(t){var e,n;return(e=(n=t._novip)._docCache)!==null&&e!==void 0?e:n._docCache={cache:{},get size(){return Object.keys(this.cache).length},find(r,i,o){const c=jo(r,i,o),l=this.cache[c];return l?l.deref():void 0},add(r){var i;const{parentTable:o,parentId:c,parentProp:l}=r.meta;if(!o||!l||c==null)throw new Error("Missing Dexie-related metadata in Y.Doc");const f=jo(o,c,l),h=(i=this.cache[f])===null||i===void 0?void 0:i.deref();h&&Uo.unregister(h),this.cache[f]=new WeakRef(r),Uo.register(r,{cache:this.cache,key:f},r)},delete(r){Uo.unregister(r);const i=jo(r.meta.parentTable,r.meta.parentId,r.meta.parentProp),o=this.cache[i];(o==null?void 0:o.deref())===r&&delete this.cache[i]}}}const Vr=new WeakSet;function ia(t){if(Vr.has(t))throw new Error(`Y.Doc ${t.meta.parentId} has been destroyed`)}function jo(t,e,n){return`${t}[${e}].${n}`}function fg(t,e,n,r,i,o){let c=e.find(n,o,r);return c||(c=new vr({meta:{db:t,updatesTable:i,parentProp:r,parentTable:n,parentId:o}}),e.add(c),c.on("destroy",()=>{Vr.add(c),e.delete(c)}),c)}const{getByKeyPath:vv}=Ee;let gf=null;function fl(t){gf=t}function dg(t,e,n,r,i,o){let c=0,l=!0;const f=yn(()=>{ia(e);const g=n.table(i);return Promise.all([(c>0?g.where("i").between(c,1/0,!1).toArray().then(m=>m.filter(b=>xs(b.k,o)===0)):g.where({k:o}).toArray()).then(m=>m),n.table(r).where(":id").equals(o).toArray()])}).subscribe(([g,m])=>{if(g.length>0&&(c=g[g.length-1].i),m.length===0){e.destroy();return}ia(e),g.length>0&&je(e,()=>{g.forEach(b=>{try{fl(b),Bu(e,b.u)}finally{fl(null)}})},t,!1),l&&(l=!1,e.emit("load",[e]))},g=>{t.on("error").fire(g)}),h=(g,m)=>{m!==t&&n.table(i).add({k:o,u:g,f:1}).then(b=>{b===c-1&&++c}).catch(b=>{t.on("error").fire(b)})},d=()=>{f.unsubscribe(),e.off("updateV2",h),e.off("destroy",d)};return e.on("updateV2",h),e.on("destroy",d),d}function mf(){}function hg(t,e){return t===mf?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}function pg(t,e){return t===mf?e:function(){t.apply(this,arguments),e.apply(this,arguments)}}const jr=new WeakMap;function dl(){return Ee.Events(null,"load","sync","error")}class ft{static getOrCreateDocument(e,n,r,i){var o,c;const l=yf(e),f=(c=(o=e.table(n).schema.yProps)===null||o===void 0?void 0:o.find(h=>h.prop===r))===null||c===void 0?void 0:c.updatesTable;if(!f)throw new Error(`Updates table for ${n}.${r} not found`);return fg(e,l,n,r,f,i)}static load(e,n){var r;let i=jr.get(e);return i?(++i.refCount,(n==null?void 0:n.gracePeriod)!=null&&i.graceTimeout<n.gracePeriod&&(i.graceTimeout=n.gracePeriod),i.graceTimer&&(clearTimeout(i.graceTimer),i.graceTimer=null)):(i=new ft(e),i.graceTimeout=(r=n==null?void 0:n.gracePeriod)!==null&&r!==void 0?r:-1,jr.set(e,i)),i}static release(e){if(!e||Vr.has(e))return;const n=jr.get(e);n?--n.refCount<=0&&(n.graceTimeout<0?n._release():n.graceTimer||(n.graceTimer=setTimeout(()=>{n.graceTimer=null,n.refCount===0&&n._release()},n.graceTimeout))):e.destroy()}_release(){this.doc&&Promise.resolve(ft.on("beforeunload").fire(this)).finally(()=>{var e;this.refCount===0&&((e=this.doc)===null||e===void 0||e.destroy())})}static for(e){return jr.get(e)}static get currentUpdateRow(){return gf}get whenLoaded(){return this._whenLoaded||(this._whenLoaded=new Promise((e,n)=>{if(!this.doc){n(new Error("No Y.Doc associated with this provider"));return}this.doc.isLoaded?e():this._error?n(this._error):Vr.has(this.doc)?n(new Ee.AbortError("Document was destroyed before loaded")):(this.on("load",e),this.on("error",n),this.doc.on("destroy",()=>n(new Ee.AbortError("Document was destroyed before loaded"))))})),this._whenLoaded}get whenSynced(){return this._whenSynced||(this._whenSynced=new Promise((e,n)=>{if(!this.doc){n(new Error("No Y.Doc associated with this provider"));return}this.doc.isSynced?e():this._error?n(this._error):Vr.has(this.doc)?n(new Ee.AbortError("Document was destroyed before synced")):(this.on("sync",e),this.on("error",n),this.doc.on("destroy",()=>n(new Ee.AbortError("Document was destroyed before synced"))))})),this._whenSynced}constructor(e){this.refCount=1,this.cleanupHandlers=[],this.graceTimeout=-1,this.doc=null,this.destroyed=!1,this.on=dl(),this.doc=e,this.off=(c,l)=>{var f;return(f=this.on[c])===null||f===void 0?void 0:f.unsubscribe(l)},"dispose"in Symbol&&(this[Symbol.dispose]=()=>ft.release(e)),e.on("load",()=>this.on("load").fire()),e.on("sync",c=>c!==!1&&this.on("sync").fire()),e.on("destroy",this.destroy.bind(this)),this.on("error",c=>{this._error=c});const{db:n,parentTable:r,parentId:i,updatesTable:o}=e.meta||{};if(!n||!r||!o)throw new Error("Missing Dexie-related metadata in Y.Doc. Documents need to be obtained through Y.Doc properties from dexie queries.");if(!n.table(r)||!n.table(o))throw new Error(`Table ${r} or ${o} not found in db`);ia(e),this.stopObserving=dg(this,e,n,r,o,i),ft.on("new").fire(this)}destroy(){var e,n,r;console.debug(`Y.Doc ${(n=(e=this.doc)===null||e===void 0?void 0:e.meta)===null||n===void 0?void 0:n.parentId} was destroyed`),jr.delete(this.doc),this.doc=null,this.destroyed=!0,this.refCount=0,(r=this.stopObserving)===null||r===void 0||r.call(this),this.on=dl(),this.cleanupHandlers.forEach(i=>i())}addCleanupHandler(e){this.cleanupHandlers.push(typeof e=="function"?e:()=>e.unsubscribe())}}ft.on=Ee.Events(null,{new:[pg],beforeunload:[hg]});ft.getDocCache=yf;Ee.DexieYProvider?ft=Ee.DexieYProvider||ft:Ee.DexieYProvider=ft;const Lo=3e4;class yg extends xp{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=cs();this.getLocalState()!==null&&Lo/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,o)=>{o!==this.clientID&&Lo<=n-i.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&vf(this,r,"timeout")},Zt(Lo/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const n=this.clientID,r=this.meta.get(n),i=r===void 0?0:r.clock+1,o=this.states.get(n);e===null?this.states.delete(n):this.states.set(n,e),this.meta.set(n,{clock:i,lastUpdated:cs()});const c=[],l=[],f=[],h=[];e===null?h.push(n):o==null?e!=null&&c.push(n):(l.push(n),qr(o,e)||f.push(n)),(c.length>0||f.length>0||h.length>0)&&this.emit("change",[{added:c,updated:f,removed:h},"local"]),this.emit("update",[{added:c,updated:l,removed:h},"local"])}setLocalStateField(e,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:n})}getStates(){return this.states}}const vf=(t,e,n)=>{const r=[];for(let i=0;i<e.length;i++){const o=e[i];if(t.states.has(o)){if(t.states.delete(o),o===t.clientID){const c=t.meta.get(o);t.meta.set(o,{clock:c.clock+1,lastUpdated:cs()})}r.push(o)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},gg=(t,e,n=t.states)=>{const r=e.length,i=gr();ye(i,r);for(let o=0;o<r;o++){const c=e[o],l=n.get(c)||null,f=t.meta.get(c).clock;ye(i,c),ye(i,f),It(i,JSON.stringify(l))}return wt(i)},mg=(t,e,n)=>{const r=ui(e),i=cs(),o=[],c=[],l=[],f=[],h=Ue(r);for(let d=0;d<h;d++){const g=Ue(r);let m=Ue(r);const b=JSON.parse(Ot(r)),w=t.meta.get(g),E=t.states.get(g),j=w===void 0?0:w.clock;(j<m||j===m&&b===null&&t.states.has(g))&&(b===null?g===t.clientID&&t.getLocalState()!=null?m++:t.states.delete(g):t.states.set(g,b),t.meta.set(g,{clock:m,lastUpdated:i}),w===void 0&&b!==null?o.push(g):w!==void 0&&b===null?f.push(g):b!==null&&(qr(b,E)||l.push(g),c.push(g)))}(o.length>0||l.length>0||f.length>0)&&t.emit("change",[{added:o,updated:l,removed:f},n]),(o.length>0||c.length>0||f.length>0)&&t.emit("update",[{added:o,updated:c,removed:f},n])};function te(t,e,n,r){return new(n||(n=Promise))(function(i,o){function c(h){try{f(r.next(h))}catch(d){o(d)}}function l(h){try{f(r.throw(h))}catch(d){o(d)}}function f(h){var d;h.done?i(h.value):(d=h.value,d instanceof n?d:new n(function(g){g(d)})).then(c,l)}f((r=r.apply(t,e||[])).next())})}function vg(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function rt(t){return this instanceof rt?(this.v=t,this):new rt(t)}function sa(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},c("next"),c("throw"),c("return"),r[Symbol.asyncIterator]=function(){return this},r;function c(g){i[g]&&(r[g]=function(m){return new Promise(function(b,w){o.push([g,m,b,w])>1||l(g,m)})})}function l(g,m){try{(function(b){b.value instanceof rt?Promise.resolve(b.value.v).then(f,h):d(o[0][2],b)})(i[g](m))}catch(b){d(o[0][3],b)}}function f(g){l("next",g)}function h(g){l("throw",g)}function d(g,m){g(m),o.shift(),o.length&&l(o[0][0],o[0][1])}}function oa(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=vg(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(o){return new Promise(function(c,l){(function(f,h,d,g){Promise.resolve(g).then(function(m){f({value:m,done:d})},h)})(c,l,(o=t[i](o)).done,o.value)})}}}const pt={userId:"unauthorized",name:"Unauthorized",claims:{sub:"unauthorized"},lastLogin:new Date(0)};try{Object.freeze(pt),Object.freeze(pt.claims)}catch{}const aa={},Wr=typeof self<"u"&&self.document&&typeof navigator<"u"&&navigator.serviceWorker;Wr&&Wr.ready.then(t=>aa.registration=t),typeof self<"u"&&"clients"in self&&!self.document&&addEventListener("message",t=>{var e,n;!((n=(e=t.data)===null||e===void 0?void 0:e.type)===null||n===void 0)&&n.startsWith("sw-broadcast-")&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>{var i;return r.id!==((i=t.source)===null||i===void 0?void 0:i.id)&&r.postMessage(t.data)})});class No{constructor(e){this.name=e}subscribe(e){if(!Wr)return()=>{};const n=r=>{var i;((i=r.data)===null||i===void 0?void 0:i.type)===`sw-broadcast-${this.name}`&&e(r.data.message)};return Wr.addEventListener("message",n),()=>Wr.removeEventListener("message",n)}postMessage(e){var n;typeof self.clients=="object"?[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:`sw-broadcast-${this.name}`,message:e})):aa.registration&&((n=aa.registration.active)===null||n===void 0||n.postMessage({type:`sw-broadcast-${this.name}`,message:e}))}}const Lr=globalThis["lbc-events"]||(globalThis["lbc-events"]=new Map);class Wi extends Ye{constructor(e){const n=typeof BroadcastChannel>"u"?new No(e):new BroadcastChannel(e);super(r=>{function i(l){r.next(l.detail)}function o(l){r.next(l.data)}let c;(function(l,f){Lr.has(l)?Lr.get(l).push(f):Lr.set(l,[f])})(`lbc-${e}`,i);try{n instanceof No?c=n.subscribe(l=>r.next(l)):n.addEventListener("message",o)}catch{}return()=>{(function(l,f){const h=Lr.get(l);if(h){const d=h.indexOf(f);d!==-1&&h.splice(d,1)}})(`lbc-${e}`,i),n instanceof No?c():n.removeEventListener("message",o)}}),this.name=e,this.bc=n}next(e){this.bc.postMessage(e),function(n){const r=Lr.get(n.type);r&&r.forEach(i=>{try{i(n)}catch{}})}(new CustomEvent(`lbc-${this.name}`,{detail:e}))}}function bf(t,e){return te(this,void 0,void 0,function*(){try{const n=yield navigator.serviceWorker.ready;if(e==="push"&&n.sync&&(yield n.sync.register(`dexie-cloud:${t.name}`)),!n.active)throw new Error("Failed to trigger sync - there's no active service worker");return void n.active.postMessage({type:"dexie-cloud-sync",dbName:t.name,purpose:e})}catch{}})}function Jt(t,e){t.cloud.usingServiceWorker?bf(t,e):t.localSyncEvent.next({purpose:e})}const bg="fromBase64"in Uint8Array,wg="toBase64"in Uint8Array.prototype,Na=typeof Buffer<"u"?t=>Buffer.from(t,"base64"):bg?t=>Uint8Array.fromBase64(t):t=>{const e=atob(t),n=e.length,r=new Uint8Array(n);for(var i=0;i<n;i++)r[i]=e.charCodeAt(i);return r},wr=typeof Buffer<"u"?t=>ArrayBuffer.isView(t)?Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"):Buffer.from(t).toString("base64"):wg?t=>(ArrayBuffer.isView(t)?t:new Uint8Array(t)).toBase64():t=>{const e=ArrayBuffer.isView(t)?t:new Uint8Array(t),n=[];for(let r=0,i=e.length;r<i;r+=4096){const o=e.subarray(r,r+4096);n.push(String.fromCharCode.apply(null,o))}return btoa(n.join(""))};function ca(t){return te(this,arguments,void 0,function*({realms:e,inviteRealms:n}){const r=JSON.stringify([...e.map(c=>({realmId:c,accepted:!0})),...n.map(c=>({realmId:c,accepted:!1}))].sort((c,l)=>c.realmId<l.realmId?-1:c.realmId>l.realmId?1:0)),i=new TextEncoder().encode(r),o=yield crypto.subtle.digest("SHA-1",i);return wr(o)})}function rs(t){return Object.entries(t.cloud.schema||{}).filter(([,{markedForSync:e}])=>e).map(([e])=>t.tables.filter(({name:n})=>n===e)[0]).filter(e=>e)}function Ma(t){return`$${t}_mutations`}function wf(t){var e;const n=(e=/^\$(.*)_mutations$/.exec(t))===null||e===void 0?void 0:e[1];if(!n)throw new Error(`Given mutationTable ${t} is not correct`);return n}const _g=[].concat;function Ka(t){return _g.apply([],t)}function la(t,e){return te(this,arguments,void 0,function*(n,r,{since:i={},limit:o=1/0}={}){const c=yield Promise.all(n.map(g=>te(this,void 0,void 0,function*(){const m=wf(g.name),b=i[m];let w=b?g.where("rev").above(b):g;o<1/0&&(w=w.limit(o));let E=yield w.toArray();return E=function(j){return j=j.map(F=>{if(F.type==="modify"&&F.criteria.index===null){const B=Object.assign(Object.assign({},F),{criteria:void 0,changeSpec:void 0,type:"update",keys:F.keys,changeSpecs:[F.changeSpec]});return delete B.criteria,delete B.changeSpec,B}return F}),j}(E),E=function(j){const F=new Map;for(const B of j)if(B.type==="update"){if(B.keys.length!==1||B.changeSpecs.length!==1)continue;const L=""+B.keys[0],G=B.changeSpecs[0];if(Object.values(G).some(Z=>typeof Z=="object"&&Z&&"@@propmod"in Z))continue;let ne=F.get(L);ne?ne.push({txid:B.txid,updateSpec:G}):F.set(L,[{txid:B.txid,updateSpec:G}])}return j=j.filter(B=>{if(B.type!=="update"||B.keys.length!==1||B.changeSpecs.length!==1)return!0;const L=new Set(Object.keys(B.changeSpecs[0])),G=""+B.keys[0],ne=F.get(G);for(let Z=ne.length-1;Z>=0;--Z){const{txid:oe,updateSpec:Re}=ne[Z];if(oe===B.txid)break;for(const de of Object.keys(Re))L.delete(de)}return L.size!==0}),j}(E),E.map(j=>({table:m,mut:j}))}))),l=Ka(c).sort((g,m)=>g.mut.txid===m.mut.txid?g.mut.opNo-m.mut.opNo:g.mut.ts-m.mut.ts),f=[];let h=null,d=null;for(const{table:g,mut:m}of l)h&&h.table===g&&d===m.txid?h.muts.push(m):(h={table:g,muts:[m]},d=m.txid,f.push(h));return f})}function _f(t){const e=new Uint8Array(t);if(typeof crypto<"u")crypto.getRandomValues(e);else for(let n=0;n<t;n++)e[n]=Math.floor(256*Math.random());if(typeof Buffer<"u"&&Buffer.from)return Buffer.from(e).toString("base64");if(typeof btoa<"u")return btoa(String.fromCharCode.apply(null,e));throw new Error("No btoa or Buffer available")}const kg={}.hasOwnProperty;function vs(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){(function(h){if(!h)throw new Error("Assertion Failed")})(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)vs(t,e[r],n[r])}else{var o=e.indexOf(".");if(o!==-1){var c=e.substr(0,o),l=e.substr(o+1);if(l==="")n===void 0?Array.isArray(t)?isNaN(parseInt(c))||t.splice(parseInt(c),1):delete t[c]:t[c]=n;else{var f=t[c];f&&function(h,d){return kg.call(h,d)}(t,c)||(f=t[c]={}),vs(f,l,n)}}else n===void 0?Array.isArray(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}const kf=typeof self<"u"&&typeof crypto<"u"?(t,e=crypto.getRandomValues.bind(crypto))=>{const n=new Uint8Array(t);return e(n),self.btoa(String.fromCharCode.apply(null,n))}:typeof Buffer<"u"?(t,e=Sg)=>{const n=Buffer.alloc(t);return e(n),n.toString("base64")}:()=>{throw new Error("No implementation of randomString was found")};function Sg(t){for(let e=0;e<t.length;++e)t[e]=Math.floor(256*Math.random())}function Ba(t){return typeof t=="string"||!!(Array.isArray(t)&&t.some(e=>Ba(e))&&t.every(Sf))}function Sf(t){return typeof t=="string"||typeof t=="number"||Array.isArray(t)&&t.every(Sf)}function xg(t,e,n){const r=t[e]||(t[e]={}),i=n.keys.map(o=>typeof o=="string"?o:JSON.stringify(o));switch(n.type){case"insert":case"upsert":i.forEach((o,c)=>{r[o]={type:"ups",val:n.values[c]}});break;case"update":case"modify":i.forEach((o,c)=>{const l=n.type==="update"?n.changeSpecs[c]:n.changeSpec,f=r[o];if(f)switch(f.type){case"ups":for(const[h,d]of Object.entries(l))vs(f.val,h,d);break;case"del":break;case"upd":Object.assign(f.mod,l)}else r[o]={type:"upd",mod:l}});break;case"delete":i.forEach(o=>{r[o]={type:"del"}})}return t}function hl(t,e){for(const{table:n,muts:r}of e)for(const i of r)xg(t,n,i)}function Eg(t){return sa(this,arguments,function*(){var e,n,r,i;let o=0,c=new Uint8Array(4),l=0,f=[],h=0;try{for(var d,g=!0,m=oa(t);!(e=(d=yield rt(m.next())).done);g=!0){i=d.value,g=!1;const b=i,w=new DataView(b.buffer,b.byteOffset,b.byteLength);let E=0;for(;E<b.byteLength;)switch(o){case 0:if(E+4>b.byteLength){for(const j of b.slice(E)){if(l===4)break;c[l++]=j,++E}if(l<4)break}else if(l>0&&l<4)for(const j of b.slice(E,E+4-l))c[l++]=j,++E;case 1:h=l===4?new DataView(c.buffer,0,4).getUint32(0,!1):w.getUint32(E,!1),l?l=0:E+=4;case 2:if(E>=b.byteLength){o=2;break}if(E+h>b.byteLength)f.push(b.slice(E)),h-=b.byteLength-E,o=2,E=b.byteLength;else{if(f.length>0){const j=new Uint8Array(f.reduce((B,L)=>B+L.byteLength,h));let F=0;for(const B of f)j.set(B,F),F+=B.byteLength;j.set(b.slice(E,E+h),F),f=[],yield yield rt(j)}else yield yield rt(b.slice(E,E+h));E+=h,o=0}}}}catch(b){n={error:b}}finally{try{g||e||!(r=m.return)||(yield rt(r.call(m)))}finally{if(n)throw n.error}}})}class ua extends Error{constructor({title:e,message:n,messageCode:r,messageParams:i}){super(n),this.name="TokenErrorResponseError",this.title=e,this.messageCode=r,this.messageParams=i}}function hi(t,e){return new Promise((n,r)=>{const i=Object.assign(Object.assign({submitLabel:"Submit",cancelLabel:"Cancel"},e),{onSubmit:o=>{t.next(void 0),n(o)},onCancel:()=>{t.next(void 0),r(new Ee.AbortError("User cancelled"))}});t.next(i)})}function fa(t,e,...n){return hi(t,{type:"message-alert",title:e,alerts:n,fields:{},submitLabel:"OK",cancelLabel:null})}function pl(t,e,n){return te(this,void 0,void 0,function*(){let r=n||"";for(;!r||!/^[\w-+.]+@([\w-]+\.)+[\w-]{2,10}(\sas\s[\w-+.]+@([\w-]+\.)+[\w-]{2,10})?$/.test(r);)r=(yield hi(t,{type:"email",title:e,alerts:r?[{type:"error",messageCode:"INVALID_EMAIL",message:"Please enter a valid email address",messageParams:{}}]:[],fields:{email:{type:"email",placeholder:"you@somedomain.com"}}})).email;return r})}function yl(t,e,n){return te(this,void 0,void 0,function*(){const r=[{type:"info",messageCode:"OTP_SENT",message:"A One-Time password has been sent to {email}",messageParams:{email:e}}];n&&r.push(n);const{otp:i}=yield hi(t,{type:"otp",title:"Enter OTP",alerts:r,fields:{otp:{type:"otp",label:"OTP",placeholder:"Paste OTP here"}}});return i})}function Us(t){return te(this,void 0,void 0,function*(){var e,n,r;const i=yield t.getCurrentUser(),{accessToken:o,accessTokenExpiration:c,refreshToken:l,refreshTokenExpiration:f,claims:h}=i;if(!o)return null;if(((e=c==null?void 0:c.getTime())!==null&&e!==void 0?e:1/0)>Date.now()&&(((n=i.license)===null||n===void 0?void 0:n.status)||"ok")==="ok")return i;if(!l)throw new Error("Refresh token missing");if(((r=f==null?void 0:f.getTime())!==null&&r!==void 0?r:1/0)<=Date.now())throw new Error("Refresh token has expired");const d=yield js(t.cloud.options.databaseUrl,i);return yield t.table("$logins").update(h.sub,{accessToken:d.accessToken,accessTokenExpiration:d.accessTokenExpiration,claims:d.claims,license:d.license,data:d.data}),d})}function Cg(t,e,n,r,i){return te(this,void 0,void 0,function*(){return e.accessToken&&e.accessTokenExpiration.getTime()>Date.now()?e:e.refreshToken&&(!e.refreshTokenExpiration||e.refreshTokenExpiration.getTime()>Date.now())?yield js(t,e):yield function(o,c,l,f){return te(this,void 0,void 0,function*(){if(!crypto.subtle)throw typeof location<"u"&&location.protocol==="http:"?new Error("Dexie Cloud Addon needs to use WebCrypto, but your browser has disabled it due to being served from an insecure location. Please serve it from https or http://localhost:<port> (See https://stackoverflow.com/questions/46670556/how-to-enable-crypto-subtle-for-unsecure-origins-in-chrome/46671627#46671627)"):new Error("This browser does not support WebCrypto.");const{privateKey:h,publicKey:d}=yield crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!1,["sign","verify"]);if(!h||!d)throw new Error("Could not generate RSA keypair");o.nonExportablePrivateKey=h;const g=function(m){const b=wr(m);return function(w){let E=`-----BEGIN PUBLIC KEY-----
`;for(;w.length>0;)E+=w.substring(0,64)+`
`,w=w.substring(64);return E+="-----END PUBLIC KEY-----",E}(b)}(yield crypto.subtle.exportKey("spki",d));o.publicKey=d;try{const m=yield c({public_key:g,hints:f});if(m.type==="error")throw new ua(m);if(m.type!=="tokens")throw new Error(`Unexpected response type from token endpoint: ${m.type}`);return o.accessToken=m.accessToken,o.accessTokenExpiration=new Date(m.accessTokenExpiration),o.refreshToken=m.refreshToken,m.refreshTokenExpiration&&(o.refreshTokenExpiration=new Date(m.refreshTokenExpiration)),o.userId=m.claims.sub,o.email=m.claims.email,o.name=m.claims.name,o.claims=m.claims,o.license={type:m.userType,status:m.claims.license||"ok"},o.data=m.data,m.evalDaysLeft!=null&&(o.license.evalDaysLeft=m.evalDaysLeft),m.userValidUntil!=null&&(o.license.validUntil=new Date(m.userValidUntil)),m.alerts&&m.alerts.length>0&&(yield hi(l,{type:"message-alert",title:"Authentication Alert",fields:{},alerts:m.alerts})),o}catch(m){if(m instanceof ua)throw yield fa(l,m.title,{type:"error",messageCode:m.messageCode,message:m.message,messageParams:{}}),m;let b="We're having a problem authenticating right now.";throw m instanceof TypeError&&(b=typeof navigator!==void 0&&!navigator.onLine?"You seem to be offline. Please connect to the internet and try again.":Ee.debug||typeof location<"u"&&(location.hostname==="localhost"||location.hostname==="127.0.0.1")?`Could not connect to server. Please verify that your origin '${location.origin}' is whitelisted using \`npx dexie-cloud whitelist\``:"Could not connect to server. Please verify the connection.",yield fa(l,"Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:b,messageParams:{}}).catch(()=>{})),m}})}(e,n,r,i)})}function js(t,e){return te(this,void 0,void 0,function*(){if(!e.refreshToken)throw new Error("Cannot refresh token - refresh token is missing.");if(!e.nonExportablePrivateKey)throw new Error("login.nonExportablePrivateKey is missing - cannot sign refresh token without a private key.");const n=Date.now(),r="RSASSA-PKCS1-v1_5",i=new TextEncoder().encode(e.refreshToken+n),o=yield crypto.subtle.sign(r,e.nonExportablePrivateKey,i),c=wr(o),l={grant_type:"refresh_token",refresh_token:e.refreshToken,scopes:["ACCESS_DB"],signature:c,signing_algorithm:r,time_stamp:n},f=yield fetch(`${t}/token`,{body:JSON.stringify(l),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});if(f.status!==200)throw new Error(`RefreshToken: Status ${f.status} from ${t}/token`);const h=yield f.json();if(h.type==="error")throw new ua(h);return e.accessToken=h.accessToken,e.accessTokenExpiration=h.accessTokenExpiration?new Date(h.accessTokenExpiration):void 0,e.claims=h.claims,e.license={type:h.userType,status:h.claims.license||"ok"},h.evalDaysLeft!=null&&(e.license.evalDaysLeft=h.evalDaysLeft),h.userValidUntil!=null&&(e.license.validUntil=new Date(h.userValidUntil)),h.data&&(e.data=h.data),e})}const{toString:Ig}={},gl={replace:function(t){const e=Object.keys(t);let n=null;for(let i=0,o=e.length;i<o;++i)e[i][0]==="$"&&(n=n||[],n.push(e[i]));if(!n)return t;const r={...t};for(const i of n)delete r[i];for(const i of n)r["$"+i]=t[i];return r}};function xf(...t){const e=t.reduce((r,i)=>({...r,...i}),t.reduce((r,i)=>({...i,...r}),{})),n=new WeakMap;return{stringify(r,i,o){return JSON.stringify(r,function(l){const f=this[l],h=function(d){const g=typeof d;switch(typeof d){case"object":case"function":{if(d===null)return null;const b=Object.getPrototypeOf(d);if(!b)return gl;let w=n.get(b);if(w!==void 0)return w;const E=(m=d,Ig.call(m).slice(8,-1)),j=Object.entries(e).find(([F,B])=>{var L,G;return(G=(L=B==null?void 0:B.test)===null||L===void 0?void 0:L.call(B,d,E))!==null&&G!==void 0?G:F===E});return w=j==null?void 0:j[1],w||(w=Array.isArray(d)?null:typeof d=="function"?e.function||null:gl),n.set(b,w),w}default:return e[g]}var m}(f);return h?h.replace(f,i,e):f},o)},parse(r,i){const o=[];return JSON.parse(r,function(c,l){const f=l==null?void 0:l.$t;if(f){const d=e[f];l=d?d.revive(l,i,e):l}let h=o[o.length-1];if(h&&h[0]===l){l={...l};for(const d of h[1])delete l[d];for(const[d,g]of Object.entries(h[2]))l[d]=g;o.pop()}if(l===void 0||c[0]==="$"&&c!=="$t"){let d,g;h=o[o.length-1],h&&h[0]===this?(d=h[1],g=h[2]):o.push([this,d=[],g={}]),c[0]==="$"&&c!=="$t"?(d.push(c),g[c.substr(1)]=l):g[c]=void 0}return l})}}}const Og={Blob:{test:(t,e)=>e==="Blob",replace:(t,e)=>{const n=e.length;return e.push(t),{$t:"Blob",mimeType:t.type,i:n}},revive:({i:t,mimeType:e},n)=>new Blob([n[t]],{type:e})}};var Ag={number:{replace:t=>{switch(!0){case isNaN(t):return{$t:"number",v:"NaN"};case t===1/0:return{$t:"number",v:"Infinity"};case t===-1/0:return{$t:"number",v:"-Infinity"};default:return t}},revive:({v:t})=>Number(t)}};const Dg={bigint:{replace:t=>({$t:"bigint",v:""+t}),revive:t=>BigInt(t.v)}};var Tg={Date:{replace:t=>({$t:"Date",v:isNaN(t.getTime())?"NaN":t.toISOString()}),revive:({v:t})=>new Date(t==="NaN"?NaN:Date.parse(t))}},Rg={Set:{replace:t=>({$t:"Set",v:Array.from(t.entries())}),revive:({v:t})=>new Set(t)}},Pg={Map:{replace:t=>({$t:"Map",v:Array.from(t.entries())}),revive:({v:t})=>new Map(t)}};const Ug=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:void 0;var jg=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","DataView","BigInt64Array","BigUint64Array"].reduce((t,e)=>({...t,[e]:{replace:(n,r,i)=>({$t:e,v:i.ArrayBuffer.replace(n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength),r,i).v}),revive:({v:n},r,i)=>{const o=Ug[e];return o&&new o(i.ArrayBuffer.revive({v:n},r,i))}}}),{});function Ef(t){return function(e){for(var n="",r=0,i=e.length;r<i;r++)n+=Cf[e[r]];return n}(wr(t))}function Lg(t){return Na(function(e){if(typeof e!="string")throw new Error("invalid decoder input: "+e);for(var n="",r=0,i=e.length;r<i;r++)n+=da[e[r]];return n}(t))}const da={"-":"=",0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",A:"K",B:"L",C:"M",D:"N",E:"O",F:"P",G:"Q",H:"R",I:"S",J:"T",K:"U",L:"V",M:"W",N:"X",O:"Y",P:"Z",Q:"a",R:"b",S:"c",T:"d",U:"e",V:"f",W:"g",X:"h",Y:"i",Z:"j",_:"k",a:"l",b:"m",c:"n",d:"o",e:"p",f:"q",g:"r",h:"s",i:"t",j:"u",k:"v",l:"w",m:"x",n:"y",o:"z",p:"0",q:"1",r:"2",s:"3",t:"4",u:"5",v:"6",w:"7",x:"8",y:"9",z:"+","|":"/"},Cf={};for(const t of Object.keys(da))Cf[da[t]]=t;var Ng={ArrayBuffer:{replace:t=>({$t:"ArrayBuffer",v:Ef(t)}),revive:({v:t})=>{const e=Lg(t);return e.buffer.byteLength===e.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}}};class Mo{constructor(e,n){this.buf=e,this.type=n}}function If(t){const e=new XMLHttpRequest;if(e.overrideMimeType("text/plain; charset=x-user-defined"),e.open("GET",URL.createObjectURL(t),!1),e.send(),e.status!==200&&e.status!==0)throw new Error("Bad Blob access: "+e.status);return e.responseText}function Of(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n);return e.buffer}var Mg={Blob:{test:(t,e)=>e==="Blob"||t instanceof Mo,replace:t=>({$t:"Blob",v:wr(t instanceof Mo?t.buf:Of(If(t))),type:t.type}),revive:({type:t,v:e})=>{const n=Na(e);return typeof Blob!==void 0?new Blob([n]):new Mo(n.buffer,t)}}};const Af={...Ag,...Dg,...Tg,...Rg,...Pg,...jg,...Ng,...Mg};function ml(t){return new Promise((e,n)=>{const r=new FileReader;r.onabort=i=>n(new Error("file read aborted")),r.onerror=i=>n(i.target.error),r.onload=i=>e(i.target.result),r.readAsArrayBuffer(t)})}var Kg={undefined:{replace:()=>({$t:"undefined"}),revive:()=>{}}},Bg={File:{test:(t,e)=>e==="File",replace:t=>({$t:"File",v:wr(Of(If(t))),type:t.type,name:t.name,lastModified:new Date(t.lastModified).toISOString()}),revive:({type:t,v:e,name:n,lastModified:r})=>{const i=Na(e);return new File([i],n,{type:t,lastModified:new Date(r).getTime()})}}};const Fg=typeof BigInt=="function"&&typeof BigInt(0)=="bigint";class vl{toString(){return this.v}constructor(e){this.v=e}}const $g=Fg?{}:{bigint:{test:t=>t instanceof vl,replace:t=>Object.assign({$t:"bigint"},t),revive:({v:t})=>new vl(t)}},Df=Object.assign(Object.assign(Object.assign(Object.assign({},Kg),$g),Bg),{PropModification:{test:t=>t instanceof Ic,replace:t=>Object.assign({$t:"PropModification"},t["@@propmod"]),revive:t=>{var e=function(n,r){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&r.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var c=0;for(o=Object.getOwnPropertySymbols(n);c<o.length;c++)r.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(n,o[c])&&(i[o[c]]=n[o[c]])}return i}(t,["$t"]);return new Ic(e)}}}),si=xf(Af,Df),qg=function(...t){const e=xf(Af,Og,...t);return{toBinary(n){const[r,i]=this.stringify(n),o=new ArrayBuffer(4);return new DataView(o).setUint32(0,r.size),new Blob([o,r,i])},stringify(n){const r=[],i=e.stringify(n,r);return[new Blob(r.map(c=>{const l=new ArrayBuffer(4);return new DataView(l).setUint32(0,"byteLength"in c?c.byteLength:c.size),new Blob([l,c])})),i]},async parse(n,r){let i=0;const o=[],c=await ml(r),l=new DataView(c);for(;i<c.byteLength;){const f=l.getUint32(i);i+=4;const h=c.slice(i,i+f);i+=f,o.push(h)}return e.parse(n,o)},async fromBinary(n){const r=new DataView(await ml(n.slice(0,4))).getUint32(0),i=n.slice(4,r+4),o=await function(c){return new Promise((l,f)=>{const h=new FileReader;h.onabort=d=>f(new Error("file read aborted")),h.onerror=d=>f(d.target.error),h.onload=d=>l(d.target.result),h.readAsText(c)})}(n.slice(r+4));return await this.parse(o,i)}}}(Df);class ha extends Error{constructor(e,n){super(n||`${e.status} ${e.statusText}`),this.httpStatus=e.status}get name(){return"HttpError"}}function Vg(t,e,n){const r=[];for(let i of n){const{table:o,muts:c}=i,l=t.tables.find(d=>d.name===o);if(!l)throw new Error(`Internal error: table ${o} not found in DBCore schema`);const{primaryKey:f}=l;let h=i;c.forEach((d,g)=>{const m=!f.outbound&&(d.type==="upsert"||d.type==="insert");d.keys.forEach((b,w)=>{if(Array.isArray(b)){h===i&&(h=bl(i,m));const E=h.muts[g],j=JSON.stringify(b);E.keys[w]=j}else if(b[0]==="#"){h===i&&(h=bl(i,m));const E=h.muts[g];if(!e.isLoggedIn)throw new Error("Internal error: Cannot sync private IDs before authenticated");const j=`${b}:${e.userId}`;E.keys[w]=j,m&&Ee.setByKeyPath(E.values[w],f.keyPath,j)}})}),r.push(h)}return r}function bl(t,e){return Object.assign(Object.assign({},t),{muts:e?t.muts.map(n=>n.type!=="insert"&&n.type!=="upsert"||!n.values?Object.assign(Object.assign({},n),{keys:n.keys.slice()}):Object.assign(Object.assign({},n),{keys:n.keys.slice(),values:n.values.slice()})):t.muts.map(n=>Object.assign(Object.assign({},n),{keys:n.keys.slice()}))})}let pa=new WeakMap;function Tf(t){return te(this,void 0,void 0,function*(){var e,n;const r=((n=(e=pa.get(t))===null||e===void 0?void 0:e.getTime())!==null&&n!==void 0?n:0)-Date.now();r>0&&(yield new Promise(i=>setTimeout(i,r)))})}function Wg(t,e,n,r,i,o,c,l,f){return te(this,void 0,void 0,function*(){const h={Accept:"application/json, application/x-bison, application/x-bison-stream","Content-Type":"application/tson"},d=yield Us(i),g=d==null?void 0:d.accessToken;g&&(h.Authorization=`Bearer ${g}`);const m={v:2,dbID:n==null?void 0:n.remoteDbId,clientIdentity:l,schema:c||{},lastPull:n?{serverRevision:n.serverRevision,yServerRevision:n.yServerRevision,realms:n.realms,inviteRealms:n.inviteRealms}:void 0,baseRevs:r,changes:Vg(i.dx.core.schema,f,t),y:e,dxcv:i.cloud.version};i.syncStateChangedEvent.next({phase:"pushing"});const b=si.stringify(m),w=yield fetch(`${o}/sync`,{method:"post",headers:h,credentials:"include",body:b});if(i.syncStateChangedEvent.next({phase:"pulling"}),function(E,j){const F=j.headers.get("Ratelimit-Limit"),B=j.headers.get("Ratelimit-Remaining"),L=j.headers.get("Ratelimit-Reset");if(F&&B&&L){const G=Number(F),ne=Math.max(0,Number(B)),Z=Number(L);if(ne<G/2){const oe=Math.ceil(Z/(ne+1));pa.set(E,new Date(Date.now()+1e3*oe))}else pa.delete(E)}}(i,w),!w.ok)throw new ha(w);if(w.headers.get("content-type")==="application/x-bison")return qg.fromBinary(yield w.blob());{const E=yield w.text();return si.parse(E)}})}function Nr(t){if(t!=null&&t.cancelled)throw new Ee.AbortError("Operation was cancelled")}let nr=!1;function Rf(t,e,n,r){return te(this,void 0,void 0,function*(){yield t.$baseRevs.bulkPut(Object.keys(e).filter(i=>e[i].markedForSync).map(i=>({tableName:i,clientRev:(n[i]||0)+1,serverRev:r}))),yield t.$baseRevs.where("tableName").noneOf(Object.keys(e).filter(i=>e[i].markedForSync)).delete()})}function ya(t,e={}){for(const{table:n,muts:r}of t){const i=r.length>0?r[r.length-1].rev:null;e[n]=i||e[n]||0}return e}function Hg(t,e,n){return te(this,void 0,void 0,function*(){const r=yield t.bulkGet(e),i=[],o=[];e.forEach((c,l)=>{const f=r[l];if(f){for(const[h,d]of Object.entries(n[l]))if(h===t.schema.primKey.keyPath){if(xs(d,c)!==0)throw new Error("Cannot change primary key")}else Ee.setByKeyPath(f,h,d);i.push(c),o.push(f)}}),yield t.schema.primKey.keyPath==null?t.bulkPut(o,i):t.bulkPut(o)})}function Pf(t,e){return te(this,void 0,void 0,function*(){for(const{table:n,muts:r}of t){if(!e.dx._allTables[n])continue;const i=e.table(n),{primaryKey:o}=i.core.schema,c=l=>{switch(l[0]){case"[":if(l.endsWith("]"))try{return JSON.parse(l)}catch{}return l;case"#":return l.endsWith(":"+e.cloud.currentUserId)?l.substr(0,l.length-e.cloud.currentUserId.length-1):l;default:return l}};for(const l of r){const f=l.keys.map(c);switch(l.type){case"insert":o.outbound?yield i.bulkAdd(l.values,f):(f.forEach((h,d)=>{Ee.setByKeyPath(l.values[d],o.keyPath,h)}),yield i.bulkAdd(l.values));break;case"upsert":o.outbound?yield i.bulkPut(l.values,f):(f.forEach((h,d)=>{Ee.setByKeyPath(l.values[d],o.keyPath,h)}),yield i.bulkPut(l.values));break;case"modify":f.length===1?yield i.update(f[0],l.changeSpec):yield i.where(":id").anyOf(f).modify(l.changeSpec);break;case"update":yield Hg(i,f,l.changeSpecs);break;case"delete":yield i.bulkDelete(f)}}}})}typeof self<"u"&&typeof navigator<"u"&&(nr=navigator.onLine,self.addEventListener("online",()=>nr=!0),self.addEventListener("offline",()=>nr=!1));const bn="dexie-cloud-syncer";function Uf(t,e){return t.where("i").between(e,1/0,!0).toArray()}function Hr(t,e,n){var r,i,o;if(!t.dx._allTables[e])return;const c=(o=(i=(r=t.table(e))===null||r===void 0?void 0:r.schema.yProps)===null||i===void 0?void 0:i.find(l=>l.prop===n))===null||o===void 0?void 0:o.updatesTable;return c&&t.dx._allTables[c]?t.table(c):void 0}function jf(t,e){return te(this,void 0,void 0,function*(){var n;const r={};let i,o=!1;for(const c of t)try{switch(c.type){case"u-s":{const l=Hr(e,c.table,c.prop);if(l){const f={k:c.k,u:c.u};c.r&&(f.r=c.r,i=c.r),r[l.name]=yield l.add(f)}break}case"u-ack":{const l=Hr(e,c.table,c.prop);l&&(yield e.transaction("rw",l,f=>te(this,void 0,void 0,function*(){let h=yield f.table(l.name).get(bn);yield f.table(l.name).put(Object.assign(Object.assign({},h||{i:bn}),{unsentFrom:Math.max((h==null?void 0:h.unsentFrom)||1,c.i+1)}))})));break}case"u-reject":{const l=Hr(e,c.table,c.prop);if(!l)break;const f=(n=yield l.get(c.i))===null||n===void 0?void 0:n.k;if(f!=null){yield e.transaction("rw",l,d=>(d.idbtrans._rejecting_y_ypdate=!0,l.where("i").aboveOrEqual(c.i).filter(g=>xs(g.k,f)===0&&(1&(g.f||0))==1).delete()));const h=ft.getDocCache(e.dx).find(c.table,f,c.prop);h&&h.destroy()}break}case"in-sync":{const l=ft.getDocCache(e.dx).find(c.table,c.k,c.prop);l&&!l.isSynced&&l.emit("sync",[!0,l]);break}case"y-complete-sync-done":i=c.yServerRev;break;case"outdated-server-rev":o=!0}}catch{}return{receivedUntils:r,resyncNeeded:o,yServerRevision:i}})}const zg=1,Yg=2,Gg=3;function Jg(t,e,n){return te(this,arguments,void 0,function*(r,i,{yDownloadedRealms:o,realms:c}){if(o&&c&&c.every(d=>o[d]==="*"))return;const l=yield Us(r),f={"Content-Type":"application/json",Accept:"application/octet-stream"};l&&(f.Authorization=`Bearer ${l.accessToken}`);const h=yield fetch(`${i}/y/download`,{body:si.stringify({downloadedRealms:o||{}}),method:"POST",headers:f,credentials:"include"});if(!h.ok)throw new Error(`Failed to download Yjs documents from server. Status: ${h.status}`);yield async function(d,...g){var m,b,w;let E=d();for(let L=0;L<g.length;L++)E=g[L](E);try{for(var j,F=!0,B=oa(E);!(m=(j=await B.next()).done);F=!0)j.value,F=!1}catch(L){b={error:L}}finally{try{F||m||!(w=B.return)||await w.call(B)}finally{if(b)throw b.error}}}(function(d){return function(){return sa(this,arguments,function*(){if(!d.body)throw new Error("Response body is not readable");const g=d.body.getReader();try{for(;;){const{done:m,value:b}=yield rt(g.read());if(m)return yield rt(void 0);yield yield rt(b)}}finally{g.releaseLock()}})}}(h),Eg,function(d){return sa(this,arguments,function*(){var g,m,b,w;let E=null,j=null,F=null,B=[];function L(oe){return te(this,void 0,void 0,function*(){const Re=B[B.length-1];if(B.length>0){if(!E||!j||!F)throw new Error(`Protocol error from ${i}/y/download`);const de=Hr(r,j,F);de&&(yield de.bulkAdd(B)),B=[]}E&&(j&&F&&Re||oe)&&(yield r.$syncState.update("syncState",de=>{const De=de.yDownloadedRealms||{};De[E]=oe?"*":{tbl:j,prop:F,key:Re.k},de.yDownloadedRealms=De}))})}try{try{for(var G,ne=!0,Z=oa(d);!(g=(G=yield rt(Z.next())).done);ne=!0){w=G.value,ne=!1;const oe=new mr(w);for(;wu(oe);)switch(or(oe)){case zg:yield rt(L(!0)),E=Ot(oe);break;case Yg:yield rt(L(!1)),j=Ot(oe),F=Ot(oe);break;case Gg:{const Re=vn(oe),de=nt(oe);B.push({k:Re,u:de});break}}yield rt(L(!1))}}catch(oe){m={error:oe}}finally{try{ne||g||!(b=Z.return)||(yield rt(b.call(Z)))}finally{if(m)throw m.error}}yield rt(L(!0))}catch(oe){throw oe instanceof Ee.DexieError||(yield rt(L(!1))),oe}})})})}const Lf="currentSyncWorker";function Ls(t,e,n,r){return Nf(t,e,n,r).then(i=>(r!=null&&r.justCheckIfNeeded||t.syncStateChangedEvent.next({phase:"in-sync"}),i)).catch(i=>te(this,void 0,void 0,function*(){return r!=null&&r.justCheckIfNeeded?Promise.reject(i):nr&&(r!=null&&r.retryImmediatelyOnFetchError)&&(i==null?void 0:i.name)==="TypeError"&&/fetch/.test(i==null?void 0:i.message)?(t.syncStateChangedEvent.next({phase:"error",error:i}),yield new Promise(o=>setTimeout(o,500)),yield Ls(t,e,n,Object.assign(Object.assign({},r),{retryImmediatelyOnFetchError:!1}))):(yield t.$syncState.update("syncState",{timestamp:new Date,error:""+i}),t.syncStateChangedEvent.next({phase:nr?"error":"offline",error:new Error(""+(i==null?void 0:i.message)||i)}),Promise.reject(i))}))}function Nf(t,e,n){return te(this,arguments,void 0,function*(r,i,o,{isInitialSync:c,cancelToken:l,justCheckIfNeeded:f,purpose:h}={isInitialSync:!1}){var d;if(!(!((d=r.cloud.options)===null||d===void 0)&&d.databaseUrl))throw new Error("Internal error: sync must not be called when no databaseUrl is configured");const{databaseUrl:g}=i,m=yield r.getCurrentUser(),b=m.isLoggedIn?rs(r):[],w=b.map(z=>r.table(Ma(z.name))),E=yield r.getPersistedSyncState(),j=m.isLoggedIn,F=j?function(z,re){const ie=(re==null?void 0:re.syncedTables)||[];return rs(z).filter(ge=>!ie.includes(ge.name))}(r,E):[];Nr(l);const B=F.length>0;if(B){if(f)return!0;yield r.transaction("rw",F,z=>te(this,void 0,void 0,function*(){z.idbtrans.disableChangeTracking=!0,z.idbtrans.disableAccessControl=!0,yield function(re,ie,ge){return te(this,void 0,void 0,function*(){const be=new Set(ge||[]);for(const ue of re)ue.name==="members"?yield ue.toCollection().modify(ae=>{be.has(ae.realmId)||ae.userId&&ae.userId!==pt.userId||(ae.userId=ie.userId)}):ue.name==="roles"||(ue.name==="realms"?yield ue.toCollection().modify(ae=>{be.has(ae.realmId)||ae.owner!==void 0&&ae.owner!==pt.userId||(ae.owner=ie.userId)}):yield ue.toCollection().modify(ae=>{ae.realmId&&be.has(ae.realmId)||(ae.owner&&ae.owner!==pt.userId||(ae.owner=ie.userId),ae.realmId&&ae.realmId!==pt.userId||(ae.realmId=ie.userId))}))})}(F,m,E==null?void 0:E.realms)})),Nr(l)}const[L,G,ne,{yMessages:Z,lastUpdateIds:oe}]=yield r.transaction("r",r.tables,()=>te(this,void 0,void 0,function*(){const z=yield r.getPersistedSyncState();let re=yield r.$baseRevs.toArray();re=re.filter(be=>b.some(ue=>ue.name===be.tableName));let ie=yield la(w,r);const ge=yield function(be,ue){return te(this,void 0,void 0,function*(){const ae=[],Ae={};for(const st of ue)if(st.schema.yProps)for(const Je of st.schema.yProps){const Ke=be.table(Je.updatesTable),ot=yield Ke.get(bn),Ve=(ot==null?void 0:ot.unsentFrom)||1,ee=(ot==null?void 0:ot.receivedUntil)||0,Le=Math.min(Ve,ee+1),qe=yield Uf(Ke,Le);qe.length>0&&(Ae[Ke.name]=qe[qe.length-1].i);const ce={};for(const _e of qe){const Ie=(1&(_e.f||0))==1;if(Ie&&_e.i<Ve)continue;const Pe=JSON.stringify(_e.k)+"/"+Ie;let mt=ce[Pe];mt?(mt.u.push(_e.u),mt.i=Math.max(_e.i,mt.i)):(ce[Pe]=mt={i:_e.i,k:_e.k,isLocal:Ie,u:[]},mt.u.push(_e.u))}for(const{k:_e,isLocal:Ie,u:Pe,i:mt}of Object.values(ce)){const Sn=Pe.length===1?Pe[0]:fs(Pe);if(Ie)ae.push({type:"u-c",table:st.name,prop:Je.prop,k:_e,u:Sn,i:mt});else{const Rt=zu(Sn);ae.push({type:"sv",table:st.name,prop:Je.prop,k:_e,sv:Rt})}}}return{yMessages:ae,lastUpdateIds:Ae}})}(r,b);if(Nr(l),B){const be=[...(E==null?void 0:E.realms)||[],...(E==null?void 0:E.inviteRealms)||[]],ue=yield function(ae,Ae,st,Je){return te(this,void 0,void 0,function*(){const Ke=`upload-${_f(8)}`;if(Ae.isLoggedIn&&ae.length>0){const ot=new Set(Je||[]);return(yield Promise.all(ae.map(Ve=>te(this,void 0,void 0,function*(){const{extractKey:ee}=Ve.core.schema.primaryKey;if(!ee)return{table:Ve.name,muts:[]};const Le=st[Ve.name],qe=Le!=null&&Le.generatedGlobalId?Ve.filter(_e=>{return ee(_e),!ot.has(_e.realmId||"")&&(Ie=ee(_e),!(Pe=Le==null?void 0:Le.idPrefix)||typeof Ie=="string"&&Ie.startsWith(Pe));var Ie,Pe}):Ve.filter(_e=>{const Ie=ee(_e);return!ot.has(_e.realmId||"")&&Ba(Ie)}),ce=yield qe.toArray();if(ce.length>0){const _e={type:"upsert",values:ce,keys:ce.map(ee),userId:Ae.userId,txid:Ke};return{table:Ve.name,muts:[_e]}}return{table:Ve.name,muts:[]}})))).filter(Ve=>Ve.muts.length>0)}return[]})}(F,m,o,be);return Nr(l),ie=ie.concat(ue),[ie,z,re,ge]}return[ie,z,re,ge]})),Re=L.some(z=>z.muts.some(re=>re.keys.length>0))||Z.some(z=>z.type==="u-c");if(f)return Re;if(h==="push"&&!Re)return!1;const de=ya(L,G==null?void 0:G.latestRevisions),De=(G==null?void 0:G.clientIdentity)||kf(16);Nr(l);const H=yield Wg(L,Z,G,ne,r,g,o,De,m),{done:he,newSyncState:me}=yield r.transaction("rw",r.tables,z=>te(this,void 0,void 0,function*(){z.idbtrans.disableChangeTracking=!0,z.idbtrans.disableAccessControl=!0;for(const ue of Object.keys(o))H.schema[ue]&&(o[ue]=H.schema[ue]);yield r.$syncState.put(o,"schema");const re=yield la(w,r,{since:de});for(const ue of w){const ae=wf(ue.name);if(re.some(Ae=>Ae.table===ae&&Ae.muts.length>0)){if(de[ae]){const Ae=de[ae]||0;yield Promise.all([ue.where("rev").belowOrEqual(Ae).delete(),r.$baseRevs.where(":id").between([ae,-1/0],[ae,Ae+1],!0,!0).reverse().offset(1).delete()])}}else yield Promise.all([ue.clear(),r.$baseRevs.where({tableName:ae}).delete()])}ya(re,de),yield Rf(r,o,de,H.serverRevision);const ie=yield r.getPersistedSyncState();yield function(ue,ae,Ae){return te(this,void 0,void 0,function*(){const st=new Set,Je=new Set,Ke=Ae?Ae.realms:[],ot=Ae?Ae.inviteRealms:[],Ve=new Set(ae.realms),ee=new Set(ae.realms.concat(ae.inviteRealms));for(const Le of Ke)Ve.has(Le)||(Je.add(Le),ee.has(Le)||st.add(Le));for(const Le of ot.concat(Ke))ee.has(Le)||st.add(Le);if(st.size>0||Je.size>0){const Le=rs(ue);for(const qe of Le){let ce=["realms","members","roles"].includes(qe.name)?st:Je;ce.size!==0&&(qe.schema.indexes.some(_e=>_e.keyPath==="realmId"||Array.isArray(_e.keyPath)&&_e.keyPath[0]==="realmId")?yield qe.where("realmId").anyOf([...ce]).delete():yield qe.filter(_e=>!!(_e!=null&&_e.realmId)&&ce.has(_e.realmId)).delete())}}if(Je.size>0&&(Ae!=null&&Ae.yDownloadedRealms))for(const Le of Je)delete Ae.yDownloadedRealms[Le]})}(r,H,ie);const ge=ie||{syncedTables:[],latestRevisions:{},realms:[],inviteRealms:[],clientIdentity:De};j&&(ge.syncedTables=b.map(ue=>ue.name).concat(F.map(ue=>ue.name))),ge.latestRevisions=de,ge.remoteDbId=H.dbId,ge.initiallySynced=!0,ge.realms=H.realms,ge.inviteRealms=H.inviteRealms,ge.serverRevision=H.serverRevision,ge.yServerRevision=H.serverRevision,ge.timestamp=new Date,delete ge.error;const be=Mf(H.changes,re);if(yield Pf(be,r),H.yMessages){const{receivedUntils:ue,resyncNeeded:ae,yServerRevision:Ae}=yield jf(H.yMessages,r);Ae&&(ge.yServerRevision=Ae),yield function(st,Je,Ke){return te(this,void 0,void 0,function*(){var ot,Ve,ee,Le,qe;const ce={};for(const[Ie,Pe]of Object.entries(st))(ot=ce[Ie])!==null&&ot!==void 0||(ce[Ie]={}),ce[Ie].unsentFrom=Pe+1;for(const[Ie,Pe]of Object.entries(Je))(Ve=ce[Ie])!==null&&Ve!==void 0||(ce[Ie]={}),ce[Ie].receivedUntil=Pe;const _e=Object.values(Ke.dx._dbSchema).filter(Ie=>Ie.yProps).map(Ie=>Ie.yProps.map(Pe=>Pe.updatesTable)).flat();for(const Ie of _e){const Pe=ce[Ie],mt=(ee=Pe==null?void 0:Pe.unsentFrom)!==null&&ee!==void 0?ee:1,Sn=(qe=(Le=Pe==null?void 0:Pe.receivedUntil)!==null&&Le!==void 0?Le:(yield Ke.table(Ie).where("i").between(1,1/0).reverse().limit(1).primaryKeys())[0])!==null&&qe!==void 0?qe:0;yield Ke.transaction("rw",Ie,()=>te(this,void 0,void 0,function*(){const Rt=yield Ke.table(Ie).get(bn);Rt?(Rt.unsentFrom=Math.max(mt,Rt.unsentFrom||1),Rt.receivedUntil=Math.max(Sn,Rt.receivedUntil||0),yield Ke.table(Ie).put(Rt)):yield Ke.table(Ie).add({i:bn,unsentFrom:mt,receivedUntil:Sn})}))}})}(oe,ue,r),ae&&(ge.yDownloadedRealms={})}return r.$syncState.put(ge,"syncState"),{done:re.length===0,newSyncState:ge}}));if(!he)return yield Tf(r),yield Nf(r,i,o,{isInitialSync:c,cancelToken:l});const we=Object.values(o).some(z=>{var re;return(re=z.yProps)===null||re===void 0?void 0:re.length}),ke=!!H.yMessages;if(we&&ke)try{yield Jg(r,g,me)}catch{}return r.syncCompleteEvent.next(),!1})}function Mf(t,e){const n={};hl(n,t);const r={};return hl(r,e),function(i,o){var c,l,f;for(const[h,d]of Object.entries(o))for(const[g,m]of Object.entries(d))switch(m.type){case"ups":{const b=(c=i[h])===null||c===void 0?void 0:c[g];if(b)switch(b.type){case"ups":case"upd":delete i[h][g]}}break;case"del":(l=i[h])===null||l===void 0||delete l[g];break;case"upd":{const b=(f=i[h])===null||f===void 0?void 0:f[g];if(b)switch(b.type){case"ups":for(const[w,E]of Object.entries(m.mod))vs(b.val,w,E);break;case"del":break;case"upd":for(const w of Object.keys(m.mod))delete b.mod[w]}break}}}(n,r),function(i,o=""){o||(o=kf(16));const c={};for(const[f,h]of Object.entries(i))for(const[d,g]of Object.entries(h)){const m=c[f]||(c[f]={});(m[g.type]||(m[g.type]=[])).push(Object.assign({key:d},g))}const l=[];for(const[f,h]of Object.entries(c)){const d={table:f,muts:[]};for(const[g,m]of Object.entries(h))switch(g){case"ups":{const b={type:"upsert",keys:m.map(w=>w.key),values:m.map(w=>w.val),txid:o};d.muts.push(b);break}case"upd":{const b={type:"update",keys:m.map(w=>w.key),changeSpecs:m.map(w=>w.mod),txid:o};d.muts.push(b);break}case"del":{const b={type:"delete",keys:m.map(w=>w.key),txid:o};d.muts.push(b);break}}l.push(d)}return l}(n)}const Xg=10,Qg=1e4,Zg=1e3;function em(t){const e=[],n=new Tt(!0),r=new Tt(null);let i=!1,o=new Array(Xg).fill(0);return r.subscribe(()=>te(this,void 0,void 0,function*(){if(!i&&e.length>0){i=!0,o.shift(),o.push(Date.now()),n.next(!1);try{yield function(){return te(this,void 0,void 0,function*(){for(var c,l,f,h,d,g;e.length>0;){const m=e.shift();try{yield Un(t.cloud.syncState.pipe(Ct(({phase:w})=>w==="in-sync"||w==="error")));const b=t.cloud.persistedSyncState.value;if(!m)continue;switch(m.type){case"token-expired":const w=t.cloud.currentUser.value,E=yield js(t.cloud.options.databaseUrl,w);yield t.table("$logins").update(w.userId,{accessToken:E.accessToken,accessTokenExpiration:E.accessTokenExpiration,claims:E.claims,license:E.license,data:E.data});break;case"realm-added":!((c=b==null?void 0:b.realms)===null||c===void 0)&&c.includes(m.realm)||!((l=b==null?void 0:b.inviteRealms)===null||l===void 0)&&l.includes(m.realm)||(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-accepted":!((f=b==null?void 0:b.realms)===null||f===void 0)&&f.includes(m.realm)||(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-removed":(!((h=b==null?void 0:b.realms)===null||h===void 0)&&h.includes(m.realm)||!((d=b==null?void 0:b.inviteRealms)===null||d===void 0)&&d.includes(m.realm))&&(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realms-changed":yield t.cloud.sync({purpose:"pull",wait:!0});break;case"changes":if(((g=t.cloud.syncState.value)===null||g===void 0?void 0:g.phase)==="error"){Jt(t,"pull");break}yield t.transaction("rw",t.dx.tables,j=>te(this,void 0,void 0,function*(){j.idbtrans.disableChangeTracking=!0,j.idbtrans.disableAccessControl=!0;const[F,B,L]=yield Promise.all([t.getSchema(),t.getPersistedSyncState(),t.getCurrentUser()]);if(!B||!F||!L)return;if(m.baseRev!==B.serverRevision)return void(typeof m.baseRev!="string"||typeof B.serverRevision!="bigint"&&typeof B.serverRevision!="object"||Jt(t,"pull"));if((yield Ee.waitFor(ca(B)))!==m.realmSetHash)return void Jt(t,"pull");let G=[];if(L.isLoggedIn){const ne=rs(t).map(Z=>t.table(Ma(Z.name)));G=yield la(ne,t)}if(m.changes.length>0){const ne=Mf(m.changes,G);yield Pf(ne,t)}B.latestRevisions=ya(G,B.latestRevisions),B.serverRevision=m.newRev,yield Rf(t,F,B.latestRevisions,m.newRev),yield t.$syncState.put(B,"syncState")}))}}catch{}}})}()}finally{o[o.length-1]-o[0]<Qg&&(yield new Promise(c=>setTimeout(c,Zg))),i=!1,n.next(!0)}}})),{enqueue:function(c){e.push(c),r.next(null)},readyToServe:n}}const wl=new WeakMap,Hi={members:"@id, [userId+realmId], [email+realmId], realmId",roles:"[realmId+name]",realms:"@realmId",$jobs:"",$syncState:"",$baseRevs:"[tableName+clientRev]",$logins:"claims.sub, lastLogin"};let tm=0;function Nt(t){"vip"in t&&(t=t.vip);let e=wl.get(t.cloud);if(!e){const n=new Nn;let r=new Wi(`syncstatechanged-${t.name}`),i=new Wi(`synccomplete-${t.name}`);n.id=++tm;let o=!1;e={get name(){return t.name},close:()=>t.close(),transaction:t.transaction.bind(t),table:t.table.bind(t),get tables(){return t.tables},cloud:t.cloud,get $jobs(){return t.table("$jobs")},get $syncState(){return t.table("$syncState")},get $baseRevs(){return t.table("$baseRevs")},get $logins(){return t.table("$logins")},get realms(){return t.realms},get members(){return t.members},get roles(){return t.roles},get initiallySynced(){return o},localSyncEvent:n,get syncStateChangedEvent(){return r},get syncCompleteEvent(){return i},dx:t},Object.assign(e,{getCurrentUser:()=>e.$logins.toArray().then(l=>l.find(f=>f.isLoggedIn)||pt),getPersistedSyncState:()=>e.$syncState.get("syncState"),getSchema:()=>e.$syncState.get("schema").then(l=>{if(l)for(const h of e.tables)h.schema.primKey&&h.schema.primKey.keyPath&&l[h.name]&&(l[h.name].primaryKey=typeof(f=h.schema.primKey.keyPath)=="string"?f:f?"["+[].join.call(f,"+")+"]":"");var f;return l}),getOptions:()=>e.$syncState.get("options"),setInitiallySynced(l){o=l},reconfigure(){r=new Wi(`syncstatechanged-${t.name}`),i=new Wi(`synccomplete-${t.name}`)}}),e.messageConsumer=em(e),e.messageProducer=new Nn,wl.set(t.cloud,e)}return e}const _l=new WeakMap;class Fa{constructor(e,n){_l.set(this,e),Object.assign(this,n)}static load(e,n){return e.table("$logins").get(n).then(r=>new Fa(e,r||{userId:n,claims:{sub:n},lastLogin:new Date(0)}))}save(){return te(this,void 0,void 0,function*(){_l.get(this).table("$logins").put(this)})}}function Kf(t,e){return Un(_t(t).pipe(Ct(e)))}function Bf(t){return te(this,void 0,void 0,function*(){const e=yield ga(t);if(e){if(!(yield function(n,r,i){return te(this,void 0,void 0,function*(){const o=[{type:"warning",messageCode:"LOGOUT_CONFIRMATION",message:`{numUnsyncedChanges} unsynced changes will get lost!
                Logout anyway?`,messageParams:{currentUserId:r,numUnsyncedChanges:i.toString()}}];return yield hi(n,{type:"logout-confirmation",title:"Confirm Logout",alerts:o,fields:{},submitLabel:"Confirm logout",cancelLabel:"Cancel"}).then(()=>!0).catch(()=>!1)})}(t.cloud.userInteraction,t.cloud.currentUserId,e)))throw new Error("User cancelled logout due to unsynced changes");yield ga(t,{deleteUnsyncedData:!0})}})}function ga(t){return te(this,arguments,void 0,function*(e,{deleteUnsyncedData:n=!1}={}){const[r,i]=yield e.dx.transaction("rw",e.dx.tables,o=>te(this,void 0,void 0,function*(){const c=o.idbtrans;c.disableChangeTracking=!0,c.disableAccessControl=!0;const l=o.storeNames.filter(h=>h.endsWith("_mutations")),f=(yield Promise.all(l.map(h=>o.table(h).count()))).reduce((h,d)=>h+d,0);if(f>0&&!n)return[f,!1];e.$syncState.delete("syncState");for(const h of e.dx.tables)h.name!=="$jobs"&&h.name!=="$syncState"&&h.clear();return[f,!0]}));return i&&(yield Kf(e.cloud.currentUser,o=>o.userId===pt.userId),yield e.cloud.sync({purpose:"pull",wait:!0})),r})}function zi(t,...e){globalThis.console[t](...e)}function Ko(t,e){return te(this,void 0,void 0,function*(){var n;const r=yield t.getCurrentUser(),i=r.userId;if(r.isLoggedIn&&(!e||!e.email&&!e.userId)){if((((n=r.license)===null||n===void 0?void 0:n.status)||"ok")==="ok"&&r.accessToken&&(!r.accessTokenExpiration||r.accessTokenExpiration.getTime()>Date.now()))return!1;if(r.refreshToken&&(!r.refreshTokenExpiration||r.refreshTokenExpiration.getTime()>Date.now()))return yield Us(t),!1}const o=new Fa(t,{claims:{},lastLogin:new Date(0)});return yield Cg(t.cloud.options.databaseUrl,o,t.cloud.options.fetchTokens||function(c){const{userInteraction:l}=c.cloud;return function(f){return te(this,arguments,void 0,function*({public_key:h,hints:d}){var g;let m;const b=(g=c.cloud.options)===null||g===void 0?void 0:g.databaseUrl;if(!b)throw new Error("No database URL given.");if((d==null?void 0:d.grant_type)==="demo")m={demo_user:yield pl(l,"Enter a demo user email",(d==null?void 0:d.email)||(d==null?void 0:d.userId)),grant_type:"demo",scopes:["ACCESS_DB"],public_key:h};else if(d!=null&&d.otpId&&d.otp)m={grant_type:"otp",otp_id:d.otpId,otp:d.otp,scopes:["ACCESS_DB"],public_key:h};else{const j=yield pl(l,"Enter email address",d==null?void 0:d.email);m=/@demo.local$/.test(j)?{demo_user:j,grant_type:"demo",scopes:["ACCESS_DB"],public_key:h}:{email:j,grant_type:"otp",scopes:["ACCESS_DB"]}}const w=yield fetch(`${b}/token`,{body:JSON.stringify(m),method:"post",headers:{"Content-Type":"application/json",mode:"cors"}});if(w.status!==200){const j=yield w.text();throw yield fa(l,"Token request failed",{type:"error",messageCode:"GENERIC_ERROR",message:j,messageParams:{}}).catch(()=>{}),new ha(w,j)}const E=yield w.json();if(E.type==="tokens"||E.type==="error")return E;if(m.grant_type==="otp"&&"email"in m){if(E.type!=="otp-sent")throw new Error(`Unexpected response from ${b}/token`);const j=yield yl(l,m.email),F=Object.assign(Object.assign({},m),{otp:j||"",otp_id:E.otp_id,public_key:h});let B=yield fetch(`${b}/token`,{body:JSON.stringify(F),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});for(;B.status===401;){const L=yield B.text();F.otp=yield yl(l,m.email,{type:"error",messageCode:"INVALID_OTP",message:L,messageParams:{}}),B=yield fetch(`${b}/token`,{body:JSON.stringify(F),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})}if(B.status!==200){const L=yield B.text();throw new ha(B,L)}return yield B.json()}throw new Error(`Unexpected response from ${b}/token`)})}}(t),t.cloud.userInteraction,e),i!==pt.userId&&o.userId!==i&&(yield Bf(t)),yield function(c,l){return te(this,void 0,void 0,function*(){const f=c.table("$logins");yield c.transaction("rw",f,h=>te(this,void 0,void 0,function*(){const d=yield f.toArray();yield Promise.all(d.filter(g=>g.userId!==l.userId&&g.isLoggedIn).map(g=>(g.isLoggedIn=!1,f.put(g)))),l.isLoggedIn=!0,l.lastLogin=new Date;try{yield l.save()}catch(g){try{g.name==="DataCloneError"&&(zi("debug","Login context property names:",Object.keys(l)),zi("debug","Login context property names:",Object.keys(l)),zi("debug","Login context:",l),zi("debug","Login context JSON:",JSON.stringify(l)))}catch{}throw g}})),yield Kf(c.cloud.currentUser,h=>h.userId===l.userId)})}(t,o),Jt(t,"pull"),o.userId!==i})}const nm=typeof InstallTrigger<"u",Ff=typeof navigator<"u"&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\/|Edge\//.test(navigator.userAgent),rm=Ff?[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]:NaN,$f=Ff&&rm<=605||nm,im=typeof self<"u"&&"clients"in self&&!self.document,{toString:sm}={};function kl(t){return sm.call(t).slice(8,-1)}function Bo(t,e){var n;return e.type==="delete"?e.keys:((n=e.keys)===null||n===void 0?void 0:n.slice())||e.values.map(t.extractKey)}const om=/b|c|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|x|y|z/i;let Yt=0;function qf(t,e){const n=new Uint8Array(18),r=new Uint8Array(n.buffer,0,6),i=Date.now();Yt>=i?++Yt:Yt=i,r[0]=Yt/1099511627776,r[1]=Yt/4294967296,r[2]=Yt/16777216,r[3]=Yt/65536,r[4]=Yt/256,r[5]=Yt;const o=new Uint8Array(n.buffer,6);return crypto.getRandomValues(o),t+Ef(new Uint8Array(n.buffer))+(e||"")}function am(t){return{stack:"dbcore",name:"idGenerationMiddleware",level:1,create:e=>Object.assign(Object.assign({},e),{table:n=>{const r=e.table(n);return Object.assign(Object.assign({},r),{mutate:i=>{var o,c;const l=i.trans;if(l.mode==="versionchange"&&(l.disableChangeTracking=!0,l.disableAccessControl=!0),l.disableChangeTracking)return r.mutate(i);if(i.type==="add"||i.type==="put"){const f=(o=t.cloud.schema)===null||o===void 0?void 0:o[n];if(f!=null&&f.generatedGlobalId){if(!((c=t.cloud.options)===null||c===void 0)&&c.databaseUrl&&!t.initiallySynced){const h=Bo(r.schema.primaryKey,i);return r.getMany({keys:h,trans:i.trans,cache:"immutable"}).then(d=>{if(d.length<h.length)throw new Error("Unable to create new objects without an initial sync having been performed.");return r.mutate(i)})}return function(h,d){let g=null;const m=Bo(r.schema.primaryKey,h);return m.forEach((b,w)=>{if(b===void 0){const E=h.values[w].realmId||t.cloud.currentUserId,j=E.substr(E.length-3);m[w]=qf(d,j),r.schema.primaryKey.outbound||(g||(g=h.values.slice()),g[w]=Ee.deepClone(g[w]),Ee.setByKeyPath(g[w],r.schema.primaryKey.keyPath,m[w]))}else if(typeof b!="string"||!b.startsWith(d)&&!b.startsWith("#"+d))throw new Ee.ConstraintError(`The ID "${b}" is not valid for table "${n}". Primary '@' keys requires the key to be prefixed with "${d}" (or "#${d}).
If you want to generate IDs programmatically, remove '@' from the schema to get rid of this constraint. Dexie Cloud supports custom IDs as long as they are random and globally unique.`)}),r.mutate(Object.assign(Object.assign({},h),{keys:m,values:g||h.values}))}(i,f.idPrefix)}f!=null&&f.markedForSync&&Bo(r.schema.primaryKey,i).forEach((h,d)=>{if(!Ba(h)){const g=Array.isArray(h)?h.map(kl).join(","):kl(h);throw new Ee.ConstraintError(`Invalid primary key type ${g} for table ${n}. Tables marked for sync has primary keys of type string or Array of string (and optional numbers)`)}})}return r.mutate(i)}})}})}}let cm=0;function Mr(t,e){return function(n){const{readers:r,writers:i}=n.trans[e]||(n.trans[e]={writers:[],readers:[]}),o=i.length,c=(o>0?i[o-1].then(()=>t(n),()=>t(n)):t(n)).finally(()=>{r.splice(r.indexOf(c))});return r.push(c),c}}function lm(t,e){return function(n){const{readers:r,writers:i}=n.trans[e]||(n.trans[e]={writers:[],readers:[]});let o=(i.length>0?i[i.length-1].then(()=>t(n),()=>t(n)):r.length>0?(c=r,new Promise(l=>{c.length===0&&l([]);let f=c.length;const h=new Array(f);c.forEach((d,g)=>Promise.resolve(d).then(m=>h[g]={status:"fulfilled",value:m},m=>h[g]={status:"rejected",reason:m}).then(()=>--f||l(h)))})).then(()=>t(n)):t(n)).finally(()=>{i.shift()});var c;return i.push(o),o}}const Jn=new Tt(new Set);function oi(t){var e,n,r,i;return((e=t.cloud.options)===null||e===void 0?void 0:e.disableEagerSync)||((r=(n=t.cloud.currentUser.value)===null||n===void 0?void 0:n.license)===null||r===void 0?void 0:r.status)!=="ok"||!(!((i=t.cloud.options)===null||i===void 0)&&i.databaseUrl)}function um({currentUserObservable:t,db:e}){return{stack:"dbcore",name:"MutationTrackingMiddleware",level:1,create:n=>{const r=new Set(n.schema.tables.map(c=>c.name)),i=n.schema.tables.filter(c=>!/^\$/.test(c.name)),o=new Map;for(const c of i){const l=`$${c.name}_mutations`;r.has(l)&&o.set(c.name,n.table(l))}return Object.assign(Object.assign({},n),{transaction:(c,l)=>{let f;if(l==="readwrite"){const h=c.filter(d=>{var g,m;return(m=(g=e.cloud.schema)===null||g===void 0?void 0:g[d])===null||m===void 0?void 0:m.markedForSync}).map(d=>Ma(d));f=n.transaction([...c,...h],l)}else f=n.transaction(c,l);if(l==="readwrite"){f.txid=_f(16),f.opCount=0,f.currentUser=t.value,Jn.value.add(f),Jn.next(Jn.value);const h=()=>{f.removeEventListener("complete",d),f.removeEventListener("error",h),f.removeEventListener("abort",h),Jn.value.delete(f),Jn.next(Jn.value)},d=()=>{f.mutationsAdded&&!oi(e)&&Jt(e,"push"),h()};f.addEventListener("complete",d),f.addEventListener("error",h),f.addEventListener("abort",h)}return f},table:c=>{const l=n.table(c);if(/^\$/.test(c))return c.endsWith("_mutations")?Object.assign(Object.assign({},l),{mutate:g=>(g.type!=="add"&&g.type!=="put"||(g.trans.mutationsAdded=!0),l.mutate(g))}):c==="$logins"?Object.assign(Object.assign({},l),{mutate:g=>l.mutate(g).then(m=>(g.trans.mutationsAdded=!0,m)).catch(m=>Promise.reject(m))}):l;const{schema:f}=l,h=o.get(c);return h?function(g){const m="$lock"+ ++cm;return Object.assign(Object.assign({},g),{count:Mr(g.count,m),get:Mr(g.get,m),getMany:Mr(g.getMany,m),openCursor:Mr(g.openCursor,m),query:Mr(g.query,m),mutate:lm(g.mutate,m)})}(Object.assign(Object.assign({},l),{mutate:g=>{var m,b,w;const E=g.trans;return E.txid?E.disableChangeTracking?l.mutate(g):!((b=(m=e.cloud.schema)===null||m===void 0?void 0:m[c])===null||b===void 0)&&b.markedForSync&&(!((w=E.currentUser)===null||w===void 0)&&w.isLoggedIn)?g.type==="deleteRange"?l.query({query:{range:g.range,index:f.primaryKey},trans:g.trans,values:!1}).then(j=>d({type:"delete",keys:j.result,trans:g.trans,criteria:{index:null,range:g.range}})):d(g):l.mutate(g):l.mutate(g)}})):l;function d(g){var m,b;const w=g.trans,E=(b=(m=e.cloud.options)===null||m===void 0?void 0:m.unsyncedProperties)===null||b===void 0?void 0:b[c],{txid:j,currentUser:{userId:F}}=w,{type:B}=g,L=++w.opCount;function G(ne){if(!E)return ne;let Z=ne;for(const oe of Object.keys(ne))E.some(Re=>oe===Re||oe.startsWith(Re+"."))&&(Z===ne&&(Z=Object.assign({},ne)),delete Z[oe]);return Z}return l.mutate(g).then(ne=>{var Z;const{numFailures:oe,failures:Re}=ne;let de=B==="delete"?g.keys:ne.results,De="values"in g?g.values:[],H="changeSpec"in g?g.changeSpec:void 0,he="updates"in g?g.updates:void 0;if(oe&&(de=de.filter((z,re)=>!Re[re]),De=De.filter((z,re)=>!Re[re])),E){if(De=De.map(z=>{const re=Object.assign({},z);for(const ie of E)delete re[ie];return re}),H&&(H=G(H),Object.keys(H).length===0))return ne;if(he){let z=he.changeSpecs.map(G),re={keys:[],changeSpecs:[]};const ie=new Bd;let ge=!1;for(let be=0,ue=z.length;be<ue;++be)Object.keys(z[be]).length>0?(re.keys.push(he.keys[be]),re.changeSpecs.push(z[be]),ie.addKey(he.keys[be])):ge=!0;if(he=re,ge){let be=[],ue=[];for(let ae=0,Ae=de.length;ae<Ae;++ae)ie.hasKey(de[ae])&&(be.push(de[ae]),ue.push(De[ae]));de=be,De=ue}}}const me=Date.now();let we="criteria"in g&&g.criteria?Object.assign(Object.assign({},g.criteria),{index:g.criteria.index===f.primaryKey.keyPath?null:g.criteria.index}):void 0;if(E&&(we!=null&&we.index)){const z=(Z=f.indexes.find(re=>re.name===we.index))===null||Z===void 0?void 0:Z.keyPath;(z?typeof z=="string"?[z]:z:[]).some(re=>E==null?void 0:E.includes(re))&&(we=void 0)}const ke=g.type==="delete"?{type:"delete",ts:me,opNo:L,keys:de,criteria:we,txid:j,userId:F}:g.type==="add"?{type:"insert",ts:me,opNo:L,keys:de,txid:j,userId:F,values:De}:we&&H?{type:"modify",ts:me,opNo:L,keys:de,criteria:we,changeSpec:H,txid:j,userId:F}:H?{type:"update",ts:me,opNo:L,keys:de,changeSpecs:de.map(()=>H),txid:j,userId:F}:he?{type:"update",ts:me,opNo:L,keys:he.keys,changeSpecs:he.changeSpecs,txid:j,userId:F}:{type:"upsert",ts:me,opNo:L,keys:de,values:De,txid:j,userId:F};return"isAdditionalChunk"in g&&g.isAdditionalChunk&&(ke.isAdditionalChunk=!0),de.length>0||we?h.mutate({type:"add",trans:w,values:[ke]}).then(()=>(w.mutationsAdded=!0,ne)):ne})}}})}}}function fm(t,e){return function(n,r){var i;const o=Object.assign(Object.assign({},Hi),n);Object.keys(Hi).forEach(h=>{const d=o[h];if(d==null)throw new Error(`Cannot delete table ${h} as it is needed for access control of Dexie Cloud`);if(!n[h])return;const g=d.split(",").map(w=>w.trim()),m=Hi[h].split(",").map(w=>w.trim()),b=new Set(g.map(w=>w.replace(/([&*]|\+\+)/g,"")));if(g[0]!==m[0])throw new Error(`Cannot override primary key of table ${h}. Please declare it as {${h}: ${JSON.stringify(Hi[h])}`);for(let w=1;w<m.length;++w){const E=m[w];b.has(E.replace(/([&*]|\+\+)/g,""))||(o[h]+=`,${E}`)}});const c=e.cloud.schema||(e.cloud.schema={}),l=new Set;Object.keys(o).forEach(h=>{const d=o[h],g=c[h]||(c[h]={});d!=null?(/^\@/.test(d)&&(o[h]=o[h].substr(1),g.generatedGlobalId=!0,g.idPrefix=function(m,b){let w=m[0].toLocaleLowerCase();for(let B=1,L=m.length;B<L&&w.length<3;++B)(om.test(m[B])||(E=m[B])>="A"&&E<="Z")&&(w+=m[B].toLowerCase());for(var E,j,F;b.has(w);){if(/\d/g.test(w)){if(w=w.substr(0,w.length-1)+(w[w.length-1]+1),!(w.length>3))continue;w=w.substr(0,3)}else if(w.length<3){w+="2";continue}let B=1,L=w;for(;b.has(L)&&B<8;)j=w,L=(1&(F=B)?j[0].toUpperCase():j[0].toLowerCase())+(2&F?j[1].toUpperCase():j[1].toLowerCase())+(4&F?j[2].toUpperCase():j[2].toLowerCase()),++B;if(B<8)w=L;else{let G=w.charCodeAt(2)+1&127;w=w.substr(0,2)+String.fromCharCode(G)}}return w}(h,l),l.add(g.idPrefix)),/^\$/.test(h)||(o[`$${h}_mutations`]="++rev",g.markedForSync=!0),g.deleted&&(g.deleted=!1)):(g.deleted=!0,g.markedForSync=!1,o[`$${h}_mutations`]=null)});const f=t.call(this,o,r);for(const[h,d]of Object.entries(r))if(!((i=d.yProps)===null||i===void 0)&&i.length){const g=c[h];g&&(g.yProps=d.yProps.map(m=>m.prop))}return f}}function Vf(t,e,n){return typeof navigator<"u"&&navigator.locks?navigator.locks.request(t.name+"|"+e,()=>n()):n()}const zr=new Tt(!0),ma=new Tt(!0);zr.pipe(ut(t=>t?Xt(!0):Xt(!1).pipe(du(2e4))),hu()).subscribe(ma);const Wf=typeof document<"u"?Kt(document,"visibilitychange"):Xt({}),dm=Wf.pipe(Ct(()=>document.visibilityState==="hidden")),hm=Wf.pipe(Ct(()=>document.visibilityState==="visible")),Hf=typeof window<"u"?Es(hm,Kt(window,"mousedown"),Kt(window,"mousemove"),Kt(window,"keydown"),Kt(window,"wheel"),Kt(window,"touchmove")):Xt({});typeof document<"u"&&Es(Xt(!0),dm,Hf).pipe(bt(()=>document.visibilityState==="visible"),Go(t=>{zr.value!==t&&zr.next(t)}),ut(t=>t?Xt(0).pipe(du(16e4),Go(()=>zr.next(!1))):Xt(0))).subscribe(()=>{});class pm extends Error{constructor(){super(...arguments),this.name="TokenExpiredError"}}const zf=new WeakMap,Sl=new WeakMap;function Yf(t){let e=Sl.get(t);return e||(e=new Nn,Sl.set(t,e)),e}class ym extends Ye{constructor(e,n,r,i,o,c,l,f){super(h=>new mm(e,n,r,i,o,f,h,c,l))}}let gm=0;class mm extends dr{constructor(e,n,r,i,o,c,l,f,h){super(()=>this.teardown()),this.id=++gm,this.subscriptions=new Set,this.reconnecting=!1,this.db=e,this.databaseUrl=e.cloud.options.databaseUrl,this.rev=n,this.yrev=r,this.realmSetHash=i,this.clientIdentity=o,this.user=c,this.subscriber=l,this.lastUserActivity=new Date,this.messageProducer=f,this.webSocketStatus=h,this.connect()}teardown(){this.disconnect()}disconnect(){if(this.webSocketStatus.next("disconnected"),this.pinger&&(clearInterval(this.pinger),this.pinger=null),this.ws)try{this.ws.close()}catch{}this.ws=null;for(const e of this.subscriptions)e.unsubscribe();this.subscriptions.clear()}reconnect(){if(!this.reconnecting){this.reconnecting=!0;try{this.disconnect()}catch{}this.connect().catch(()=>{}).then(()=>this.reconnecting=!1)}}connect(){return te(this,void 0,void 0,function*(){if(this.lastServerActivity=new Date,this.pauseUntil&&this.pauseUntil>new Date)return;if(this.ws)throw new Error("Called connect() when a connection is already open");if(!this.databaseUrl)throw new Error("Cannot connect without a database URL");if(this.closed)return;const e=this.user.accessTokenExpiration;if(e&&e<new Date)return void this.subscriber.error(new pm);this.webSocketStatus.next("connecting"),this.pinger=setInterval(()=>te(this,void 0,void 0,function*(){if(this.closed)this.teardown();else if(this.ws)try{this.ws.send(JSON.stringify({type:"ping"})),setTimeout(()=>{this.pinger&&(this.closed?this.teardown():this.lastServerActivity<new Date(Date.now()-2e4)&&this.reconnect())},2e4)}catch{this.reconnect()}else this.reconnect()}),3e4);const n=new URL(this.databaseUrl);n.protocol=n.protocol==="http:"?"ws":"wss";const r=new URLSearchParams;if(this.subscriber.closed)return;r.set("v","2"),this.rev&&r.set("rev",this.rev),this.yrev&&r.set("yrev",this.yrev),r.set("realmsHash",this.realmSetHash),r.set("clientId",this.clientIdentity),r.set("dxcv",this.db.cloud.version),this.user.accessToken&&r.set("token",this.user.accessToken);const i=this.ws=new WebSocket(`${n}/changes?${r}`);i.binaryType="arraybuffer",i.onclose=o=>{this.pinger&&this.reconnect()},i.onmessage=o=>{if(this.pinger){this.lastServerActivity=new Date;try{const c=typeof o.data=="string"?si.parse(o.data):function(l){const f=new mr(l),h=Ot(f);if(h==="outdated-server-rev")return{type:h};if(h==="y-complete-sync-done")return{type:h,yServerRev:Ot(f)};const d=Ot(f),g=Ot(f);switch(h){case"u-ack":case"u-reject":return{type:h,table:d,prop:g,i:Number(Yc(f))};default:{const m=vn(f);switch(h){case"in-sync":case"doc-close":return{type:h,table:d,prop:g,k:m};case"aware":return{type:h,table:d,prop:g,k:m,u:nt(f)};case"doc-open":return{type:h,table:d,prop:g,k:m,serverRev:vn(f),sv:vn(f)};case"sv":return{type:h,table:d,prop:g,k:m,sv:nt(f)};case"u-c":return{type:h,table:d,prop:g,k:m,u:nt(f),i:Number(Yc(f))};case"u-s":return{type:h,table:d,prop:g,k:m,u:nt(f),r:f.pos<f.arr.length&&Ot(f)||void 0};default:throw new TypeError(`Unknown message type: ${h}`)}}}}(new Uint8Array(o.data));if(c.type==="error")throw new Error(`Error message from dexie-cloud: ${c.error}`);if(c.type==="aware"){const l=ft.getDocCache(this.db.dx).find(c.table,c.k,c.prop);if(l){const f=(h=>zf.get(h))(l);f&&mg(f,c.u,"server")}}else if(c.type!=="pong")if(c.type==="doc-open"){const l=ft.getDocCache(this.db.dx).find(c.table,c.k,c.prop);l&&Yf(l).next()}else c.type==="u-ack"||c.type==="u-reject"||c.type==="u-s"||c.type==="in-sync"||c.type==="outdated-server-rev"||c.type==="y-complete-sync-done"?jf([c],this.db).then(l=>te(this,[l],void 0,function*({resyncNeeded:f,yServerRevision:h,receivedUntils:d}){if(h&&(yield this.db.$syncState.update("syncState",{yServerRevision:h})),c.type==="u-s"&&d){const g=Hr(this.db,c.table,c.prop);if(g){const m=d[g.name];m&&(yield g.update(bn,{receivedUntil:m}))}}f&&(yield this.db.cloud.sync({purpose:"pull",wait:!0}))})):this.subscriber.next(c)}catch(c){this.subscriber.error(c)}}};try{let o=!1;yield new Promise((c,l)=>{i.onopen=f=>{o=!0,c(null)},i.onerror=f=>{if(o)this.reconnect();else{const h=f.error||new Error("WebSocket Error");this.subscriber.error(h),this.webSocketStatus.next("error"),l(h)}}}),this.subscriptions.add(this.messageProducer.subscribe(c=>{var l,f;this.closed||(c.type==="ready"&&this.webSocketStatus.value!=="connected"&&this.webSocketStatus.next("connected"),c.type==="ready"?(this.rev=c.rev,(l=this.ws)===null||l===void 0||l.send(si.stringify(c))):(f=this.ws)===null||f===void 0||f.send(function(h){const d=new yr;switch(It(d,h.type),"table"in h&&It(d,h.table),"prop"in h&&It(d,h.prop),h.type){case"u-ack":case"u-reject":qc(d,BigInt(h.i));break;case"outdated-server-rev":break;case"y-complete-sync-done":It(d,h.yServerRev);break;default:switch(mn(d,h.k),h.type){case"aware":tt(d,h.u);break;case"doc-open":mn(d,h.serverRev),mn(d,h.sv);break;case"doc-close":break;case"sv":tt(d,h.sv);break;case"u-c":tt(d,h.u),qc(d,BigInt(h.i));break;case"u-s":tt(d,h.u),It(d,h.r||"")}}return wt(d)}(c)))})),this.user.isLoggedIn&&!oi(this.db)&&this.subscriptions.add(function(c){const l=Ka(c.tables.filter(f=>{var h,d;return((d=(h=c.cloud.schema)===null||h===void 0?void 0:h[f.name])===null||d===void 0?void 0:d.markedForSync)&&f.schema.yProps}).map(f=>f.schema.yProps.map(h=>({table:f.name,ydocProp:h.prop,updatesTable:h.updatesTable}))));return Es(...l.map(({table:f,ydocProp:h,updatesTable:d})=>{const g=c.table(d);return _t(g.get(bn)).pipe(ut(m=>{let b=(m==null?void 0:m.unsentFrom)||1;return _t(yn(()=>te(this,void 0,void 0,function*(){return(yield Uf(g,b)).filter(w=>w.f&&1&w.f).map(w=>({type:"u-c",table:f,prop:h,k:w.k,u:w.u,i:w.i}))}))).pipe(Go(w=>{w.length>0&&(b=w.at(-1).i+1)}))}))})).pipe(ci(f=>f))}(this.db).subscribe(this.db.messageProducer))}catch{this.pauseUntil=new Date(Date.now()+6e4)}})}}class vm extends Error{constructor(e){super(e==="expired"?"License expired":e==="deactivated"?"User deactivated":"Invalid license"),this.name="InvalidLicenseError",e&&(this.license=e)}}function bm(t){return te(this,void 0,void 0,function*(){var e;yield(e=3e3,new Promise(n=>setTimeout(n,e))),yield Un(Hf)})}function xl(t){return te(this,void 0,void 0,function*(){var e;return!(!(!((e=t.cloud.options)===null||e===void 0)&&e.databaseUrl)||!t.cloud.schema)&&(yield Ls(t,t.cloud.options,t.cloud.schema,{justCheckIfNeeded:!0}))})}const Yi=new WeakMap;function $a(t,e,n,r){const i=Yi.get(t);if(i){if(i.pull||(r==null?void 0:r.purpose)==="push")return i.promise;{let c=!1;const l=t.cloud.syncState.subscribe(f=>{f.phase==="pulling"&&(c=!0)});return i.promise.then(()=>{l.unsubscribe()}).catch(f=>(l.unsubscribe(),Promise.reject(f))).then(()=>{if(!c)return $a(t,e,n,r)})}}const o=function(){return te(this,void 0,void 0,function*(){try{yield Tf(t),yield Vf(t,Lf,()=>Ls(t,e,n,r)),Yi.delete(t)}catch(c){throw Yi.delete(t),c}})}();return Yi.set(t,{promise:o,pull:(r==null?void 0:r.purpose)!=="push"}),o}const wm=1e3;function _m(t,e,n){let r=null,i={cancelled:!1},o=0,c=0;function l(b=1){setTimeout(()=>{const w=f?"pull":"push";c=Date.now(),$a(t,e,n,{cancelToken:i,retryImmediatelyOnFetchError:!0,purpose:w}).then(()=>{if(i.cancelled)m();else if(f||h)return f=!1,h=!1,l();d=!1,o=0,c=0}).catch(E=>{if(i.cancelled)m(),d=!1,o=0,c=0;else if(b<5){const j=[0,20,40,300,900][b]*wm;o=Date.now()+j,c=0,setTimeout(()=>l(b+1),j)}else d=!1,o=0,c=0})},0)}let f=!1,h=!1,d=!1;const g=b=>{i.cancelled||(b==="pull"&&(f=!0),b==="push"&&(h=!0),d?o||c>0&&Date.now():(d=!0,l()))},m=()=>{i.cancelled=!0,r&&r.unsubscribe()};return{start:()=>{r=t.localSyncEvent.subscribe(({purpose:b})=>{g(b||"pull")})},stop:m}}function Fo(t,e){if(t&&e&&e.unsyncedTables)for(const n of e.unsyncedTables)t[n]&&(t[n].markedForSync=!1)}var Ns,ve,Gf,Yr,El,bs={},Jf=[],km=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function hn(t,e){for(var n in e)t[n]=e[n];return t}function Xf(t){var e=t.parentNode;e&&e.removeChild(t)}function We(t,e,n){var r,i,o,c={};for(o in e)o=="key"?r=e[o]:o=="ref"?i=e[o]:c[o]=e[o];if(arguments.length>2&&(c.children=arguments.length>3?Ns.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)c[o]===void 0&&(c[o]=t.defaultProps[o]);return is(t,c,r,i,null)}function is(t,e,n,r,i){var o={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i??++Gf};return i==null&&ve.vnode!=null&&ve.vnode(o),o}function ur(t){return t.children}function Gr(t,e){this.props=t,this.context=e}function fr(t,e){if(e==null)return t.__?fr(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?fr(t):null}function Qf(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Qf(t)}}function Cl(t){(!t.__d&&(t.__d=!0)&&Yr.push(t)&&!ws.__r++||El!==ve.debounceRendering)&&((El=ve.debounceRendering)||setTimeout)(ws)}function ws(){for(var t;ws.__r=Yr.length;)t=Yr.sort(function(e,n){return e.__v.__b-n.__v.__b}),Yr=[],t.some(function(e){var n,r,i,o,c,l;e.__d&&(c=(o=(n=e).__v).__e,(l=n.__P)&&(r=[],(i=hn({},o)).__v=o.__v+1,qa(l,o,i,n.__n,l.ownerSVGElement!==void 0,o.__h!=null?[c]:null,r,c??fr(o),o.__h),nd(r,o),o.__e!=c&&Qf(o)))})}function Zf(t,e,n,r,i,o,c,l,f,h){var d,g,m,b,w,E,j,F=r&&r.__k||Jf,B=F.length;for(n.__k=[],d=0;d<e.length;d++)if((b=n.__k[d]=(b=e[d])==null||typeof b=="boolean"?null:typeof b=="string"||typeof b=="number"||typeof b=="bigint"?is(null,b,null,null,b):Array.isArray(b)?is(ur,{children:b},null,null,null):b.__b>0?is(b.type,b.props,b.key,null,b.__v):b)!=null){if(b.__=n,b.__b=n.__b+1,(m=F[d])===null||m&&b.key==m.key&&b.type===m.type)F[d]=void 0;else for(g=0;g<B;g++){if((m=F[g])&&b.key==m.key&&b.type===m.type){F[g]=void 0;break}m=null}qa(t,b,m=m||bs,i,o,c,l,f,h),w=b.__e,(g=b.ref)&&m.ref!=g&&(j||(j=[]),m.ref&&j.push(m.ref,null,b),j.push(g,b.__c||w,b)),w!=null?(E==null&&(E=w),typeof b.type=="function"&&b.__k===m.__k?b.__d=f=ed(b,f,t):f=td(t,b,m,F,w,f),typeof n.type=="function"&&(n.__d=f)):f&&m.__e==f&&f.parentNode!=t&&(f=fr(m))}for(n.__e=E,d=B;d--;)F[d]!=null&&(typeof n.type=="function"&&F[d].__e!=null&&F[d].__e==n.__d&&(n.__d=fr(r,d+1)),id(F[d],F[d]));if(j)for(d=0;d<j.length;d++)rd(j[d],j[++d],j[++d])}function ed(t,e,n){for(var r,i=t.__k,o=0;i&&o<i.length;o++)(r=i[o])&&(r.__=t,e=typeof r.type=="function"?ed(r,e,n):td(n,r,r,i,r.__e,e));return e}function td(t,e,n,r,i,o){var c,l,f;if(e.__d!==void 0)c=e.__d,e.__d=void 0;else if(n==null||i!=o||i.parentNode==null)e:if(o==null||o.parentNode!==t)t.appendChild(i),c=null;else{for(l=o,f=0;(l=l.nextSibling)&&f<r.length;f+=2)if(l==i)break e;t.insertBefore(i,o),c=o}return c!==void 0?c:i.nextSibling}function Il(t,e,n){e[0]==="-"?t.setProperty(e,n):t[e]=n==null?"":typeof n!="number"||km.test(e)?n:n+"px"}function Gi(t,e,n,r,i){var o;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||Il(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||Il(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?r||t.addEventListener(e,o?Al:Ol,o):t.removeEventListener(e,o?Al:Ol,o);else if(e!=="dangerouslySetInnerHTML"){if(i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n!=null&&(n!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,n):t.removeAttribute(e))}}function Ol(t){this.l[t.type+!1](ve.event?ve.event(t):t)}function Al(t){this.l[t.type+!0](ve.event?ve.event(t):t)}function qa(t,e,n,r,i,o,c,l,f){var h,d,g,m,b,w,E,j,F,B,L,G,ne,Z=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(f=n.__h,l=e.__e=n.__e,e.__h=null,o=[l]),(h=ve.__b)&&h(e);try{e:if(typeof Z=="function"){if(j=e.props,F=(h=Z.contextType)&&r[h.__c],B=h?F?F.props.value:h.__:r,n.__c?E=(d=e.__c=n.__c).__=d.__E:("prototype"in Z&&Z.prototype.render?e.__c=d=new Z(j,B):(e.__c=d=new Gr(j,B),d.constructor=Z,d.render=xm),F&&F.sub(d),d.props=j,d.state||(d.state={}),d.context=B,d.__n=r,g=d.__d=!0,d.__h=[]),d.__s==null&&(d.__s=d.state),Z.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=hn({},d.__s)),hn(d.__s,Z.getDerivedStateFromProps(j,d.__s))),m=d.props,b=d.state,g)Z.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(Z.getDerivedStateFromProps==null&&j!==m&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(j,B),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(j,d.__s,B)===!1||e.__v===n.__v){d.props=j,d.state=d.__s,e.__v!==n.__v&&(d.__d=!1),d.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(oe){oe&&(oe.__=e)}),d.__h.length&&c.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(j,d.__s,B),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(m,b,w)})}if(d.context=B,d.props=j,d.__v=e,d.__P=t,L=ve.__r,G=0,"prototype"in Z&&Z.prototype.render)d.state=d.__s,d.__d=!1,L&&L(e),h=d.render(d.props,d.state,d.context);else do d.__d=!1,L&&L(e),h=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++G<25);d.state=d.__s,d.getChildContext!=null&&(r=hn(hn({},r),d.getChildContext())),g||d.getSnapshotBeforeUpdate==null||(w=d.getSnapshotBeforeUpdate(m,b)),ne=h!=null&&h.type===ur&&h.key==null?h.props.children:h,Zf(t,Array.isArray(ne)?ne:[ne],e,n,r,i,o,c,l,f),d.base=e.__e,e.__h=null,d.__h.length&&c.push(d),E&&(d.__E=d.__=null),d.__e=!1}else o==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Sm(n.__e,e,n,r,i,o,c,f);(h=ve.diffed)&&h(e)}catch(oe){e.__v=null,(f||o!=null)&&(e.__e=l,e.__h=!!f,o[o.indexOf(l)]=null),ve.__e(oe,e,n)}}function nd(t,e){ve.__c&&ve.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(r){r.call(n)})}catch(r){ve.__e(r,n.__v)}})}function Sm(t,e,n,r,i,o,c,l){var f,h,d,g=n.props,m=e.props,b=e.type,w=0;if(b==="svg"&&(i=!0),o!=null){for(;w<o.length;w++)if((f=o[w])&&"setAttribute"in f==!!b&&(b?f.localName===b:f.nodeType===3)){t=f,o[w]=null;break}}if(t==null){if(b===null)return document.createTextNode(m);t=i?document.createElementNS("http://www.w3.org/2000/svg",b):document.createElement(b,m.is&&m),o=null,l=!1}if(b===null)g===m||l&&t.data===m||(t.data=m);else{if(o=o&&Ns.call(t.childNodes),h=(g=n.props||bs).dangerouslySetInnerHTML,d=m.dangerouslySetInnerHTML,!l){if(o!=null)for(g={},w=0;w<t.attributes.length;w++)g[t.attributes[w].name]=t.attributes[w].value;(d||h)&&(d&&(h&&d.__html==h.__html||d.__html===t.innerHTML)||(t.innerHTML=d&&d.__html||""))}if(function(E,j,F,B,L){var G;for(G in F)G==="children"||G==="key"||G in j||Gi(E,G,null,F[G],B);for(G in j)L&&typeof j[G]!="function"||G==="children"||G==="key"||G==="value"||G==="checked"||F[G]===j[G]||Gi(E,G,j[G],F[G],B)}(t,m,g,i,l),d)e.__k=[];else if(w=e.props.children,Zf(t,Array.isArray(w)?w:[w],e,n,r,i&&b!=="foreignObject",o,c,o?o[0]:n.__k&&fr(n,0),l),o!=null)for(w=o.length;w--;)o[w]!=null&&Xf(o[w]);l||("value"in m&&(w=m.value)!==void 0&&(w!==t.value||b==="progress"&&!w||b==="option"&&w!==g.value)&&Gi(t,"value",w,g.value,!1),"checked"in m&&(w=m.checked)!==void 0&&w!==t.checked&&Gi(t,"checked",w,g.checked,!1))}return t}function rd(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(r){ve.__e(r,n)}}function id(t,e,n){var r,i;if(ve.unmount&&ve.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||rd(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){ve.__e(o,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&id(r[i],e,typeof t.type!="function");n||t.__e==null||Xf(t.__e),t.__e=t.__d=void 0}function xm(t,e,n){return this.constructor(t,n)}function Dl(t,e,n){var r,i,o;ve.__&&ve.__(t,e),i=(r=!1)?null:e.__k,o=[],qa(e,t=e.__k=We(ur,null,[t]),i||bs,bs,e.ownerSVGElement!==void 0,i?null:e.firstChild?Ns.call(e.childNodes):null,o,i?i.__e:e.firstChild,r),nd(o,t)}Ns=Jf.slice,ve={__e:function(t,e,n,r){for(var i,o,c;e=e.__;)if((i=e.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(t)),c=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,r||{}),c=i.__d),c)return i.__E=i}catch(l){t=l}throw t}},Gf=0,Gr.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=hn({},this.state),typeof t=="function"&&(t=t(hn({},n),this.props)),t&&hn(n,t),t!=null&&this.__v&&(e&&this.__h.push(e),Cl(this))},Gr.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Cl(this))},Gr.prototype.render=ur,Yr=[],ws.__r=0;const Mt={Alert:{error:{color:"red",fontWeight:"bold"},warning:{color:"#f80",fontWeight:"bold"},info:{color:"black"}},Darken:{position:"fixed",top:0,left:0,opacity:.5,backgroundColor:"#000",width:"100vw",height:"100vh",zIndex:150,webkitBackdropFilter:"blur(2px)",backdropFilter:"blur(2px)"},DialogOuter:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:150,alignItems:"center",display:"flex",justifyContent:"center"},DialogInner:{position:"relative",color:"#222",backgroundColor:"#fff",padding:"30px",marginBottom:"2em",maxWidth:"90%",maxHeight:"90%",overflowY:"auto",border:"3px solid #3d3d5d",borderRadius:"8px",boxShadow:"0 0 80px 10px #666",width:"auto",fontFamily:"sans-serif"},Input:{height:"35px",width:"17em",borderColor:"#ccf4",outline:"none",fontSize:"17pt",padding:"8px"}};function Em({children:t,className:e}){return We("div",{className:e},We("div",{style:Mt.Darken}),We("div",{style:Mt.DialogOuter},We("div",{style:Mt.DialogInner},t)))}var Ms,He,$o,Tl,_s=0,sd=[],ss=[],Rl=ve.__b,Pl=ve.__r,Ul=ve.diffed,jl=ve.__c,Ll=ve.unmount;function Va(t,e){ve.__h&&ve.__h(He,t,_s||e),_s=0;var n=He.__H||(He.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:ss}),n.__[t]}function Cm(t){return _s=1,function(e,n,r){var i=Va(Ms++,2);if(i.t=e,!i.__c&&(i.__=[Ml(void 0,n),function(c){var l=i.__N?i.__N[0]:i.__[0],f=i.t(l,c);l!==f&&(i.__N=[f,i.__[1]],i.__c.setState({}))}],i.__c=He,!He.u)){He.u=!0;var o=He.shouldComponentUpdate;He.shouldComponentUpdate=function(c,l,f){if(!i.__c.__H)return!0;var h=i.__c.__H.__.filter(function(g){return g.__c});if(h.every(function(g){return!g.__N}))return!o||o.call(this,c,l,f);var d=!1;return h.forEach(function(g){if(g.__N){var m=g.__[0];g.__=g.__N,g.__N=void 0,m!==g.__[0]&&(d=!0)}}),!!d&&(!o||o.call(this,c,l,f))}}return i.__N||i.__}(Ml,t)}function Im(t){return _s=5,function(e,n){var r=Va(Ms++,7);return od(r.__H,n)?(r.__V=e(),r.i=n,r.__h=e,r.__V):r.__}(function(){return{current:t}},[])}function Om(){for(var t;t=sd.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(os),t.__H.__h.forEach(va),t.__H.__h=[]}catch(e){t.__H.__h=[],ve.__e(e,t.__v)}}ve.__b=function(t){He=null,Rl&&Rl(t)},ve.__r=function(t){Pl&&Pl(t),Ms=0;var e=(He=t.__c).__H;e&&($o===He?(e.__h=[],He.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=ss,n.__N=n.i=void 0})):(e.__h.forEach(os),e.__h.forEach(va),e.__h=[])),$o=He},ve.diffed=function(t){Ul&&Ul(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(sd.push(e)!==1&&Tl===ve.requestAnimationFrame||((Tl=ve.requestAnimationFrame)||function(n){var r,i=function(){clearTimeout(o),Nl&&cancelAnimationFrame(r),setTimeout(n)},o=setTimeout(i,100);Nl&&(r=requestAnimationFrame(i))})(Om)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==ss&&(n.__=n.__V),n.i=void 0,n.__V=ss})),$o=He=null},ve.__c=function(t,e){e.some(function(n){try{n.__h.forEach(os),n.__h=n.__h.filter(function(r){return!r.__||va(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],ve.__e(r,n.__v)}}),jl&&jl(t,e)},ve.unmount=function(t){Ll&&Ll(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{os(r)}catch(i){e=i}}),e&&ve.__e(e,n.__v))};var Nl=typeof requestAnimationFrame=="function";function os(t){var e=He,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),He=e}function va(t){var e=He;t.__c=t.__(),He=e}function od(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Ml(t,e){return typeof e=="function"?e(t):e}function Am({title:t,type:e,alerts:n,fields:r,submitLabel:i,cancelLabel:o,onCancel:c,onSubmit:l}){const[f,h]=Cm({}),d=Im(null);return function(g,m){var b=Va(Ms++,4);!ve.__s&&od(b.__H,m)&&(b.__=g,b.i=m,He.__h.push(b))}(()=>{var g;return(g=d.current)===null||g===void 0?void 0:g.focus()},[]),We(Em,{className:"dxc-login-dlg"},We(ur,null,We("h3",{style:Mt.WindowHeader},t),n.map(g=>We("p",{style:Mt.Alert[g.type]},function({message:m,messageCode:b,messageParams:w}){return m.replace(/\{\w+\}/gi,E=>w[E.substring(1,E.length-1)])}(g))),We("form",{onSubmit:g=>{g.preventDefault(),l(f)}},Object.entries(r).map(([g,{type:m,label:b,placeholder:w}],E)=>We("label",{style:Mt.Label,key:E},b?`${b}: `:"",We("input",{ref:E===0?d:void 0,type:m,name:g,autoComplete:"on",style:Mt.Input,autoFocus:!0,placeholder:w,value:f[g]||"",onInput:j=>{var F;const B=function(G,ne){switch(G){case"email":return ne.toLowerCase();case"otp":return ne.toUpperCase();default:return ne}}(m,(F=j.target)===null||F===void 0?void 0:F.value);let L=Object.assign(Object.assign({},f),{[g]:B});h(L),m==="otp"&&(B==null?void 0:B.trim().length)===8&&l(L)}}))))),We("div",{style:Mt.ButtonsDiv},We(ur,null,We("button",{type:"submit",style:Mt.Button,onClick:()=>l(f)},i),o&&We("button",{style:Mt.Button,onClick:c},o))))}class Kl extends Gr{constructor(e){super(e),this.observer=n=>this.setState({userInteraction:n}),this.state={userInteraction:void 0}}componentDidMount(){this.subscription=_t(this.props.db.cloud.userInteraction).subscribe(this.observer)}componentWillUnmount(){this.subscription&&(this.subscription.unsubscribe(),delete this.subscription)}render(e,{userInteraction:n}){return n?We(Am,Object.assign({},n)):null}}function pi(t){const e=new WeakMap;return n=>{let r=e.get(n);return r||(r=t(n),e.set(n,r)),r}}const ks=pi(t=>new Tt(pt));function Ks(t,e){let n=e,r=_t(t).pipe(bt(o=>n=o),Vh({resetOnRefCountZero:()=>fu(1e3)}));const i=new Ye(o=>{let c=!1;const l=r.subscribe({next(f){c=!0,o.next(f)},error(f){o.error(f)},complete(){o.complete()}});return c||l.closed||o.next(n),l});return i.getValue=()=>n,i}const ad=pi(t=>Ks(yn(()=>t.roles.where({realmId:"rlm-public"}).toArray().then(e=>{const n={};for(const r of e.slice().sort((i,o)=>(i.sortOrder||0)-(o.sortOrder||0)))n[r.name]=r;return n})),{})),cd=pi(t=>Ks(ks(t._novip).pipe(ut(e=>yn(()=>t.transaction("r","realms","members",()=>Promise.all([t.members.where({userId:e.userId}).toArray(),t.realms.toArray(),e.userId]).then(([n,r,i])=>({selfMembers:n,realms:r,userId:i})))))),{selfMembers:[],realms:[],get userId(){return t.cloud.currentUserId}}));function Dm(...t){return t.length===0?{}:t.reduce((n,r)=>{const i=Object.assign({},n);for(const[o,c]of Object.entries(r))if(o in i&&i[o]){if(i[o]==="*")continue;if(c==="*")i[o]="*";else if(Array.isArray(c)&&Array.isArray(i[o])){const l=i,f=l[o];l[o]=[...new Set([...f,...c])]}else if(typeof c=="object"&&c&&typeof i[o]=="object"){const l=i[o];for(const[f,h]of Object.entries(c))l[f]!=="*"&&(h==="*"?l[f]="*":Array.isArray(l[f])&&Array.isArray(h)&&(l[f]=[...new Set([...l[f],...h])]))}}else i[o]=r[o];return i})}const ld=pi(t=>function(e,n){let r;const i=e.pipe(bt(o=>r=n(o)));return i.getValue=()=>r!==void 0?r:r=n(e.getValue()),i}(Ks(Xr([cd(t._novip),ad(t._novip)]).pipe(bt(([{selfMembers:e,realms:n,userId:r},i])=>({selfMembers:e,realms:n,userId:r,globalRoles:i}))),{selfMembers:[],realms:[],userId:pt.userId,globalRoles:{}}),({selfMembers:e,realms:n,userId:r,globalRoles:i})=>n.map(c=>{const l=e.filter(d=>d.realmId===c.realmId),f=l.map(d=>d.permissions).filter(d=>d),h=Ka(l.map(d=>d.roles).filter(d=>d)).map(d=>i[d]).filter(d=>d).map(d=>d.permissions);return Object.assign(Object.assign({},c),{permissions:c.owner===r?{manage:"*"}:Dm(...f,...h)})}).reduce((c,l)=>Object.assign(Object.assign({},c),{[l.realmId]:l}),{[r]:{realmId:r,owner:r,name:r,permissions:{manage:"*"}}})));class Bl{constructor(e,n,r){this.permissions=e||{},this.tableName=n,this.isOwner=r}add(...e){var n;return this.permissions.manage==="*"||!!(!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))||this.permissions.add==="*"||!!e.every(r=>{var i;return(i=this.permissions.add)===null||i===void 0?void 0:i.includes(r)})}update(...e){var n,r;if(this.isOwner||this.permissions.manage==="*"||!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))return!0;if(this.permissions.update==="*")return e.every(o=>o!=="owner");const i=(r=this.permissions.update)===null||r===void 0?void 0:r[this.tableName];return i==="*"?e.every(o=>o!=="owner"):e.every(o=>i==null?void 0:i.some(c=>c===o||c==="*"&&o!=="owner"))}delete(){var e;return!(!this.isOwner&&this.permissions.manage!=="*")||!!(!((e=this.permissions.manage)===null||e===void 0)&&e.includes(this.tableName))}}const Tm=pi(t=>{const e=ks(t._novip).pipe(ut(i=>yn(()=>t.members.where({email:i.email||""}).toArray()))),n=ld(t._novip),r=cd(t._novip);return Ks(Xr([e,r,n]).pipe(bt(([i,o,c])=>{const l=(d,g)=>Object.assign(Object.assign({},d),{[g.id]:Object.assign(Object.assign({},g),{realm:c[g.realmId]})}),f=i.reduce(l,{}),h=o.selfMembers.reduce(l,f);return Object.values(h).filter(d=>!d.accepted).map(d=>Object.assign(Object.assign({},d),{accept(){return te(this,void 0,void 0,function*(){yield t.members.update(d.id,{accepted:new Date})})},reject(){return te(this,void 0,void 0,function*(){yield t.members.update(d.id,{rejected:new Date})})}}))})),[])});function Rm(t){return e=>{var n;const r=e.doc;if(!r)throw new Error("Internal error: DexieYProvider.createYHandler called without a doc. This is unexpected.");const{parentTable:i}=r.meta||{};if(!(!((n=t.cloud.schema)===null||n===void 0)&&n[i].markedForSync))return;let o;Object.defineProperty(e,"awareness",{get:()=>o||(o=function(c,l,f){const{parentTable:h,parentId:d,parentProp:g,updatesTable:m}=l.meta,b=new yg(l),w=Yf(l);return b.on("update",({added:E,updated:j,removed:F},B)=>{const L=E.concat(j).concat(F),G=c.cloud.currentUser.value;if(B!=="server"&&G.isLoggedIn&&!oi(c)){const ne=gg(b,L);c.messageProducer.next({type:"aware",table:h,prop:g,k:l.meta.parentId,u:ne}),f.destroyed&&c.messageProducer.next({type:"doc-close",table:h,prop:g,k:l.meta.parentId})}}),b.on("destroy",()=>{vf(b,[l.clientID],"provider destroyed")}),te(this,void 0,void 0,function*(){if(f.destroyed)return;let E=!1,j=1;const F=Xr([c.cloud.webSocketStatus,w.pipe(pu(null))]).subscribe(([L])=>{if(f.destroyed)return;E=L==="connected";const G=c.cloud.currentUser.value;L==="connected"&&G.isLoggedIn&&!oi(c)&&(++j,B().catch(ne=>{}))});function B(){return te(this,void 0,void 0,function*(){const L=j,G=c.table(m),ne=c.$syncState,[Z,oe]=yield c.transaction("r",ne,G,()=>te(this,void 0,void 0,function*(){const De=yield G.get(bn),H=yield ne.get("syncState");return[(De==null?void 0:De.receivedUntil)||0,(H==null?void 0:H.yServerRevision)||(H==null?void 0:H.serverRevision)]}));if(f.destroyed||j!==L||!E)return;const Re={type:"doc-open",table:h,prop:g,k:d,serverRev:oe},de=yield G.where("i").between(Z,1/0,!1).filter(De=>xs(De.k,d)===0&&(1&(De.f||0))==0).toArray();if(!f.destroyed&&j===L&&E){if(de.length>0){const De=fs(de.map(he=>he.u)),H=zu(De);Re.sv=H}c.messageProducer.next(Re)}})}f.addCleanupHandler(F)}),b}(t,r,e),zf.set(r,o),o)})}}const Pm={nameSuffix:!0};function ba(t){const e=t.name,n=ks(t),r=[];let i=!1,o=null;t.on("ready",d=>te(this,void 0,void 0,function*(){try{yield function(g){return te(this,void 0,void 0,function*(){var m,b,w,E,j,F,B;c=!1;const L=Nt(g);typeof window<"u"&&typeof document<"u"&&(!((m=L.cloud.options)===null||m===void 0)&&m.customLoginGui||r.push(function(H){let he=!1;const me=document.createElement("div");return document.body?(document.body.appendChild(me),Dl(We(Kl,{db:H.vip}),me)):addEventListener("DOMContentLoaded",()=>{he||(document.body.appendChild(me),Dl(We(Kl,{db:H.vip}),me))}),{unsubscribe(){try{me.remove()}catch{}he=!0},get closed(){return he}}}(g))),L.cloud.isServiceWorkerDB||r.push(function(H){let he=H.cloud.webSocketStatus.value;const me=H.cloud.webSocketStatus.pipe(ut(we=>{const ke=he;he=we;const z=Xt(we);switch(we){case"disconnected":return zr.value?z.pipe(Mc(500)):z;case"connecting":return ke==="not-started"||ke==="error"?z:z.pipe(Mc(4e3));default:return z}}));return Xr([me,H.syncStateChangedEvent.pipe(pu({phase:"initial"})),ks(H.dx._novip),ma]).pipe(bt(([we,ke,z,re])=>{var ie;if(!((ie=z.license)===null||ie===void 0)&&ie.status&&z.license.status!=="ok")return{phase:"offline",status:"offline",license:z.license.status};let{phase:ge,error:be,progress:ue}=ke,ae=we;return ge==="error"&&(ae="error"),we==="not-started"&&(ge!=="pushing"&&ge!=="pulling"||(ae="connecting")),H.cloud.syncState.value.phase!=="error"||ke.phase!=="pushing"&&ke.phase!=="pulling"||(ae="connecting"),re||(ae="disconnected"),{phase:ge,error:be,progress:ue,status:nr?ae:"offline",license:"ok"}}))}(L).subscribe(g.cloud.syncState)),r.push(L.syncCompleteEvent.subscribe(f)),L.tables.every(H=>H.core)||function(){throw new Ee.SchemaError("Version increment needed to allow dexie-cloud change tracking")}();const G="serviceWorker"in navigator?yield navigator.serviceWorker.getRegistrations():[],[ne,Z]=yield L.transaction("rw",L.$syncState,()=>te(this,void 0,void 0,function*(){var H,he;const{options:me,schema:we}=L.cloud,[ke,z,re]=yield Promise.all([L.getOptions(),L.getSchema(),L.getPersistedSyncState()]);if(i){if(!ke||JSON.stringify(ke)!==JSON.stringify(me)){if(!me)throw new Error("Internal error");const ie=Object.assign({},me);delete ie.fetchTokens,delete ie.awarenessProtocol,yield L.$syncState.put(ie,"options")}}else L.cloud.options=ke||null;if(!((H=L.cloud.options)===null||H===void 0)&&H.tryUseServiceWorker&&"serviceWorker"in navigator&&G.length>0&&!$f?L.cloud.usingServiceWorker=!0:(!((he=L.cloud.options)===null||he===void 0)&&he.tryUseServiceWorker&&L.cloud.isServiceWorkerDB,L.cloud.usingServiceWorker=!1),Fo(we,L.cloud.options),Fo(z,L.cloud.options),we){if(!z||JSON.stringify(z)!==JSON.stringify(we)){const ie=z||{};for(const[ge,be]of Object.entries(we)){const ue=ie[ge];ue?(ue.markedForSync=be.markedForSync,be.deleted=ue.deleted,ue.generatedGlobalId=be.generatedGlobalId):ie[ge]=Object.assign({},be)}yield L.$syncState.put(ie,"schema"),Object.assign(we,ie)}}else L.cloud.schema=z||null;return[re==null?void 0:re.initiallySynced,re==null?void 0:re.realms]}));if(ne&&L.setInitiallySynced(!0),function(H){var he,me;for(const we of H.tables)if(!((me=(he=H.cloud.schema)===null||he===void 0?void 0:he[we.name])===null||me===void 0)&&me.markedForSync){if(we.schema.primKey.auto)throw new Ee.SchemaError(`Table ${we.name} is both autoIncremented and synced. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(we.name)}]}) to blacklist it from sync`);if(!we.schema.primKey.keyPath)throw new Ee.SchemaError(`Table ${we.name} cannot be both synced and outbound. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(we.name)}]}) to blacklist it from sync`)}}(L),l(),!L.cloud.isServiceWorkerDB){r.push(yn(()=>L.getCurrentUser()).subscribe(n)),r.push(yn(()=>L.getPersistedSyncState()).subscribe(L.cloud.persistedSyncState)),yield Un(Xr([n.pipe(Kc(1),Xn(1)),L.cloud.persistedSyncState.pipe(Kc(1),Xn(1))]));const H=Rm(L);ft.on.new.subscribe(H),L.dx.once("close",()=>{ft.on.new.unsubscribe(H)})}let oe=!1;const Re=yield L.getCurrentUser(),de=(b=L.cloud.options)===null||b===void 0?void 0:b.requireAuth;de&&(L.cloud.isServiceWorkerDB?yield Un(n.pipe(Ct(H=>!!H.isLoggedIn),Xn(1))):typeof de=="object"?(!Re.isLoggedIn||de.userId&&Re.userId!==de.userId||de.email&&Re.email!==de.email)&&(oe=yield Ko(L,de)):Re.isLoggedIn||(oe=yield Ko(L))),!Re.isLoggedIn||Z&&Z.includes(Re.userId)||(oe=!0),o&&o.stop(),o=null,l();const De=((w=L.cloud.options)===null||w===void 0?void 0:w.databaseUrl)&&(!ne||oe);De&&(yield function(H,he,me){return te(this,void 0,void 0,function*(){yield Vf(H,Lf,()=>Ls(H,he,me,{isInitialSync:!0}))})}(L,L.cloud.options,L.cloud.schema),L.setInitiallySynced(!0)),l(),L.cloud.usingServiceWorker&&(!((E=L.cloud.options)===null||E===void 0)&&E.databaseUrl)?(De||bf(L,"push").catch(()=>{}),function(H){return te(this,void 0,void 0,function*(){var he;try{const{periodicSync:me}=yield navigator.serviceWorker.ready;if(me)try{yield me.register(`dexie-cloud:${H.name}`,(he=H.cloud.options)===null||he===void 0?void 0:he.periodicSync)}catch{}}catch{}})}(L).catch(()=>{})):!((j=L.cloud.options)===null||j===void 0)&&j.databaseUrl&&L.cloud.schema&&!L.cloud.isServiceWorkerDB&&(o=_m(L,L.cloud.options,L.cloud.schema),o.start(),De||Jt(L,"push")),l(),L.cloud.isServiceWorkerDB||r.push(Kt(self,"online").subscribe(()=>{L.syncStateChangedEvent.next({phase:"not-in-sync"}),oi(L)||Jt(L,"push")}),Kt(self,"offline").subscribe(()=>{L.syncStateChangedEvent.next({phase:"offline"})})),!(!((F=L.cloud.options)===null||F===void 0)&&F.databaseUrl)||!((B=L.cloud.options)===null||B===void 0)&&B.disableWebSocket||im||r.push(function(H){var he;if(!(!((he=H.cloud.options)===null||he===void 0)&&he.databaseUrl))throw new Error("No database URL to connect WebSocket to");const me=H.messageConsumer.readyToServe.pipe(Ct(ke=>ke),ut(()=>H.getPersistedSyncState()),Ct(ke=>ke&&ke.serverRevision),ut(ke=>te(this,void 0,void 0,function*(){return{type:"ready",rev:ke.serverRevision,realmSetHash:yield ca(ke)}}))),we=Es(me,H.messageProducer);return function ke(){return H.cloud.persistedSyncState.pipe(Ct(z=>z==null?void 0:z.serverRevision),Xn(1),ut(z=>H.cloud.currentUser.pipe(bt(re=>[re,z]))),ut(([z,re])=>ma.pipe(bt(ie=>[ie?z:null,re]))),ut(([z,re])=>z!=null&&z.isLoggedIn&&!(re!=null&&re.realms.includes(z.userId))?H.cloud.persistedSyncState.pipe(Ct(ie=>(ie==null?void 0:ie.realms.includes(z.userId))||!1),Xn(1),bt(ie=>[z,ie])):new Tt([z,re])),ut(z=>te(this,[z],void 0,function*([re,ie]){return[re,yield ca(ie)]})),hu(([z,re],[ie,ge])=>z===ie&&re===ge),ut(([z,re])=>{var ie;return!((ie=H.cloud.persistedSyncState)===null||ie===void 0)&&ie.value?z?new ym(H,H.cloud.persistedSyncState.value.serverRevision,H.cloud.persistedSyncState.value.yServerRevision,re,H.cloud.persistedSyncState.value.clientIdentity,we,H.cloud.webSocketStatus,z):_t([]):ke()}),Yo(z=>(z==null?void 0:z.name)==="TokenExpiredError"?Xt(!0).pipe(ut(()=>te(this,void 0,void 0,function*(){const re=yield H.getCurrentUser(),ie=yield js(H.cloud.options.databaseUrl,re);yield H.table("$logins").update(re.userId,{accessToken:ie.accessToken,accessTokenExpiration:ie.accessTokenExpiration,claims:ie.claims,license:ie.license,data:ie.data})})),ut(()=>ke())):Uc(()=>z)),Yo(z=>(H.cloud.webSocketStatus.next("error"),z instanceof vm?Uc(()=>z):_t(bm()).pipe(ut(()=>ke())))))}().subscribe({next:ke=>{ke&&H.messageConsumer.enqueue(ke)},error:ke=>{},complete:()=>{}})}(L))})}(d)}catch{}}),!0);let c=!1;function l(){if(c)throw new Ee.DatabaseClosedError}t.once("close",()=>{r.forEach(d=>d.unsubscribe()),r.splice(0,r.length),c=!0,o&&o.stop(),o=null,n.next(pt)});const f=new Nn;var h;t.cloud={version:"4.2.1",options:Object.assign({},Pm),schema:null,get currentUserId(){return n.value.userId||pt.userId},currentUser:n,syncState:new Tt({phase:"initial",status:"not-started"}),events:{syncComplete:f},persistedSyncState:new Tt(void 0),userInteraction:new Tt(void 0),webSocketStatus:new Tt("not-started"),login(d){return te(this,void 0,void 0,function*(){const g=Nt(t);yield g.cloud.sync(),yield Ko(g,d)})},invites:Tm(t),roles:ad(t),configure(d){d=t.cloud.options=Object.assign(Object.assign({},t.cloud.options),d),i=!0,d.databaseUrl&&d.nameSuffix&&(t.name=`${e}-${function(g){const m=new URL(g);return m.pathname==="/"?m.hostname.split(".")[0]:m.pathname.split("/")[1]}(d.databaseUrl)}`,Nt(t).reconfigure()),Fo(t.cloud.schema,t.cloud.options)},logout(){return te(this,arguments,void 0,function*({force:d}={}){d?yield ga(Nt(t),{deleteUnsyncedData:!0}):yield Bf(Nt(t))})},sync(){return te(this,arguments,void 0,function*({wait:d,purpose:g}={wait:!0,purpose:"push"}){var m;d===void 0&&(d=!0);const b=Nt(t);if((((m=b.cloud.currentUser.value.license)===null||m===void 0?void 0:m.status)||"ok")!=="ok"&&(yield Us(b)),g==="pull"){const w=b.cloud.persistedSyncState.value;if(Jt(b,g),d){const E=yield Un(b.cloud.persistedSyncState.pipe(Ct(j=>(j==null?void 0:j.timestamp)!=null&&(!w||j.timestamp>w.timestamp))));if(E!=null&&E.error)throw new Error("Sync error: "+E.error)}}else if(yield xl(b)){const w=b.cloud.persistedSyncState.value;Jt(b,g),d&&(yield Un(_t(yn(()=>te(this,void 0,void 0,function*(){const E=yield xl(b),j=yield b.getPersistedSyncState();if((j==null?void 0:j.timestamp)!==(w==null?void 0:w.timestamp)&&(j!=null&&j.error))throw new Error("Sync error: "+j.error);return E}))).pipe(Ct(E=>!E))))}})},permissions:(d,g)=>function(m,b,w){if(!b)throw new TypeError("Cannot check permissions of undefined or null. A Dexie Cloud object with realmId and owner expected.");const{owner:E,realmId:j}=b;if(!w){if(typeof b.table!="function")throw new TypeError("Missing 'table' argument to permissions and table could not be extracted from entity");w=b.table()}const F=ld(m),B=G=>{const ne=G[j||m.cloud.currentUserId];return ne?new Bl(ne.permissions,w,j===void 0||j===m.cloud.currentUserId||E===m.cloud.currentUserId):new Bl({},w,!E||E===m.cloud.currentUserId)},L=F.pipe(bt(B));return L.getValue=()=>B(F.getValue()),L}(t._novip,d,g)},t.Version.prototype._parseStoresSpec=Ee.override(t.Version.prototype._parseStoresSpec,d=>fm(d,t)),t.Table.prototype.newId=function({colocateWith:d}={}){const g=d&&d.substr(d.length-3);return qf(t.cloud.schema[this.name].idPrefix||"",g)},t.Table.prototype.idPrefix=function(){var d,g;return((g=(d=this.db.cloud.schema)===null||d===void 0?void 0:d[this.name])===null||g===void 0?void 0:g.idPrefix)||""},t.use(um({currentUserObservable:t.cloud.currentUser,db:Nt(t)})),t.use((h=Nt(t),{stack:"dbcore",name:"implicitPropSetterMiddleware",level:1,create:d=>Object.assign(Object.assign({},d),{table:g=>{const m=d.table(g);return Object.assign(Object.assign({},m),{mutate:b=>{var w,E,j,F,B,L;const G=b.trans;if(G.disableChangeTracking)return m.mutate(b);const ne=(E=(w=G.currentUser)===null||w===void 0?void 0:w.userId)!==null&&E!==void 0?E:pt.userId;if(!((F=(j=h.cloud.schema)===null||j===void 0?void 0:j[g])===null||F===void 0)&&F.markedForSync&&(b.type==="add"||b.type==="put")){if(g==="members")for(const Z of b.values)typeof Z.email=="string"&&(Z.email=Z.email.trim().toLowerCase());for(const Z of b.values){Z.owner||(Z.owner=ne),Z.realmId||(Z.realmId=ne);const oe=(L=(B=m.schema.primaryKey).extractKey)===null||L===void 0?void 0:L.call(B,Z);typeof oe=="string"&&oe[0]==="#"&&b.type==="put"&&(delete b.criteria,delete b.changeSpec,delete b.updates,Z.$ts=Date.now())}}return m.mutate(b)}})}})})),t.use(am(Nt(t)))}ba.version="4.2.1",Ee.Cloud=ba;const Kr=new Map;function Fl(t){return t.startsWith("dexie-cloud:")&&t.split(":")[1]}const Ji=new Map;function qo(t,e){let n=Ji.get(t+"/"+e);return n||(n=function r(i,o){return te(this,void 0,void 0,function*(){var c;let l=Kr.get(i);if(!l){const h=new Ee(i,{addons:[ba]});if(l=Nt(h),l.cloud.isServiceWorkerDB=!0,h.on("versionchange",f),yield l.dx.open(),Kr.get(i))return l.close(),yield r(i,o);Kr.set(i,l)}if(!((c=l.cloud.options)===null||c===void 0)&&c.databaseUrl&&l.cloud.schema)try{yield $a(l,l.cloud.options,l.cloud.schema,{retryImmediatelyOnFetchError:!0,purpose:o})}catch(h){if(f(),h.name!==Ee.errnames.NoSuchDatabase)throw h}function f(){return l.dx.on.versionchange.unsubscribe(f),Kr.get(l.name)===l&&Kr.delete(l.name),l.dx.close(),!1}})}(t,e).then(()=>{Ji.delete(t+"/"+e)}).catch(r=>(Ji.delete(t+"/"+e),Promise.reject(r))),Ji.set(t+"/"+e,n)),n}$f||(self.addEventListener("sync",t=>{const e=Fl(t.tag);e&&t.waitUntil(qo(e,"push"))}),self.addEventListener("periodicsync",t=>{const e=Fl(t.tag);e&&t.waitUntil(qo(e,"pull"))}),self.addEventListener("message",t=>{if(t.data.type==="dexie-cloud-sync"){const{dbName:e}=t.data,n=(r=1)=>qo(e,t.data.purpose||"pull").catch(i=>te(void 0,void 0,void 0,function*(){if(r===3)throw i;var o;yield(o=6e4,new Promise(c=>setTimeout(c,o))),n(r+1)}));"waitUntil"in t?t.waitUntil(n().catch(r=>{})):n().catch(r=>{})}}));try{self["workbox:core:7.2.0"]&&_()}catch{}const Um=(t,...e)=>{let n=t;return e.length>0&&(n+=` :: ${JSON.stringify(e)}`),n},jm=Um;class gt extends Error{constructor(e,n){const r=jm(e,n);super(r),this.name=e,this.details=n}}const Gt={googleAnalytics:"googleAnalytics",precache:"precache-v2",prefix:"workbox",runtime:"runtime",suffix:typeof registration<"u"?registration.scope:""},Vo=t=>[Gt.prefix,t,Gt.suffix].filter(e=>e&&e.length>0).join("-"),Lm=t=>{for(const e of Object.keys(Gt))t(e)},Bs={updateDetails:t=>{Lm(e=>{typeof t[e]=="string"&&(Gt[e]=t[e])})},getGoogleAnalyticsName:t=>t||Vo(Gt.googleAnalytics),getPrecacheName:t=>t||Vo(Gt.precache),getPrefix:()=>Gt.prefix,getRuntimeName:t=>t||Vo(Gt.runtime),getSuffix:()=>Gt.suffix};function $l(t,e){const n=e();return t.waitUntil(n),n}try{self["workbox:precaching:7.2.0"]&&_()}catch{}const Nm="__WB_REVISION__";function Mm(t){if(!t)throw new gt("add-to-cache-list-unexpected-type",{entry:t});if(typeof t=="string"){const o=new URL(t,location.href);return{cacheKey:o.href,url:o.href}}const{revision:e,url:n}=t;if(!n)throw new gt("add-to-cache-list-unexpected-type",{entry:t});if(!e){const o=new URL(n,location.href);return{cacheKey:o.href,url:o.href}}const r=new URL(n,location.href),i=new URL(n,location.href);return r.searchParams.set(Nm,e),{cacheKey:r.href,url:i.href}}class Km{constructor(){this.updatedURLs=[],this.notUpdatedURLs=[],this.handlerWillStart=async({request:e,state:n})=>{n&&(n.originalRequest=e)},this.cachedResponseWillBeUsed=async({event:e,state:n,cachedResponse:r})=>{if(e.type==="install"&&n&&n.originalRequest&&n.originalRequest instanceof Request){const i=n.originalRequest.url;r?this.notUpdatedURLs.push(i):this.updatedURLs.push(i)}return r}}}class Bm{constructor({precacheController:e}){this.cacheKeyWillBeUsed=async({request:n,params:r})=>{const i=(r==null?void 0:r.cacheKey)||this._precacheController.getCacheKeyForURL(n.url);return i?new Request(i,{headers:n.headers}):n},this._precacheController=e}}let Br;function Fm(){if(Br===void 0){const t=new Response("");if("body"in t)try{new Response(t.body),Br=!0}catch{Br=!1}Br=!1}return Br}async function $m(t,e){let n=null;if(t.url&&(n=new URL(t.url).origin),n!==self.location.origin)throw new gt("cross-origin-copy-response",{origin:n});const r=t.clone(),o={headers:new Headers(r.headers),status:r.status,statusText:r.statusText},c=Fm()?r.body:await r.blob();return new Response(c,o)}const qm=t=>new URL(String(t),location.href).href.replace(new RegExp(`^${location.origin}`),"");function ql(t,e){const n=new URL(t);for(const r of e)n.searchParams.delete(r);return n.href}async function Vm(t,e,n,r){const i=ql(e.url,n);if(e.url===i)return t.match(e,r);const o=Object.assign(Object.assign({},r),{ignoreSearch:!0}),c=await t.keys(e,o);for(const l of c){const f=ql(l.url,n);if(i===f)return t.match(l,r)}}class Wm{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}const Hm=new Set;async function zm(){for(const t of Hm)await t()}function Ym(t){return new Promise(e=>setTimeout(e,t))}try{self["workbox:strategies:7.2.0"]&&_()}catch{}function Xi(t){return typeof t=="string"?new Request(t):t}class Gm{constructor(e,n){this._cacheKeys={},Object.assign(this,n),this.event=n.event,this._strategy=e,this._handlerDeferred=new Wm,this._extendLifetimePromises=[],this._plugins=[...e.plugins],this._pluginStateMap=new Map;for(const r of this._plugins)this._pluginStateMap.set(r,{});this.event.waitUntil(this._handlerDeferred.promise)}async fetch(e){const{event:n}=this;let r=Xi(e);if(r.mode==="navigate"&&n instanceof FetchEvent&&n.preloadResponse){const c=await n.preloadResponse;if(c)return c}const i=this.hasCallback("fetchDidFail")?r.clone():null;try{for(const c of this.iterateCallbacks("requestWillFetch"))r=await c({request:r.clone(),event:n})}catch(c){if(c instanceof Error)throw new gt("plugin-error-request-will-fetch",{thrownErrorMessage:c.message})}const o=r.clone();try{let c;c=await fetch(r,r.mode==="navigate"?void 0:this._strategy.fetchOptions);for(const l of this.iterateCallbacks("fetchDidSucceed"))c=await l({event:n,request:o,response:c});return c}catch(c){throw i&&await this.runCallbacks("fetchDidFail",{error:c,event:n,originalRequest:i.clone(),request:o.clone()}),c}}async fetchAndCachePut(e){const n=await this.fetch(e),r=n.clone();return this.waitUntil(this.cachePut(e,r)),n}async cacheMatch(e){const n=Xi(e);let r;const{cacheName:i,matchOptions:o}=this._strategy,c=await this.getCacheKey(n,"read"),l=Object.assign(Object.assign({},o),{cacheName:i});r=await caches.match(c,l);for(const f of this.iterateCallbacks("cachedResponseWillBeUsed"))r=await f({cacheName:i,matchOptions:o,cachedResponse:r,request:c,event:this.event})||void 0;return r}async cachePut(e,n){const r=Xi(e);await Ym(0);const i=await this.getCacheKey(r,"write");if(!n)throw new gt("cache-put-with-no-response",{url:qm(i.url)});const o=await this._ensureResponseSafeToCache(n);if(!o)return!1;const{cacheName:c,matchOptions:l}=this._strategy,f=await self.caches.open(c),h=this.hasCallback("cacheDidUpdate"),d=h?await Vm(f,i.clone(),["__WB_REVISION__"],l):null;try{await f.put(i,h?o.clone():o)}catch(g){if(g instanceof Error)throw g.name==="QuotaExceededError"&&await zm(),g}for(const g of this.iterateCallbacks("cacheDidUpdate"))await g({cacheName:c,oldResponse:d,newResponse:o.clone(),request:i,event:this.event});return!0}async getCacheKey(e,n){const r=`${e.url} | ${n}`;if(!this._cacheKeys[r]){let i=e;for(const o of this.iterateCallbacks("cacheKeyWillBeUsed"))i=Xi(await o({mode:n,request:i,event:this.event,params:this.params}));this._cacheKeys[r]=i}return this._cacheKeys[r]}hasCallback(e){for(const n of this._strategy.plugins)if(e in n)return!0;return!1}async runCallbacks(e,n){for(const r of this.iterateCallbacks(e))await r(n)}*iterateCallbacks(e){for(const n of this._strategy.plugins)if(typeof n[e]=="function"){const r=this._pluginStateMap.get(n);yield o=>{const c=Object.assign(Object.assign({},o),{state:r});return n[e](c)}}}waitUntil(e){return this._extendLifetimePromises.push(e),e}async doneWaiting(){let e;for(;e=this._extendLifetimePromises.shift();)await e}destroy(){this._handlerDeferred.resolve(null)}async _ensureResponseSafeToCache(e){let n=e,r=!1;for(const i of this.iterateCallbacks("cacheWillUpdate"))if(n=await i({request:this.request,response:n,event:this.event})||void 0,r=!0,!n)break;return r||n&&n.status!==200&&(n=void 0),n}}class Jm{constructor(e={}){this.cacheName=Bs.getRuntimeName(e.cacheName),this.plugins=e.plugins||[],this.fetchOptions=e.fetchOptions,this.matchOptions=e.matchOptions}handle(e){const[n]=this.handleAll(e);return n}handleAll(e){e instanceof FetchEvent&&(e={event:e,request:e.request});const n=e.event,r=typeof e.request=="string"?new Request(e.request):e.request,i="params"in e?e.params:void 0,o=new Gm(this,{event:n,request:r,params:i}),c=this._getResponse(o,r,n),l=this._awaitComplete(c,o,r,n);return[c,l]}async _getResponse(e,n,r){await e.runCallbacks("handlerWillStart",{event:r,request:n});let i;try{if(i=await this._handle(n,e),!i||i.type==="error")throw new gt("no-response",{url:n.url})}catch(o){if(o instanceof Error){for(const c of e.iterateCallbacks("handlerDidError"))if(i=await c({error:o,event:r,request:n}),i)break}if(!i)throw o}for(const o of e.iterateCallbacks("handlerWillRespond"))i=await o({event:r,request:n,response:i});return i}async _awaitComplete(e,n,r,i){let o,c;try{o=await e}catch{}try{await n.runCallbacks("handlerDidRespond",{event:i,request:r,response:o}),await n.doneWaiting()}catch(l){l instanceof Error&&(c=l)}if(await n.runCallbacks("handlerDidComplete",{event:i,request:r,response:o,error:c}),n.destroy(),c)throw c}}class pn extends Jm{constructor(e={}){e.cacheName=Bs.getPrecacheName(e.cacheName),super(e),this._fallbackToNetwork=e.fallbackToNetwork!==!1,this.plugins.push(pn.copyRedirectedCacheableResponsesPlugin)}async _handle(e,n){const r=await n.cacheMatch(e);return r||(n.event&&n.event.type==="install"?await this._handleInstall(e,n):await this._handleFetch(e,n))}async _handleFetch(e,n){let r;const i=n.params||{};if(this._fallbackToNetwork){const o=i.integrity,c=e.integrity,l=!c||c===o;r=await n.fetch(new Request(e,{integrity:e.mode!=="no-cors"?c||o:void 0})),o&&l&&e.mode!=="no-cors"&&(this._useDefaultCacheabilityPluginIfNeeded(),await n.cachePut(e,r.clone()))}else throw new gt("missing-precache-entry",{cacheName:this.cacheName,url:e.url});return r}async _handleInstall(e,n){this._useDefaultCacheabilityPluginIfNeeded();const r=await n.fetch(e);if(!await n.cachePut(e,r.clone()))throw new gt("bad-precaching-response",{url:e.url,status:r.status});return r}_useDefaultCacheabilityPluginIfNeeded(){let e=null,n=0;for(const[r,i]of this.plugins.entries())i!==pn.copyRedirectedCacheableResponsesPlugin&&(i===pn.defaultPrecacheCacheabilityPlugin&&(e=r),i.cacheWillUpdate&&n++);n===0?this.plugins.push(pn.defaultPrecacheCacheabilityPlugin):n>1&&e!==null&&this.plugins.splice(e,1)}}pn.defaultPrecacheCacheabilityPlugin={async cacheWillUpdate({response:t}){return!t||t.status>=400?null:t}};pn.copyRedirectedCacheableResponsesPlugin={async cacheWillUpdate({response:t}){return t.redirected?await $m(t):t}};class Xm{constructor({cacheName:e,plugins:n=[],fallbackToNetwork:r=!0}={}){this._urlsToCacheKeys=new Map,this._urlsToCacheModes=new Map,this._cacheKeysToIntegrities=new Map,this._strategy=new pn({cacheName:Bs.getPrecacheName(e),plugins:[...n,new Bm({precacheController:this})],fallbackToNetwork:r}),this.install=this.install.bind(this),this.activate=this.activate.bind(this)}get strategy(){return this._strategy}precache(e){this.addToCacheList(e),this._installAndActiveListenersAdded||(self.addEventListener("install",this.install),self.addEventListener("activate",this.activate),this._installAndActiveListenersAdded=!0)}addToCacheList(e){const n=[];for(const r of e){typeof r=="string"?n.push(r):r&&r.revision===void 0&&n.push(r.url);const{cacheKey:i,url:o}=Mm(r),c=typeof r!="string"&&r.revision?"reload":"default";if(this._urlsToCacheKeys.has(o)&&this._urlsToCacheKeys.get(o)!==i)throw new gt("add-to-cache-list-conflicting-entries",{firstEntry:this._urlsToCacheKeys.get(o),secondEntry:i});if(typeof r!="string"&&r.integrity){if(this._cacheKeysToIntegrities.has(i)&&this._cacheKeysToIntegrities.get(i)!==r.integrity)throw new gt("add-to-cache-list-conflicting-integrities",{url:o});this._cacheKeysToIntegrities.set(i,r.integrity)}if(this._urlsToCacheKeys.set(o,i),this._urlsToCacheModes.set(o,c),n.length>0){const l=`Workbox is precaching URLs without revision info: ${n.join(", ")}
This is generally NOT safe. Learn more at https://bit.ly/wb-precache`;console.warn(l)}}}install(e){return $l(e,async()=>{const n=new Km;this.strategy.plugins.push(n);for(const[o,c]of this._urlsToCacheKeys){const l=this._cacheKeysToIntegrities.get(c),f=this._urlsToCacheModes.get(o),h=new Request(o,{integrity:l,cache:f,credentials:"same-origin"});await Promise.all(this.strategy.handleAll({params:{cacheKey:c},request:h,event:e}))}const{updatedURLs:r,notUpdatedURLs:i}=n;return{updatedURLs:r,notUpdatedURLs:i}})}activate(e){return $l(e,async()=>{const n=await self.caches.open(this.strategy.cacheName),r=await n.keys(),i=new Set(this._urlsToCacheKeys.values()),o=[];for(const c of r)i.has(c.url)||(await n.delete(c),o.push(c.url));return{deletedURLs:o}})}getURLsToCacheKeys(){return this._urlsToCacheKeys}getCachedURLs(){return[...this._urlsToCacheKeys.keys()]}getCacheKeyForURL(e){const n=new URL(e,location.href);return this._urlsToCacheKeys.get(n.href)}getIntegrityForCacheKey(e){return this._cacheKeysToIntegrities.get(e)}async matchPrecache(e){const n=e instanceof Request?e.url:e,r=this.getCacheKeyForURL(n);if(r)return(await self.caches.open(this.strategy.cacheName)).match(r)}createHandlerBoundToURL(e){const n=this.getCacheKeyForURL(e);if(!n)throw new gt("non-precached-url",{url:e});return r=>(r.request=new Request(e),r.params=Object.assign({cacheKey:n},r.params),this.strategy.handle(r))}}let Wo;const ud=()=>(Wo||(Wo=new Xm),Wo);try{self["workbox:routing:7.2.0"]&&_()}catch{}const fd="GET",Ss=t=>t&&typeof t=="object"?t:{handle:t};class Jr{constructor(e,n,r=fd){this.handler=Ss(n),this.match=e,this.method=r}setCatchHandler(e){this.catchHandler=Ss(e)}}class Qm extends Jr{constructor(e,n,r){const i=({url:o})=>{const c=e.exec(o.href);if(c&&!(o.origin!==location.origin&&c.index!==0))return c.slice(1)};super(i,n,r)}}class Zm{constructor(){this._routes=new Map,this._defaultHandlerMap=new Map}get routes(){return this._routes}addFetchListener(){self.addEventListener("fetch",e=>{const{request:n}=e,r=this.handleRequest({request:n,event:e});r&&e.respondWith(r)})}addCacheListener(){self.addEventListener("message",e=>{if(e.data&&e.data.type==="CACHE_URLS"){const{payload:n}=e.data,r=Promise.all(n.urlsToCache.map(i=>{typeof i=="string"&&(i=[i]);const o=new Request(...i);return this.handleRequest({request:o,event:e})}));e.waitUntil(r),e.ports&&e.ports[0]&&r.then(()=>e.ports[0].postMessage(!0))}})}handleRequest({request:e,event:n}){const r=new URL(e.url,location.href);if(!r.protocol.startsWith("http"))return;const i=r.origin===location.origin,{params:o,route:c}=this.findMatchingRoute({event:n,request:e,sameOrigin:i,url:r});let l=c&&c.handler;const f=e.method;if(!l&&this._defaultHandlerMap.has(f)&&(l=this._defaultHandlerMap.get(f)),!l)return;let h;try{h=l.handle({url:r,request:e,event:n,params:o})}catch(g){h=Promise.reject(g)}const d=c&&c.catchHandler;return h instanceof Promise&&(this._catchHandler||d)&&(h=h.catch(async g=>{if(d)try{return await d.handle({url:r,request:e,event:n,params:o})}catch(m){m instanceof Error&&(g=m)}if(this._catchHandler)return this._catchHandler.handle({url:r,request:e,event:n});throw g})),h}findMatchingRoute({url:e,sameOrigin:n,request:r,event:i}){const o=this._routes.get(r.method)||[];for(const c of o){let l;const f=c.match({url:e,sameOrigin:n,request:r,event:i});if(f)return l=f,(Array.isArray(l)&&l.length===0||f.constructor===Object&&Object.keys(f).length===0||typeof f=="boolean")&&(l=void 0),{route:c,params:l}}return{}}setDefaultHandler(e,n=fd){this._defaultHandlerMap.set(n,Ss(e))}setCatchHandler(e){this._catchHandler=Ss(e)}registerRoute(e){this._routes.has(e.method)||this._routes.set(e.method,[]),this._routes.get(e.method).push(e)}unregisterRoute(e){if(!this._routes.has(e.method))throw new gt("unregister-route-but-not-found-with-method",{method:e.method});const n=this._routes.get(e.method).indexOf(e);if(n>-1)this._routes.get(e.method).splice(n,1);else throw new gt("unregister-route-route-not-registered")}}let Fr;const ev=()=>(Fr||(Fr=new Zm,Fr.addFetchListener(),Fr.addCacheListener()),Fr);function tv(t,e,n){let r;if(typeof t=="string"){const o=new URL(t,location.href),c=({url:l})=>l.href===o.href;r=new Jr(c,e,n)}else if(t instanceof RegExp)r=new Qm(t,e,n);else if(typeof t=="function")r=new Jr(t,e,n);else if(t instanceof Jr)r=t;else throw new gt("unsupported-route-type",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});return ev().registerRoute(r),r}function nv(t,e=[]){for(const n of[...t.searchParams.keys()])e.some(r=>r.test(n))&&t.searchParams.delete(n);return t}function*rv(t,{ignoreURLParametersMatching:e=[/^utm_/,/^fbclid$/],directoryIndex:n="index.html",cleanURLs:r=!0,urlManipulation:i}={}){const o=new URL(t,location.href);o.hash="",yield o.href;const c=nv(o,e);if(yield c.href,n&&c.pathname.endsWith("/")){const l=new URL(c.href);l.pathname+=n,yield l.href}if(r){const l=new URL(c.href);l.pathname+=".html",yield l.href}if(i){const l=i({url:o});for(const f of l)yield f.href}}class iv extends Jr{constructor(e,n){const r=({request:i})=>{const o=e.getURLsToCacheKeys();for(const c of rv(i.url,n)){const l=o.get(c);if(l){const f=e.getIntegrityForCacheKey(l);return{cacheKey:l,integrity:f}}}};super(r,e.strategy)}}function sv(t){const e=ud(),n=new iv(e,t);tv(n)}const ov="-precache-",av=async(t,e=ov)=>{const r=(await self.caches.keys()).filter(i=>i.includes(e)&&i.includes(self.registration.scope)&&i!==t);return await Promise.all(r.map(i=>self.caches.delete(i))),r};function cv(){self.addEventListener("activate",t=>{const e=Bs.getPrecacheName();t.waitUntil(av(e).then(n=>{}))})}function lv(t){ud().precache(t)}function uv(t,e){lv(t),sv(e)}console.log("🚀 Service Worker starting (built at 2025-10-01T12:06:41.316Z)");uv([{"revision":null,"url":"assets/index-DkZs9do6.js"},{"revision":null,"url":"assets/index-DVNu3zGM.css"},{"revision":"7d5a3ead2d3cf969f9fc49133c2ded54","url":"index.html"},{"revision":"0ea25c17ba9443457d913d6be03fea55","url":"dexie-icon-192x192.png"},{"revision":"f1749b24004626d4cb2f90aee4e442d2","url":"dexie-icon-512x512.png"},{"revision":"fc723c843a0b8a137167d3d63dda4e28","url":"dexie-icon-64x64.gif"},{"revision":"2482ade6e4b177e1de1473f83be15e59","url":"manifest.webmanifest"}]);cv();self.addEventListener("install",t=>{self.skipWaiting()});
//# sourceMappingURL=sw.js.map
