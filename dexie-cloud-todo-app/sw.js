var Zd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rs={exports:{}},th=rs.exports,jc;function nh(){return jc||(jc=1,(function(t,e){((n,r)=>{t.exports=r()})(th,function(){var n=function(o,a){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(u,h){u.__proto__=h}:function(u,h){for(var y in h)Object.prototype.hasOwnProperty.call(h,y)&&(u[y]=h[y])}))(o,a)},r=function(){return(r=Object.assign||function(o){for(var a,u=1,h=arguments.length;u<h;u++)for(var y in a=arguments[u])Object.prototype.hasOwnProperty.call(a,y)&&(o[y]=a[y]);return o}).apply(this,arguments)};function i(o,a,u){for(var h,y=0,v=a.length;y<v;y++)!h&&y in a||((h=h||Array.prototype.slice.call(a,0,y))[y]=a[y]);return o.concat(h||Array.prototype.slice.call(a))}var s=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Zd,c=Object.keys,l=Array.isArray;function d(o,a){return typeof a=="object"&&c(a).forEach(function(u){o[u]=a[u]}),o}typeof Promise>"u"||s.Promise||(s.Promise=Promise);var f=Object.getPrototypeOf,g={}.hasOwnProperty;function p(o,a){return g.call(o,a)}function m(o,a){typeof a=="function"&&(a=a(f(o))),(typeof Reflect>"u"?c:Reflect.ownKeys)(a).forEach(function(u){S(o,u,a[u])})}var b=Object.defineProperty;function S(o,a,u,h){b(o,a,d(u&&p(u,"get")&&typeof u.get=="function"?{get:u.get,set:u.set,configurable:!0}:{value:u,configurable:!0,writable:!0},h))}function x(o){return{from:function(a){return o.prototype=Object.create(a.prototype),S(o.prototype,"constructor",o),{extend:m.bind(null,o.prototype)}}}}var N=Object.getOwnPropertyDescriptor,U=[].slice;function M(o,a,u){return U.call(o,a,u)}function V(o,a){return a(o)}function q(o){if(!o)throw new Error("Assertion Failed")}function K(o){s.setImmediate?setImmediate(o):setTimeout(o,0)}function ie(o,a){if(typeof a=="string"&&p(o,a))return o[a];if(!a)return o;if(typeof a!="string"){for(var u=[],h=0,y=a.length;h<y;++h){var v=ie(o,a[h]);u.push(v)}return u}var w,k=a.indexOf(".");return k===-1||(w=o[a.substr(0,k)])==null?void 0:ie(w,a.substr(k+1))}function Z(o,a,u){if(o&&a!==void 0&&!("isFrozen"in Object&&Object.isFrozen(o)))if(typeof a!="string"&&"length"in a){q(typeof u!="string"&&"length"in u);for(var h=0,y=a.length;h<y;++h)Z(o,a[h],u[h])}else{var v,w,k=a.indexOf(".");k!==-1?(v=a.substr(0,k),(k=a.substr(k+1))===""?u===void 0?l(o)&&!isNaN(parseInt(v))?o.splice(v,1):delete o[v]:o[v]=u:Z(w=(w=o[v])&&p(o,v)?w:o[v]={},k,u)):u===void 0?l(o)&&!isNaN(parseInt(a))?o.splice(a,1):delete o[a]:o[a]=u}}function he(o){var a,u={};for(a in o)p(o,a)&&(u[a]=o[a]);return u}var ne=[].concat;function J(o){return ne.apply([],o)}var ce="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(J([8,16,32,64].map(function(o){return["Int","Uint","Float"].map(function(a){return a+o+"Array"})}))).filter(function(o){return s[o]}),re=new Set(ce.map(function(o){return s[o]})),we=null;function ee(o){return we=new WeakMap,o=(function a(u){if(!u||typeof u!="object")return u;var h=we.get(u);if(h)return h;if(l(u)){h=[],we.set(u,h);for(var y=0,v=u.length;y<v;++y)h.push(a(u[y]))}else if(re.has(u.constructor))h=u;else{var w,k=f(u);for(w in h=k===Object.prototype?{}:Object.create(k),we.set(u,h),u)p(u,w)&&(h[w]=a(u[w]))}return h})(o),we=null,o}var me={}.toString;function ve(o){return me.call(o).slice(8,-1)}var le=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ae=typeof le=="symbol"?function(o){var a;return o!=null&&(a=o[le])&&a.apply(o)}:function(){return null};function H(o,a){a=o.indexOf(a),0<=a&&o.splice(a,1)}var de={};function ue(o){var a,u,h,y;if(arguments.length===1){if(l(o))return o.slice();if(this===de&&typeof o=="string")return[o];if(y=ae(o))for(u=[];!(h=y.next()).done;)u.push(h.value);else{if(o==null)return[o];if(typeof(a=o.length)!="number")return[o];for(u=new Array(a);a--;)u[a]=o[a]}}else for(a=arguments.length,u=new Array(a);a--;)u[a]=arguments[a];return u}var pe=typeof Symbol<"u"?function(o){return o[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ce=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],mt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ce),ke={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Pe(o,a){this.name=o,this.message=a}function at(o,a){return o+". Errors: "+Object.keys(a).map(function(u){return a[u].toString()}).filter(function(u,h,y){return y.indexOf(u)===h}).join(`
`)}function ze(o,a,u,h){this.failures=a,this.failedKeys=h,this.successCount=u,this.message=at(o,a)}function Ge(o,a){this.name="BulkError",this.failures=Object.keys(a).map(function(u){return a[u]}),this.failuresByPos=a,this.message=at(o,this.failures)}x(Pe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),x(ze).from(Pe),x(Ge).from(Pe);var qe=mt.reduce(function(o,a){return o[a]=a+"Error",o},{}),ct=Pe,G=mt.reduce(function(o,a){var u=a+"Error";function h(y,v){this.name=u,y?typeof y=="string"?(this.message="".concat(y).concat(v?`
 `+v:""),this.inner=v||null):typeof y=="object"&&(this.message="".concat(y.name," ").concat(y.message),this.inner=y):(this.message=ke[a]||u,this.inner=null)}return x(h).from(ct),o[a]=h,o},{}),Ze=(G.Syntax=SyntaxError,G.Type=TypeError,G.Range=RangeError,ce.reduce(function(o,a){return o[a+"Error"]=G[a],o},{}));ce=mt.reduce(function(o,a){return["Syntax","Type","Range"].indexOf(a)===-1&&(o[a+"Error"]=G[a]),o},{});function ge(){}function Se(o){return o}function Ae(o,a){return o==null||o===Se?a:function(u){return a(o(u))}}function je(o,a){return function(){o.apply(this,arguments),a.apply(this,arguments)}}function gt(o,a){return o===ge?a:function(){var u=o.apply(this,arguments),h=(u!==void 0&&(arguments[0]=u),this.onsuccess),y=this.onerror,v=(this.onsuccess=null,this.onerror=null,a.apply(this,arguments));return h&&(this.onsuccess=this.onsuccess?je(h,this.onsuccess):h),y&&(this.onerror=this.onerror?je(y,this.onerror):y),v!==void 0?v:u}}function xn(o,a){return o===ge?a:function(){o.apply(this,arguments);var u=this.onsuccess,h=this.onerror;this.onsuccess=this.onerror=null,a.apply(this,arguments),u&&(this.onsuccess=this.onsuccess?je(u,this.onsuccess):u),h&&(this.onerror=this.onerror?je(h,this.onerror):h)}}function Pt(o,a){return o===ge?a:function(y){var h=o.apply(this,arguments),y=(d(y,h),this.onsuccess),v=this.onerror,w=(this.onsuccess=null,this.onerror=null,a.apply(this,arguments));return y&&(this.onsuccess=this.onsuccess?je(y,this.onsuccess):y),v&&(this.onerror=this.onerror?je(v,this.onerror):v),h===void 0?w===void 0?void 0:w:d(h,w)}}function Od(o,a){return o===ge?a:function(){return a.apply(this,arguments)!==!1&&o.apply(this,arguments)}}function Hs(o,a){return o===ge?a:function(){var u=o.apply(this,arguments);if(u&&typeof u.then=="function"){for(var h=this,y=arguments.length,v=new Array(y);y--;)v[y]=arguments[y];return u.then(function(){return a.apply(h,v)})}return a.apply(this,arguments)}}ce.ModifyError=ze,ce.DexieError=Pe,ce.BulkError=Ge;var jt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Za(o){jt=o}var xr={},ec=100,Cr=typeof Promise>"u"?[]:(mt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[Cr=crypto.subtle.digest("SHA-512",new Uint8Array([0])),f(Cr),mt]:[mt,f(mt),mt]),mt=Cr[0],Qn=Cr[1],Qn=Qn&&Qn.then,Cn=mt&&mt.constructor,zs=!!Cr[2],Er=function(o,a){Or.push([o,a]),bi&&(queueMicrotask(Ad),bi=!1)},Ys=!0,bi=!0,En=[],wi=[],Gs=Se,an={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ge,pgp:!1,env:{},finalize:ge},fe=an,Or=[],On=0,_i=[];function X(o){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var a=this._PSD=fe;if(typeof o!="function"){if(o!==xr)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Xs(this,this._value)}else this._state=null,this._value=null,++a.ref,(function u(h,y){try{y(function(v){if(h._state===null){if(v===h)throw new TypeError("A promise cannot be resolved with itself.");var w=h._lib&&Vn();v&&typeof v.then=="function"?u(h,function(k,O){v instanceof X?v._then(k,O):v.then(k,O)}):(h._state=!0,h._value=v,nc(h)),w&&Hn()}},Xs.bind(null,h))}catch(v){Xs(h,v)}})(this,o)}var Js={get:function(){var o=fe,a=Ci;function u(h,y){var v=this,w=!o.global&&(o!==fe||a!==Ci),k=w&&!ln(),O=new X(function(P,I){Qs(v,new tc(ic(h,o,w,k),ic(y,o,w,k),P,I,o))});return this._consoleTask&&(O._consoleTask=this._consoleTask),O}return u.prototype=xr,u},set:function(o){S(this,"then",o&&o.prototype===xr?Js:{get:function(){return o},set:Js.set})}};function tc(o,a,u,h,y){this.onFulfilled=typeof o=="function"?o:null,this.onRejected=typeof a=="function"?a:null,this.resolve=u,this.reject=h,this.psd=y}function Xs(o,a){var u,h;wi.push(a),o._state===null&&(u=o._lib&&Vn(),a=Gs(a),o._state=!1,o._value=a,h=o,En.some(function(y){return y._value===h._value})||En.push(h),nc(o),u)&&Hn()}function nc(o){var a=o._listeners;o._listeners=[];for(var u=0,h=a.length;u<h;++u)Qs(o,a[u]);var y=o._PSD;--y.ref||y.finalize(),On===0&&(++On,Er(function(){--On==0&&Zs()},[]))}function Qs(o,a){if(o._state===null)o._listeners.push(a);else{var u=o._state?a.onFulfilled:a.onRejected;if(u===null)return(o._state?a.resolve:a.reject)(o._value);++a.psd.ref,++On,Er(Id,[u,o,a])}}function Id(o,a,u){try{var h,y=a._value;!a._state&&wi.length&&(wi=[]),h=jt&&a._consoleTask?a._consoleTask.run(function(){return o(y)}):o(y),a._state||wi.indexOf(y)!==-1||(v=>{for(var w=En.length;w;)if(En[--w]._value===v._value)return En.splice(w,1)})(a),u.resolve(h)}catch(v){u.reject(v)}finally{--On==0&&Zs(),--u.psd.ref||u.psd.finalize()}}function Ad(){In(an,function(){Vn()&&Hn()})}function Vn(){var o=Ys;return bi=Ys=!1,o}function Hn(){var o,a,u;do for(;0<Or.length;)for(o=Or,Or=[],u=o.length,a=0;a<u;++a){var h=o[a];h[0].apply(null,h[1])}while(0<Or.length);bi=Ys=!0}function Zs(){for(var o=En,a=(En=[],o.forEach(function(h){h._PSD.onunhandled.call(null,h._value,h)}),_i.slice(0)),u=a.length;u;)a[--u]()}function ki(o){return new X(xr,!1,o)}function Ke(o,a){var u=fe;return function(){var h=Vn(),y=fe;try{return un(u,!0),o.apply(this,arguments)}catch(v){a&&a(v)}finally{un(y,!1),h&&Hn()}}}m(X.prototype,{then:Js,_then:function(o,a){Qs(this,new tc(null,null,o,a,fe))},catch:function(o){var a,u;return arguments.length===1?this.then(null,o):(a=o,u=arguments[1],typeof a=="function"?this.then(null,function(h){return(h instanceof a?u:ki)(h)}):this.then(null,function(h){return(h&&h.name===a?u:ki)(h)}))},finally:function(o){return this.then(function(a){return X.resolve(o()).then(function(){return a})},function(a){return X.resolve(o()).then(function(){return ki(a)})})},timeout:function(o,a){var u=this;return o<1/0?new X(function(h,y){var v=setTimeout(function(){return y(new G.Timeout(a))},o);u.then(h,y).finally(clearTimeout.bind(null,v))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&S(X.prototype,Symbol.toStringTag,"Dexie.Promise"),an.env=rc(),m(X,{all:function(){var o=ue.apply(null,arguments).map(Ei);return new X(function(a,u){o.length===0&&a([]);var h=o.length;o.forEach(function(y,v){return X.resolve(y).then(function(w){o[v]=w,--h||a(o)},u)})})},resolve:function(o){return o instanceof X?o:o&&typeof o.then=="function"?new X(function(a,u){o.then(a,u)}):new X(xr,!0,o)},reject:ki,race:function(){var o=ue.apply(null,arguments).map(Ei);return new X(function(a,u){o.map(function(h){return X.resolve(h).then(a,u)})})},PSD:{get:function(){return fe},set:function(o){return fe=o}},totalEchoes:{get:function(){return Ci}},newPSD:cn,usePSD:In,scheduler:{get:function(){return Er},set:function(o){Er=o}},rejectionMapper:{get:function(){return Gs},set:function(o){Gs=o}},follow:function(o,a){return new X(function(u,h){return cn(function(y,v){var w=fe;w.unhandleds=[],w.onunhandled=v,w.finalize=je(function(){var k,O=this;k=function(){O.unhandleds.length===0?y():v(O.unhandleds[0])},_i.push(function P(){k(),_i.splice(_i.indexOf(P),1)}),++On,Er(function(){--On==0&&Zs()},[])},w.finalize),o()},a,u,h)})}}),Cn&&(Cn.allSettled&&S(X,"allSettled",function(){var o=ue.apply(null,arguments).map(Ei);return new X(function(a){o.length===0&&a([]);var u=o.length,h=new Array(u);o.forEach(function(y,v){return X.resolve(y).then(function(w){return h[v]={status:"fulfilled",value:w}},function(w){return h[v]={status:"rejected",reason:w}}).then(function(){return--u||a(h)})})})}),Cn.any&&typeof AggregateError<"u"&&S(X,"any",function(){var o=ue.apply(null,arguments).map(Ei);return new X(function(a,u){o.length===0&&u(new AggregateError([]));var h=o.length,y=new Array(h);o.forEach(function(v,w){return X.resolve(v).then(function(k){return a(k)},function(k){y[w]=k,--h||u(new AggregateError(y))})})})}),Cn.withResolvers)&&(X.withResolvers=Cn.withResolvers);var et={awaits:0,echoes:0,id:0},Dd=0,Si=[],xi=0,Ci=0,Td=0;function cn(o,w,u,h){var y=fe,v=Object.create(y),w=(v.parent=y,v.ref=0,v.global=!1,v.id=++Td,an.env,v.env=zs?{Promise:X,PromiseProp:{value:X,configurable:!0,writable:!0},all:X.all,race:X.race,allSettled:X.allSettled,any:X.any,resolve:X.resolve,reject:X.reject}:{},w&&d(v,w),++y.ref,v.finalize=function(){--this.parent.ref||this.parent.finalize()},In(v,o,u,h));return v.ref===0&&v.finalize(),w}function zn(){return et.id||(et.id=++Dd),++et.awaits,et.echoes+=ec,et.id}function ln(){return!!et.awaits&&(--et.awaits==0&&(et.id=0),et.echoes=et.awaits*ec,!0)}function Ei(o){return et.echoes&&o&&o.constructor===Cn?(zn(),o.then(function(a){return ln(),a},function(a){return ln(),We(a)})):o}function Rd(){var o=Si[Si.length-1];Si.pop(),un(o,!1)}function un(o,a){var u,h,y=fe;(a?!et.echoes||xi++&&o===fe:!xi||--xi&&o===fe)||queueMicrotask(a?(function(v){++Ci,et.echoes&&--et.echoes!=0||(et.echoes=et.awaits=et.id=0),Si.push(fe),un(v,!0)}).bind(null,o):Rd),o!==fe&&(fe=o,y===an&&(an.env=rc()),zs)&&(u=an.env.Promise,h=o.env,y.global||o.global)&&(Object.defineProperty(s,"Promise",h.PromiseProp),u.all=h.all,u.race=h.race,u.resolve=h.resolve,u.reject=h.reject,h.allSettled&&(u.allSettled=h.allSettled),h.any)&&(u.any=h.any)}function rc(){var o=s.Promise;return zs?{Promise:o,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:o.all,race:o.race,allSettled:o.allSettled,any:o.any,resolve:o.resolve,reject:o.reject}:{}}function In(o,a,u,h,y){var v=fe;try{return un(o,!0),a(u,h,y)}finally{un(v,!1)}}function ic(o,a,u,h){return typeof o!="function"?o:function(){var y=fe;u&&zn(),un(a,!0);try{return o.apply(this,arguments)}finally{un(y,!1),h&&queueMicrotask(ln)}}}function eo(o){Promise===Cn&&et.echoes===0?xi===0?o():enqueueNativeMicroTask(o):setTimeout(o,0)}(""+Qn).indexOf("[native code]")===-1&&(zn=ln=ge);var We=X.reject,An="ï¿¿",Ht="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",sc="String expected.",Yn=[],Oi="__dbnames",to="readonly",no="readwrite";function Dn(o,a){return o?a?function(){return o.apply(this,arguments)&&a.apply(this,arguments)}:o:a}var oc={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ii(o){return typeof o!="string"||/\./.test(o)?function(a){return a}:function(a){return a[o]===void 0&&o in a&&delete(a=ee(a))[o],a}}function ac(){throw G.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function xe(o,a){try{var u=cc(o),h=cc(a);if(u!==h)return u==="Array"?1:h==="Array"?-1:u==="binary"?1:h==="binary"?-1:u==="string"?1:h==="string"?-1:u==="Date"?1:h!=="Date"?NaN:-1;switch(u){case"number":case"Date":case"string":return a<o?1:o<a?-1:0;case"binary":for(var y=lc(o),v=lc(a),w=y.length,k=v.length,O=w<k?w:k,P=0;P<O;++P)if(y[P]!==v[P])return y[P]<v[P]?-1:1;return w===k?0:w<k?-1:1;case"Array":for(var I=o,C=a,D=I.length,T=C.length,A=D<T?D:T,E=0;E<A;++E){var j=xe(I[E],C[E]);if(j!==0)return j}return D===T?0:D<T?-1:1}}catch{}return NaN}function cc(o){var a=typeof o;return a=="object"&&(ArrayBuffer.isView(o)||(a=ve(o))==="ArrayBuffer")?"binary":a}function lc(o){return o instanceof Uint8Array?o:ArrayBuffer.isView(o)?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):new Uint8Array(o)}function Ai(o,a,u){var h=o.schema.yProps;return h?(a&&0<u.numFailures&&(a=a.filter(function(y,v){return!u.failures[v]})),Promise.all(h.map(function(y){return y=y.updatesTable,a?o.db.table(y).where("k").anyOf(a).delete():o.db.table(y).clear()})).then(function(){return u})):u}uc.prototype.execute=function(o){var a=this["@@propmod"];if(a.add!==void 0){var u=a.add;if(l(u))return i(i([],l(o)?o:[],!0),u).sort();if(typeof u=="number")return(Number(o)||0)+u;if(typeof u=="bigint")try{return BigInt(o)+u}catch{return BigInt(0)+u}throw new TypeError("Invalid term ".concat(u))}if(a.remove!==void 0){var h=a.remove;if(l(h))return l(o)?o.filter(function(y){return!h.includes(y)}).sort():[];if(typeof h=="number")return Number(o)-h;if(typeof h=="bigint")try{return BigInt(o)-h}catch{return BigInt(0)-h}throw new TypeError("Invalid subtrahend ".concat(h))}return u=(u=a.replacePrefix)==null?void 0:u[0],u&&typeof o=="string"&&o.startsWith(u)?a.replacePrefix[1]+o.substring(u.length):o};var Ir=uc;function uc(o){this["@@propmod"]=o}function fc(o,a){for(var u=c(a),h=u.length,y=!1,v=0;v<h;++v){var w=u[v],k=a[w],O=ie(o,w);k instanceof Ir?(Z(o,w,k.execute(O)),y=!0):O!==k&&(Z(o,w,k),y=!0)}return y}Me.prototype._trans=function(o,a,u){var h=this._tx||fe.trans,y=this.name,v=jt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(o==="readonly"?"read":"write"," ").concat(this.name));function w(P,I,C){if(C.schema[y])return a(C.idbtrans,C);throw new G.NotFound("Table "+y+" not part of transaction")}var k=Vn();try{var O=h&&h.db._novip===this.db._novip?h===fe.trans?h._promise(o,w,u):cn(function(){return h._promise(o,w,u)},{trans:h,transless:fe.transless||fe}):(function P(I,C,D,T){if(I.idbdb&&(I._state.openComplete||fe.letThrough||I._vip)){var A=I._createTransaction(C,D,I._dbSchema);try{A.create(),I._state.PR1398_maxLoop=3}catch(E){return E.name===qe.InvalidState&&I.isOpen()&&0<--I._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),I.close({disableAutoOpen:!1}),I.open().then(function(){return P(I,C,D,T)})):We(E)}return A._promise(C,function(E,j){return cn(function(){return fe.trans=A,T(E,j,A)})}).then(function(E){if(C==="readwrite")try{A.idbtrans.commit()}catch{}return C==="readonly"?E:A._completion.then(function(){return E})})}if(I._state.openComplete)return We(new G.DatabaseClosed(I._state.dbOpenError));if(!I._state.isBeingOpened){if(!I._state.autoOpen)return We(new G.DatabaseClosed);I.open().catch(ge)}return I._state.dbReadyPromise.then(function(){return P(I,C,D,T)})})(this.db,o,[this.name],w);return v&&(O._consoleTask=v,O=O.catch(function(P){return console.trace(P),We(P)})),O}finally{k&&Hn()}},Me.prototype.get=function(o,a){var u=this;return o&&o.constructor===Object?this.where(o).first(a):o==null?We(new G.Type("Invalid argument to Table.get()")):this._trans("readonly",function(h){return u.core.get({trans:h,key:o}).then(function(y){return u.hook.reading.fire(y)})}).then(a)},Me.prototype.where=function(o){if(typeof o=="string")return new this.db.WhereClause(this,o);if(l(o))return new this.db.WhereClause(this,"[".concat(o.join("+"),"]"));var a=c(o);if(a.length===1)return this.where(a[0]).equals(o[a[0]]);var u=this.schema.indexes.concat(this.schema.primKey).filter(function(k){if(k.compound&&a.every(function(P){return 0<=k.keyPath.indexOf(P)})){for(var O=0;O<a.length;++O)if(a.indexOf(k.keyPath[O])===-1)return!1;return!0}return!1}).sort(function(k,O){return k.keyPath.length-O.keyPath.length})[0];if(u&&this.db._maxKey!==An)return w=u.keyPath.slice(0,a.length),this.where(w).equals(w.map(function(k){return o[k]}));!u&&jt&&console.warn("The query ".concat(JSON.stringify(o)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(a.join("+"),"]"));var h=this.schema.idxByName;function y(k,O){return xe(k,O)===0}var w=a.reduce(function(I,O){var P=I[0],I=I[1],C=h[O],D=o[O];return[P||C,P||!C?Dn(I,C&&C.multi?function(T){return T=ie(T,O),l(T)&&T.some(function(A){return y(D,A)})}:function(T){return y(D,ie(T,O))}):I]},[null,null]),v=w[0],w=w[1];return v?this.where(v.name).equals(o[v.keyPath]).filter(w):u?this.filter(w):this.where(a).equals("")},Me.prototype.filter=function(o){return this.toCollection().and(o)},Me.prototype.count=function(o){return this.toCollection().count(o)},Me.prototype.offset=function(o){return this.toCollection().offset(o)},Me.prototype.limit=function(o){return this.toCollection().limit(o)},Me.prototype.each=function(o){return this.toCollection().each(o)},Me.prototype.toArray=function(o){return this.toCollection().toArray(o)},Me.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Me.prototype.orderBy=function(o){return new this.db.Collection(new this.db.WhereClause(this,l(o)?"[".concat(o.join("+"),"]"):o))},Me.prototype.reverse=function(){return this.toCollection().reverse()},Me.prototype.mapToClass=function(o){for(var a=this.db,u=this.name,h=((this.schema.mappedClass=o).prototype instanceof ac&&(o=(w=>{var k=I,O=w;if(typeof O!="function"&&O!==null)throw new TypeError("Class extends value "+String(O)+" is not a constructor or null");function P(){this.constructor=k}function I(){return w!==null&&w.apply(this,arguments)||this}return n(k,O),k.prototype=O===null?Object.create(O):(P.prototype=O.prototype,new P),Object.defineProperty(I.prototype,"db",{get:function(){return a},enumerable:!1,configurable:!0}),I.prototype.table=function(){return u},I})(o)),new Set),y=o.prototype;y;y=f(y))Object.getOwnPropertyNames(y).forEach(function(w){return h.add(w)});function v(w){if(!w)return w;var k,O=Object.create(o.prototype);for(k in w)if(!h.has(k))try{O[k]=w[k]}catch{}return O}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=v,this.hook("reading",v),o},Me.prototype.defineClass=function(){return this.mapToClass(function(o){d(this,o)})},Me.prototype.add=function(o,a){var u=this,h=this.schema.primKey,y=h.auto,v=h.keyPath,w=o;return v&&y&&(w=Ii(v)(o)),this._trans("readwrite",function(k){return u.core.mutate({trans:k,type:"add",keys:a!=null?[a]:null,values:[w]})}).then(function(k){return k.numFailures?X.reject(k.failures[0]):k.lastResult}).then(function(k){if(v)try{Z(o,v,k)}catch{}return k})},Me.prototype.upsert=function(o,a){var u=this,h=this.schema.primKey.keyPath;return this._trans("readwrite",function(y){return u.core.get({trans:y,key:o}).then(function(v){var w=v??{};return fc(w,a),h&&Z(w,h,o),u.core.mutate({trans:y,type:"put",values:[w],keys:[o],upsert:!0,updates:{keys:[o],changeSpecs:[a]}}).then(function(k){return k.numFailures?X.reject(k.failures[0]):!!v})})})},Me.prototype.update=function(o,a){return typeof o!="object"||l(o)?this.where(":id").equals(o).modify(a):(o=ie(o,this.schema.primKey.keyPath))===void 0?We(new G.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(o).modify(a)},Me.prototype.put=function(o,a){var u=this,h=this.schema.primKey,y=h.auto,v=h.keyPath,w=o;return v&&y&&(w=Ii(v)(o)),this._trans("readwrite",function(k){return u.core.mutate({trans:k,type:"put",values:[w],keys:a!=null?[a]:null})}).then(function(k){return k.numFailures?X.reject(k.failures[0]):k.lastResult}).then(function(k){if(v)try{Z(o,v,k)}catch{}return k})},Me.prototype.delete=function(o){var a=this;return this._trans("readwrite",function(u){return a.core.mutate({trans:u,type:"delete",keys:[o]}).then(function(h){return Ai(a,[o],h)}).then(function(h){return h.numFailures?X.reject(h.failures[0]):void 0})})},Me.prototype.clear=function(){var o=this;return this._trans("readwrite",function(a){return o.core.mutate({trans:a,type:"deleteRange",range:oc}).then(function(u){return Ai(o,null,u)})}).then(function(a){return a.numFailures?X.reject(a.failures[0]):void 0})},Me.prototype.bulkGet=function(o){var a=this;return this._trans("readonly",function(u){return a.core.getMany({keys:o,trans:u}).then(function(h){return h.map(function(y){return a.hook.reading.fire(y)})})})},Me.prototype.bulkAdd=function(o,a,u){var h=this,y=Array.isArray(a)?a:void 0,v=(u=u||(y?void 0:a))?u.allKeys:void 0;return this._trans("readwrite",function(w){var k=h.schema.primKey,P=k.auto,k=k.keyPath;if(k&&y)throw new G.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(y&&y.length!==o.length)throw new G.InvalidArgument("Arguments objects and keys must have the same length");var O=o.length,P=k&&P?o.map(Ii(k)):o;return h.core.mutate({trans:w,type:"add",keys:y,values:P,wantResults:v}).then(function(I){var C=I.numFailures,D=I.failures;if(C===0)return v?I.results:I.lastResult;throw new Ge("".concat(h.name,".bulkAdd(): ").concat(C," of ").concat(O," operations failed"),D)})})},Me.prototype.bulkPut=function(o,a,u){var h=this,y=Array.isArray(a)?a:void 0,v=(u=u||(y?void 0:a))?u.allKeys:void 0;return this._trans("readwrite",function(w){var k=h.schema.primKey,P=k.auto,k=k.keyPath;if(k&&y)throw new G.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(y&&y.length!==o.length)throw new G.InvalidArgument("Arguments objects and keys must have the same length");var O=o.length,P=k&&P?o.map(Ii(k)):o;return h.core.mutate({trans:w,type:"put",keys:y,values:P,wantResults:v}).then(function(I){var C=I.numFailures,D=I.failures;if(C===0)return v?I.results:I.lastResult;throw new Ge("".concat(h.name,".bulkPut(): ").concat(C," of ").concat(O," operations failed"),D)})})},Me.prototype.bulkUpdate=function(o){var a=this,u=this.core,h=o.map(function(w){return w.key}),y=o.map(function(w){return w.changes}),v=[];return this._trans("readwrite",function(w){return u.getMany({trans:w,keys:h,cache:"clone"}).then(function(k){var O=[],P=[],I=(o.forEach(function(C,D){var T=C.key,A=C.changes,E=k[D];if(E){for(var j=0,L=Object.keys(A);j<L.length;j++){var R=L[j],B=A[R];if(R===a.schema.primKey.keyPath){if(xe(B,T)!==0)throw new G.Constraint("Cannot update primary key in bulkUpdate()")}else Z(E,R,B)}v.push(D),O.push(T),P.push(E)}}),O.length);return u.mutate({trans:w,type:"put",keys:O,values:P,updates:{keys:h,changeSpecs:y}}).then(function(C){var D=C.numFailures,T=C.failures;if(D===0)return I;for(var A=0,E=Object.keys(T);A<E.length;A++){var j,L=E[A],R=v[Number(L)];R!=null&&(j=T[L],delete T[L],T[R]=j)}throw new Ge("".concat(a.name,".bulkUpdate(): ").concat(D," of ").concat(I," operations failed"),T)})})})},Me.prototype.bulkDelete=function(o){var a=this,u=o.length;return this._trans("readwrite",function(h){return a.core.mutate({trans:h,type:"delete",keys:o}).then(function(y){return Ai(a,o,y)})}).then(function(h){var y=h.numFailures,v=h.failures;if(y===0)return h.lastResult;throw new Ge("".concat(a.name,".bulkDelete(): ").concat(y," of ").concat(u," operations failed"),v)})};var dc=Me;function Me(){}function Ar(o){function a(w,k){if(k){for(var O=arguments.length,P=new Array(O-1);--O;)P[O-1]=arguments[O];return u[w].subscribe.apply(null,P),o}if(typeof w=="string")return u[w]}var u={};a.addEventType=v;for(var h=1,y=arguments.length;h<y;++h)v(arguments[h]);return a;function v(w,k,O){var P,I;if(typeof w!="object")return k=k||Od,I={subscribers:[],fire:O=O||ge,subscribe:function(C){I.subscribers.indexOf(C)===-1&&(I.subscribers.push(C),I.fire=k(I.fire,C))},unsubscribe:function(C){I.subscribers=I.subscribers.filter(function(D){return D!==C}),I.fire=I.subscribers.reduce(k,O)}},u[w]=a[w]=I;c(P=w).forEach(function(C){var D=P[C];if(l(D))v(C,P[C][0],P[C][1]);else{if(D!=="asap")throw new G.InvalidArgument("Invalid event config");var T=v(C,Se,function(){for(var A=arguments.length,E=new Array(A);A--;)E[A]=arguments[A];T.subscribers.forEach(function(j){K(function(){j.apply(null,E)})})})}})}}function Dr(o,a){return x(a).from({prototype:o}),a}function Gn(o,a){return!(o.filter||o.algorithm||o.or)&&(a?o.justLimit:!o.replayFilter)}function ro(o,a){o.filter=Dn(o.filter,a)}function io(o,a,u){var h=o.replayFilter;o.replayFilter=h?function(){return Dn(h(),a())}:a,o.justLimit=u&&!h}function Di(o,a){if(o.isPrimKey)return a.primaryKey;var u=a.getIndexByKeyPath(o.index);if(u)return u;throw new G.Schema("KeyPath "+o.index+" on object store "+a.name+" is not indexed")}function hc(o,a,u){var h=Di(o,a.schema);return a.openCursor({trans:u,values:!o.keysOnly,reverse:o.dir==="prev",unique:!!o.unique,query:{index:h,range:o.range}})}function Ti(o,a,u,h){var y,v,w=o.replayFilter?Dn(o.filter,o.replayFilter()):o.filter;return o.or?(y={},v=function(k,O,P){var I,C;w&&!w(O,P,function(D){return O.stop(D)},function(D){return O.fail(D)})||((C=""+(I=O.primaryKey))=="[object ArrayBuffer]"&&(C=""+new Uint8Array(I)),p(y,C))||(y[C]=!0,a(k,O,P))},Promise.all([o.or._iterate(v,u),pc(hc(o,h,u),o.algorithm,v,!o.keysOnly&&o.valueMapper)])):pc(hc(o,h,u),Dn(o.algorithm,w),a,!o.keysOnly&&o.valueMapper)}function pc(o,a,u,h){var y=Ke(h?function(v,w,k){return u(h(v),w,k)}:u);return o.then(function(v){if(v)return v.start(function(){var w=function(){return v.continue()};a&&!a(v,function(k){return w=k},function(k){v.stop(k),w=ge},function(k){v.fail(k),w=ge})||y(v.value,v,function(k){return w=k}),w()})})}De.prototype._read=function(o,a){var u=this._ctx;return u.error?u.table._trans(null,We.bind(null,u.error)):u.table._trans("readonly",o).then(a)},De.prototype._write=function(o){var a=this._ctx;return a.error?a.table._trans(null,We.bind(null,a.error)):a.table._trans("readwrite",o,"locked")},De.prototype._addAlgorithm=function(o){var a=this._ctx;a.algorithm=Dn(a.algorithm,o)},De.prototype._iterate=function(o,a){return Ti(this._ctx,o,a,this._ctx.table.core)},De.prototype.clone=function(o){var a=Object.create(this.constructor.prototype),u=Object.create(this._ctx);return o&&d(u,o),a._ctx=u,a},De.prototype.raw=function(){return this._ctx.valueMapper=null,this},De.prototype.each=function(o){var a=this._ctx;return this._read(function(u){return Ti(a,o,u,a.table.core)})},De.prototype.count=function(o){var a=this;return this._read(function(u){var h,y=a._ctx,v=y.table.core;return Gn(y,!0)?v.count({trans:u,query:{index:Di(y,v.schema),range:y.range}}).then(function(w){return Math.min(w,y.limit)}):(h=0,Ti(y,function(){return++h,!1},u,v).then(function(){return h}))}).then(o)},De.prototype.sortBy=function(o,a){var u=o.split(".").reverse(),h=u[0],y=u.length-1;function v(O,P){return P?v(O[u[P]],P-1):O[h]}var w=this._ctx.dir==="next"?1:-1;function k(O,P){return xe(v(O,y),v(P,y))*w}return this.toArray(function(O){return O.sort(k)}).then(a)},De.prototype.toArray=function(o){var a=this;return this._read(function(u){var h,y,v,w=a._ctx;return w.dir==="next"&&Gn(w,!0)&&0<w.limit?(h=w.valueMapper,y=Di(w,w.table.core.schema),w.table.core.query({trans:u,limit:w.limit,values:!0,query:{index:y,range:w.range}}).then(function(k){return k=k.result,h?k.map(h):k})):(v=[],Ti(w,function(k){return v.push(k)},u,w.table.core).then(function(){return v}))},o)},De.prototype.offset=function(o){var a=this._ctx;return o<=0||(a.offset+=o,Gn(a)?io(a,function(){var u=o;return function(h,y){return u===0||(u===1?--u:y(function(){h.advance(u),u=0}),!1)}}):io(a,function(){var u=o;return function(){return--u<0}})),this},De.prototype.limit=function(o){return this._ctx.limit=Math.min(this._ctx.limit,o),io(this._ctx,function(){var a=o;return function(u,h,y){return--a<=0&&h(y),0<=a}},!0),this},De.prototype.until=function(o,a){return ro(this._ctx,function(u,h,y){return!o(u.value)||(h(y),a)}),this},De.prototype.first=function(o){return this.limit(1).toArray(function(a){return a[0]}).then(o)},De.prototype.last=function(o){return this.reverse().first(o)},De.prototype.filter=function(o){var a;return ro(this._ctx,function(u){return o(u.value)}),(a=this._ctx).isMatch=Dn(a.isMatch,o),this},De.prototype.and=function(o){return this.filter(o)},De.prototype.or=function(o){return new this.db.WhereClause(this._ctx.table,o,this)},De.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},De.prototype.desc=function(){return this.reverse()},De.prototype.eachKey=function(o){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(u,h){o(h.key,h)})},De.prototype.eachUniqueKey=function(o){return this._ctx.unique="unique",this.eachKey(o)},De.prototype.eachPrimaryKey=function(o){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(u,h){o(h.primaryKey,h)})},De.prototype.keys=function(o){var a=this._ctx,u=(a.keysOnly=!a.isMatch,[]);return this.each(function(h,y){u.push(y.key)}).then(function(){return u}).then(o)},De.prototype.primaryKeys=function(o){var a=this._ctx;if(a.dir==="next"&&Gn(a,!0)&&0<a.limit)return this._read(function(h){var y=Di(a,a.table.core.schema);return a.table.core.query({trans:h,values:!1,limit:a.limit,query:{index:y,range:a.range}})}).then(function(h){return h.result}).then(o);a.keysOnly=!a.isMatch;var u=[];return this.each(function(h,y){u.push(y.primaryKey)}).then(function(){return u}).then(o)},De.prototype.uniqueKeys=function(o){return this._ctx.unique="unique",this.keys(o)},De.prototype.firstKey=function(o){return this.limit(1).keys(function(a){return a[0]}).then(o)},De.prototype.lastKey=function(o){return this.reverse().firstKey(o)},De.prototype.distinct=function(){var o,a=this._ctx,a=a.index&&a.table.schema.idxByName[a.index];return a&&a.multi&&(o={},ro(this._ctx,function(h){var h=h.primaryKey.toString(),y=p(o,h);return o[h]=!0,!y})),this},De.prototype.modify=function(o){var a=this,u=this._ctx;return this._write(function(h){function y(E,j){var L=j.failures;D+=E-j.numFailures;for(var R=0,B=c(L);R<B.length;R++){var F=B[R];C.push(L[F])}}var v=typeof o=="function"?o:function(E){return fc(E,o)},w=u.table.core,I=w.schema.primaryKey,k=I.outbound,O=I.extractKey,P=200,I=a.db._options.modifyChunkSize,C=(I&&(P=typeof I=="object"?I[w.name]||I["*"]||200:I),[]),D=0,T=[],A=o===yc;return a.clone().primaryKeys().then(function(E){function j(R){var B=Math.min(P,E.length-R),F=E.slice(R,R+B);return(A?Promise.resolve([]):w.getMany({trans:h,keys:F,cache:"immutable"})).then(function(z){var Y=[],$=[],se=k?[]:null,te=A?F:[];if(!A)for(var W=0;W<B;++W){var oe=z[W],Ee={value:ee(oe),primKey:E[R+W]};v.call(Ee,Ee.value,Ee)!==!1&&(Ee.value==null?te.push(E[R+W]):k||xe(O(oe),O(Ee.value))===0?($.push(Ee.value),k&&se.push(E[R+W])):(te.push(E[R+W]),Y.push(Ee.value)))}return Promise.resolve(0<Y.length&&w.mutate({trans:h,type:"add",values:Y}).then(function(Te){for(var ye in Te.failures)te.splice(parseInt(ye),1);y(Y.length,Te)})).then(function(){return(0<$.length||L&&typeof o=="object")&&w.mutate({trans:h,type:"put",keys:se,values:$,criteria:L,changeSpec:typeof o!="function"&&o,isAdditionalChunk:0<R}).then(function(Te){return y($.length,Te)})}).then(function(){return(0<te.length||L&&A)&&w.mutate({trans:h,type:"delete",keys:te,criteria:L,isAdditionalChunk:0<R}).then(function(Te){return Ai(u.table,te,Te)}).then(function(Te){return y(te.length,Te)})}).then(function(){return E.length>R+B&&j(R+P)})})}var L=Gn(u)&&u.limit===1/0&&(typeof o!="function"||A)&&{index:u.index,range:u.range};return j(0).then(function(){if(0<C.length)throw new ze("Error modifying one or more objects",C,D,T);return E.length})})})},De.prototype.delete=function(){var o=this._ctx,a=o.range;return!Gn(o)||o.table.schema.yProps||!o.isPrimKey&&a.type!==3?this.modify(yc):this._write(function(u){var h=o.table.core.schema.primaryKey,y=a;return o.table.core.count({trans:u,query:{index:h,range:y}}).then(function(v){return o.table.core.mutate({trans:u,type:"deleteRange",range:y}).then(function(O){var k=O.failures,O=O.numFailures;if(O)throw new ze("Could not delete some values",Object.keys(k).map(function(P){return k[P]}),v-O);return v-O})})})};var Pd=De;function De(){}var yc=function(o,a){return a.value=null};function jd(o,a){return o<a?-1:o===a?0:1}function Ud(o,a){return a<o?-1:o===a?0:1}function vt(o,a,u){return o=o instanceof mc?new o.Collection(o):o,o._ctx.error=new(u||TypeError)(a),o}function Jn(o){return new o.Collection(o,function(){return gc("")}).limit(0)}function Ri(T,a,u,h){var y,v,w,k,O,P,I,C=u.length;if(!u.every(function(E){return typeof E=="string"}))return vt(T,sc);function D(E){y=E==="next"?function(L){return L.toUpperCase()}:function(L){return L.toLowerCase()},v=E==="next"?function(L){return L.toLowerCase()}:function(L){return L.toUpperCase()},w=E==="next"?jd:Ud;var j=u.map(function(L){return{lower:v(L),upper:y(L)}}).sort(function(L,R){return w(L.lower,R.lower)});k=j.map(function(L){return L.upper}),O=j.map(function(L){return L.lower}),I=(P=E)==="next"?"":h}D("next");var T=new T.Collection(T,function(){return fn(k[0],O[C-1]+h)}),A=(T._ondirectionchange=function(E){D(E)},0);return T._addAlgorithm(function(E,j,L){var R=E.key;if(typeof R=="string"){var B=v(R);if(a(B,O,A))return!0;for(var F=null,z=A;z<C;++z){var Y=(($,se,te,W,oe,Ee)=>{for(var Te=Math.min($.length,W.length),ye=-1,_e=0;_e<Te;++_e){var Fe=se[_e];if(Fe!==W[_e])return oe($[_e],te[_e])<0?$.substr(0,_e)+te[_e]+te.substr(_e+1):oe($[_e],W[_e])<0?$.substr(0,_e)+W[_e]+te.substr(_e+1):0<=ye?$.substr(0,ye)+se[ye]+te.substr(ye+1):null;oe($[_e],Fe)<0&&(ye=_e)}return Te<W.length&&Ee==="next"?$+te.substr($.length):Te<$.length&&Ee==="prev"?$.substr(0,te.length):ye<0?null:$.substr(0,ye)+W[ye]+te.substr(ye+1)})(R,B,k[z],O[z],w,P);Y===null&&F===null?A=z+1:(F===null||0<w(F,Y))&&(F=Y)}j(F!==null?function(){E.continue(F+I)}:L)}return!1}),T}function fn(o,a,u,h){return{type:2,lower:o,upper:a,lowerOpen:u,upperOpen:h}}function gc(o){return{type:1,lower:o,upper:o}}Object.defineProperty(tt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),tt.prototype.between=function(o,a,u,h){u=u!==!1,h=h===!0;try{return 0<this._cmp(o,a)||this._cmp(o,a)===0&&(u||h)&&(!u||!h)?Jn(this):new this.Collection(this,function(){return fn(o,a,!u,!h)})}catch{return vt(this,Ht)}},tt.prototype.equals=function(o){return o==null?vt(this,Ht):new this.Collection(this,function(){return gc(o)})},tt.prototype.above=function(o){return o==null?vt(this,Ht):new this.Collection(this,function(){return fn(o,void 0,!0)})},tt.prototype.aboveOrEqual=function(o){return o==null?vt(this,Ht):new this.Collection(this,function(){return fn(o,void 0,!1)})},tt.prototype.below=function(o){return o==null?vt(this,Ht):new this.Collection(this,function(){return fn(void 0,o,!1,!0)})},tt.prototype.belowOrEqual=function(o){return o==null?vt(this,Ht):new this.Collection(this,function(){return fn(void 0,o)})},tt.prototype.startsWith=function(o){return typeof o!="string"?vt(this,sc):this.between(o,o+An,!0,!0)},tt.prototype.startsWithIgnoreCase=function(o){return o===""?this.startsWith(o):Ri(this,function(a,u){return a.indexOf(u[0])===0},[o],An)},tt.prototype.equalsIgnoreCase=function(o){return Ri(this,function(a,u){return a===u[0]},[o],"")},tt.prototype.anyOfIgnoreCase=function(){var o=ue.apply(de,arguments);return o.length===0?Jn(this):Ri(this,function(a,u){return u.indexOf(a)!==-1},o,"")},tt.prototype.startsWithAnyOfIgnoreCase=function(){var o=ue.apply(de,arguments);return o.length===0?Jn(this):Ri(this,function(a,u){return u.some(function(h){return a.indexOf(h)===0})},o,An)},tt.prototype.anyOf=function(){var o,a,u=this,h=ue.apply(de,arguments),y=this._cmp;try{h.sort(y)}catch{return vt(this,Ht)}return h.length===0?Jn(this):((o=new this.Collection(this,function(){return fn(h[0],h[h.length-1])}))._ondirectionchange=function(v){y=v==="next"?u._ascending:u._descending,h.sort(y)},a=0,o._addAlgorithm(function(v,w,k){for(var O=v.key;0<y(O,h[a]);)if(++a===h.length)return w(k),!1;return y(O,h[a])===0||(w(function(){v.continue(h[a])}),!1)}),o)},tt.prototype.notEqual=function(o){return this.inAnyRange([[-1/0,o],[o,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},tt.prototype.noneOf=function(){var o=ue.apply(de,arguments);if(o.length===0)return new this.Collection(this);try{o.sort(this._ascending)}catch{return vt(this,Ht)}var a=o.reduce(function(u,h){return u?u.concat([[u[u.length-1][1],h]]):[[-1/0,h]]},null);return a.push([o[o.length-1],this.db._maxKey]),this.inAnyRange(a,{includeLowers:!1,includeUppers:!1})},tt.prototype.inAnyRange=function(o,L){var u=this,h=this._cmp,y=this._ascending,v=this._descending,w=this._min,k=this._max;if(o.length===0)return Jn(this);if(!o.every(function(R){return R[0]!==void 0&&R[1]!==void 0&&y(R[0],R[1])<=0}))return vt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",G.InvalidArgument);var O=!L||L.includeLowers!==!1,P=L&&L.includeUppers===!0,I,C=y;function D(R,B){return C(R[0],B[0])}try{(I=o.reduce(function(R,B){for(var F=0,z=R.length;F<z;++F){var Y=R[F];if(h(B[0],Y[1])<0&&0<h(B[1],Y[0])){Y[0]=w(Y[0],B[0]),Y[1]=k(Y[1],B[1]);break}}return F===z&&R.push(B),R},[])).sort(D)}catch{return vt(this,Ht)}var T=0,A=P?function(R){return 0<y(R,I[T][1])}:function(R){return 0<=y(R,I[T][1])},E=O?function(R){return 0<v(R,I[T][0])}:function(R){return 0<=v(R,I[T][0])},j=A,L=new this.Collection(this,function(){return fn(I[0][0],I[I.length-1][1],!O,!P)});return L._ondirectionchange=function(R){C=R==="next"?(j=A,y):(j=E,v),I.sort(D)},L._addAlgorithm(function(R,B,F){for(var z,Y=R.key;j(Y);)if(++T===I.length)return B(F),!1;return!A(z=Y)&&!E(z)||(u._cmp(Y,I[T][1])===0||u._cmp(Y,I[T][0])===0||B(function(){C===y?R.continue(I[T][0]):R.continue(I[T][1])}),!1)}),L},tt.prototype.startsWithAnyOf=function(){var o=ue.apply(de,arguments);return o.every(function(a){return typeof a=="string"})?o.length===0?Jn(this):this.inAnyRange(o.map(function(a){return[a,a+An]})):vt(this,"startsWithAnyOf() only works with strings")};var mc=tt;function tt(){}function Ut(o){return Ke(function(a){return Tr(a),o(a.target.error),!1})}function Tr(o){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault()}var Rr="storagemutated",so="x-storagemutated-1",dn=Ar(null,Rr),Ld=(Lt.prototype._lock=function(){return q(!fe.global),++this._reculock,this._reculock!==1||fe.global||(fe.lockOwnerFor=this),this},Lt.prototype._unlock=function(){if(q(!fe.global),--this._reculock==0)for(fe.global||(fe.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var o=this._blockedFuncs.shift();try{In(o[1],o[0])}catch{}}return this},Lt.prototype._locked=function(){return this._reculock&&fe.lockOwnerFor!==this},Lt.prototype.create=function(o){var a=this;if(this.mode){var u=this.db.idbdb,h=this.db._state.dbOpenError;if(q(!this.idbtrans),!o&&!u)switch(h&&h.name){case"DatabaseClosedError":throw new G.DatabaseClosed(h);case"MissingAPIError":throw new G.MissingAPI(h.message,h);default:throw new G.OpenFailed(h)}if(!this.active)throw new G.TransactionInactive;q(this._completion._state===null),(o=this.idbtrans=o||(this.db.core||u).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ke(function(y){Tr(y),a._reject(o.error)}),o.onabort=Ke(function(y){Tr(y),a.active&&a._reject(new G.Abort(o.error)),a.active=!1,a.on("abort").fire(y)}),o.oncomplete=Ke(function(){a.active=!1,a._resolve(),"mutatedParts"in o&&dn.storagemutated.fire(o.mutatedParts)})}return this},Lt.prototype._promise=function(o,a,u){var h,y=this;return o==="readwrite"&&this.mode!=="readwrite"?We(new G.ReadOnly("Transaction is readonly")):this.active?this._locked()?new X(function(v,w){y._blockedFuncs.push([function(){y._promise(o,a,u).then(v,w)},fe])}):u?cn(function(){var v=new X(function(w,k){y._lock();var O=a(w,k,y);O&&O.then&&O.then(w,k)});return v.finally(function(){return y._unlock()}),v._lib=!0,v}):((h=new X(function(v,w){var k=a(v,w,y);k&&k.then&&k.then(v,w)}))._lib=!0,h):We(new G.TransactionInactive)},Lt.prototype._root=function(){return this.parent?this.parent._root():this},Lt.prototype.waitFor=function(o){var a,u=this._root(),h=X.resolve(o),y=(u._waitingFor?u._waitingFor=u._waitingFor.then(function(){return h}):(u._waitingFor=h,u._waitingQueue=[],a=u.idbtrans.objectStore(u.storeNames[0]),(function v(){for(++u._spinCount;u._waitingQueue.length;)u._waitingQueue.shift()();u._waitingFor&&(a.get(-1/0).onsuccess=v)})()),u._waitingFor);return new X(function(v,w){h.then(function(k){return u._waitingQueue.push(Ke(v.bind(null,k)))},function(k){return u._waitingQueue.push(Ke(w.bind(null,k)))}).finally(function(){u._waitingFor===y&&(u._waitingFor=null)})})},Lt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new G.Abort))},Lt.prototype.table=function(o){var a=this._memoizedTables||(this._memoizedTables={});if(p(a,o))return a[o];var u=this.schema[o];if(u)return(u=new this.db.Table(o,u,this)).core=this.db.core.table(o),a[o]=u;throw new G.NotFound("Table "+o+" not part of transaction")},Lt);function Lt(){}function oo(o,a,u,h,y,v,w,k){return{name:o,keyPath:a,unique:u,multi:h,auto:y,compound:v,src:(u&&!w?"&":"")+(h?"*":"")+(y?"++":"")+vc(a),type:k}}function vc(o){return typeof o=="string"?o:o?"["+[].join.call(o,"+")+"]":""}function ao(o,a,u){return{name:o,primKey:a,indexes:u,mappedClass:null,idxByName:(h=function(y){return[y.name,y]},u.reduce(function(y,v,w){return v=h(v,w),v&&(y[v[0]]=v[1]),y},{}))};var h}var Pr=function(o){try{return o.only([[]]),Pr=function(){return[[]]},[[]]}catch{return Pr=function(){return An},An}};function co(o){return o==null?function(){}:typeof o=="string"?(a=o).split(".").length===1?function(u){return u[a]}:function(u){return ie(u,a)}:function(u){return ie(u,o)};var a}function bc(o){return[].slice.call(o)}var Md=0;function jr(o){return o==null?":id":typeof o=="string"?o:"[".concat(o.join("+"),"]")}function Nd(o,a,O){function h(A){if(A.type===3)return null;if(A.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var C=A.lower,D=A.upper,T=A.lowerOpen,A=A.upperOpen;return C===void 0?D===void 0?null:a.upperBound(D,!!A):D===void 0?a.lowerBound(C,!!T):a.bound(C,D,!!T,!!A)}function y(I){var C,D=I.name;return{name:D,schema:I,mutate:function(T){var A=T.trans,E=T.type,j=T.keys,L=T.values,R=T.range;return new Promise(function(B,F){B=Ke(B);var z=A.objectStore(D),Y=z.keyPath==null,$=E==="put"||E==="add";if(!$&&E!=="delete"&&E!=="deleteRange")throw new Error("Invalid operation type: "+E);var se,te=(j||L||{length:1}).length;if(j&&L&&j.length!==L.length)throw new Error("Given keys array must have same length as given values array.");if(te===0)return B({numFailures:0,failures:{},results:[],lastResult:void 0});function W($e){++Te,Tr($e)}var oe=[],Ee=[],Te=0;if(E==="deleteRange"){if(R.type===4)return B({numFailures:Te,failures:Ee,results:[],lastResult:void 0});R.type===3?oe.push(se=z.clear()):oe.push(se=z.delete(h(R)))}else{var Y=$?Y?[L,j]:[L,null]:[j,null],ye=Y[0],_e=Y[1];if($)for(var Fe=0;Fe<te;++Fe)oe.push(se=_e&&_e[Fe]!==void 0?z[E](ye[Fe],_e[Fe]):z[E](ye[Fe])),se.onerror=W;else for(Fe=0;Fe<te;++Fe)oe.push(se=z[E](ye[Fe])),se.onerror=W}function Ct($e){$e=$e.target.result,oe.forEach(function(Pn,Oo){return Pn.error!=null&&(Ee[Oo]=Pn.error)}),B({numFailures:Te,failures:Ee,results:E==="delete"?j:oe.map(function(Pn){return Pn.result}),lastResult:$e})}se.onerror=function($e){W($e),Ct($e)},se.onsuccess=Ct})},getMany:function(T){var A=T.trans,E=T.keys;return new Promise(function(j,L){j=Ke(j);for(var R,B=A.objectStore(D),F=E.length,z=new Array(F),Y=0,$=0,se=function(oe){oe=oe.target,z[oe._pos]=oe.result,++$===Y&&j(z)},te=Ut(L),W=0;W<F;++W)E[W]!=null&&((R=B.get(E[W]))._pos=W,R.onsuccess=se,R.onerror=te,++Y);Y===0&&j(z)})},get:function(T){var A=T.trans,E=T.key;return new Promise(function(j,L){j=Ke(j);var R=A.objectStore(D).get(E);R.onsuccess=function(B){return j(B.target.result)},R.onerror=Ut(L)})},query:(C=k,function(T){return new Promise(function(A,E){A=Ke(A);var j,L,R,$=T.trans,B=T.values,F=T.limit,Y=T.query,z=F===1/0?void 0:F,se=Y.index,Y=Y.range,$=$.objectStore(D),$=se.isPrimaryKey?$:$.index(se.name),se=h(Y);if(F===0)return A({result:[]});C?((Y=B?$.getAll(se,z):$.getAllKeys(se,z)).onsuccess=function(te){return A({result:te.target.result})},Y.onerror=Ut(E)):(j=0,L=!B&&"openKeyCursor"in $?$.openKeyCursor(se):$.openCursor(se),R=[],L.onsuccess=function(te){var W=L.result;return!W||(R.push(B?W.value:W.primaryKey),++j===F)?A({result:R}):void W.continue()},L.onerror=Ut(E))})}),openCursor:function(T){var A=T.trans,E=T.values,j=T.query,L=T.reverse,R=T.unique;return new Promise(function(B,F){B=Ke(B);var $=j.index,z=j.range,Y=A.objectStore(D),Y=$.isPrimaryKey?Y:Y.index($.name),$=L?R?"prevunique":"prev":R?"nextunique":"next",se=!E&&"openKeyCursor"in Y?Y.openKeyCursor(h(z),$):Y.openCursor(h(z),$);se.onerror=Ut(F),se.onsuccess=Ke(function(te){var W,oe,Ee,Te,ye=se.result;ye?(ye.___id=++Md,ye.done=!1,W=ye.continue.bind(ye),oe=(oe=ye.continuePrimaryKey)&&oe.bind(ye),Ee=ye.advance.bind(ye),Te=function(){throw new Error("Cursor not stopped")},ye.trans=A,ye.stop=ye.continue=ye.continuePrimaryKey=ye.advance=function(){throw new Error("Cursor not started")},ye.fail=Ke(F),ye.next=function(){var _e=this,Fe=1;return this.start(function(){return Fe--?_e.continue():_e.stop()}).then(function(){return _e})},ye.start=function(_e){function Fe(){if(se.result)try{_e()}catch($e){ye.fail($e)}else ye.done=!0,ye.start=function(){throw new Error("Cursor behind last entry")},ye.stop()}var Ct=new Promise(function($e,Pn){$e=Ke($e),se.onerror=Ut(Pn),ye.fail=Pn,ye.stop=function(Oo){ye.stop=ye.continue=ye.continuePrimaryKey=ye.advance=Te,$e(Oo)}});return se.onsuccess=Ke(function($e){se.onsuccess=Fe,Fe()}),ye.continue=W,ye.continuePrimaryKey=oe,ye.advance=Ee,Fe(),Ct},B(ye)):B(null)},F)})},count:function(T){var A=T.query,E=T.trans,j=A.index,L=A.range;return new Promise(function(R,B){var F=E.objectStore(D),F=j.isPrimaryKey?F:F.index(j.name),z=h(L),z=z?F.count(z):F.count();z.onsuccess=Ke(function(Y){return R(Y.target.result)}),z.onerror=Ut(B)})}}}v=O,w=bc((O=o).objectStoreNames);var v,O={schema:{name:O.name,tables:w.map(function(I){return v.objectStore(I)}).map(function(I){var C=I.keyPath,D=I.autoIncrement,A=l(C),T={},A={name:I.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:C==null,compound:A,keyPath:C,autoIncrement:D,unique:!0,extractKey:co(C)},indexes:bc(I.indexNames).map(function(E){return I.index(E)}).map(function(R){var B=R.name,j=R.unique,L=R.multiEntry,R=R.keyPath,B={name:B,compound:l(R),keyPath:R,unique:j,multiEntry:L,extractKey:co(R)};return T[jr(R)]=B}),getIndexByKeyPath:function(E){return T[jr(E)]}};return T[":id"]=A.primaryKey,C!=null&&(T[jr(C)]=A.primaryKey),A})},hasGetAll:0<w.length&&"getAll"in v.objectStore(w[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},w=O.schema,k=O.hasGetAll,O=w.tables.map(y),P={};return O.forEach(function(I){return P[I.name]=I}),{stack:"dbcore",transaction:o.transaction.bind(o),table:function(I){if(P[I])return P[I];throw new Error("Table '".concat(I,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Pr(a),schema:w}}function Kd(o,a,u,h){return u=u.IDBKeyRange,a=Nd(a,u,h),{dbcore:o.dbcore.reduce(function(y,v){return v=v.create,r(r({},y),v(y))},a)}}function Pi(o,a){var u=a.db,u=Kd(o._middlewares,u,o._deps,a);o.core=u.dbcore,o.tables.forEach(function(h){var y=h.name;o.core.schema.tables.some(function(v){return v.name===y})&&(h.core=o.core.table(y),o[y]instanceof o.Table)&&(o[y].core=h.core)})}function ji(o,a,u,h){u.forEach(function(y){var v=h[y];a.forEach(function(w){var k=(function O(P,I){return N(P,I)||(P=f(P))&&O(P,I)})(w,y);(!k||"value"in k&&k.value===void 0)&&(w===o.Transaction.prototype||w instanceof o.Transaction?S(w,y,{get:function(){return this.table(y)},set:function(O){b(this,y,{value:O,writable:!0,configurable:!0,enumerable:!0})}}):w[y]=new o.Table(y,v))})})}function lo(o,a){a.forEach(function(u){for(var h in u)u[h]instanceof o.Table&&delete u[h]})}function Bd(o,a){return o._cfg.version-a._cfg.version}function Fd(o,a,u,h){var y=o._dbSchema,v=(u.objectStoreNames.contains("$meta")&&!y.$meta&&(y.$meta=ao("$meta",_c("")[0],[]),o._storeNames.push("$meta")),o._createTransaction("readwrite",o._storeNames,y)),w=(v.create(u),v._completion.catch(h),v._reject.bind(v)),k=fe.transless||fe;cn(function(){if(fe.trans=v,fe.transless=k,a!==0)return Pi(o,u),P=a,((O=v).storeNames.includes("$meta")?O.table("$meta").get("version").then(function(I){return I??P}):X.resolve(P)).then(function(j){var C=o,D=j,T=v,A=u,E=[],j=C._versions,L=C._dbSchema=Li(0,C.idbdb,A);return(j=j.filter(function(R){return R._cfg.version>=D})).length===0?X.resolve():(j.forEach(function(R){E.push(function(){var B,F,z,Y=L,$=R._cfg.dbschema,se=(Mi(C,Y,A),Mi(C,$,A),L=C._dbSchema=$,uo(Y,$)),te=(se.add.forEach(function(W){fo(A,W[0],W[1].primKey,W[1].indexes)}),se.change.forEach(function(W){if(W.recreate)throw new G.Upgrade("Not yet support for changing primary key");var oe=A.objectStore(W.name);W.add.forEach(function(Ee){return Ui(oe,Ee)}),W.change.forEach(function(Ee){oe.deleteIndex(Ee.name),Ui(oe,Ee)}),W.del.forEach(function(Ee){return oe.deleteIndex(Ee)})}),R._cfg.contentUpgrade);if(te&&R._cfg.version>D)return Pi(C,A),T._memoizedTables={},B=he($),se.del.forEach(function(W){B[W]=Y[W]}),lo(C,[C.Transaction.prototype]),ji(C,[C.Transaction.prototype],c(B),B),T.schema=B,(F=pe(te))&&zn(),$=X.follow(function(){var W;(z=te(T))&&F&&(W=ln.bind(null,null),z.then(W,W))}),z&&typeof z.then=="function"?X.resolve(z):$.then(function(){return z})}),E.push(function(B){var F,z,Y=R._cfg.dbschema;F=Y,z=B,[].slice.call(z.db.objectStoreNames).forEach(function($){return F[$]==null&&z.db.deleteObjectStore($)}),lo(C,[C.Transaction.prototype]),ji(C,[C.Transaction.prototype],C._storeNames,C._dbSchema),T.schema=C._dbSchema}),E.push(function(B){C.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(C.idbdb.version/10)===R._cfg.version?(C.idbdb.deleteObjectStore("$meta"),delete C._dbSchema.$meta,C._storeNames=C._storeNames.filter(function(F){return F!=="$meta"})):B.objectStore("$meta").put(R._cfg.version,"version"))})}),(function R(){return E.length?X.resolve(E.shift()(T.idbtrans)).then(R):X.resolve()})().then(function(){wc(L,A)}))}).catch(w);var O,P;c(y).forEach(function(I){fo(u,I,y[I].primKey,y[I].indexes)}),Pi(o,u),X.follow(function(){return o.on.populate.fire(v)}).catch(w)})}function $d(o,a){wc(o._dbSchema,a),a.db.version%10!=0||a.objectStoreNames.contains("$meta")||a.db.createObjectStore("$meta").add(Math.ceil(a.db.version/10-1),"version");var u=Li(0,o.idbdb,a);Mi(o,o._dbSchema,a);for(var h=0,y=uo(u,o._dbSchema).change;h<y.length;h++){var v=(w=>{if(w.change.length||w.recreate)return console.warn("Unable to patch indexes of table ".concat(w.name," because it has changes on the type of index or primary key.")),{value:void 0};var k=a.objectStore(w.name);w.add.forEach(function(O){jt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(w.name,".").concat(O.src)),Ui(k,O)})})(y[h]);if(typeof v=="object")return v.value}}function uo(o,a){var u,h={del:[],add:[],change:[]};for(u in o)a[u]||h.del.push(u);for(u in a){var y=o[u],v=a[u];if(y){var w={name:u,def:v,recreate:!1,del:[],add:[],change:[]};if(""+(y.primKey.keyPath||"")!=""+(v.primKey.keyPath||"")||y.primKey.auto!==v.primKey.auto)w.recreate=!0,h.change.push(w);else{var k=y.idxByName,O=v.idxByName,P=void 0;for(P in k)O[P]||w.del.push(P);for(P in O){var I=k[P],C=O[P];I?I.src!==C.src&&w.change.push(C):w.add.push(C)}(0<w.del.length||0<w.add.length||0<w.change.length)&&h.change.push(w)}}else h.add.push([u,v])}return h}function fo(o,a,u,h){var y=o.db.createObjectStore(a,u.keyPath?{keyPath:u.keyPath,autoIncrement:u.auto}:{autoIncrement:u.auto});h.forEach(function(v){return Ui(y,v)})}function wc(o,a){c(o).forEach(function(u){a.db.objectStoreNames.contains(u)||(jt&&console.debug("Dexie: Creating missing table",u),fo(a,u,o[u].primKey,o[u].indexes))})}function Ui(o,a){o.createIndex(a.name,a.keyPath,{unique:a.unique,multiEntry:a.multi})}function Li(o,a,u){var h={};return M(a.objectStoreNames,0).forEach(function(y){for(var v=u.objectStore(y),w=oo(vc(P=v.keyPath),P||"",!0,!1,!!v.autoIncrement,P&&typeof P!="string",!0),k=[],O=0;O<v.indexNames.length;++O){var I=v.index(v.indexNames[O]),P=I.keyPath,I=oo(I.name,P,!!I.unique,!!I.multiEntry,!1,P&&typeof P!="string",!1);k.push(I)}h[y]=ao(y,w,k)}),h}function Mi(o,a,u){for(var h=u.db.objectStoreNames,y=0;y<h.length;++y){var v=h[y],w=u.objectStore(v);o._hasGetAll="getAll"in w;for(var k=0;k<w.indexNames.length;++k){var O,P=w.indexNames[k],I=w.index(P).keyPath,I=typeof I=="string"?I:"["+M(I).join("+")+"]";a[v]&&(O=a[v].idxByName[I])&&(O.name=P,delete a[v].idxByName[I],a[v].idxByName[P]=O)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(o._hasGetAll=!1)}function _c(o){return o.split(",").map(function(a,u){var y=a.split(":"),h=(h=y[1])==null?void 0:h.trim(),y=(a=y[0].trim()).replace(/([&*]|\+\+)/g,""),v=/^\[/.test(y)?y.match(/^\[(.*)\]$/)[1].split("+"):y;return oo(y,v||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),l(v),u===0,h)})}Xn.prototype._createTableSchema=ao,Xn.prototype._parseIndexSyntax=_c,Xn.prototype._parseStoresSpec=function(o,a){var u=this;c(o).forEach(function(h){if(o[h]!==null){var y=u._parseIndexSyntax(o[h]),v=y.shift();if(!v)throw new G.Schema("Invalid schema for table "+h+": "+o[h]);if(v.unique=!0,v.multi)throw new G.Schema("Primary key cannot be multiEntry*");y.forEach(function(w){if(w.auto)throw new G.Schema("Only primary key can be marked as autoIncrement (++)");if(!w.keyPath)throw new G.Schema("Index must have a name and cannot be an empty string")}),v=u._createTableSchema(h,v,y),a[h]=v}})},Xn.prototype.stores=function(u){var a=this.db,u=(this._cfg.storesSource=this._cfg.storesSource?d(this._cfg.storesSource,u):u,a._versions),h={},y={};return u.forEach(function(v){d(h,v._cfg.storesSource),y=v._cfg.dbschema={},v._parseStoresSpec(h,y)}),a._dbSchema=y,lo(a,[a._allTables,a,a.Transaction.prototype]),ji(a,[a._allTables,a,a.Transaction.prototype,this._cfg.tables],c(y),y),a._storeNames=c(y),this},Xn.prototype.upgrade=function(o){return this._cfg.contentUpgrade=Hs(this._cfg.contentUpgrade||ge,o),this};var qd=Xn;function Xn(){}function ho(o,a){var u=o._dbNamesDB;return u||(u=o._dbNamesDB=new zt(Oi,{addons:[],indexedDB:o,IDBKeyRange:a})).version(1).stores({dbnames:"name"}),u.table("dbnames")}function po(o){return o&&typeof o.databases=="function"}function yo(o){return cn(function(){return fe.letThrough=!0,o()})}function go(o){return!("from"in o)}var lt=function(o,a){var u;if(!this)return u=new lt,o&&"d"in o&&d(u,o),u;d(this,arguments.length?{d:1,from:o,to:1<arguments.length?a:o}:{d:0})};function Ur(o,a,u){var h=xe(a,u);if(!isNaN(h)){if(0<h)throw RangeError();if(go(o))return d(o,{from:a,to:u,d:1});var h=o.l,y=o.r;if(xe(u,o.from)<0)return h?Ur(h,a,u):o.l={from:a,to:u,d:1,l:null,r:null},Sc(o);if(0<xe(a,o.to))return y?Ur(y,a,u):o.r={from:a,to:u,d:1,l:null,r:null},Sc(o);xe(a,o.from)<0&&(o.from=a,o.l=null,o.d=y?y.d+1:1),0<xe(u,o.to)&&(o.to=u,o.r=null,o.d=o.l?o.l.d+1:1),a=!o.r,h&&!o.l&&Lr(o,h),y&&a&&Lr(o,y)}}function Lr(o,a){go(a)||(function u(h,y){var v=y.from,w=y.l,k=y.r;Ur(h,v,y.to),w&&u(h,w),k&&u(h,k)})(o,a)}function kc(o,a){var u=Ni(a),h=u.next();if(!h.done)for(var y=h.value,v=Ni(o),w=v.next(y.from),k=w.value;!h.done&&!w.done;){if(xe(k.from,y.to)<=0&&0<=xe(k.to,y.from))return!0;xe(y.from,k.from)<0?y=(h=u.next(k.from)).value:k=(w=v.next(y.from)).value}return!1}function Ni(o){var a=go(o)?null:{s:0,n:o};return{next:function(u){for(var h=0<arguments.length;a;)switch(a.s){case 0:if(a.s=1,h)for(;a.n.l&&xe(u,a.n.from)<0;)a={up:a,n:a.n.l,s:1};else for(;a.n.l;)a={up:a,n:a.n.l,s:1};case 1:if(a.s=2,!h||xe(u,a.n.to)<=0)return{value:a.n,done:!1};case 2:if(a.n.r){a.s=3,a={up:a,n:a.n.r,s:0};continue}case 3:a=a.up}return{done:!0}}}}function Sc(o){var a,u,h,y=(((y=o.r)==null?void 0:y.d)||0)-(((y=o.l)==null?void 0:y.d)||0),y=1<y?"r":y<-1?"l":"";y&&(a=y=="r"?"l":"r",u=r({},o),h=o[y],o.from=h.from,o.to=h.to,o[y]=h[y],u[y]=h[a],(o[a]=u).d=xc(u)),o.d=xc(o)}function xc(u){var a=u.r,u=u.l;return(a?u?Math.max(a.d,u.d):a.d:u?u.d:0)+1}function Ki(o,a){return c(a).forEach(function(u){o[u]?Lr(o[u],a[u]):o[u]=(function h(y){var v,w,k={};for(v in y)p(y,v)&&(w=y[v],k[v]=!w||typeof w!="object"||re.has(w.constructor)?w:h(w));return k})(a[u])}),o}function mo(o,a){return o.all||a.all||Object.keys(o).some(function(u){return a[u]&&kc(a[u],o[u])})}m(lt.prototype,((mt={add:function(o){return Lr(this,o),this},addKey:function(o){return Ur(this,o,o),this},addKeys:function(o){var a=this;return o.forEach(function(u){return Ur(a,u,u)}),this},hasKey:function(o){var a=Ni(this).next(o).value;return a&&xe(a.from,o)<=0&&0<=xe(a.to,o)}})[le]=function(){return Ni(this)},mt));var Tn={},vo={},bo=!1;function Bi(o){Ki(vo,o),bo||(bo=!0,setTimeout(function(){bo=!1,wo(vo,!(vo={}))},0))}function wo(o,a){a===void 0&&(a=!1);var u=new Set;if(o.all)for(var h=0,y=Object.values(Tn);h<y.length;h++)Cc(k=y[h],o,u,a);else for(var v in o){var w,k,v=/^idb\:\/\/(.*)\/(.*)\//.exec(v);v&&(w=v[1],v=v[2],k=Tn["idb://".concat(w,"/").concat(v)])&&Cc(k,o,u,a)}u.forEach(function(O){return O()})}function Cc(o,a,u,h){for(var y=[],v=0,w=Object.entries(o.queries.query);v<w.length;v++){for(var k=w[v],O=k[0],P=[],I=0,C=k[1];I<C.length;I++){var D=C[I];mo(a,D.obsSet)?D.subscribers.forEach(function(j){return u.add(j)}):h&&P.push(D)}h&&y.push([O,P])}if(h)for(var T=0,A=y;T<A.length;T++){var E=A[T],O=E[0],P=E[1];o.queries.query[O]=P}}function Wd(o){var a=o._state,u=o._deps.indexedDB;if(a.isBeingOpened||o.idbdb)return a.dbReadyPromise.then(function(){return a.dbOpenError?We(a.dbOpenError):o});a.isBeingOpened=!0,a.dbOpenError=null,a.openComplete=!1;var h=a.openCanceller,y=Math.round(10*o.verno),v=!1;function w(){if(a.openCanceller!==h)throw new G.DatabaseClosed("db.open() was cancelled")}function k(){return new X(function(D,T){if(w(),!u)throw new G.MissingAPI;var A=o.name,E=a.autoSchema||!y?u.open(A):u.open(A,y);if(!E)throw new G.MissingAPI;E.onerror=Ut(T),E.onblocked=Ke(o._fireOnBlocked),E.onupgradeneeded=Ke(function(j){var L;I=E.transaction,a.autoSchema&&!o._options.allowEmptyDB?(E.onerror=Tr,I.abort(),E.result.close(),(L=u.deleteDatabase(A)).onsuccess=L.onerror=Ke(function(){T(new G.NoSuchDatabase("Database ".concat(A," doesnt exist")))})):(I.onerror=Ut(T),L=j.oldVersion>Math.pow(2,62)?0:j.oldVersion,C=L<1,o.idbdb=E.result,v&&$d(o,I),Fd(o,L/10,I,T))},T),E.onsuccess=Ke(function(){I=null;var j,L,R,B,F,z,Y=o.idbdb=E.result,$=M(Y.objectStoreNames);if(0<$.length)try{var se=Y.transaction((F=$).length===1?F[0]:F,"readonly");if(a.autoSchema)z=Y,B=se,(R=o).verno=z.version/10,B=R._dbSchema=Li(0,z,B),R._storeNames=M(z.objectStoreNames,0),ji(R,[R._allTables],c(B),B);else if(Mi(o,o._dbSchema,se),L=se,((L=uo(Li(0,(j=o).idbdb,L),j._dbSchema)).add.length||L.change.some(function(te){return te.add.length||te.change.length}))&&!v)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Y.close(),y=Y.version+1,v=!0,D(k());Pi(o,se)}catch{}Yn.push(o),Y.onversionchange=Ke(function(te){a.vcFired=!0,o.on("versionchange").fire(te)}),Y.onclose=Ke(function(){o.close({disableAutoOpen:!1})}),C&&($=o._deps,F=A,po(z=$.indexedDB)||F===Oi||ho(z,$.IDBKeyRange).put({name:F}).catch(ge)),D()},T)}).catch(function(D){switch(D==null?void 0:D.name){case"UnknownError":if(0<a.PR1398_maxLoop)return a.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),k();break;case"VersionError":if(0<y)return y=0,k()}return X.reject(D)})}var O,P=a.dbReadyResolve,I=null,C=!1;return X.race([h,(typeof navigator>"u"?X.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(D){function T(){return indexedDB.databases().finally(D)}O=setInterval(T,100),T()}).finally(function(){return clearInterval(O)}):Promise.resolve()).then(k)]).then(function(){return w(),a.onReadyBeingFired=[],X.resolve(yo(function(){return o.on.ready.fire(o.vip)})).then(function D(){var T;if(0<a.onReadyBeingFired.length)return T=a.onReadyBeingFired.reduce(Hs,ge),a.onReadyBeingFired=[],X.resolve(yo(function(){return T(o.vip)})).then(D)})}).finally(function(){a.openCanceller===h&&(a.onReadyBeingFired=null,a.isBeingOpened=!1)}).catch(function(D){a.dbOpenError=D;try{I&&I.abort()}catch{}return h===a.openCanceller&&o._close(),We(D)}).finally(function(){a.openComplete=!0,P()}).then(function(){var D;return C&&(D={},o.tables.forEach(function(T){T.schema.indexes.forEach(function(A){A.name&&(D["idb://".concat(o.name,"/").concat(T.name,"/").concat(A.name)]=new lt(-1/0,[[[]]]))}),D["idb://".concat(o.name,"/").concat(T.name,"/")]=D["idb://".concat(o.name,"/").concat(T.name,"/:dels")]=new lt(-1/0,[[[]]])}),dn(Rr).fire(D),wo(D,!0)),o})}function _o(o){function a(v){return o.next(v)}var u=y(a),h=y(function(v){return o.throw(v)});function y(v){return function(k){var k=v(k),O=k.value;return k.done?O:O&&typeof O.then=="function"?O.then(u,h):l(O)?Promise.all(O).then(u,h):u(O)}}return y(a)()}function Fi(o,a,u){for(var h=l(o)?o.slice():[o],y=0;y<u;++y)h.push(a);return h}var Vd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(o){return r(r({},o),{table:function(h){var u=o.table(h),h=u.schema,y={},v=[];function w(D,T,A){var R=jr(D),E=y[R]=y[R]||[],j=D==null?0:typeof D=="string"?1:D.length,L=0<T,R=r(r({},A),{name:L?"".concat(R,"(virtual-from:").concat(A.name,")"):A.name,lowLevelIndex:A,isVirtual:L,keyTail:T,keyLength:j,extractKey:co(D),unique:!L&&A.unique});return E.push(R),R.isPrimaryKey||v.push(R),1<j&&w(j===2?D[0]:D.slice(0,j-1),T+1,A),E.sort(function(B,F){return B.keyTail-F.keyTail}),R}var k=w(h.primaryKey.keyPath,0,h.primaryKey);y[":id"]=[k];for(var O=0,P=h.indexes;O<P.length;O++){var I=P[O];w(I.keyPath,0,I)}function C(D){var T,A=D.query.index;return A.isVirtual?r(r({},D),{query:{index:A.lowLevelIndex,range:(T=D.query.range,A=A.keyTail,{type:T.type===1?2:T.type,lower:Fi(T.lower,T.lowerOpen?o.MAX_KEY:o.MIN_KEY,A),lowerOpen:!0,upper:Fi(T.upper,T.upperOpen?o.MIN_KEY:o.MAX_KEY,A),upperOpen:!0})}}):D}return r(r({},u),{schema:r(r({},h),{primaryKey:k,indexes:v,getIndexByKeyPath:function(D){return(D=y[jr(D)])&&D[0]}}),count:function(D){return u.count(C(D))},query:function(D){return u.query(C(D))},openCursor:function(D){var T=D.query.index,A=T.keyTail,E=T.keyLength;return T.isVirtual?u.openCursor(C(D)).then(function(L){return L&&j(L)}):u.openCursor(D);function j(L){return Object.create(L,{continue:{value:function(R){R!=null?L.continue(Fi(R,D.reverse?o.MAX_KEY:o.MIN_KEY,A)):D.unique?L.continue(L.key.slice(0,E).concat(D.reverse?o.MIN_KEY:o.MAX_KEY,A)):L.continue()}},continuePrimaryKey:{value:function(R,B){L.continuePrimaryKey(Fi(R,o.MAX_KEY,A),B)}},primaryKey:{get:function(){return L.primaryKey}},key:{get:function(){var R=L.key;return E===1?R[0]:R.slice(0,E)}},value:{get:function(){return L.value}}})}}})}})}};function ko(o,a,u,h){return u=u||{},h=h||"",c(o).forEach(function(y){var v,w,k;p(a,y)?(v=o[y],w=a[y],typeof v=="object"&&typeof w=="object"&&v&&w?(k=ve(v))!==ve(w)?u[h+y]=a[y]:k==="Object"?ko(v,w,u,h+y+"."):v!==w&&(u[h+y]=a[y]):v!==w&&(u[h+y]=a[y])):u[h+y]=void 0}),c(a).forEach(function(y){p(o,y)||(u[h+y]=a[y])}),u}function So(o,a){return a.type==="delete"?a.keys:a.keys||a.values.map(o.extractKey)}var Hd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(o){return r(r({},o),{table:function(a){var u=o.table(a),h=u.schema.primaryKey;return r(r({},u),{mutate:function(y){var v=fe.trans,w=v.table(a).hook,k=w.deleting,O=w.creating,P=w.updating;switch(y.type){case"add":if(O.fire===ge)break;return v._promise("readwrite",function(){return I(y)},!0);case"put":if(O.fire===ge&&P.fire===ge)break;return v._promise("readwrite",function(){return I(y)},!0);case"delete":if(k.fire===ge)break;return v._promise("readwrite",function(){return I(y)},!0);case"deleteRange":if(k.fire===ge)break;return v._promise("readwrite",function(){return(function C(D,T,A){return u.query({trans:D,values:!1,query:{index:h,range:T},limit:A}).then(function(E){var j=E.result;return I({type:"delete",keys:j,trans:D}).then(function(L){return 0<L.numFailures?Promise.reject(L.failures[0]):j.length<A?{failures:[],numFailures:0,lastResult:void 0}:C(D,r(r({},T),{lower:j[j.length-1],lowerOpen:!0}),A)})})})(y.trans,y.range,1e4)},!0)}return u.mutate(y);function I(C){var D,T,A,E=fe.trans,j=C.keys||So(h,C);if(j)return(C=C.type==="add"||C.type==="put"?r(r({},C),{keys:j}):r({},C)).type!=="delete"&&(C.values=i([],C.values)),C.keys&&(C.keys=i([],C.keys)),D=u,A=j,((T=C).type==="add"?Promise.resolve([]):D.getMany({trans:T.trans,keys:A,cache:"immutable"})).then(function(L){var R=j.map(function(B,F){var z,Y,$,se=L[F],te={onerror:null,onsuccess:null};return C.type==="delete"?k.fire.call(te,B,se,E):C.type==="add"||se===void 0?(z=O.fire.call(te,B,C.values[F],E),B==null&&z!=null&&(C.keys[F]=B=z,h.outbound||Z(C.values[F],h.keyPath,B))):(z=ko(se,C.values[F]),(Y=P.fire.call(te,z,B,se,E))&&($=C.values[F],Object.keys(Y).forEach(function(W){p($,W)?$[W]=Y[W]:Z($,W,Y[W])}))),te});return u.mutate(C).then(function(B){for(var F=B.failures,z=B.results,Y=B.numFailures,B=B.lastResult,$=0;$<j.length;++$){var se=(z||j)[$],te=R[$];se==null?te.onerror&&te.onerror(F[$]):te.onsuccess&&te.onsuccess(C.type==="put"&&L[$]?C.values[$]:se)}return{failures:F,results:z,numFailures:Y,lastResult:B}}).catch(function(B){return R.forEach(function(F){return F.onerror&&F.onerror(B)}),Promise.reject(B)})});throw new Error("Keys missing")}}})}})}};function Ec(o,a,u){try{if(!a||a.keys.length<o.length)return null;for(var h=[],y=0,v=0;y<a.keys.length&&v<o.length;++y)xe(a.keys[y],o[v])===0&&(h.push(u?ee(a.values[y]):a.values[y]),++v);return h.length===o.length?h:null}catch{return null}}var zd={stack:"dbcore",level:-1,create:function(o){return{table:function(a){var u=o.table(a);return r(r({},u),{getMany:function(h){var y;return h.cache?(y=Ec(h.keys,h.trans._cache,h.cache==="clone"))?X.resolve(y):u.getMany(h).then(function(v){return h.trans._cache={keys:h.keys,values:h.cache==="clone"?ee(v):v},v}):u.getMany(h)},mutate:function(h){return h.type!=="add"&&(h.trans._cache=null),u.mutate(h)}})}}}};function Oc(o,a){return o.trans.mode==="readonly"&&!!o.subscr&&!o.trans.explicit&&o.trans.db._options.cache!=="disabled"&&!a.schema.primaryKey.outbound}function Ic(o,a){switch(o){case"query":return a.values&&!a.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Yd={stack:"dbcore",level:0,name:"Observability",create:function(o){var a=o.schema.name,u=new lt(o.MIN_KEY,o.MAX_KEY);return r(r({},o),{transaction:function(h,y,v){if(fe.subscr&&y!=="readonly")throw new G.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(fe.querier));return o.transaction(h,y,v)},table:function(h){function y(j){var E,j=j.query;return[E=j.index,new lt((E=(j=j.range).lower)!=null?E:o.MIN_KEY,(E=j.upper)!=null?E:o.MAX_KEY)]}var v=o.table(h),w=v.schema,k=w.primaryKey,O=w.indexes,P=k.extractKey,I=k.outbound,C=k.autoIncrement&&O.filter(function(A){return A.compound&&A.keyPath.includes(k.keyPath)}),D=r(r({},v),{mutate:function(A){function E(oe){return oe="idb://".concat(a,"/").concat(h,"/").concat(oe),F[oe]||(F[oe]=new lt)}var j,L,R,B=A.trans,F=A.mutatedParts||(A.mutatedParts={}),z=E(""),Y=E(":dels"),$=A.type,te=A.type==="deleteRange"?[A.range]:A.type==="delete"?[A.keys]:A.values.length<50?[So(k,A).filter(function(oe){return oe}),A.values]:[],se=te[0],te=te[1],W=A.trans._cache;return l(se)?(z.addKeys(se),($=$==="delete"||se.length===te.length?Ec(se,W):null)||Y.addKeys(se),($||te)&&(j=E,L=$,R=te,w.indexes.forEach(function(oe){var Ee=j(oe.name||"");function Te(_e){return _e!=null?oe.extractKey(_e):null}function ye(_e){oe.multiEntry&&l(_e)?_e.forEach(function(Fe){return Ee.addKey(Fe)}):Ee.addKey(_e)}(L||R).forEach(function(_e,$e){var Ct=L&&Te(L[$e]),$e=R&&Te(R[$e]);xe(Ct,$e)!==0&&(Ct!=null&&ye(Ct),$e!=null)&&ye($e)})}))):se?(te={from:(W=se.lower)!=null?W:o.MIN_KEY,to:($=se.upper)!=null?$:o.MAX_KEY},Y.add(te),z.add(te)):(z.add(u),Y.add(u),w.indexes.forEach(function(oe){return E(oe.name).add(u)})),v.mutate(A).then(function(oe){return!se||A.type!=="add"&&A.type!=="put"||(z.addKeys(oe.results),C&&C.forEach(function(Ee){for(var Te=A.values.map(function(Ct){return Ee.extractKey(Ct)}),ye=Ee.keyPath.findIndex(function(Ct){return Ct===k.keyPath}),_e=0,Fe=oe.results.length;_e<Fe;++_e)Te[_e][ye]=oe.results[_e];E(Ee.name).addKeys(Te)})),B.mutatedParts=Ki(B.mutatedParts||{},F),oe})}}),T={get:function(A){return[k,new lt(A.key)]},getMany:function(A){return[k,new lt().addKeys(A.keys)]},count:y,query:y,openCursor:y};return c(T).forEach(function(A){D[A]=function(E){var j=fe.subscr,L=!!j,R=Oc(fe,v)&&Ic(A,E)?E.obsSet={}:j;if(L){var B,j=function(te){return te="idb://".concat(a,"/").concat(h,"/").concat(te),R[te]||(R[te]=new lt)},F=j(""),z=j(":dels"),L=T[A](E),Y=L[0],L=L[1];if((A==="query"&&Y.isPrimaryKey&&!E.values?z:j(Y.name||"")).add(L),!Y.isPrimaryKey){if(A!=="count")return B=A==="query"&&I&&E.values&&v.query(r(r({},E),{values:!1})),v[A].apply(this,arguments).then(function(te){if(A==="query"){if(I&&E.values)return B.then(function(Te){return Te=Te.result,F.addKeys(Te),te});var W=E.values?te.result.map(P):te.result;(E.values?F:z).addKeys(W)}else{var oe,Ee;if(A==="openCursor")return Ee=E.values,(oe=te)&&Object.create(oe,{key:{get:function(){return z.addKey(oe.primaryKey),oe.key}},primaryKey:{get:function(){var Te=oe.primaryKey;return z.addKey(Te),Te}},value:{get:function(){return Ee&&F.addKey(oe.primaryKey),oe.value}}})}return te});z.add(u)}}return v[A].apply(this,arguments)}}),D}})}};function Ac(o,a,u){var h;return u.numFailures===0?a:a.type==="deleteRange"||(h=a.keys?a.keys.length:"values"in a&&a.values?a.values.length:1,u.numFailures===h)?null:(h=r({},a),l(h.keys)&&(h.keys=h.keys.filter(function(y,v){return!(v in u.failures)})),"values"in h&&l(h.values)&&(h.values=h.values.filter(function(y,v){return!(v in u.failures)})),h)}function xo(o,a){return u=o,((h=a).lower===void 0||(h.lowerOpen?0<xe(u,h.lower):0<=xe(u,h.lower)))&&(u=o,(h=a).upper===void 0||(h.upperOpen?xe(u,h.upper)<0:xe(u,h.upper)<=0));var u,h}function Dc(o,a,u,h,y,v){var w,k,O,P,I,C;return!u||u.length===0||(w=a.query.index,k=w.multiEntry,O=a.query.range,P=h.schema.primaryKey.extractKey,I=w.extractKey,C=(w.lowLevelIndex||w).extractKey,(h=u.reduce(function(D,T){var A=D,E=[];if(T.type==="add"||T.type==="put")for(var j=new lt,L=T.values.length-1;0<=L;--L){var R,B=T.values[L],F=P(B);!j.hasKey(F)&&(R=I(B),k&&l(R)?R.some(function(te){return xo(te,O)}):xo(R,O))&&(j.addKey(F),E.push(B))}switch(T.type){case"add":var z=new lt().addKeys(a.values?D.map(function(W){return P(W)}):D),A=D.concat(a.values?E.filter(function(W){return W=P(W),!z.hasKey(W)&&(z.addKey(W),!0)}):E.map(function(W){return P(W)}).filter(function(W){return!z.hasKey(W)&&(z.addKey(W),!0)}));break;case"put":var Y=new lt().addKeys(T.values.map(function(W){return P(W)}));A=D.filter(function(W){return!Y.hasKey(a.values?P(W):W)}).concat(a.values?E:E.map(function(W){return P(W)}));break;case"delete":var $=new lt().addKeys(T.keys);A=D.filter(function(W){return!$.hasKey(a.values?P(W):W)});break;case"deleteRange":var se=T.range;A=D.filter(function(W){return!xo(P(W),se)})}return A},o))===o)?o:(h.sort(function(D,T){return xe(C(D),C(T))||xe(P(D),P(T))}),a.limit&&a.limit<1/0&&(h.length>a.limit?h.length=a.limit:o.length===a.limit&&h.length<a.limit&&(y.dirty=!0)),v?Object.freeze(h):h)}function Tc(o,a){return xe(o.lower,a.lower)===0&&xe(o.upper,a.upper)===0&&!!o.lowerOpen==!!a.lowerOpen&&!!o.upperOpen==!!a.upperOpen}function Gd(o,a){return((u,h,y,v)=>{if(u===void 0)return h!==void 0?-1:0;if(h===void 0)return 1;if((u=xe(u,h))===0){if(y&&v)return 0;if(y)return 1;if(v)return-1}return u})(o.lower,a.lower,o.lowerOpen,a.lowerOpen)<=0&&0<=((u,h,y,v)=>{if(u===void 0)return h!==void 0?1:0;if(h===void 0)return-1;if((u=xe(u,h))===0){if(y&&v)return 0;if(y)return-1;if(v)return 1}return u})(o.upper,a.upper,o.upperOpen,a.upperOpen)}function Jd(o,a,u,h){o.subscribers.add(u),h.addEventListener("abort",function(){var y,v;o.subscribers.delete(u),o.subscribers.size===0&&(y=o,v=a,setTimeout(function(){y.subscribers.size===0&&H(v,y)},3e3))})}var Xd={stack:"dbcore",level:0,name:"Cache",create:function(o){var a=o.schema.name;return r(r({},o),{transaction:function(u,h,y){var v,w,k=o.transaction(u,h,y);return h==="readwrite"&&(y=(v=new AbortController).signal,k.addEventListener("abort",(w=function(O){return function(){if(v.abort(),h==="readwrite"){for(var P=new Set,I=0,C=u;I<C.length;I++){var D=C[I],T=Tn["idb://".concat(a,"/").concat(D)];if(T){var A=o.table(D),E=T.optimisticOps.filter(function(oe){return oe.trans===k});if(k._explicit&&O&&k.mutatedParts)for(var j=0,L=Object.values(T.queries.query);j<L.length;j++)for(var R=0,B=(Y=L[j]).slice();R<B.length;R++)mo(($=B[R]).obsSet,k.mutatedParts)&&(H(Y,$),$.subscribers.forEach(function(oe){return P.add(oe)}));else if(0<E.length){T.optimisticOps=T.optimisticOps.filter(function(oe){return oe.trans!==k});for(var F=0,z=Object.values(T.queries.query);F<z.length;F++)for(var Y,$,se,te=0,W=(Y=z[F]).slice();te<W.length;te++)($=W[te]).res!=null&&k.mutatedParts&&(O&&!$.dirty?(se=Object.isFrozen($.res),se=Dc($.res,$.req,E,A,$,se),$.dirty?(H(Y,$),$.subscribers.forEach(function(oe){return P.add(oe)})):se!==$.res&&($.res=se,$.promise=X.resolve({result:se}))):($.dirty&&H(Y,$),$.subscribers.forEach(function(oe){return P.add(oe)})))}}}P.forEach(function(oe){return oe()})}}})(!1),{signal:y}),k.addEventListener("error",w(!1),{signal:y}),k.addEventListener("complete",w(!0),{signal:y})),k},table:function(u){var h=o.table(u),y=h.schema.primaryKey;return r(r({},h),{mutate:function(v){var w,k=fe.trans;return!y.outbound&&k.db._options.cache!=="disabled"&&!k.explicit&&k.idbtrans.mode==="readwrite"&&(w=Tn["idb://".concat(a,"/").concat(u)])?(k=h.mutate(v),v.type!=="add"&&v.type!=="put"||!(50<=v.values.length||So(y,v).some(function(O){return O==null}))?(w.optimisticOps.push(v),v.mutatedParts&&Bi(v.mutatedParts),k.then(function(O){0<O.numFailures&&(H(w.optimisticOps,v),(O=Ac(0,v,O))&&w.optimisticOps.push(O),v.mutatedParts)&&Bi(v.mutatedParts)}),k.catch(function(){H(w.optimisticOps,v),v.mutatedParts&&Bi(v.mutatedParts)})):k.then(function(O){var P=Ac(0,r(r({},v),{values:v.values.map(function(I,C){var D;return O.failures[C]?I:(Z(D=(D=y.keyPath)!=null&&D.includes(".")?ee(I):r({},I),y.keyPath,O.results[C]),D)})}),O);w.optimisticOps.push(P),queueMicrotask(function(){return v.mutatedParts&&Bi(v.mutatedParts)})}),k):h.mutate(v)},query:function(v){var w,k,O,P,I,C,D;return Oc(fe,h)&&Ic("query",v)?(w=((O=fe.trans)==null?void 0:O.db._options.cache)==="immutable",k=(O=fe).requery,O=O.signal,C=((T,A,E,j)=>{var L=Tn["idb://".concat(T,"/").concat(A)];if(!L)return[];if(!(T=L.queries[E]))return[null,!1,L,null];var R=T[(j.query?j.query.index.name:null)||""];if(!R)return[null,!1,L,null];switch(E){case"query":var B=R.find(function(F){return F.req.limit===j.limit&&F.req.values===j.values&&Tc(F.req.query.range,j.query.range)});return B?[B,!0,L,R]:[R.find(function(F){return("limit"in F.req?F.req.limit:1/0)>=j.limit&&(!j.values||F.req.values)&&Gd(F.req.query.range,j.query.range)}),!1,L,R];case"count":return B=R.find(function(F){return Tc(F.req.query.range,j.query.range)}),[B,!!B,L,R]}})(a,u,"query",v),D=C[0],P=C[2],I=C[3],D&&C[1]?D.obsSet=v.obsSet:(C=h.query(v).then(function(T){var A=T.result;if(D&&(D.res=A),w){for(var E=0,j=A.length;E<j;++E)Object.freeze(A[E]);Object.freeze(A)}else T.result=ee(A);return T}).catch(function(T){return I&&D&&H(I,D),Promise.reject(T)}),D={obsSet:v.obsSet,promise:C,subscribers:new Set,type:"query",req:v,dirty:!1},I?I.push(D):(I=[D],(P=P||(Tn["idb://".concat(a,"/").concat(u)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[v.query.index.name||""]=I)),Jd(D,I,k,O),D.promise.then(function(T){return{result:Dc(T.result,v,P==null?void 0:P.optimisticOps,h,D,w)}})):h.query(v)}})}})}};function $i(o,a){return new Proxy(o,{get:function(u,h,y){return h==="db"?a:Reflect.get(u,h,y)}})}Ve.prototype.version=function(o){if(isNaN(o)||o<.1)throw new G.Type("Given version is not a positive number");if(o=Math.round(10*o)/10,this.idbdb||this._state.isBeingOpened)throw new G.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,o);var a=this._versions,u=a.filter(function(h){return h._cfg.version===o})[0];return u||(u=new this.Version(o),a.push(u),a.sort(Bd),u.stores({}),this._state.autoSchema=!1),u},Ve.prototype._whenReady=function(o){var a=this;return this.idbdb&&(this._state.openComplete||fe.letThrough||this._vip)?o():new X(function(u,h){if(a._state.openComplete)return h(new G.DatabaseClosed(a._state.dbOpenError));if(!a._state.isBeingOpened){if(!a._state.autoOpen)return void h(new G.DatabaseClosed);a.open().catch(ge)}a._state.dbReadyPromise.then(u,h)}).then(o)},Ve.prototype.use=function(y){var a=y.stack,u=y.create,h=y.level,y=y.name,v=(y&&this.unuse({stack:a,name:y}),this._middlewares[a]||(this._middlewares[a]=[]));return v.push({stack:a,create:u,level:h??10,name:y}),v.sort(function(w,k){return w.level-k.level}),this},Ve.prototype.unuse=function(o){var a=o.stack,u=o.name,h=o.create;return a&&this._middlewares[a]&&(this._middlewares[a]=this._middlewares[a].filter(function(y){return h?y.create!==h:!!u&&y.name!==u})),this},Ve.prototype.open=function(){var o=this;return In(an,function(){return Wd(o)})},Ve.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var o=this._state,a=Yn.indexOf(this);if(0<=a&&Yn.splice(a,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}o.isBeingOpened||(o.dbReadyPromise=new X(function(u){o.dbReadyResolve=u}),o.openCanceller=new X(function(u,h){o.cancelOpen=h}))},Ve.prototype.close=function(a){var a=(a===void 0?{disableAutoOpen:!0}:a).disableAutoOpen,u=this._state;a?(u.isBeingOpened&&u.cancelOpen(new G.DatabaseClosed),this._close(),u.autoOpen=!1,u.dbOpenError=new G.DatabaseClosed):(this._close(),u.autoOpen=this._options.autoOpen||u.isBeingOpened,u.openComplete=!1,u.dbOpenError=null)},Ve.prototype.delete=function(o){var a=this,u=(o===void 0&&(o={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),h=this._state;return new X(function(y,v){function w(){a.close(o);var k=a._deps.indexedDB.deleteDatabase(a.name);k.onsuccess=Ke(function(){var O,P,I;O=a._deps,P=a.name,po(I=O.indexedDB)||P===Oi||ho(I,O.IDBKeyRange).delete(P).catch(ge),y()}),k.onerror=Ut(v),k.onblocked=a._fireOnBlocked}if(u)throw new G.InvalidArgument("Invalid closeOptions argument to db.delete()");h.isBeingOpened?h.dbReadyPromise.then(w):w()})},Ve.prototype.backendDB=function(){return this.idbdb},Ve.prototype.isOpen=function(){return this.idbdb!==null},Ve.prototype.hasBeenClosed=function(){var o=this._state.dbOpenError;return o&&o.name==="DatabaseClosed"},Ve.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ve.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ve.prototype,"tables",{get:function(){var o=this;return c(this._allTables).map(function(a){return o._allTables[a]})},enumerable:!1,configurable:!0}),Ve.prototype.transaction=function(){var o=(function(a,u,h){var y=arguments.length;if(y<2)throw new G.InvalidArgument("Too few arguments");for(var v=new Array(y-1);--y;)v[y-1]=arguments[y];return h=v.pop(),[a,J(v),h]}).apply(this,arguments);return this._transaction.apply(this,o)},Ve.prototype._transaction=function(o,a,u){var h,y,v=this,w=fe.trans,k=(w&&w.db===this&&o.indexOf("!")===-1||(w=null),o.indexOf("?")!==-1);o=o.replace("!","").replace("?","");try{if(y=a.map(function(P){if(P=P instanceof v.Table?P.name:P,typeof P!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return P}),o=="r"||o===to)h=to;else{if(o!="rw"&&o!=no)throw new G.InvalidArgument("Invalid transaction mode: "+o);h=no}if(w){if(w.mode===to&&h===no){if(!k)throw new G.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");w=null}w&&y.forEach(function(P){if(w&&w.storeNames.indexOf(P)===-1){if(!k)throw new G.SubTransaction("Table "+P+" not included in parent transaction.");w=null}}),k&&w&&!w.active&&(w=null)}}catch(P){return w?w._promise(null,function(I,C){C(P)}):We(P)}var O=(function P(I,C,D,T,A){return X.resolve().then(function(){var R=fe.transless||fe,E=I._createTransaction(C,D,I._dbSchema,T),R=(E.explicit=!0,{trans:E,transless:R});if(T)E.idbtrans=T.idbtrans;else try{E.create(),E.idbtrans._explicit=!0,I._state.PR1398_maxLoop=3}catch(B){return B.name===qe.InvalidState&&I.isOpen()&&0<--I._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),I.close({disableAutoOpen:!1}),I.open().then(function(){return P(I,C,D,null,A)})):We(B)}var j,L=pe(A),R=(L&&zn(),X.follow(function(){var B;(j=A.call(E,E))&&(L?(B=ln.bind(null,null),j.then(B,B)):typeof j.next=="function"&&typeof j.throw=="function"&&(j=_o(j)))},R));return(j&&typeof j.then=="function"?X.resolve(j).then(function(B){return E.active?B:We(new G.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):R.then(function(){return j})).then(function(B){return T&&E._resolve(),E._completion.then(function(){return B})}).catch(function(B){return E._reject(B),We(B)})})}).bind(null,this,h,y,w,u);return w?w._promise(h,O,"lock"):fe.trans?In(fe.transless,function(){return v._whenReady(O)}):this._whenReady(O)},Ve.prototype.table=function(o){if(p(this._allTables,o))return this._allTables[o];throw new G.InvalidTable("Table ".concat(o," does not exist"))};var zt=Ve;function Ve(o,a){var u,h,y,v,w,k=this,O=(this._middlewares={},this.verno=0,Ve.dependencies),O=(this._options=a=r({addons:Ve.addons,autoOpen:!0,indexedDB:O.indexedDB,IDBKeyRange:O.IDBKeyRange,cache:"cloned"},a),this._deps={indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange},a.addons),P=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ge,dbReadyPromise:null,cancelOpen:ge,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:a.autoOpen}),I=(P.dbReadyPromise=new X(function(C){P.dbReadyResolve=C}),P.openCanceller=new X(function(C,D){P.cancelOpen=D}),this._state=P,this.name=o,this.on=Ar(this,"populate","blocked","versionchange","close",{ready:[Hs,ge]}),this.once=function(C,D){var T=function(){for(var A=[],E=0;E<arguments.length;E++)A[E]=arguments[E];k.on(C).unsubscribe(T),D.apply(k,A)};return k.on(C,T)},this.on.ready.subscribe=V(this.on.ready.subscribe,function(C){return function(D,T){Ve.vip(function(){var A,E=k._state;E.openComplete?(E.dbOpenError||X.resolve().then(D),T&&C(D)):E.onReadyBeingFired?(E.onReadyBeingFired.push(D),T&&C(D)):(C(D),A=k,T||C(function j(){A.on.ready.unsubscribe(D),A.on.ready.unsubscribe(j)}))})}}),this.Collection=(u=this,Dr(Pd.prototype,function(j,E){this.db=u;var T=oc,A=null;if(E)try{T=E()}catch(R){A=R}var E=j._ctx,j=E.table,L=j.hook.reading.fire;this._ctx={table:j,index:E.index,isPrimKey:!E.index||j.schema.primKey.keyPath&&E.index===j.schema.primKey.name,range:T,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:A,or:E.or,valueMapper:L!==Se?L:null}})),this.Table=(h=this,Dr(dc.prototype,function(C,D,T){this.db=h,this._tx=T,this.name=C,this.schema=D,this.hook=h._allTables[C]?h._allTables[C].hook:Ar(null,{creating:[gt,ge],reading:[Ae,Se],updating:[Pt,ge],deleting:[xn,ge]})})),this.Transaction=(y=this,Dr(Ld.prototype,function(C,D,T,A,E){var j=this;C!=="readonly"&&D.forEach(function(L){L=(L=T[L])==null?void 0:L.yProps,L&&(D=D.concat(L.map(function(R){return R.updatesTable})))}),this.db=y,this.mode=C,this.storeNames=D,this.schema=T,this.chromeTransactionDurability=A,this.idbtrans=null,this.on=Ar(this,"complete","error","abort"),this.parent=E||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new X(function(L,R){j._resolve=L,j._reject=R}),this._completion.then(function(){j.active=!1,j.on.complete.fire()},function(L){var R=j.active;return j.active=!1,j.on.error.fire(L),j.parent?j.parent._reject(L):R&&j.idbtrans&&j.idbtrans.abort(),We(L)})})),this.Version=(v=this,Dr(qd.prototype,function(C){this.db=v,this._cfg={version:C,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(w=this,Dr(mc.prototype,function(C,D,T){if(this.db=w,this._ctx={table:C,index:D===":id"?null:D,or:T},this._cmp=this._ascending=xe,this._descending=function(A,E){return xe(E,A)},this._max=function(A,E){return 0<xe(A,E)?A:E},this._min=function(A,E){return xe(A,E)<0?A:E},this._IDBKeyRange=w._deps.IDBKeyRange,!this._IDBKeyRange)throw new G.MissingAPI})),this.on("versionchange",function(C){0<C.newVersion?console.warn("Another connection wants to upgrade database '".concat(k.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(k.name,"'. Closing db now to resume the delete request.")),k.close({disableAutoOpen:!1})}),this.on("blocked",function(C){!C.newVersion||C.newVersion<C.oldVersion?console.warn("Dexie.delete('".concat(k.name,"') was blocked")):console.warn("Upgrade '".concat(k.name,"' blocked by other connection holding version ").concat(C.oldVersion/10))}),this._maxKey=Pr(a.IDBKeyRange),this._createTransaction=function(C,D,T,A){return new k.Transaction(C,D,T,k._options.chromeTransactionDurability,A)},this._fireOnBlocked=function(C){k.on("blocked").fire(C),Yn.filter(function(D){return D.name===k.name&&D!==k&&!D._state.vcFired}).map(function(D){return D.on("versionchange").fire(C)})},this.use(zd),this.use(Xd),this.use(Yd),this.use(Vd),this.use(Hd),new Proxy(this,{get:function(C,D,T){var A;return D==="_vip"||(D==="table"?function(E){return $i(k.table(E),I)}:(A=Reflect.get(C,D,T))instanceof dc?$i(A,I):D==="tables"?A.map(function(E){return $i(E,I)}):D==="_createTransaction"?function(){return $i(A.apply(this,arguments),I)}:A)}}));this.vip=I,O.forEach(function(C){return C(k)})}var qi,Qn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Qd=(Co.prototype.subscribe=function(o,a,u){return this._subscribe(o&&typeof o!="function"?o:{next:o,error:a,complete:u})},Co.prototype[Qn]=function(){return this},Co);function Co(o){this._subscribe=o}try{qi={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch{qi={indexedDB:null,IDBKeyRange:null}}function Rc(o){var a,u=!1,h=new Qd(function(y){var v=pe(o),w,k=!1,O={},P={},I={get closed(){return k},unsubscribe:function(){k||(k=!0,w&&w.abort(),C&&dn.storagemutated.unsubscribe(T))}},C=(y.start&&y.start(I),!1),D=function(){return eo(A)},T=function(E){Ki(O,E),mo(P,O)&&D()},A=function(){var E,j,L;!k&&qi.indexedDB&&(O={},E={},w&&w.abort(),w=new AbortController,L=(R=>{var B=Vn();try{v&&zn();var F=cn(o,R);return F=v?F.finally(ln):F}finally{B&&Hn()}})(j={subscr:E,signal:w.signal,requery:D,querier:o,trans:null}),Promise.resolve(L).then(function(R){u=!0,a=R,k||j.signal.aborted||(O={},(B=>{for(var F in B)if(p(B,F))return;return 1})(P=E)||C||(dn(Rr,T),C=!0),eo(function(){return!k&&y.next&&y.next(R)}))},function(R){u=!1,["DatabaseClosedError","AbortError"].includes(R==null?void 0:R.name)||k||eo(function(){k||y.error&&y.error(R)})}))};return setTimeout(D,0),I});return h.hasValue=function(){return u},h.getValue=function(){return a},h}var Rn=zt;function Eo(o){var a=hn;try{hn=!0,dn.storagemutated.fire(o),wo(o,!0)}finally{hn=a}}m(Rn,r(r({},ce),{delete:function(o){return new Rn(o,{addons:[]}).delete()},exists:function(o){return new Rn(o,{addons:[]}).open().then(function(a){return a.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(o){try{return a=Rn.dependencies,u=a.indexedDB,a=a.IDBKeyRange,(po(u)?Promise.resolve(u.databases()).then(function(h){return h.map(function(y){return y.name}).filter(function(y){return y!==Oi})}):ho(u,a).toCollection().primaryKeys()).then(o)}catch{return We(new G.MissingAPI)}var a,u},defineClass:function(){return function(o){d(this,o)}},ignoreTransaction:function(o){return fe.trans?In(fe.transless,o):o()},vip:yo,async:function(o){return function(){try{var a=_o(o.apply(this,arguments));return a&&typeof a.then=="function"?a:X.resolve(a)}catch(u){return We(u)}}},spawn:function(o,a,u){try{var h=_o(o.apply(u,a||[]));return h&&typeof h.then=="function"?h:X.resolve(h)}catch(y){return We(y)}},currentTransaction:{get:function(){return fe.trans||null}},waitFor:function(o,a){return o=X.resolve(typeof o=="function"?Rn.ignoreTransaction(o):o).timeout(a||6e4),fe.trans?fe.trans.waitFor(o):o},Promise:X,debug:{get:function(){return jt},set:function(o){Za(o)}},derive:x,extend:d,props:m,override:V,Events:Ar,on:dn,liveQuery:Rc,extendObservabilitySet:Ki,getByKeyPath:ie,setByKeyPath:Z,delByKeyPath:function(o,a){typeof a=="string"?Z(o,a,void 0):"length"in a&&[].map.call(a,function(u){Z(o,u,void 0)})},shallowClone:he,deepClone:ee,getObjectDiff:ko,cmp:xe,asap:K,minKey:-1/0,addons:[],connections:Yn,errnames:qe,dependencies:qi,cache:Tn,semVer:"4.3.0",version:"4.3.0".split(".").map(function(o){return parseInt(o)}).reduce(function(o,a,u){return o+a/Math.pow(10,2*u)})})),Rn.maxKey=Pr(Rn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(dn(Rr,function(o){hn||(o=new CustomEvent(so,{detail:o}),hn=!0,dispatchEvent(o),hn=!1)}),addEventListener(so,function(o){o=o.detail,hn||Eo(o)}));var Zn,hn=!1,Pc=function(){};return typeof BroadcastChannel<"u"&&((Pc=function(){(Zn=new BroadcastChannel(so)).onmessage=function(o){return o.data&&Eo(o.data)}})(),typeof Zn.unref=="function"&&Zn.unref(),dn(Rr,function(o){hn||Zn.postMessage(o)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(o){if(!zt.disableBfCache&&o.persisted){jt&&console.debug("Dexie: handling persisted pagehide"),Zn!=null&&Zn.close();for(var a=0,u=Yn;a<u.length;a++)u[a].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(o){!zt.disableBfCache&&o.persisted&&(jt&&console.debug("Dexie: handling persisted pageshow"),Pc(),Eo({all:new lt(-1/0,[[]])}))})),X.rejectionMapper=function(o,a){return!o||o instanceof Pe||o instanceof TypeError||o instanceof SyntaxError||!o.name||!Ze[o.name]?o:(a=new Ze[o.name](a||o.message,o),"stack"in o&&S(a,"stack",{get:function(){return this.inner.stack}}),a)},Za(jt),r(zt,Object.freeze({__proto__:null,Dexie:zt,Entity:ac,PropModification:Ir,RangeSet:lt,add:function(o){return new Ir({add:o})},cmp:xe,default:zt,liveQuery:Rc,mergeRanges:Lr,rangesOverlap:kc,remove:function(o){return new Ir({remove:o})},replacePrefix:function(o,a){return new Ir({replacePrefix:[o,a]})}}),{default:zt}),zt})})(rs)),rs.exports}var rh=nh();const Xo=eh(rh),Uc=Symbol.for("Dexie"),Ce=globalThis[Uc]||(globalThis[Uc]=Xo);if(Xo.semVer!==Ce.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Xo.semVer} and ${Ce.semVer}`);const{liveQuery:gn,mergeRanges:Pv,rangesOverlap:jv,RangeSet:ih,cmp:As,Entity:Uv,PropModification:Lc,replacePrefix:Lv,add:Mv,remove:Nv,DexieYProvider:Kv}=Ce;var Qo=function(t,e){return Qo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Qo(t,e)};function nn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Qo(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function sh(t,e,n,r){function i(s){return s instanceof n?s:new n(function(c){c(s)})}return new(n||(n=Promise))(function(s,c){function l(g){try{f(r.next(g))}catch(p){c(p)}}function d(g){try{f(r.throw(g))}catch(p){c(p)}}function f(g){g.done?s(g.value):i(g.value).then(l,d)}f((r=r.apply(t,e||[])).next())})}function ou(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=l(0),c.throw=l(1),c.return=l(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(f){return function(g){return d([f,g])}}function d(f){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,f[0]&&(n=0)),n;)try{if(r=1,i&&(s=f[0]&2?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return n.label++,{value:f[1],done:!1};case 5:n.label++,i=f[1],f=[0];continue;case 7:f=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){n=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){n.label=f[1];break}if(f[0]===6&&n.label<s[1]){n.label=s[1],s=f;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(f);break}s[2]&&n.ops.pop(),n.trys.pop();continue}f=e.call(t,n)}catch(g){f=[6,g],i=0}finally{r=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function ar(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kn(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],c;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(l){c={error:l}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(c)throw c.error}}return s}function cr(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function rr(t){return this instanceof rr?(this.v=t,this):new rr(t)}function oh(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",c),i[Symbol.asyncIterator]=function(){return this},i;function c(b){return function(S){return Promise.resolve(S).then(b,p)}}function l(b,S){r[b]&&(i[b]=function(x){return new Promise(function(N,U){s.push([b,x,N,U])>1||d(b,x)})},S&&(i[b]=S(i[b])))}function d(b,S){try{f(r[b](S))}catch(x){m(s[0][3],x)}}function f(b){b.value instanceof rr?Promise.resolve(b.value.v).then(g,p):m(s[0][2],b)}function g(b){d("next",b)}function p(b){d("throw",b)}function m(b,S){b(S),s.shift(),s.length&&d(s[0][0],s[0][1])}}function ah(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ar=="function"?ar(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(c){return new Promise(function(l,d){c=t[s](c),i(l,d,c.done,c.value)})}}function i(s,c,l,d){Promise.resolve(d).then(function(f){s({value:f,done:l})},c)}}function Re(t){return typeof t=="function"}function Ca(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Io=Ca(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function ds(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var yr=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var l=ar(c),d=l.next();!d.done;d=l.next()){var f=d.value;f.remove(this)}}catch(x){e={error:x}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}else c.remove(this);var g=this.initialTeardown;if(Re(g))try{g()}catch(x){s=x instanceof Io?x.errors:[x]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var m=ar(p),b=m.next();!b.done;b=m.next()){var S=b.value;try{Mc(S)}catch(x){s=s??[],x instanceof Io?s=cr(cr([],Kn(s)),Kn(x.errors)):s.push(x)}}}catch(x){r={error:x}}finally{try{b&&!b.done&&(i=m.return)&&i.call(m)}finally{if(r)throw r.error}}}if(s)throw new Io(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Mc(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&ds(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&ds(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),au=yr.EMPTY;function cu(t){return t instanceof yr||t&&"closed"in t&&Re(t.remove)&&Re(t.add)&&Re(t.unsubscribe)}function Mc(t){Re(t)?t():t.unsubscribe()}var ch={Promise:void 0},lh={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,cr([t,e],Kn(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function lu(t){lh.setTimeout(function(){throw t})}function Nc(){}function is(t){t()}var Ea=(function(t){nn(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,cu(n)&&n.add(r)):r.destination=dh,r}return e.create=function(n,r,i){return new lr(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(yr),uh=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Wi(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Wi(r)}else Wi(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Wi(n)}},t})(),lr=(function(t){nn(e,t);function e(n,r,i){var s=t.call(this)||this,c;return Re(n)||!n?c={next:n??void 0,error:r??void 0,complete:i??void 0}:c=n,s.destination=new uh(c),s}return e})(Ea);function Wi(t){lu(t)}function fh(t){throw t}var dh={closed:!0,next:Nc,error:fh,complete:Nc},Oa=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function gr(t){return t}function hh(t){return t.length===0?gr:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var Xe=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=yh(e)?e:new lr(e,n,r);return is(function(){var c=i,l=c.operator,d=c.source;s.add(l?l.call(s,d):d?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=Kc(n),new n(function(i,s){var c=new lr({next:function(l){try{e(l)}catch(d){s(d),c.unsubscribe()}},error:s,complete:i});r.subscribe(c)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Oa]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return hh(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Kc(e),new e(function(r,i){var s;n.subscribe(function(c){return s=c},function(c){return i(c)},function(){return r(s)})})},t.create=function(e){return new t(e)},t})();function Kc(t){var e;return(e=t??ch.Promise)!==null&&e!==void 0?e:Promise}function ph(t){return t&&Re(t.next)&&Re(t.error)&&Re(t.complete)}function yh(t){return t&&t instanceof Ea||ph(t)&&cu(t)}function gh(t){return Re(t==null?void 0:t.lift)}function xt(t){return function(e){if(gh(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function St(t,e,n,r,i){return new mh(t,e,n,r,i)}var mh=(function(t){nn(e,t);function e(n,r,i,s,c,l){var d=t.call(this,n)||this;return d.onFinalize=c,d.shouldUnsubscribe=l,d._next=r?function(f){try{r(f)}catch(g){n.error(g)}}:t.prototype._next,d._error=s?function(f){try{s(f)}catch(g){n.error(g)}finally{this.unsubscribe()}}:t.prototype._error,d._complete=i?function(){try{i()}catch(f){n.error(f)}finally{this.unsubscribe()}}:t.prototype._complete,d}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e})(Ea),vh=Ca(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Bn=(function(t){nn(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new Bc(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new vh},e.prototype.next=function(n){var r=this;is(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var c=ar(r.currentObservers),l=c.next();!l.done;l=c.next()){var d=l.value;d.next(n)}}catch(f){i={error:f}}finally{try{l&&!l.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;is(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;is(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,c=i.isStopped,l=i.observers;return s||c?au:(this.currentObservers=null,l.push(n),new yr(function(){r.currentObservers=null,ds(l,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,c=r.isStopped;i?n.error(s):c&&n.complete()},e.prototype.asObservable=function(){var n=new Xe;return n.source=this,n},e.create=function(n,r){return new Bc(n,r)},e})(Xe),Bc=(function(t){nn(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:au},e})(Bn),Rt=(function(t){nn(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(Bn),bh={now:function(){return Date.now()}},wh=(function(t){nn(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e})(yr),Fc={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,cr([t,e],Kn(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},_h=(function(t){nn(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,c=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(c,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(c,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),Fc.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&Fc.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(c){i=!0,s=c||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ds(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e})(wh),$c=(function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=bh.now,t})(),kh=(function(t){nn(e,t);function e(n,r){r===void 0&&(r=$c.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e})($c),Ia=new kh(_h),Sh=Ia,uu=new Xe(function(t){return t.complete()});function fu(t){return t&&Re(t.schedule)}function Aa(t){return t[t.length-1]}function xh(t){return Re(Aa(t))?t.pop():void 0}function fi(t){return fu(Aa(t))?t.pop():void 0}function Ch(t,e){return typeof Aa(t)=="number"?t.pop():e}var Da=(function(t){return t&&typeof t.length=="number"&&typeof t!="function"});function du(t){return Re(t==null?void 0:t.then)}function hu(t){return Re(t[Oa])}function pu(t){return Symbol.asyncIterator&&Re(t==null?void 0:t[Symbol.asyncIterator])}function yu(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Eh(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var gu=Eh();function mu(t){return Re(t==null?void 0:t[gu])}function vu(t){return oh(this,arguments,function(){var n,r,i,s;return ou(this,function(c){switch(c.label){case 0:n=t.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,rr(n.read())];case 3:return r=c.sent(),i=r.value,s=r.done,s?[4,rr(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,rr(i)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function bu(t){return Re(t==null?void 0:t.getReader)}function Tt(t){if(t instanceof Xe)return t;if(t!=null){if(hu(t))return Oh(t);if(Da(t))return Ih(t);if(du(t))return Ah(t);if(pu(t))return wu(t);if(mu(t))return Dh(t);if(bu(t))return Th(t)}throw yu(t)}function Oh(t){return new Xe(function(e){var n=t[Oa]();if(Re(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Ih(t){return new Xe(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function Ah(t){return new Xe(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,lu)})}function Dh(t){return new Xe(function(e){var n,r;try{for(var i=ar(t),s=i.next();!s.done;s=i.next()){var c=s.value;if(e.next(c),e.closed)return}}catch(l){n={error:l}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function wu(t){return new Xe(function(e){Rh(t,e).catch(function(n){return e.error(n)})})}function Th(t){return wu(vu(t))}function Rh(t,e){var n,r,i,s;return sh(this,void 0,void 0,function(){var c,l;return ou(this,function(d){switch(d.label){case 0:d.trys.push([0,5,6,11]),n=ah(t),d.label=1;case 1:return[4,n.next()];case 2:if(r=d.sent(),!!r.done)return[3,4];if(c=r.value,e.next(c),e.closed)return[2];d.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=d.sent(),i={error:l},[3,11];case 6:return d.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:d.sent(),d.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function mn(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function _u(t,e){return e===void 0&&(e=0),xt(function(n,r){n.subscribe(St(r,function(i){return mn(r,t,function(){return r.next(i)},e)},function(){return mn(r,t,function(){return r.complete()},e)},function(i){return mn(r,t,function(){return r.error(i)},e)}))})}function ku(t,e){return e===void 0&&(e=0),xt(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function Ph(t,e){return Tt(t).pipe(ku(e),_u(e))}function jh(t,e){return Tt(t).pipe(ku(e),_u(e))}function Uh(t,e){return new Xe(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function Lh(t,e){return new Xe(function(n){var r;return mn(n,e,function(){r=t[gu](),mn(n,e,function(){var i,s,c;try{i=r.next(),s=i.value,c=i.done}catch(l){n.error(l);return}c?n.complete():n.next(s)},0,!0)}),function(){return Re(r==null?void 0:r.return)&&r.return()}})}function Su(t,e){if(!t)throw new Error("Iterable cannot be null");return new Xe(function(n){mn(n,e,function(){var r=t[Symbol.asyncIterator]();mn(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function Mh(t,e){return Su(vu(t),e)}function Nh(t,e){if(t!=null){if(hu(t))return Ph(t,e);if(Da(t))return Uh(t,e);if(du(t))return jh(t,e);if(pu(t))return Su(t,e);if(mu(t))return Lh(t,e);if(bu(t))return Mh(t,e)}throw yu(t)}function _t(t,e){return e?Nh(t,e):Tt(t)}function Zt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fi(t);return _t(t,n)}function qc(t,e){var n=Re(t)?t:function(){return t},r=function(i){return i.error(n())};return new Xe(r)}var Kh=Ca(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function Un(t,e){return new Promise(function(n,r){var i=new lr({next:function(s){n(s),i.unsubscribe()},error:r,complete:function(){r(new Kh)}});t.subscribe(i)})}function Bh(t){return t instanceof Date&&!isNaN(t)}function bt(t,e){return xt(function(n,r){var i=0;n.subscribe(St(r,function(s){r.next(t.call(e,s,i++))}))})}var Fh=Array.isArray;function $h(t,e){return Fh(e)?t.apply(void 0,cr([],Kn(e))):t(e)}function xu(t){return bt(function(e){return $h(t,e)})}var qh=Array.isArray,Wh=Object.getPrototypeOf,Vh=Object.prototype,Hh=Object.keys;function zh(t){if(t.length===1){var e=t[0];if(qh(e))return{args:e,keys:null};if(Yh(e)){var n=Hh(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function Yh(t){return t&&typeof t=="object"&&Wh(t)===Vh}function Gh(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function Zr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fi(t),r=xh(t),i=zh(t),s=i.args,c=i.keys;if(s.length===0)return _t([],n);var l=new Xe(Jh(s,n,c?function(d){return Gh(c,d)}:gr));return r?l.pipe(xu(r)):l}function Jh(t,e,n){return n===void 0&&(n=gr),function(r){Wc(e,function(){for(var i=t.length,s=new Array(i),c=i,l=i,d=function(g){Wc(e,function(){var p=_t(t[g],e),m=!1;p.subscribe(St(r,function(b){s[g]=b,m||(m=!0,l--),l||r.next(n(s.slice()))},function(){--c||r.complete()}))},r)},f=0;f<i;f++)d(f)},r)}}function Wc(t,e,n){t?mn(n,t,e):e()}function Xh(t,e,n,r,i,s,c,l){var d=[],f=0,g=0,p=!1,m=function(){p&&!d.length&&!f&&e.complete()},b=function(x){return f<r?S(x):d.push(x)},S=function(x){f++;var N=!1;Tt(n(x,g++)).subscribe(St(e,function(U){e.next(U)},function(){N=!0},void 0,function(){if(N)try{f--;for(var U=function(){var M=d.shift();c||S(M)};d.length&&f<r;)U();m()}catch(M){e.error(M)}}))};return t.subscribe(St(e,b,function(){p=!0,m()})),function(){}}function di(t,e,n){return n===void 0&&(n=1/0),Re(e)?di(function(r,i){return bt(function(s,c){return e(r,s,i,c)})(Tt(t(r,i)))},n):(typeof e=="number"&&(n=e),xt(function(r,i){return Xh(r,i,t,n)}))}function Cu(t){return t===void 0&&(t=1/0),di(gr,t)}function Qh(){return Cu(1)}function Vc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Qh()(_t(t,fi(t)))}var Zh=["addListener","removeListener"],ep=["addEventListener","removeEventListener"],tp=["on","off"];function Ft(t,e,n,r){if(Re(n)&&(r=n,n=void 0),r)return Ft(t,e,n).pipe(xu(r));var i=Kn(ip(t)?ep.map(function(l){return function(d){return t[l](e,d,n)}}):np(t)?Zh.map(Hc(t,e)):rp(t)?tp.map(Hc(t,e)):[],2),s=i[0],c=i[1];if(!s&&Da(t))return di(function(l){return Ft(l,e,n)})(Tt(t));if(!s)throw new TypeError("Invalid event target");return new Xe(function(l){var d=function(){for(var f=[],g=0;g<arguments.length;g++)f[g]=arguments[g];return l.next(1<f.length?f:f[0])};return s(d),function(){return c(d)}})}function Hc(t,e){return function(n){return function(r){return t[n](e,r)}}}function np(t){return Re(t.addListener)&&Re(t.removeListener)}function rp(t){return Re(t.on)&&Re(t.off)}function ip(t){return Re(t.addEventListener)&&Re(t.removeEventListener)}function Eu(t,e,n){t===void 0&&(t=0),n===void 0&&(n=Sh);var r=-1;return e!=null&&(fu(e)?n=e:r=e),new Xe(function(i){var s=Bh(t)?+t-n.now():t;s<0&&(s=0);var c=0;return n.schedule(function(){i.closed||(i.next(c++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function Ds(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fi(t),r=Ch(t,1/0),i=t;return i.length?i.length===1?Tt(i[0]):Cu(r)(_t(i,n)):uu}function Et(t,e){return xt(function(n,r){var i=0;n.subscribe(St(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function Zo(t){return xt(function(e,n){var r=null,i=!1,s;r=e.subscribe(St(n,void 0,void 0,function(c){s=Tt(t(c,Zo(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function zc(t,e){return e===void 0&&(e=Ia),xt(function(n,r){var i=null,s=null,c=null,l=function(){if(i){i.unsubscribe(),i=null;var f=s;s=null,r.next(f)}};function d(){var f=c+t,g=e.now();if(g<f){i=this.schedule(void 0,f-g),r.add(i);return}l()}n.subscribe(St(r,function(f){s=f,c=e.now(),i||(i=e.schedule(d,t),r.add(i))},function(){l(),r.complete()},void 0,function(){s=i=null}))})}function tr(t){return t<=0?function(){return uu}:xt(function(e,n){var r=0;e.subscribe(St(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function sp(t){return bt(function(){return t})}function op(t,e){return di(function(n,r){return Tt(t(n,r)).pipe(tr(1),sp(n))})}function Ou(t,e){e===void 0&&(e=Ia);var n=Eu(t,e);return op(function(){return n})}function Iu(t,e){return e===void 0&&(e=gr),t=t??ap,xt(function(n,r){var i,s=!0;n.subscribe(St(r,function(c){var l=e(c);(s||!t(i,l))&&(s=!1,i=l,r.next(c))}))})}function ap(t,e){return t===e}function cp(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new Bn}:e,r=t.resetOnError,i=r===void 0?!0:r,s=t.resetOnComplete,c=s===void 0?!0:s,l=t.resetOnRefCountZero,d=l===void 0?!0:l;return function(f){var g,p,m,b=0,S=!1,x=!1,N=function(){p==null||p.unsubscribe(),p=void 0},U=function(){N(),g=m=void 0,S=x=!1},M=function(){var V=g;U(),V==null||V.unsubscribe()};return xt(function(V,q){b++,!x&&!S&&N();var K=m=m??n();q.add(function(){b--,b===0&&!x&&!S&&(p=Ao(M,d))}),K.subscribe(q),!g&&b>0&&(g=new lr({next:function(ie){return K.next(ie)},error:function(ie){x=!0,N(),p=Ao(U,i,ie),K.error(ie)},complete:function(){S=!0,N(),p=Ao(U,c),K.complete()}}),Tt(V).subscribe(g))})(f)}}function Ao(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(e===!0){t();return}if(e!==!1){var i=new lr({next:function(){i.unsubscribe(),t()}});return Tt(e.apply(void 0,cr([],Kn(n)))).subscribe(i)}}function Yc(t){return Et(function(e,n){return t<=n})}function Au(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fi(t);return xt(function(r,i){(n?Vc(t,r,n):Vc(t,r)).subscribe(i)})}function ut(t,e){return xt(function(n,r){var i=null,s=0,c=!1,l=function(){return c&&!i&&r.complete()};n.subscribe(St(r,function(d){i==null||i.unsubscribe();var f=0,g=s++;Tt(t(d,g)).subscribe(i=St(r,function(p){return r.next(e?e(d,p,g,f++):p)},function(){i=null,l()}))},function(){c=!0,l()}))})}function ea(t,e,n){var r=Re(t)||e||n?{next:t,error:e,complete:n}:t;return r?xt(function(i,s){var c;(c=r.subscribe)===null||c===void 0||c.call(r);var l=!0;i.subscribe(St(s,function(d){var f;(f=r.next)===null||f===void 0||f.call(r,d),s.next(d)},function(){var d;l=!1,(d=r.complete)===null||d===void 0||d.call(r),s.complete()},function(d){var f;l=!1,(f=r.error)===null||f===void 0||f.call(r,d),s.error(d)},function(){var d,f;l&&((d=r.unsubscribe)===null||d===void 0||d.call(r)),(f=r.finalize)===null||f===void 0||f.call(r)}))}):gr}const tn=Math.floor,ss=Math.abs,Du=(t,e)=>t<e?t:e,mr=(t,e)=>t>e?t:e,Tu=t=>t!==0?t<0:1/t<0,Gc=1,Jc=2,Do=4,To=8,ei=32,en=64,kt=128,Ts=31,ta=63,Mn=127,lp=2147483647,Ru=Number.MAX_SAFE_INTEGER,up=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&tn(t)===t),Fn=()=>new Set,Ro=t=>t[t.length-1],fp=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},_n=Array.from,dp=Array.isArray,hp=t=>t.toLowerCase(),pp=/^\s*/g,yp=t=>t.replace(pp,""),gp=/([A-Z])/g,Xc=(t,e)=>yp(t.replace(gp,n=>`${e}${hp(n)}`)),mp=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},ti=typeof TextEncoder<"u"?new TextEncoder:null,vp=t=>ti.encode(t),bp=ti?vp:mp;let Vr=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Vr&&Vr.decode(new Uint8Array).length===1&&(Vr=null);class vr{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const br=()=>new vr,wp=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},wt=t=>{const e=new Uint8Array(wp(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},_p=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(mr(n,e)*2),t.cpos=0)},nt=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},na=nt,be=(t,e)=>{for(;e>Mn;)nt(t,kt|Mn&e),e=tn(e/128);nt(t,Mn&e)},Ta=(t,e)=>{const n=Tu(e);for(n&&(e=-e),nt(t,(e>ta?kt:0)|(n?en:0)|ta&e),e=tn(e/64);e>0;)nt(t,(e>Mn?kt:0)|Mn&e),e=tn(e/128)},ra=new Uint8Array(3e4),kp=ra.length/3,Sp=(t,e)=>{if(e.length<kp){const n=ti.encodeInto(e,ra).written||0;be(t,n);for(let r=0;r<n;r++)nt(t,ra[r])}else it(t,bp(e))},xp=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;be(t,r);for(let i=0;i<r;i++)nt(t,n.codePointAt(i))},Ot=ti&&ti.encodeInto?Sp:xp,Cp=(t,e)=>hi(t,wt(e)),hi=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Du(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(mr(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},it=(t,e)=>{be(t,e.byteLength),hi(t,e)},Rs=(t,e)=>{_p(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Ep=(t,e)=>Rs(t,4).setFloat32(0,e,!1),Op=(t,e)=>Rs(t,8).setFloat64(0,e,!1),Ip=(t,e)=>Rs(t,8).setBigInt64(0,e,!1),Qc=(t,e)=>Rs(t,8).setBigUint64(0,e,!1),Zc=new DataView(new ArrayBuffer(4)),Ap=t=>(Zc.setFloat32(0,t),Zc.getFloat32(0)===t),vn=(t,e)=>{switch(typeof e){case"string":nt(t,119),Ot(t,e);break;case"number":up(e)&&ss(e)<=lp?(nt(t,125),Ta(t,e)):Ap(e)?(nt(t,124),Ep(t,e)):(nt(t,123),Op(t,e));break;case"bigint":nt(t,122),Ip(t,e);break;case"object":if(e===null)nt(t,126);else if(dp(e)){nt(t,117),be(t,e.length);for(let n=0;n<e.length;n++)vn(t,e[n])}else if(e instanceof Uint8Array)nt(t,116),it(t,e);else{nt(t,118);const n=Object.keys(e);be(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ot(t,i),vn(t,e[i])}}break;case"boolean":nt(t,e?120:121);break;default:nt(t,127)}};class el extends vr{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&be(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const tl=t=>{t.count>0&&(Ta(t.encoder,t.count===1?t.s:-t.s),t.count>1&&be(t.encoder,t.count-2))};class os{constructor(){this.encoder=new vr,this.s=0,this.count=0}write(e){this.s===e?this.count++:(tl(this),this.count=1,this.s=e)}toUint8Array(){return tl(this),wt(this.encoder)}}const nl=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Ta(t.encoder,e),t.count>1&&be(t.encoder,t.count-2)}};class Po{constructor(){this.encoder=new vr,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(nl(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return nl(this),wt(this.encoder)}}class Dp{constructor(){this.sarr=[],this.s="",this.lensE=new os}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new vr;return this.sarr.push(this.s),this.s="",Ot(e,this.sarr.join("")),hi(e,this.lensE.toUint8Array()),wt(e)}}const kn=t=>new Error(t),$t=()=>{throw kn("Method unimplemented")},qt=()=>{throw kn("Unexpected case")},Pu=kn("Unexpected end of array"),ju=kn("Integer out of Range");class wr{constructor(e){this.arr=e,this.pos=0}}const pi=t=>new wr(t),Uu=t=>t.pos!==t.arr.length,Tp=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},st=t=>Tp(t,Ue(t)),ur=t=>t.arr[t.pos++],Ue=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&Mn)*n,n*=128,i<kt)return e;if(e>Ru)throw ju}throw Pu},Ra=t=>{let e=t.arr[t.pos++],n=e&ta,r=64;const i=(e&en)>0?-1:1;if((e&kt)===0)return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&Mn)*r,r*=128,e<kt)return i*n;if(n>Ru)throw ju}throw Pu},Rp=t=>{let e=Ue(t);if(e===0)return"";{let n=String.fromCodePoint(ur(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(ur(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Pp=t=>Vr.decode(st(t)),It=Vr?Pp:Rp,Ps=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},jp=t=>Ps(t,4).getFloat32(0,!1),Up=t=>Ps(t,8).getFloat64(0,!1),Lp=t=>Ps(t,8).getBigInt64(0,!1),rl=t=>Ps(t,8).getBigUint64(0,!1),Mp=[t=>{},t=>null,Ra,jp,Up,Lp,t=>!1,t=>!0,It,t=>{const e=Ue(t),n={};for(let r=0;r<e;r++){const i=It(t);n[i]=bn(t)}return n},t=>{const e=Ue(t),n=[];for(let r=0;r<e;r++)n.push(bn(t));return n},st],bn=t=>Mp[127-ur(t)](t);class il extends wr{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Uu(this)?this.count=Ue(this)+1:this.count=-1),this.count--,this.s}}class as extends wr{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Ra(this);const e=Tu(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ue(this)+2)}return this.count--,this.s}}class jo extends wr{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Ra(this),n=e&1;this.diff=tn(e/2),this.count=1,n&&(this.count=Ue(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Np{constructor(e){this.decoder=new as(e),this.str=It(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const pt=()=>new Map,ia=t=>{const e=pt();return t.forEach((n,r)=>{e.set(r,n)}),e},rn=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Kp=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},Bp=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1};class Fp{constructor(){this._observers=pt()}on(e,n){return rn(this._observers,e,Fn).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return _n((this._observers.get(e)||pt()).values()).forEach(r=>r(...n))}destroy(){this._observers=pt()}}class $p{constructor(){this._observers=pt()}on(e,n){rn(this._observers,e,Fn).add(n)}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return _n((this._observers.get(e)||pt()).values()).forEach(r=>r(...n))}destroy(){this._observers=pt()}}const qp=crypto.getRandomValues.bind(crypto),Lu=()=>qp(new Uint32Array(1))[0],Wp="10000000-1000-4000-8000"+-1e11,Vp=()=>Wp.replace(/[018]/g,t=>(t^Lu()&15>>t/4).toString(16)),hs=Date.now,sl=t=>new Promise(t);Promise.all.bind(Promise);const ol=t=>t===void 0?null:t;class Hp{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Mu=new Hp,zp=!0;try{typeof localStorage<"u"&&localStorage&&(Mu=localStorage,zp=!1)}catch{}const Yp=Mu,Gp=Object.assign,Nu=Object.keys,Jp=(t,e)=>{for(const n in t)e(t[n],n)},al=t=>Nu(t).length,cl=t=>Nu(t).length,Xp=t=>{for(const e in t)return!1;return!0},Qp=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Ku=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Zp=(t,e)=>t===e||cl(t)===cl(e)&&Qp(t,(n,r)=>(n!==void 0||Ku(e,r))&&e[r]===n),ey=Object.freeze,Bu=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Bu(t[e])}return ey(t)},ll=Symbol("Equality"),Pa=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Pa(t,e,n+1)}},Hr=(t,e)=>{if(t===e)return!0;if(t==null||e==null||t.constructor!==e.constructor)return!1;if(t[ll]!=null)return t[ll](e);switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:{if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break}case Set:{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break}case Map:{if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!Hr(t.get(n),e.get(n)))return!1;break}case Object:if(al(t)!==al(e))return!1;for(const n in t)if(!Ku(t,n)||!Hr(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Hr(t[n],e[n]))return!1;break;default:return!1}return!0},ty=(t,e)=>e.includes(t);var Fu={};const ni=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Mt;const ny=()=>{if(Mt===void 0)if(ni){Mt=pt();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Mt.set(e,""),e=r):e!==null&&(Mt.set(e,r),e=null)}e!==null&&Mt.set(e,"")}else typeof location=="object"?(Mt=pt(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Mt.set(`--${Xc(e,"-")}`,n),Mt.set(`-${Xc(e,"-")}`,n)}})):Mt=pt();return Mt},sa=t=>ny().has(t),ps=t=>ol(ni?Fu[t.toUpperCase().replaceAll("-","_")]:Yp.getItem(t)),$u=t=>sa("--"+t)||ps(t)!==null;$u("production");const ry=ni&&ty(Fu.FORCE_COLOR,["true","1","2"]),iy=ry||!sa("--no-colors")&&!$u("no-color")&&(!ni||process.stdout.isTTY)&&(!ni||sa("--color")||ps("COLORTERM")!==null||(ps("TERM")||"").includes("color"));class sy{constructor(e,n){this.left=e,this.right=n}}const Yt=(t,e)=>new sy(t,e);typeof DOMParser<"u"&&new DOMParser;const oy=t=>Kp(t,(e,n)=>`${n}:${e};`).join(""),sn=Symbol,qu=sn(),Wu=sn(),ay=sn(),cy=sn(),ly=sn(),Vu=sn(),uy=sn(),ja=sn(),fy=sn(),dy=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},hy={[qu]:Yt("font-weight","bold"),[Wu]:Yt("font-weight","normal"),[ay]:Yt("color","blue"),[ly]:Yt("color","green"),[cy]:Yt("color","grey"),[Vu]:Yt("color","red"),[uy]:Yt("color","purple"),[ja]:Yt("color","orange"),[fy]:Yt("color","black")},py=t=>{var c;t.length===1&&((c=t[0])==null?void 0:c.constructor)===Function&&(t=t[0]());const e=[],n=[],r=pt();let i=[],s=0;for(;s<t.length;s++){const l=t[s],d=hy[l];if(d!==void 0)r.set(d.left,d.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){const f=oy(r);s>0||f.length>0?(e.push("%c"+l),n.push(f)):e.push(l)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const l=t[s];l instanceof Symbol||i.push(l)}return i},Hu=iy?py:dy,yy=(...t)=>{console.log(...Hu(t)),zu.forEach(e=>e.print(t))},gy=(...t)=>{console.warn(...Hu(t)),t.unshift(ja),zu.forEach(e=>e.print(t))},zu=Fn(),Yu=t=>({[Symbol.iterator](){return this},next:t}),my=(t,e)=>Yu(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Uo=(t,e)=>Yu(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Gu{constructor(e,n){this.clock=e,this.len=n}}class js{constructor(){this.clients=new Map}}const Ju=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);if(s!=null){const c=s[s.length-1],l=c.id.clock+c.length;for(let d=0,f=r[d];d<r.length&&f.clock<l;f=r[++d])of(t,s,f.clock,f.len,n)}}),vy=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=tn((n+r)/2),s=t[i],c=s.clock;if(c<=e){if(e<c+s.len)return i;n=i+1}else r=i-1}return null},Xu=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&vy(n,e.clock)!==null},Ua=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=mr(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},by=t=>{const e=new js;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let c=n+1;c<t.length;c++)fp(s,t[c].clients.get(i)||[]);e.clients.set(i,s)}});return Ua(e),e},ys=(t,e,n,r)=>{rn(t.clients,e,()=>[]).push(new Gu(n,r))},La=(t,e)=>{be(t.restEncoder,e.clients.size),_n(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),be(t.restEncoder,n);const i=r.length;be(t.restEncoder,i);for(let s=0;s<i;s++){const c=r[s];t.writeDsClock(c.clock),t.writeDsLen(c.len)}})},wy=t=>{const e=new js,n=Ue(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Ue(t.restDecoder),s=Ue(t.restDecoder);if(s>0){const c=rn(e.clients,i,()=>[]);for(let l=0;l<s;l++)c.push(new Gu(t.readDsClock(),t.readDsLen()))}}return e},ul=(t,e,n)=>{const r=new js,i=Ue(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const c=Ue(t.restDecoder),l=Ue(t.restDecoder),d=n.clients.get(c)||[],f=rt(n,c);for(let g=0;g<l;g++){const p=t.readDsClock(),m=p+t.readDsLen();if(p<f){f<m&&ys(r,c,f,m-f);let b=Wt(d,p),S=d[b];for(!S.deleted&&S.id.clock<p&&(d.splice(b+1,0,ks(e,S,p-S.id.clock)),b++);b<d.length&&(S=d[b++],S.id.clock<m);)S.deleted||(m<S.id.clock+S.length&&d.splice(b,0,ks(e,S,m-S.id.clock)),S.delete(e))}else ys(r,c,p,m-p)}}if(r.clients.size>0){const s=new Us;return be(s.restEncoder,0),La(s,r),s.toUint8Array()}return null},Qu=Lu;class _r extends Fp{constructor({guid:e=Vp(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:c=!1,shouldLoad:l=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Qu(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new rf,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=c,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=sl(f=>{this.on("load",()=>{this.isLoaded=!0,f(this)})});const d=()=>sl(f=>{const g=p=>{(p===void 0||p===!0)&&(this.off("sync",g),f())};this.on("sync",g)});this.on("sync",f=>{f===!1&&this.isSynced&&(this.whenSynced=d()),this.isSynced=f===void 0||f===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=d()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Le(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(_n(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Le(this,e,n)}get(e,n=ot){const r=rn(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==ot&&i!==n)if(i===ot){const s=new n;s._map=r._map,r._map.forEach(c=>{for(;c!==null;c=c.left)c.parent=s}),s._start=r._start;for(let c=s._start;c!==null;c=c.right)c.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,sr)}getText(e=""){return this.get(e,dr)}getMap(e=""){return this.get(e,fr)}getXmlElement(e=""){return this.get(e,hr)}getXmlFragment(e=""){return this.get(e,$n)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,_n(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new _r({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Le(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class _y{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ue(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ue(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class ri extends _y{constructor(e){super(e),this.keys=[],Ue(e),this.keyClockDecoder=new jo(st(e)),this.clientDecoder=new as(st(e)),this.leftClockDecoder=new jo(st(e)),this.rightClockDecoder=new jo(st(e)),this.infoDecoder=new il(st(e),ur),this.stringDecoder=new Np(st(e)),this.parentInfoDecoder=new il(st(e),ur),this.typeRefDecoder=new as(st(e)),this.lenDecoder=new as(st(e))}readLeftID(){return new ir(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ir(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return bn(this.restDecoder)}readBuf(){return st(this.restDecoder)}readJSON(){return bn(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class ky{constructor(){this.restEncoder=br()}toUint8Array(){return wt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){be(this.restEncoder,e)}writeDsLen(e){be(this.restEncoder,e)}}class Sy extends ky{writeLeftID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeRightID(e){be(this.restEncoder,e.client),be(this.restEncoder,e.clock)}writeClient(e){be(this.restEncoder,e)}writeInfo(e){na(this.restEncoder,e)}writeString(e){Ot(this.restEncoder,e)}writeParentInfo(e){be(this.restEncoder,e?1:0)}writeTypeRef(e){be(this.restEncoder,e)}writeLen(e){be(this.restEncoder,e)}writeAny(e){vn(this.restEncoder,e)}writeBuf(e){it(this.restEncoder,e)}writeJSON(e){Ot(this.restEncoder,JSON.stringify(e))}writeKey(e){Ot(this.restEncoder,e)}}class Zu{constructor(){this.restEncoder=br(),this.dsCurrVal=0}toUint8Array(){return wt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,be(this.restEncoder,n)}writeDsLen(e){e===0&&qt(),be(this.restEncoder,e-1),this.dsCurrVal+=e}}class Us extends Zu{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Po,this.clientEncoder=new os,this.leftClockEncoder=new Po,this.rightClockEncoder=new Po,this.infoEncoder=new el(na),this.stringEncoder=new Dp,this.parentInfoEncoder=new el(na),this.typeRefEncoder=new os,this.lenEncoder=new os}toUint8Array(){const e=br();return be(e,0),it(e,this.keyClockEncoder.toUint8Array()),it(e,this.clientEncoder.toUint8Array()),it(e,this.leftClockEncoder.toUint8Array()),it(e,this.rightClockEncoder.toUint8Array()),it(e,wt(this.infoEncoder)),it(e,this.stringEncoder.toUint8Array()),it(e,wt(this.parentInfoEncoder)),it(e,this.typeRefEncoder.toUint8Array()),it(e,this.lenEncoder.toUint8Array()),hi(e,wt(this.restEncoder)),wt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){vn(this.restEncoder,e)}writeBuf(e){it(this.restEncoder,e)}writeJSON(e){vn(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const xy=(t,e,n,r)=>{r=mr(r,e[0].id.clock);const i=Wt(e,r);be(t.restEncoder,e.length-i),t.writeClient(n),be(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let c=i+1;c<e.length;c++)e[c].write(t,0)},ef=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{rt(e,s)>i&&r.set(s,i)}),Ma(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),be(t.restEncoder,r.size),_n(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{xy(t,e.clients.get(i),i,s)})},Cy=(t,e)=>{const n=pt(),r=Ue(t.restDecoder);for(let i=0;i<r;i++){const s=Ue(t.restDecoder),c=new Array(s),l=t.readClient();let d=Ue(t.restDecoder);n.set(l,{i:0,refs:c});for(let f=0;f<s;f++){const g=t.readInfo();switch(Ts&g){case 0:{const p=t.readLen();c[f]=new At(Ie(l,d),p),d+=p;break}case 10:{const p=Ue(t.restDecoder);c[f]=new Dt(Ie(l,d),p),d+=p;break}default:{const p=(g&(en|kt))===0,m=new Je(Ie(l,d),null,(g&kt)===kt?t.readLeftID():null,null,(g&en)===en?t.readRightID():null,p?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,p&&(g&ei)===ei?t.readString():null,Of(t,g));c[f]=m,d+=m.length}}}}return n},Ey=(t,e,n)=>{const r=[];let i=_n(n.keys()).sort((b,S)=>b-S);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let b=n.get(i[i.length-1]);for(;b.refs.length===b.i;)if(i.pop(),i.length>0)b=n.get(i[i.length-1]);else return null;return b};let c=s();if(c===null)return null;const l=new rf,d=new Map,f=(b,S)=>{const x=d.get(b);(x==null||x>S)&&d.set(b,S)};let g=c.refs[c.i++];const p=new Map,m=()=>{for(const b of r){const S=b.id.client,x=n.get(S);x?(x.i--,l.clients.set(S,x.refs.slice(x.i)),n.delete(S),x.i=0,x.refs=[]):l.clients.set(S,[b]),i=i.filter(N=>N!==S)}r.length=0};for(;;){if(g.constructor!==Dt){const S=rn(p,g.id.client,()=>rt(e,g.id.client))-g.id.clock;if(S<0)r.push(g),f(g.id.client,g.id.clock-1),m();else{const x=g.getMissing(t,e);if(x!==null){r.push(g);const N=n.get(x)||{refs:[],i:0};if(N.refs.length===N.i)f(x,rt(e,x)),m();else{g=N.refs[N.i++];continue}}else(S===0||S<g.length)&&(g.integrate(t,S),p.set(g.id.client,g.id.clock+g.length))}}if(r.length>0)g=r.pop();else if(c!==null&&c.i<c.refs.length)g=c.refs[c.i++];else{if(c=s(),c===null)break;g=c.refs[c.i++]}}if(l.clients.size>0){const b=new Us;return ef(b,l,new Map),be(b.restEncoder,0),{missing:d,update:b.toUint8Array()}}return null},Oy=(t,e)=>ef(t,e.doc.store,e.beforeState),Iy=(t,e,n,r=new ri(t))=>Le(e,i=>{i.local=!1;let s=!1;const c=i.doc,l=c.store,d=Cy(r,c),f=Ey(i,l,d),g=l.pendingStructs;if(g){for(const[m,b]of g.missing)if(b<rt(l,m)){s=!0;break}if(f){for(const[m,b]of f.missing){const S=g.missing.get(m);(S==null||S>b)&&g.missing.set(m,b)}g.update=gs([g.update,f.update])}}else l.pendingStructs=f;const p=ul(r,i,l);if(l.pendingDs){const m=new ri(pi(l.pendingDs));Ue(m.restDecoder);const b=ul(m,i,l);p&&b?l.pendingDs=gs([p,b]):l.pendingDs=p||b}else l.pendingDs=p;if(s){const m=l.pendingStructs.update;l.pendingStructs=null,tf(i.doc,m)}},n,!1),tf=(t,e,n,r=ri)=>{const i=pi(e);Iy(i,t,n,new r(i))};class Ay{constructor(){this.l=[]}}const fl=()=>new Ay,dl=(t,e)=>t.l.push(e),hl=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},nf=(t,e,n)=>Pa(t.l,[e,n]);class ir{constructor(e,n){this.client=e,this.clock=n}}const Vi=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Ie=(t,e)=>new ir(t,e),Dy=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw qt()},nr=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Xu(e.ds,t.id),oa=(t,e)=>{const n=rn(t.meta,oa,Fn),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<rt(r,s)&&Sn(t,Ie(s,i))}),Ju(t,e.ds,i=>{}),n.add(e))};class rf{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ma=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},rt=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},sf=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw qt()}n.push(e)},Wt=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let c=tn(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[c],s=i.id.clock,s<=e){if(e<s+i.length)return c;n=c+1}else r=c-1;c=tn((n+r)/2)}throw qt()},Ty=(t,e)=>{const n=t.clients.get(e.client);return n[Wt(n,e.clock)]},Lo=Ty,aa=(t,e,n)=>{const r=Wt(e,n),i=e[r];return i.id.clock<n&&i instanceof Je?(e.splice(r+1,0,ks(t,i,n-i.id.clock)),r+1):r},Sn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[aa(t,n,e.clock)]},pl=(t,e,n)=>{const r=e.clients.get(n.client),i=Wt(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==At&&r.splice(i+1,0,ks(t,s,n.clock-s.id.clock+1)),s},Ry=(t,e,n)=>{const r=t.clients.get(e.id.client);r[Wt(r,e.id.clock)]=n},of=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let c=aa(t,e,n),l;do l=e[c++],s<l.id.clock+l.length&&aa(t,e,s),i(l);while(c<e.length&&e[c].id.clock<s)};class Py{constructor(e,n,r){this.doc=e,this.deleteSet=new js,this.beforeState=Ma(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const yl=(t,e)=>e.deleteSet.clients.size===0&&!Bp(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(Ua(e.deleteSet),Oy(t,e),La(t,e.deleteSet),!0),gl=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&rn(t.changed,e,Fn).add(n)},cs=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Je&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},jy=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let c=i.length-1;c>=0;c--){const l=i[c],d=l.clock+l.len;for(let f=Wt(s,l.clock),g=s[f];f<s.length&&g.id.clock<d;g=s[++f]){const p=s[f];if(l.clock+l.len<=p.id.clock)break;p instanceof Je&&p.deleted&&!p.keep&&n(p)&&p.gc(e,!1)}}}},Uy=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const c=n[s],l=Du(i.length-1,1+Wt(i,c.clock+c.len-1));for(let d=l,f=i[d];d>0&&f.id.clock>=c.clock;f=i[d])d-=1+cs(i,d)}})},af=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,c=n._mergeStructs;try{Ua(s),n.afterState=Ma(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const l=[];n.changed.forEach((d,f)=>l.push(()=>{(f._item===null||!f._item.deleted)&&f._callObserver(n,d)})),l.push(()=>{n.changedParentTypes.forEach((d,f)=>{f._dEH.l.length>0&&(f._item===null||!f._item.deleted)&&(d=d.filter(g=>g.target._item===null||!g.target._item.deleted),d.forEach(g=>{g.currentTarget=f,g._path=null}),d.sort((g,p)=>g.path.length-p.path.length),nf(f._dEH,d,n))})}),l.push(()=>r.emit("afterTransaction",[n,r])),Pa(l,[]),n._needFormattingCleanup&&Zy(n)}finally{r.gc&&jy(s,i,r.gcFilter),Uy(s,i),n.afterState.forEach((g,p)=>{const m=n.beforeState.get(p)||0;if(m!==g){const b=i.clients.get(p),S=mr(Wt(b,m),1);for(let x=b.length-1;x>=S;)x-=1+cs(b,x)}});for(let g=c.length-1;g>=0;g--){const{client:p,clock:m}=c[g].id,b=i.clients.get(p),S=Wt(b,m);S+1<b.length&&cs(b,S+1)>1||S>0&&cs(b,S)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(yy(ja,qu,"[yjs] ",Wu,Vu,"Changed the client-id because another client seems to be using it."),r.clientID=Qu()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const g=new Sy;yl(g,n)&&r.emit("update",[g.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const g=new Us;yl(g,n)&&r.emit("updateV2",[g.toUint8Array(),n.origin,r,n])}const{subdocsAdded:l,subdocsLoaded:d,subdocsRemoved:f}=n;(l.size>0||f.size>0||d.size>0)&&(l.forEach(g=>{g.clientID=r.clientID,g.collectionid==null&&(g.collectionid=r.collectionid),r.subdocs.add(g)}),f.forEach(g=>r.subdocs.delete(g)),r.emit("subdocs",[{loaded:d,added:l,removed:f},r,n]),f.forEach(g=>g.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):af(t,e+1)}}},Le=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,c=null;t._transaction===null&&(s=!0,t._transaction=new Py(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{c=e(t._transaction)}finally{if(s){const l=t._transaction===i[0];t._transaction=null,l&&af(i,0)}}return c};function*Ly(t){const e=Ue(t.restDecoder);for(let n=0;n<e;n++){const r=Ue(t.restDecoder),i=t.readClient();let s=Ue(t.restDecoder);for(let c=0;c<r;c++){const l=t.readInfo();if(l===10){const d=Ue(t.restDecoder);yield new Dt(Ie(i,s),d),s+=d}else if((Ts&l)!==0){const d=(l&(en|kt))===0,f=new Je(Ie(i,s),null,(l&kt)===kt?t.readLeftID():null,null,(l&en)===en?t.readRightID():null,d?t.readParentInfo()?t.readString():t.readLeftID():null,d&&(l&ei)===ei?t.readString():null,Of(t,l));yield f,s+=f.length}else{const d=t.readLen();yield new At(Ie(i,s),d),s+=d}}}}class cf{constructor(e,n){this.gen=Ly(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Dt);return this.curr}}class My{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const lf=(t,e=Zu,n=ri)=>{const r=new e,i=new cf(new n(pi(t)),!1);let s=i.curr;if(s!==null){let c=0,l=s.id.client,d=s.id.clock!==0,f=d?0:s.id.clock+s.length;for(;s!==null;s=i.next())l!==s.id.client&&(f!==0&&(c++,be(r.restEncoder,l),be(r.restEncoder,f)),l=s.id.client,f=0,d=s.id.clock!==0),s.constructor===Dt&&(d=!0),d||(f=s.id.clock+s.length);f!==0&&(c++,be(r.restEncoder,l),be(r.restEncoder,f));const g=br();return be(g,c),Cp(g,r.restEncoder),r.restEncoder=g,r.toUint8Array()}else return be(r.restEncoder,0),r.toUint8Array()},Ny=(t,e)=>{if(t.constructor===At){const{client:n,clock:r}=t.id;return new At(Ie(n,r+e),t.length-e)}else if(t.constructor===Dt){const{client:n,clock:r}=t.id;return new Dt(Ie(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new Je(Ie(r,i+e),null,Ie(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},gs=(t,e=ri,n=Us)=>{if(t.length===1)return t[0];const r=t.map(g=>new e(pi(g)));let i=r.map(g=>new cf(g,!0)),s=null;const c=new n,l=new My(c);for(;i=i.filter(m=>m.curr!==null),i.sort((m,b)=>{if(m.curr.id.client===b.curr.id.client){const S=m.curr.id.clock-b.curr.id.clock;return S===0?m.curr.constructor===b.curr.constructor?0:m.curr.constructor===Dt?1:-1:S}else return b.curr.id.client-m.curr.id.client}),i.length!==0;){const g=i[0],p=g.curr.id.client;if(s!==null){let m=g.curr,b=!1;for(;m!==null&&m.id.clock+m.length<=s.struct.id.clock+s.struct.length&&m.id.client>=s.struct.id.client;)m=g.next(),b=!0;if(m===null||m.id.client!==p||b&&m.id.clock>s.struct.id.clock+s.struct.length)continue;if(p!==s.struct.id.client)Mr(l,s.struct,s.offset),s={struct:m,offset:0},g.next();else if(s.struct.id.clock+s.struct.length<m.id.clock)if(s.struct.constructor===Dt)s.struct.length=m.id.clock+m.length-s.struct.id.clock;else{Mr(l,s.struct,s.offset);const S=m.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Dt(Ie(p,s.struct.id.clock+s.struct.length),S),offset:0}}else{const S=s.struct.id.clock+s.struct.length-m.id.clock;S>0&&(s.struct.constructor===Dt?s.struct.length-=S:m=Ny(m,S)),s.struct.mergeWith(m)||(Mr(l,s.struct,s.offset),s={struct:m,offset:0},g.next())}}else s={struct:g.curr,offset:0},g.next();for(let m=g.curr;m!==null&&m.id.client===p&&m.id.clock===s.struct.id.clock+s.struct.length&&m.constructor!==Dt;m=g.next())Mr(l,s.struct,s.offset),s={struct:m,offset:0}}s!==null&&(Mr(l,s.struct,s.offset),s=null),Ky(l);const d=r.map(g=>wy(g)),f=by(d);return La(c,f),c.toUint8Array()},uf=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:wt(t.encoder.restEncoder)}),t.encoder.restEncoder=br(),t.written=0)},Mr=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&uf(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),be(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Ky=t=>{uf(t);const e=t.encoder.restEncoder;be(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];be(e,r.written),hi(e,r.restEncoder)}},ml="You must not compute changes after the event-handler fired.";class Ls{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=By(this.currentTarget,this.target))}deletes(e){return Xu(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw kn(ml);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let c,l;if(this.adds(s)){let d=s.left;for(;d!==null&&this.adds(d);)d=d.left;if(this.deletes(s))if(d!==null&&this.deletes(d))c="delete",l=Ro(d.content.getContent());else return;else d!==null&&this.deletes(d)?(c="update",l=Ro(d.content.getContent())):(c="add",l=void 0)}else if(this.deletes(s))c="delete",l=Ro(s.content.getContent());else return;e.set(i,{action:c,oldValue:l})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw kn(ml);const n=this.target,r=Fn(),i=Fn(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let l=null;const d=()=>{l&&s.push(l)};for(let f=n._start;f!==null;f=f.right)f.deleted?this.deletes(f)&&!this.adds(f)&&((l===null||l.delete===void 0)&&(d(),l={delete:0}),l.delete+=f.length,i.add(f)):this.adds(f)?((l===null||l.insert===void 0)&&(d(),l={insert:[]}),l.insert=l.insert.concat(f.content.getContent()),r.add(f)):((l===null||l.retain===void 0)&&(d(),l={retain:0}),l.retain+=f.length);l!==null&&l.retain===void 0&&d()}this._changes=e}return e}}const By=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},dt=()=>{gy("Invalid access: Add Yjs type to a document before reading data.")},ff=80;let Na=0;class Fy{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Na++}}const $y=t=>{t.timestamp=Na++},df=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Na++},qy=(t,e,n)=>{if(t.length>=ff){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return df(r,e,n),r}else{const r=new Fy(e,n);return t.push(r),r}},Ms=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,c)=>ss(e-s.index)<ss(e-c.index)?s:c);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,$y(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&ss(n.index-i)<r.parent.length/ff?(df(n,r,i),n):qy(t._searchMarker,r,i)},ii=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=mr(e,i.index+n))}},Ns=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;rn(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;nf(r._eH,n,e)};class ot{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=fl(),this._dEH=fl(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw $t()}clone(){throw $t()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){dl(this._eH,e)}observeDeep(e){dl(this._dEH,e)}unobserve(e){hl(this._eH,e)}unobserveDeep(e){hl(this._dEH,e)}toJSON(){}}const hf=(t,e,n)=>{t.doc??dt(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const c=s.content.getContent();if(c.length<=e)e-=c.length;else{for(let l=e;l<c.length&&r>0;l++)i.push(c[l]),r--;e=0}}s=s.right}return i},pf=t=>{t.doc??dt();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},si=(t,e)=>{let n=0,r=t._start;for(t.doc??dt();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},yf=(t,e)=>{const n=[];return si(t,(r,i)=>{n.push(e(r,i,t))}),n},Wy=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},gf=(t,e)=>{t.doc??dt();const n=Ms(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},ms=(t,e,n,r)=>{let i=n;const s=t.doc,c=s.clientID,l=s.store,d=n===null?e._start:n.right;let f=[];const g=()=>{f.length>0&&(i=new Je(Ie(c,rt(l,c)),i,i&&i.lastId,d,d&&d.id,e,null,new qn(f)),i.integrate(t,0),f=[])};r.forEach(p=>{if(p===null)f.push(p);else switch(p.constructor){case Number:case Object:case Boolean:case Array:case String:f.push(p);break;default:switch(g(),p.constructor){case Uint8Array:case ArrayBuffer:i=new Je(Ie(c,rt(l,c)),i,i&&i.lastId,d,d&&d.id,e,null,new yi(new Uint8Array(p))),i.integrate(t,0);break;case _r:i=new Je(Ie(c,rt(l,c)),i,i&&i.lastId,d,d&&d.id,e,null,new gi(p)),i.integrate(t,0);break;default:if(p instanceof ot)i=new Je(Ie(c,rt(l,c)),i,i&&i.lastId,d,d&&d.id,e,null,new on(p)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),g()},mf=()=>kn("Length exceeded!"),vf=(t,e,n,r)=>{if(n>e._length)throw mf();if(n===0)return e._searchMarker&&ii(e._searchMarker,n,r.length),ms(t,e,null,r);const i=n,s=Ms(e,n);let c=e._start;for(s!==null&&(c=s.p,n-=s.index,n===0&&(c=c.prev,n+=c&&c.countable&&!c.deleted?c.length:0));c!==null;c=c.right)if(!c.deleted&&c.countable){if(n<=c.length){n<c.length&&Sn(t,Ie(c.id.client,c.id.clock+n));break}n-=c.length}return e._searchMarker&&ii(e._searchMarker,i,r.length),ms(t,e,c,r)},Vy=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,c)=>c.index>s.index?c:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return ms(t,e,i,n)},bf=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,c=Ms(e,n);let l=e._start;for(c!==null&&(l=c.p,n-=c.index);l!==null&&n>0;l=l.right)!l.deleted&&l.countable&&(n<l.length&&Sn(t,Ie(l.id.client,l.id.clock+n)),n-=l.length);for(;r>0&&l!==null;)l.deleted||(r<l.length&&Sn(t,Ie(l.id.client,l.id.clock+r)),l.delete(t),r-=l.length),l=l.right;if(r>0)throw mf();e._searchMarker&&ii(e._searchMarker,i,-s+r)},vs=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Ka=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,c=s.clientID;let l;if(r==null)l=new qn([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:l=new qn([r]);break;case Uint8Array:l=new yi(r);break;case _r:l=new gi(r);break;default:if(r instanceof ot)l=new on(r);else throw new Error("Unexpected content type")}new Je(Ie(c,rt(s.store,c)),i,i&&i.lastId,null,null,e,n,l).integrate(t,0)},Ba=(t,e)=>{t.doc??dt();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},wf=t=>{const e={};return t.doc??dt(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},_f=(t,e)=>{t.doc??dt();const n=t._map.get(e);return n!==void 0&&!n.deleted},Hy=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&nr(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Hi=t=>(t.doc??dt(),my(t._map.entries(),e=>!e[1].deleted));class zy extends Ls{}class sr extends ot{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new sr;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new sr}clone(){const e=new sr;return e.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),e}get length(){return this.doc??dt(),this._length}_callObserver(e,n){super._callObserver(e,n),Ns(this,e,new zy(this,e))}insert(e,n){this.doc!==null?Le(this.doc,r=>{vf(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Le(this.doc,n=>{Vy(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Le(this.doc,r=>{bf(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return gf(this,e)}toArray(){return pf(this)}slice(e=0,n=this.length){return hf(this,e,n)}toJSON(){return this.map(e=>e instanceof ot?e.toJSON():e)}map(e){return yf(this,e)}forEach(e){si(this,e)}[Symbol.iterator](){return Wy(this)}_write(e){e.writeTypeRef(vg)}}const Yy=t=>new sr;class Gy extends Ls{constructor(e,n,r){super(e,n),this.keysChanged=r}}class fr extends ot{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new fr}clone(){const e=new fr;return this.forEach((n,r)=>{e.set(r,n instanceof ot?n.clone():n)}),e}_callObserver(e,n){Ns(this,e,new Gy(this,e,n))}toJSON(){this.doc??dt();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof ot?i.toJSON():i}}),e}get size(){return[...Hi(this)].length}keys(){return Uo(Hi(this),e=>e[0])}values(){return Uo(Hi(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Uo(Hi(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??dt(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Le(this.doc,n=>{vs(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Le(this.doc,r=>{Ka(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Ba(this,e)}has(e){return _f(this,e)}clear(){this.doc!==null?Le(this.doc,e=>{this.forEach(function(n,r,i){vs(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(bg)}}const Jy=t=>new fr,pn=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Zp(t,e);class ca{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&qt(),this.right.content.constructor){case Qe:this.right.deleted||kr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const vl=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Qe:e.right.deleted||kr(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Sn(t,Ie(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},zi=(t,e,n,r)=>{const i=new Map,s=r?Ms(e,n):null;if(s){const c=new ca(s.p.left,s.p,s.index,i);return vl(t,c,n-s.index)}else{const c=new ca(null,e._start,0,i);return vl(t,c,n)}},kf=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Qe&&pn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((c,l)=>{const d=n.left,f=n.right,g=new Je(Ie(s,rt(i.store,s)),d,d&&d.lastId,f,f&&f.id,e,null,new Qe(l,c));g.integrate(t,0),n.right=g,n.forward()})},kr=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},Sf=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Qe&&pn(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},xf=(t,e,n,r)=>{const i=t.doc,s=i.clientID,c=new Map;for(const l in r){const d=r[l],f=n.currentAttributes.get(l)??null;if(!pn(f,d)){c.set(l,f);const{left:g,right:p}=n;n.right=new Je(Ie(s,rt(i.store,s)),g,g&&g.lastId,p,p&&p.id,e,null,new Qe(l,d)),n.right.integrate(t,0),n.forward()}}return c},Mo=(t,e,n,r,i)=>{n.currentAttributes.forEach((m,b)=>{i[b]===void 0&&(i[b]=null)});const s=t.doc,c=s.clientID;Sf(n,i);const l=xf(t,e,n,i),d=r.constructor===String?new Vt(r):r instanceof ot?new on(r):new Wn(r);let{left:f,right:g,index:p}=n;e._searchMarker&&ii(e._searchMarker,n.index,d.getLength()),g=new Je(Ie(c,rt(s.store,c)),f,f&&f.lastId,g,g&&g.id,e,null,d),g.integrate(t,0),n.right=g,n.index=p,n.forward(),kf(t,e,n,l)},bl=(t,e,n,r,i)=>{const s=t.doc,c=s.clientID;Sf(n,i);const l=xf(t,e,n,i);e:for(;n.right!==null&&(r>0||l.size>0&&(n.right.deleted||n.right.content.constructor===Qe));){if(!n.right.deleted)switch(n.right.content.constructor){case Qe:{const{key:d,value:f}=n.right.content,g=i[d];if(g!==void 0){if(pn(g,f))l.delete(d);else{if(r===0)break e;l.set(d,f)}n.right.delete(t)}else n.currentAttributes.set(d,f);break}default:r<n.right.length&&Sn(t,Ie(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let d="";for(;r>0;r--)d+=`
`;n.right=new Je(Ie(c,rt(s.store,c)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Vt(d)),n.right.integrate(t,0),n.forward()}kf(t,e,n,l)},Cf=(t,e,n,r,i)=>{let s=e;const c=pt();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Qe){const f=s.content;c.set(f.key,f)}s=s.right}let l=0,d=!1;for(;e!==s;){if(n===e&&(d=!0),!e.deleted){const f=e.content;switch(f.constructor){case Qe:{const{key:g,value:p}=f,m=r.get(g)??null;(c.get(g)!==f||m===p)&&(e.delete(t),l++,!d&&(i.get(g)??null)===p&&m!==p&&(m===null?i.delete(g):i.set(g,m))),!d&&!e.deleted&&kr(i,f);break}}}e=e.right}return l},Xy=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Qe){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},Qy=t=>{let e=0;return Le(t.doc,n=>{let r=t._start,i=t._start,s=pt();const c=ia(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Qe:kr(c,i.content);break;default:e+=Cf(n,r,i,s,c),s=ia(c),r=i;break}i=i.right}}),e},Zy=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&of(t,n.store.clients.get(r),s,i,c=>{!c.deleted&&c.content.constructor===Qe&&c.constructor!==At&&e.add(c.parent)})}Le(n,r=>{Ju(t,t.deleteSet,i=>{if(i instanceof At||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Qe?e.add(s):Xy(r,i)});for(const i of e)Qy(i)})},wl=(t,e,n)=>{const r=n,i=ia(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case on:case Wn:case Vt:n<e.right.length&&Sn(t,Ie(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&Cf(t,s,e.right,i,e.currentAttributes);const c=(e.left||e.right).parent;return c._searchMarker&&ii(c._searchMarker,e.index,-r+n),e};class eg extends Ls{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Le(e,r=>{const i=new Map,s=new Map;let c=this.target._start,l=null;const d={};let f="",g=0,p=0;const m=()=>{if(l!==null){let b=null;switch(l){case"delete":p>0&&(b={delete:p}),p=0;break;case"insert":(typeof f=="object"||f.length>0)&&(b={insert:f},i.size>0&&(b.attributes={},i.forEach((S,x)=>{S!==null&&(b.attributes[x]=S)}))),f="";break;case"retain":g>0&&(b={retain:g},Xp(d)||(b.attributes=Gp({},d))),g=0;break}b&&n.push(b),l=null}};for(;c!==null;){switch(c.content.constructor){case on:case Wn:this.adds(c)?this.deletes(c)||(m(),l="insert",f=c.content.getContent()[0],m()):this.deletes(c)?(l!=="delete"&&(m(),l="delete"),p+=1):c.deleted||(l!=="retain"&&(m(),l="retain"),g+=1);break;case Vt:this.adds(c)?this.deletes(c)||(l!=="insert"&&(m(),l="insert"),f+=c.content.str):this.deletes(c)?(l!=="delete"&&(m(),l="delete"),p+=c.length):c.deleted||(l!=="retain"&&(m(),l="retain"),g+=c.length);break;case Qe:{const{key:b,value:S}=c.content;if(this.adds(c)){if(!this.deletes(c)){const x=i.get(b)??null;pn(x,S)?S!==null&&c.delete(r):(l==="retain"&&m(),pn(S,s.get(b)??null)?delete d[b]:d[b]=S)}}else if(this.deletes(c)){s.set(b,S);const x=i.get(b)??null;pn(x,S)||(l==="retain"&&m(),d[b]=x)}else if(!c.deleted){s.set(b,S);const x=d[b];x!==void 0&&(pn(x,S)?x!==null&&c.delete(r):(l==="retain"&&m(),S===null?delete d[b]:d[b]=S))}c.deleted||(l==="insert"&&m(),kr(i,c.content));break}}c=c.right}for(m();n.length>0;){const b=n[n.length-1];if(b.retain!==void 0&&b.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class dr extends ot{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??dt(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new dr}clone(){const e=new dr;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new eg(this,e,n);Ns(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??dt();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Vt&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Le(this.doc,r=>{const i=new ca(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const c=e[s];if(c.insert!==void 0){const l=!n&&typeof c.insert=="string"&&s===e.length-1&&i.right===null&&c.insert.slice(-1)===`
`?c.insert.slice(0,-1):c.insert;(typeof l!="string"||l.length>0)&&Mo(r,this,i,l,c.attributes||{})}else c.retain!==void 0?bl(r,this,i,c.retain,c.attributes||{}):c.delete!==void 0&&wl(r,i,c.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??dt();const i=[],s=new Map,c=this.doc;let l="",d=this._start;function f(){if(l.length>0){const p={};let m=!1;s.forEach((S,x)=>{m=!0,p[x]=S});const b={insert:l};m&&(b.attributes=p),i.push(b),l=""}}const g=()=>{for(;d!==null;){if(nr(d,e)||n!==void 0&&nr(d,n))switch(d.content.constructor){case Vt:{const p=s.get("ychange");e!==void 0&&!nr(d,e)?(p===void 0||p.user!==d.id.client||p.type!=="removed")&&(f(),s.set("ychange",r?r("removed",d.id):{type:"removed"})):n!==void 0&&!nr(d,n)?(p===void 0||p.user!==d.id.client||p.type!=="added")&&(f(),s.set("ychange",r?r("added",d.id):{type:"added"})):p!==void 0&&(f(),s.delete("ychange")),l+=d.content.str;break}case on:case Wn:{f();const p={insert:d.content.getContent()[0]};if(s.size>0){const m={};p.attributes=m,s.forEach((b,S)=>{m[S]=b})}i.push(p);break}case Qe:nr(d,e)&&(f(),kr(s,d.content));break}d=d.right}f()};return e||n?Le(c,p=>{e&&oa(p,e),n&&oa(p,n),g()},"cleanup"):g(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?Le(i,s=>{const c=zi(s,this,e,!r);r||(r={},c.currentAttributes.forEach((l,d)=>{r[d]=l})),Mo(s,this,c,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?Le(i,s=>{const c=zi(s,this,e,!r);Mo(s,this,c,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Le(r,i=>{wl(i,zi(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?Le(i,s=>{const c=zi(s,this,e,!1);c.right!==null&&bl(s,this,c,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Le(this.doc,n=>{vs(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Le(this.doc,r=>{Ka(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Ba(this,e)}getAttributes(){return wf(this)}_write(e){e.writeTypeRef(wg)}}const tg=t=>new dr;class No{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??dt()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===hr||n.constructor===$n)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class $n extends ot{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $n}clone(){const e=new $n;return e.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),e}get length(){return this.doc??dt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new No(this,e)}querySelector(e){e=e.toUpperCase();const r=new No(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),_n(new No(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Ns(this,e,new ig(this,n,e))}toString(){return yf(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),si(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?Le(this.doc,r=>{vf(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Le(this.doc,r=>{const i=e&&e instanceof ot?e._item:e;ms(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw kn("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?Le(this.doc,r=>{bf(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return pf(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return gf(this,e)}slice(e=0,n=this.length){return hf(this,e,n)}forEach(e){si(this,e)}_write(e){e.writeTypeRef(kg)}}const ng=t=>new $n;class hr extends $n{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new hr(this.nodeName)}clone(){const e=new hr(this.nodeName),n=this.getAttributes();return Jp(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof ot?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const l in e)r.push(l);r.sort();const i=r.length;for(let l=0;l<i;l++){const d=r[l];n.push(d+'="'+e[d]+'"')}const s=this.nodeName.toLocaleLowerCase(),c=n.length>0?" "+n.join(" "):"";return`<${s}${c}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Le(this.doc,n=>{vs(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Le(this.doc,r=>{Ka(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Ba(this,e)}hasAttribute(e){return _f(this,e)}getAttributes(e){return e?Hy(this,e):wf(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const c in s){const l=s[c];typeof l=="string"&&i.setAttribute(c,l)}return si(this,c=>{i.appendChild(c.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(_g),e.writeKey(this.nodeName)}}const rg=t=>new hr(t.readKey());class ig extends Ls{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class bs extends fr{constructor(e){super(),this.hookName=e}_copy(){return new bs(this.hookName)}clone(){const e=new bs(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(Sg),e.writeKey(this.hookName)}}const sg=t=>new bs(t.readKey());class ws extends dr{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new ws}clone(){const e=new ws;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const c in e.attributes[i])s.push({key:c,value:e.attributes[i][c]});s.sort((c,l)=>c.key<l.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let c=0;c<s.attrs.length;c++){const l=s.attrs[c];r+=` ${l.key}="${l.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(xg)}}const og=t=>new ws;class Fa{constructor(e,n){this.id=e,this.length=n}get deleted(){throw $t()}mergeWith(e){return!1}write(e,n,r){throw $t()}integrate(e,n){throw $t()}}const ag=0;class At extends Fa{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),sf(e.doc.store,this)}write(e,n){e.writeInfo(ag),e.writeLen(this.length-n)}getMissing(e,n){return null}}class yi{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new yi(this.content)}splice(e){throw $t()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const cg=t=>new yi(t.readBuf());class oi{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new oi(this.len)}splice(e){const n=new oi(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){ys(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const lg=t=>new oi(t.readLen()),Ef=(t,e)=>new _r({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class gi{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new gi(Ef(this.doc.guid,this.opts))}splice(e){throw $t()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const ug=t=>new gi(Ef(t.readString(),t.readAny()));class Wn{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Wn(this.embed)}splice(e){throw $t()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const fg=t=>new Wn(t.readJSON());class Qe{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Qe(this.key,this.value)}splice(e){throw $t()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const dg=t=>new Qe(t.readKey(),t.readJSON());class _s{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new _s(this.arr)}splice(e){const n=new _s(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const hg=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new _s(n)},pg=ps("node_env")==="development";class qn{constructor(e){this.arr=e,pg&&Bu(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new qn(this.arr)}splice(e){const n=new qn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const yg=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new qn(n)};class Vt{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Vt(this.str)}splice(e){const n=new Vt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const gg=t=>new Vt(t.readString()),mg=[Yy,Jy,tg,rg,ng,sg,og],vg=0,bg=1,wg=2,_g=3,kg=4,Sg=5,xg=6;class on{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new on(this.type._copy())}splice(e){throw $t()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const Cg=t=>new on(mg[t.readTypeRef()](t)),ks=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Je(Ie(r,i+n),e,Ie(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ie(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class Je extends Fa{constructor(e,n,r,i,s,c,l,d){super(e,d.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=c,this.parentSub=l,this.redone=null,this.content=d,this.info=this.content.isCountable()?Jc:0}set marker(e){(this.info&To)>0!==e&&(this.info^=To)}get marker(){return(this.info&To)>0}get keep(){return(this.info&Gc)>0}set keep(e){this.keep!==e&&(this.info^=Gc)}get countable(){return(this.info&Jc)>0}get deleted(){return(this.info&Do)>0}set deleted(e){this.deleted!==e&&(this.info^=Do)}markDeleted(){this.info|=Do}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=rt(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=rt(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ir&&this.id.client!==this.parent.client&&this.parent.clock>=rt(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=pl(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Sn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===At||this.right&&this.right.constructor===At)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Je?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Je&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ir){const r=Lo(n,this.parent);r.constructor===At?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=pl(e,e.doc.store,Ie(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,c=new Set;for(;i!==null&&i!==this.right;){if(c.add(i),s.add(i),Vi(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Vi(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&c.has(Lo(e.doc.store,i.origin)))s.has(Lo(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),sf(e.doc.store,this),this.content.integrate(e,this),gl(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new At(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ie(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Vi(e.origin,this.lastId)&&this.right===e&&Vi(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),ys(e.deleteSet,this.id.client,this.id.clock,this.length),gl(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw qt();this.content.gc(e),n?Ry(e,this,new At(this.id,this.length)):this.content=new oi(this.length)}write(e,n){const r=n>0?Ie(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,c=this.content.getRef()&Ts|(r===null?0:kt)|(i===null?0:en)|(s===null?0:ei);if(e.writeInfo(c),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const l=this.parent;if(l._item!==void 0){const d=l._item;if(d===null){const f=Dy(l);e.writeParentInfo(!0),e.writeString(f)}else e.writeParentInfo(!1),e.writeLeftID(d.id)}else l.constructor===String?(e.writeParentInfo(!0),e.writeString(l)):l.constructor===ir?(e.writeParentInfo(!1),e.writeLeftID(l)):qt();s!==null&&e.writeString(s)}this.content.write(e,n)}}const Of=(t,e)=>Eg[e&Ts](t),Eg=[()=>{qt()},lg,hg,cg,gg,fg,dg,Cg,yg,ug,()=>{qt()}],Og=10;class Dt extends Fa{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){qt()}write(e,n){e.writeInfo(Og),be(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const If=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Af="__ $YJS$ __";If[Af]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");If[Af]=!0;const Ko=new FinalizationRegistry(({cache:t,key:e})=>{delete t[e]});function Df(t){var e,n;return(e=(n=t._novip)._docCache)!==null&&e!==void 0?e:n._docCache={cache:{},get size(){return Object.keys(this.cache).length},find(r,i,s){const c=Bo(r,i,s),l=this.cache[c];return l?l.deref():void 0},add(r){var i;const{parentTable:s,parentId:c,parentProp:l}=r.meta;if(!s||!l||c==null)throw new Error("Missing Dexie-related metadata in Y.Doc");const d=Bo(s,c,l),f=(i=this.cache[d])===null||i===void 0?void 0:i.deref();f&&Ko.unregister(f),this.cache[d]=new WeakRef(r),Ko.register(r,{cache:this.cache,key:d},r)},delete(r){Ko.unregister(r);const i=Bo(r.meta.parentTable,r.meta.parentId,r.meta.parentProp),s=this.cache[i];(s==null?void 0:s.deref())===r&&delete this.cache[i]}}}const zr=new WeakSet;function la(t){if(zr.has(t))throw new Error(`Y.Doc ${t.meta.parentId} has been destroyed`)}function Bo(t,e,n){return`${t}[${e}].${n}`}function Ig(t,e,n,r,i,s){let c=e.find(n,s,r);return c||(c=new _r({meta:{db:t,updatesTable:i,parentProp:r,parentTable:n,parentId:s}}),e.add(c),c.on("destroy",()=>{zr.add(c),e.delete(c)}),c)}const{getByKeyPath:Bv}=Ce;let Tf=null;function _l(t){Tf=t}function Ag(t,e,n,r,i,s){let c=0,l=!0;const d=gn(()=>{la(e);const p=n.table(i);return Promise.all([(c>0?p.where("i").between(c,1/0,!1).toArray().then(m=>m.filter(b=>As(b.k,s)===0)):p.where({k:s}).toArray()).then(m=>m),n.table(r).where(":id").equals(s).toArray()])}).subscribe(([p,m])=>{if(p.length>0&&(c=p[p.length-1].i),m.length===0){e.destroy();return}la(e),p.length>0&&Le(e,()=>{p.forEach(b=>{try{_l(b),tf(e,b.u)}finally{_l(null)}})},t,!1),l&&(l=!1,e.emit("load",[e]))},p=>{t.on("error").fire(p)}),f=(p,m)=>{m!==t&&n.table(i).add({k:s,u:p,f:1}).then(b=>{b===c-1&&++c}).catch(b=>{t.on("error").fire(b)})},g=()=>{d.unsubscribe(),e.off("updateV2",f),e.off("destroy",g)};return e.on("updateV2",f),e.on("destroy",g),g}function Rf(){}function Dg(t,e){return t===Rf?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}function Tg(t,e){return t===Rf?e:function(){t.apply(this,arguments),e.apply(this,arguments)}}const Nr=new WeakMap;function kl(){return Ce.Events(null,"load","sync","error")}class ft{static getOrCreateDocument(e,n,r,i){var s,c;const l=Df(e),d=(c=(s=e.table(n).schema.yProps)===null||s===void 0?void 0:s.find(f=>f.prop===r))===null||c===void 0?void 0:c.updatesTable;if(!d)throw new Error(`Updates table for ${n}.${r} not found`);return Ig(e,l,n,r,d,i)}static load(e,n){var r;let i=Nr.get(e);return i?(++i.refCount,(n==null?void 0:n.gracePeriod)!=null&&i.graceTimeout<n.gracePeriod&&(i.graceTimeout=n.gracePeriod),i.graceTimer&&(clearTimeout(i.graceTimer),i.graceTimer=null)):(i=new ft(e),i.graceTimeout=(r=n==null?void 0:n.gracePeriod)!==null&&r!==void 0?r:-1,Nr.set(e,i)),i}static release(e){if(!e||zr.has(e))return;const n=Nr.get(e);n?--n.refCount<=0&&(n.graceTimeout<0?n._release():n.graceTimer||(n.graceTimer=setTimeout(()=>{n.graceTimer=null,n.refCount===0&&n._release()},n.graceTimeout))):e.destroy()}_release(){this.doc&&Promise.resolve(ft.on("beforeunload").fire(this)).finally(()=>{var e;this.refCount===0&&((e=this.doc)===null||e===void 0||e.destroy())})}static for(e){return Nr.get(e)}static get currentUpdateRow(){return Tf}get whenLoaded(){return this._whenLoaded||(this._whenLoaded=new Promise((e,n)=>{if(!this.doc){n(new Error("No Y.Doc associated with this provider"));return}this.doc.isLoaded?e():this._error?n(this._error):zr.has(this.doc)?n(new Ce.AbortError("Document was destroyed before loaded")):(this.on("load",e),this.on("error",n),this.doc.on("destroy",()=>n(new Ce.AbortError("Document was destroyed before loaded"))))})),this._whenLoaded}get whenSynced(){return this._whenSynced||(this._whenSynced=new Promise((e,n)=>{if(!this.doc){n(new Error("No Y.Doc associated with this provider"));return}this.doc.isSynced?e():this._error?n(this._error):zr.has(this.doc)?n(new Ce.AbortError("Document was destroyed before synced")):(this.on("sync",e),this.on("error",n),this.doc.on("destroy",()=>n(new Ce.AbortError("Document was destroyed before synced"))))})),this._whenSynced}constructor(e){this.refCount=1,this.cleanupHandlers=[],this.graceTimeout=-1,this.doc=null,this.destroyed=!1,this.on=kl(),this.doc=e,this.off=(c,l)=>{var d;return(d=this.on[c])===null||d===void 0?void 0:d.unsubscribe(l)},"dispose"in Symbol&&(this[Symbol.dispose]=()=>ft.release(e)),e.on("load",()=>this.on("load").fire()),e.on("sync",c=>c!==!1&&this.on("sync").fire()),e.on("destroy",this.destroy.bind(this)),this.on("error",c=>{this._error=c});const{db:n,parentTable:r,parentId:i,updatesTable:s}=e.meta||{};if(!n||!r||!s)throw new Error("Missing Dexie-related metadata in Y.Doc. Documents need to be obtained through Y.Doc properties from dexie queries.");if(!n.table(r)||!n.table(s))throw new Error(`Table ${r} or ${s} not found in db`);la(e),this.stopObserving=Ag(this,e,n,r,s,i),ft.on("new").fire(this)}destroy(){var e,n,r;console.debug(`Y.Doc ${(n=(e=this.doc)===null||e===void 0?void 0:e.meta)===null||n===void 0?void 0:n.parentId} was destroyed`),Nr.delete(this.doc),this.doc=null,this.destroyed=!0,this.refCount=0,(r=this.stopObserving)===null||r===void 0||r.call(this),this.on=kl(),this.cleanupHandlers.forEach(i=>i())}addCleanupHandler(e){this.cleanupHandlers.push(typeof e=="function"?e:()=>e.unsubscribe())}}ft.on=Ce.Events(null,{new:[Tg],beforeunload:[Dg]});ft.getDocCache=Df;Ce.DexieYProvider?ft=Ce.DexieYProvider||ft:Ce.DexieYProvider=ft;const Fo=3e4;class Rg extends $p{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=hs();this.getLocalState()!==null&&Fo/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,s)=>{s!==this.clientID&&Fo<=n-i.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&Pf(this,r,"timeout")},tn(Fo/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const n=this.clientID,r=this.meta.get(n),i=r===void 0?0:r.clock+1,s=this.states.get(n);e===null?this.states.delete(n):this.states.set(n,e),this.meta.set(n,{clock:i,lastUpdated:hs()});const c=[],l=[],d=[],f=[];e===null?f.push(n):s==null?e!=null&&c.push(n):(l.push(n),Hr(s,e)||d.push(n)),(c.length>0||d.length>0||f.length>0)&&this.emit("change",[{added:c,updated:d,removed:f},"local"]),this.emit("update",[{added:c,updated:l,removed:f},"local"])}setLocalStateField(e,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:n})}getStates(){return this.states}}const Pf=(t,e,n)=>{const r=[];for(let i=0;i<e.length;i++){const s=e[i];if(t.states.has(s)){if(t.states.delete(s),s===t.clientID){const c=t.meta.get(s);t.meta.set(s,{clock:c.clock+1,lastUpdated:hs()})}r.push(s)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},Pg=(t,e,n=t.states)=>{const r=e.length,i=br();be(i,r);for(let s=0;s<r;s++){const c=e[s],l=n.get(c)||null,d=t.meta.get(c).clock;be(i,c),be(i,d),Ot(i,JSON.stringify(l))}return wt(i)},jg=(t,e,n)=>{const r=pi(e),i=hs(),s=[],c=[],l=[],d=[],f=Ue(r);for(let g=0;g<f;g++){const p=Ue(r);let m=Ue(r);const b=JSON.parse(It(r)),S=t.meta.get(p),x=t.states.get(p),N=S===void 0?0:S.clock;(N<m||N===m&&b===null&&t.states.has(p))&&(b===null?p===t.clientID&&t.getLocalState()!=null?m++:t.states.delete(p):t.states.set(p,b),t.meta.set(p,{clock:m,lastUpdated:i}),S===void 0&&b!==null?s.push(p):S!==void 0&&b===null?d.push(p):b!==null&&(Hr(b,x)||l.push(p),c.push(p)))}(s.length>0||l.length>0||d.length>0)&&t.emit("change",[{added:s,updated:l,removed:d},n]),(s.length>0||c.length>0||d.length>0)&&t.emit("update",[{added:s,updated:c,removed:d},n])};function Q(t,e,n,r){return new(n||(n=Promise))(function(i,s){function c(f){try{d(r.next(f))}catch(g){s(g)}}function l(f){try{d(r.throw(f))}catch(g){s(g)}}function d(f){var g;f.done?i(f.value):(g=f.value,g instanceof n?g:new n(function(p){p(g)})).then(c,l)}d((r=r.apply(t,e||[])).next())})}function Ug(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kt(t){return this instanceof Kt?(this.v=t,this):new Kt(t)}function Lg(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",function(p){return function(m){return Promise.resolve(m).then(p,f)}}),r[Symbol.asyncIterator]=function(){return this},r;function c(p,m){i[p]&&(r[p]=function(b){return new Promise(function(S,x){s.push([p,b,S,x])>1||l(p,b)})},m&&(r[p]=m(r[p])))}function l(p,m){try{(function(b){b.value instanceof Kt?Promise.resolve(b.value.v).then(d,f):g(s[0][2],b)})(i[p](m))}catch(b){g(s[0][3],b)}}function d(p){l("next",p)}function f(p){l("throw",p)}function g(p,m){p(m),s.shift(),s.length&&l(s[0][0],s[0][1])}}function Mg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=Ug(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(s){return new Promise(function(c,l){(function(d,f,g,p){Promise.resolve(p).then(function(m){d({value:m,done:g})},f)})(c,l,(s=t[i](s)).done,s.value)})}}}const ht={userId:"unauthorized",name:"Unauthorized",claims:{sub:"unauthorized"},lastLogin:new Date(0)};try{Object.freeze(ht),Object.freeze(ht.claims)}catch{}const ua={},Yr=typeof self<"u"&&self.document&&typeof navigator<"u"&&navigator.serviceWorker;Yr&&Yr.ready.then(t=>ua.registration=t),typeof self<"u"&&"clients"in self&&!self.document&&addEventListener("message",t=>{var e,n;!((n=(e=t.data)===null||e===void 0?void 0:e.type)===null||n===void 0)&&n.startsWith("sw-broadcast-")&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>{var i;return r.id!==((i=t.source)===null||i===void 0?void 0:i.id)&&r.postMessage(t.data)})});class $o{constructor(e){this.name=e}subscribe(e){if(!Yr)return()=>{};const n=r=>{var i;((i=r.data)===null||i===void 0?void 0:i.type)===`sw-broadcast-${this.name}`&&e(r.data.message)};return Yr.addEventListener("message",n),()=>Yr.removeEventListener("message",n)}postMessage(e){var n;typeof self.clients=="object"?[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:`sw-broadcast-${this.name}`,message:e})):ua.registration&&((n=ua.registration.active)===null||n===void 0||n.postMessage({type:`sw-broadcast-${this.name}`,message:e}))}}const Kr=globalThis["lbc-events"]||(globalThis["lbc-events"]=new Map);class Yi extends Xe{constructor(e){const n=typeof BroadcastChannel>"u"?new $o(e):new BroadcastChannel(e);super(r=>{function i(l){r.next(l.detail)}function s(l){r.next(l.data)}let c;(function(l,d){Kr.has(l)?Kr.get(l).push(d):Kr.set(l,[d])})(`lbc-${e}`,i);try{n instanceof $o?c=n.subscribe(l=>r.next(l)):n.addEventListener("message",s)}catch{}return()=>{(function(l,d){const f=Kr.get(l);if(f){const g=f.indexOf(d);g!==-1&&f.splice(g,1)}})(`lbc-${e}`,i),n instanceof $o?c():n.removeEventListener("message",s)}}),this.name=e,this.bc=n}next(e){this.bc.postMessage(e),(function(n){const r=Kr.get(n.type);r&&r.forEach(i=>{try{i(n)}catch{}})})(new CustomEvent(`lbc-${this.name}`,{detail:e}))}}function jf(t,e){return Q(this,void 0,void 0,function*(){try{const n=yield navigator.serviceWorker.ready;if(e==="push"&&n.sync&&(yield n.sync.register(`dexie-cloud:${t.name}`)),!n.active)throw new Error("Failed to trigger sync - there's no active service worker");return void n.active.postMessage({type:"dexie-cloud-sync",dbName:t.name,purpose:e})}catch{}})}function Xt(t,e){t.cloud.usingServiceWorker?jf(t,e):t.localSyncEvent.next({purpose:e})}const Ng="fromBase64"in Uint8Array,Kg="toBase64"in Uint8Array.prototype,$a=typeof Buffer<"u"?t=>Buffer.from(t,"base64"):Ng?t=>Uint8Array.fromBase64(t):t=>{const e=atob(t),n=e.length,r=new Uint8Array(n);for(var i=0;i<n;i++)r[i]=e.charCodeAt(i);return r},Sr=typeof Buffer<"u"?t=>ArrayBuffer.isView(t)?Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"):Buffer.from(t).toString("base64"):Kg?t=>(ArrayBuffer.isView(t)?t:new Uint8Array(t)).toBase64():t=>{const e=ArrayBuffer.isView(t)?t:new Uint8Array(t),n=[];for(let r=0,i=e.length;r<i;r+=4096){const s=e.subarray(r,r+4096);n.push(String.fromCharCode.apply(null,s))}return btoa(n.join(""))};function fa(t){return Q(this,arguments,void 0,function*({realms:e,inviteRealms:n}){const r=JSON.stringify([...e.map(c=>({realmId:c,accepted:!0})),...n.map(c=>({realmId:c,accepted:!1}))].sort((c,l)=>c.realmId<l.realmId?-1:c.realmId>l.realmId?1:0)),i=new TextEncoder().encode(r),s=yield crypto.subtle.digest("SHA-1",i);return Sr(s)})}function ls(t){return Object.entries(t.cloud.schema||{}).filter(([,{markedForSync:e}])=>e).map(([e])=>t.tables.filter(({name:n})=>n===e)[0]).filter(e=>e)}function qa(t){return`$${t}_mutations`}function Uf(t){var e;const n=(e=/^\$(.*)_mutations$/.exec(t))===null||e===void 0?void 0:e[1];if(!n)throw new Error(`Given mutationTable ${t} is not correct`);return n}const Bg=[].concat;function Wa(t){return Bg.apply([],t)}function da(t,e){return Q(this,arguments,void 0,function*(n,r,{since:i={},limit:s=1/0}={}){const c=yield Promise.all(n.map(p=>Q(this,void 0,void 0,function*(){const m=Uf(p.name),b=i[m];let S=b?p.where("rev").above(b):p;s<1/0&&(S=S.limit(s));let x=yield S.toArray();return x=(function(N){return N=N.map(U=>{if(U.type==="modify"&&U.criteria.index===null){const M=Object.assign(Object.assign({},U),{criteria:void 0,changeSpec:void 0,type:"update",keys:U.keys,changeSpecs:[U.changeSpec]});return delete M.criteria,delete M.changeSpec,M}return U}),N})(x),x=(function(N){const U=new Map;for(const M of N)if(M.type==="update"){if(M.keys.length!==1||M.changeSpecs.length!==1)continue;const V=""+M.keys[0],q=M.changeSpecs[0];if(Object.values(q).some(ie=>typeof ie=="object"&&ie&&"@@propmod"in ie))continue;let K=U.get(V);K?K.push({txid:M.txid,updateSpec:q}):U.set(V,[{txid:M.txid,updateSpec:q}])}return N=N.filter(M=>{if(M.type!=="update"||M.keys.length!==1||M.changeSpecs.length!==1)return!0;const V=M.changeSpecs[0];if(Object.values(V).some(Z=>typeof Z=="object"&&Z&&"@@propmod"in Z))return!0;const q=new Set(Object.keys(M.changeSpecs[0])),K=""+M.keys[0],ie=U.get(K);if(!ie)return!0;for(let Z=ie.length-1;Z>=0;--Z){const{txid:he,updateSpec:ne}=ie[Z];if(he===M.txid)break;for(const J of Object.keys(ne))q.delete(J)}return q.size!==0}),N})(x),x.map(N=>({table:m,mut:N}))}))),l=Wa(c).sort((p,m)=>p.mut.txid===m.mut.txid?p.mut.opNo-m.mut.opNo:p.mut.ts-m.mut.ts),d=[];let f=null,g=null;for(const{table:p,mut:m}of l)f&&f.table===p&&g===m.txid?f.muts.push(m):(f={table:p,muts:[m]},g=m.txid,d.push(f));return d})}function Lf(t){const e=new Uint8Array(t);if(typeof crypto<"u")crypto.getRandomValues(e);else for(let n=0;n<t;n++)e[n]=Math.floor(256*Math.random());if(typeof Buffer<"u"&&Buffer.from)return Buffer.from(e).toString("base64");if(typeof btoa<"u")return btoa(String.fromCharCode.apply(null,e));throw new Error("No btoa or Buffer available")}const Fg={}.hasOwnProperty;function Ss(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){(function(f){if(!f)throw new Error("Assertion Failed")})(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)Ss(t,e[r],n[r])}else{var s=e.indexOf(".");if(s!==-1){var c=e.substr(0,s),l=e.substr(s+1);if(l==="")n===void 0?Array.isArray(t)?isNaN(parseInt(c))||t.splice(parseInt(c),1):delete t[c]:t[c]=n;else{var d=t[c];d&&(function(f,g){return Fg.call(f,g)})(t,c)||(d=t[c]={}),Ss(d,l,n)}}else n===void 0?Array.isArray(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}const $g=typeof self<"u"&&typeof crypto<"u"?(t,e=crypto.getRandomValues.bind(crypto))=>{const n=new Uint8Array(t);return e(n),self.btoa(String.fromCharCode.apply(null,n))}:typeof Buffer<"u"?(t,e=qg)=>{const n=Buffer.alloc(t);return e(n),n.toString("base64")}:()=>{throw new Error("No implementation of randomString was found")};function qg(t){for(let e=0;e<t.length;++e)t[e]=Math.floor(256*Math.random())}function Va(t){return typeof t=="string"||!!(Array.isArray(t)&&t.some(e=>Va(e))&&t.every(Mf))}function Mf(t){return typeof t=="string"||typeof t=="number"||Array.isArray(t)&&t.every(Mf)}function Wg(t,e,n){const r=t[e]||(t[e]={}),i=n.keys.map(s=>typeof s=="string"?s:JSON.stringify(s));switch(n.type){case"insert":case"upsert":i.forEach((s,c)=>{r[s]={type:"ups",val:n.values[c]}});break;case"update":case"modify":i.forEach((s,c)=>{const l=n.type==="update"?n.changeSpecs[c]:n.changeSpec,d=r[s];if(d)switch(d.type){case"ups":for(const[f,g]of Object.entries(l))Ss(d.val,f,g);break;case"del":break;case"upd":Object.assign(d.mod,l)}else r[s]={type:"upd",mod:l}});break;case"delete":i.forEach(s=>{r[s]={type:"del"}})}return t}function Sl(t,e){for(const{table:n,muts:r}of e)for(const i of r)Wg(t,n,i)}async function*Vg(t){let e=0,n=new Uint8Array(4),r=0,i=[],s=0;for await(const c of t){const l=new DataView(c.buffer,c.byteOffset,c.byteLength);let d=0;for(;d<c.byteLength;)switch(e){case 0:if(d+4>c.byteLength){for(const f of c.slice(d)){if(r===4)break;n[r++]=f,++d}if(r<4)break}else if(r>0&&r<4)for(const f of c.slice(d,d+4-r))n[r++]=f,++d;case 1:s=r===4?new DataView(n.buffer,0,4).getUint32(0,!1):l.getUint32(d,!1),r?r=0:d+=4;case 2:if(d>=c.byteLength){e=2;break}if(d+s>c.byteLength)i.push(c.slice(d)),s-=c.byteLength-d,e=2,d=c.byteLength;else{if(i.length>0){const f=new Uint8Array(i.reduce((p,m)=>p+m.byteLength,s));let g=0;for(const p of i)f.set(p,g),g+=p.byteLength;f.set(c.slice(d,d+s),g),i=[],yield f}else yield c.slice(d,d+s);d+=s,e=0}}}}class Ln extends Error{constructor({title:e,message:n,messageCode:r,messageParams:i}){super(n),this.name="TokenErrorResponseError",this.title=e,this.messageCode=r,this.messageParams=i}}const qo={},xl={google:'<svg viewBox="0 0 24 24" width="20" height="20"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>',github:'<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>',microsoft:'<svg viewBox="0 0 24 24" width="20" height="20"><rect fill="#F25022" x="1" y="1" width="10" height="10"/><rect fill="#00A4EF" x="1" y="13" width="10" height="10"/><rect fill="#7FBA00" x="13" y="1" width="10" height="10"/><rect fill="#FFB900" x="13" y="13" width="10" height="10"/></svg>',apple:'<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg>'};function Hg(t){return Q(this,void 0,void 0,function*(){var e;let n;if(xl[t.type])n=xl[t.type];else if(!((e=t.iconUrl)===null||e===void 0)&&e.toLowerCase().endsWith(".svg")){const r=yield(function(i){return Q(this,void 0,void 0,function*(){if(qo[i])return qo[i];try{const s=yield fetch(i);if(s.ok){const c=yield s.text();if(c.includes("<svg"))return qo[i]=c,c}}catch{}return null})})(t.iconUrl);r&&(n=r)}return{name:"provider",value:t.name,displayName:`Continue with ${t.displayName}`,iconSvg:n,iconUrl:!n&&t.iconUrl?t.iconUrl:void 0,styleHint:t.type}})}function mi(t,e){return new Promise((n,r)=>{const i=Object.assign(Object.assign({submitLabel:"Submit",cancelLabel:"Cancel"},e),{onSubmit:s=>{t.next(void 0),n(s)},onCancel:()=>{t.next(void 0),r(new Ce.AbortError("User cancelled"))}});t.next(i)})}function xs(t,e,...n){return mi(t,{type:"message-alert",title:e,alerts:n,fields:{},submitLabel:"OK",cancelLabel:null})}function Cl(t,e,n){return Q(this,void 0,void 0,function*(){let r=n||"";for(;!r||!/^[\w-+.]+@([\w-]+\.)+[\w-]{2,10}(\sas\s[\w-+.]+@([\w-]+\.)+[\w-]{2,10})?$/.test(r);)r=(yield mi(t,{type:"email",title:e,alerts:r?[{type:"error",messageCode:"INVALID_EMAIL",message:"Please enter a valid email address",messageParams:{}}]:[],fields:{email:{type:"email",placeholder:"you@somedomain.com"}}})).email;return r})}function El(t,e,n){return Q(this,void 0,void 0,function*(){const r=[{type:"info",messageCode:"OTP_SENT",message:"A One-Time password has been sent to {email}",messageParams:{email:e}}];n&&r.push(n);const{otp:i}=yield mi(t,{type:"otp",title:"Enter OTP",alerts:r,fields:{otp:{type:"otp",label:"OTP",placeholder:"Paste OTP here"}}});return i})}class ha extends Error{constructor(e){super(`OAuth redirect initiated for provider: ${e}`),this.name="OAuthRedirectError",this.provider=e}}function Ks(t){return Q(this,void 0,void 0,function*(){var e,n,r;const i=yield t.getCurrentUser(),{accessToken:s,accessTokenExpiration:c,refreshToken:l,refreshTokenExpiration:d,claims:f}=i;if(!s)return null;if(((e=c==null?void 0:c.getTime())!==null&&e!==void 0?e:1/0)>Date.now()&&(((n=i.license)===null||n===void 0?void 0:n.status)||"ok")==="ok")return i;if(!l)throw new Error("Refresh token missing");if(((r=d==null?void 0:d.getTime())!==null&&r!==void 0?r:1/0)<=Date.now())throw new Error("Refresh token has expired");const g=yield Bs(t.cloud.options.databaseUrl,i);return yield t.table("$logins").update(f.sub,{accessToken:g.accessToken,accessTokenExpiration:g.accessTokenExpiration,claims:g.claims,license:g.license,data:g.data}),g})}function zg(t,e,n,r,i){return Q(this,void 0,void 0,function*(){return e.accessToken&&e.accessTokenExpiration.getTime()>Date.now()?e:e.refreshToken&&(!e.refreshTokenExpiration||e.refreshTokenExpiration.getTime()>Date.now())?yield Bs(t,e):yield(function(s,c,l,d){return Q(this,void 0,void 0,function*(){if(!crypto.subtle)throw typeof location<"u"&&location.protocol==="http:"?new Error("Dexie Cloud Addon needs to use WebCrypto, but your browser has disabled it due to being served from an insecure location. Please serve it from https or http://localhost:<port> (See https://stackoverflow.com/questions/46670556/how-to-enable-crypto-subtle-for-unsecure-origins-in-chrome/46671627#46671627)"):new Error("This browser does not support WebCrypto.");const{privateKey:f,publicKey:g}=yield crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!1,["sign","verify"]);if(!f||!g)throw new Error("Could not generate RSA keypair");s.nonExportablePrivateKey=f;const p=(function(m){const b=Sr(m);return(function(S){let x=`-----BEGIN PUBLIC KEY-----
`;for(;S.length>0;)x+=S.substring(0,64)+`
`,S=S.substring(64);return x+="-----END PUBLIC KEY-----",x})(b)})(yield crypto.subtle.exportKey("spki",g));s.publicKey=g;try{const m=yield c({public_key:p,hints:d});if(m.type==="error")throw new Ln(m);if(m.type!=="tokens")throw new Error(`Unexpected response type from token endpoint: ${m.type}`);return s.accessToken=m.accessToken,s.accessTokenExpiration=new Date(m.accessTokenExpiration),s.refreshToken=m.refreshToken,m.refreshTokenExpiration&&(s.refreshTokenExpiration=new Date(m.refreshTokenExpiration)),s.userId=m.claims.sub,s.email=m.claims.email,s.name=m.claims.name,s.claims=m.claims,s.license={type:m.userType,status:m.claims.license||"ok"},s.data=m.data,m.evalDaysLeft!=null&&(s.license.evalDaysLeft=m.evalDaysLeft),m.userValidUntil!=null&&(s.license.validUntil=new Date(m.userValidUntil)),m.alerts&&m.alerts.length>0&&(yield mi(l,{type:"message-alert",title:"Authentication Alert",fields:{},alerts:m.alerts})),s}catch(m){if(m instanceof ha||(m==null?void 0:m.name)==="OAuthRedirectError")throw m;if(m instanceof Ln)throw yield xs(l,m.title,{type:"error",messageCode:m.messageCode,message:m.message,messageParams:{}}),m;let b="We're having a problem authenticating right now.";throw m instanceof TypeError&&(b=typeof navigator!==void 0&&!navigator.onLine?"You seem to be offline. Please connect to the internet and try again.":Ce.debug||typeof location<"u"&&(location.hostname==="localhost"||location.hostname==="127.0.0.1")?`Could not connect to server. Please verify that your origin '${location.origin}' is whitelisted using \`npx dexie-cloud whitelist\``:"Could not connect to server. Please verify the connection.",yield xs(l,"Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:b,messageParams:{}}).catch(()=>{})),m}})})(e,n,r,i)})}function Bs(t,e){return Q(this,void 0,void 0,function*(){if(!e.refreshToken)throw new Error("Cannot refresh token - refresh token is missing.");if(!e.nonExportablePrivateKey)throw new Error("login.nonExportablePrivateKey is missing - cannot sign refresh token without a private key.");const n=Date.now(),r="RSASSA-PKCS1-v1_5",i=new TextEncoder().encode(e.refreshToken+n),s=yield crypto.subtle.sign(r,e.nonExportablePrivateKey,i),c=Sr(s),l={grant_type:"refresh_token",refresh_token:e.refreshToken,scopes:["ACCESS_DB"],signature:c,signing_algorithm:r,time_stamp:n},d=yield fetch(`${t}/token`,{body:JSON.stringify(l),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});if(d.status!==200)throw new Error(`RefreshToken: Status ${d.status} from ${t}/token`);const f=yield d.json();if(f.type==="error")throw new Ln(f);return e.accessToken=f.accessToken,e.accessTokenExpiration=f.accessTokenExpiration?new Date(f.accessTokenExpiration):void 0,e.claims=f.claims,e.license={type:f.userType,status:f.claims.license||"ok"},f.evalDaysLeft!=null&&(e.license.evalDaysLeft=f.evalDaysLeft),f.userValidUntil!=null&&(e.license.validUntil=new Date(f.userValidUntil)),f.data&&(e.data=f.data),e})}const{toString:Yg}={},Ol={replace:function(t){const e=Object.keys(t);let n=null;for(let i=0,s=e.length;i<s;++i)e[i][0]==="$"&&(n=n||[],n.push(e[i]));if(!n)return t;const r={...t};for(const i of n)delete r[i];for(const i of n)r["$"+i]=t[i];return r}};function Nf(...t){const e=t.reduce((r,i)=>({...r,...i}),t.reduce((r,i)=>({...i,...r}),{})),n=new WeakMap;return{stringify(r,i,s){return JSON.stringify(r,function(l){const d=this[l],f=(function(g){const p=typeof g;switch(typeof g){case"object":case"function":{if(g===null)return null;const b=Object.getPrototypeOf(g);if(!b)return Ol;let S=n.get(b);if(S!==void 0)return S;const x=(m=g,Yg.call(m).slice(8,-1)),N=Object.entries(e).find(([U,M])=>{var V,q;return(q=(V=M==null?void 0:M.test)===null||V===void 0?void 0:V.call(M,g,x))!==null&&q!==void 0?q:U===x});return S=N==null?void 0:N[1],S||(S=Array.isArray(g)?null:typeof g=="function"?e.function||null:Ol),n.set(b,S),S}default:return e[p]}var m})(d);return f?f.replace(d,i,e):d},s)},parse(r,i){const s=[];return JSON.parse(r,function(c,l){const d=l==null?void 0:l.$t;if(d){const g=e[d];l=g?g.revive(l,i,e):l}let f=s[s.length-1];if(f&&f[0]===l){l={...l};for(const g of f[1])delete l[g];for(const[g,p]of Object.entries(f[2]))l[g]=p;s.pop()}if(l===void 0||c[0]==="$"&&c!=="$t"){let g,p;f=s[s.length-1],f&&f[0]===this?(g=f[1],p=f[2]):s.push([this,g=[],p={}]),c[0]==="$"&&c!=="$t"?(g.push(c),p[c.substr(1)]=l):p[c]=void 0}return l})}}}const Gg={Blob:{test:(t,e)=>e==="Blob",replace:(t,e)=>{const n=e.length;return e.push(t),{$t:"Blob",mimeType:t.type,i:n}},revive:({i:t,mimeType:e},n)=>new Blob([n[t]],{type:e})}};var Jg={number:{replace:t=>{switch(!0){case isNaN(t):return{$t:"number",v:"NaN"};case t===1/0:return{$t:"number",v:"Infinity"};case t===-1/0:return{$t:"number",v:"-Infinity"};default:return t}},revive:({v:t})=>Number(t)}};const Xg={bigint:{replace:t=>({$t:"bigint",v:""+t}),revive:t=>BigInt(t.v)}};var Qg={Date:{replace:t=>({$t:"Date",v:isNaN(t.getTime())?"NaN":t.toISOString()}),revive:({v:t})=>new Date(t==="NaN"?NaN:Date.parse(t))}},Zg={Set:{replace:t=>({$t:"Set",v:Array.from(t.entries())}),revive:({v:t})=>new Set(t)}},em={Map:{replace:t=>({$t:"Map",v:Array.from(t.entries())}),revive:({v:t})=>new Map(t)}};const tm=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:void 0;var nm=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","DataView","BigInt64Array","BigUint64Array"].reduce((t,e)=>({...t,[e]:{replace:(n,r,i)=>({$t:e,v:i.ArrayBuffer.replace(n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength),r,i).v}),revive:({v:n},r,i)=>{const s=tm[e];return s&&new s(i.ArrayBuffer.revive({v:n},r,i))}}}),{});function Kf(t){return(function(e){for(var n="",r=0,i=e.length;r<i;r++)n+=Bf[e[r]];return n})(Sr(t))}function rm(t){return $a((function(e){if(typeof e!="string")throw new Error("invalid decoder input: "+e);for(var n="",r=0,i=e.length;r<i;r++)n+=pa[e[r]];return n})(t))}const pa={"-":"=",0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",A:"K",B:"L",C:"M",D:"N",E:"O",F:"P",G:"Q",H:"R",I:"S",J:"T",K:"U",L:"V",M:"W",N:"X",O:"Y",P:"Z",Q:"a",R:"b",S:"c",T:"d",U:"e",V:"f",W:"g",X:"h",Y:"i",Z:"j",_:"k",a:"l",b:"m",c:"n",d:"o",e:"p",f:"q",g:"r",h:"s",i:"t",j:"u",k:"v",l:"w",m:"x",n:"y",o:"z",p:"0",q:"1",r:"2",s:"3",t:"4",u:"5",v:"6",w:"7",x:"8",y:"9",z:"+","|":"/"},Bf={};for(const t of Object.keys(pa))Bf[pa[t]]=t;var im={ArrayBuffer:{replace:t=>({$t:"ArrayBuffer",v:Kf(t)}),revive:({v:t})=>{const e=rm(t);return e.buffer.byteLength===e.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}}};class Wo{constructor(e,n){this.buf=e,this.type=n}}function Ff(t){const e=new XMLHttpRequest;if(e.overrideMimeType("text/plain; charset=x-user-defined"),e.open("GET",URL.createObjectURL(t),!1),e.send(),e.status!==200&&e.status!==0)throw new Error("Bad Blob access: "+e.status);return e.responseText}function $f(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n);return e.buffer}var sm={Blob:{test:(t,e)=>e==="Blob"||t instanceof Wo,replace:t=>({$t:"Blob",v:Sr(t instanceof Wo?t.buf:$f(Ff(t))),type:t.type}),revive:({type:t,v:e})=>{const n=$a(e);return typeof Blob!==void 0?new Blob([n]):new Wo(n.buffer,t)}}};const qf={...Jg,...Xg,...Qg,...Zg,...em,...nm,...im,...sm};function Il(t){return new Promise((e,n)=>{const r=new FileReader;r.onabort=i=>n(new Error("file read aborted")),r.onerror=i=>n(i.target.error),r.onload=i=>e(i.target.result),r.readAsArrayBuffer(t)})}var om={undefined:{replace:()=>({$t:"undefined"}),revive:()=>{}}},am={File:{test:(t,e)=>e==="File",replace:t=>({$t:"File",v:Sr($f(Ff(t))),type:t.type,name:t.name,lastModified:new Date(t.lastModified).toISOString()}),revive:({type:t,v:e,name:n,lastModified:r})=>{const i=$a(e);return new File([i],n,{type:t,lastModified:new Date(r).getTime()})}}};const cm=typeof BigInt=="function"&&typeof BigInt(0)=="bigint";class Al{toString(){return this.v}constructor(e){this.v=e}}const lm=cm?{}:{bigint:{test:t=>t instanceof Al,replace:t=>Object.assign({$t:"bigint"},t),revive:({v:t})=>new Al(t)}},Wf=Object.assign(Object.assign(Object.assign(Object.assign({},om),lm),am),{PropModification:{test:t=>t instanceof Lc,replace:t=>Object.assign({$t:"PropModification"},t["@@propmod"]),revive:t=>{var{$t:e}=t,n=(function(r,i){var s={};for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&i.indexOf(c)<0&&(s[c]=r[c]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var l=0;for(c=Object.getOwnPropertySymbols(r);l<c.length;l++)i.indexOf(c[l])<0&&Object.prototype.propertyIsEnumerable.call(r,c[l])&&(s[c[l]]=r[c[l]])}return s})(t,["$t"]);return new Lc(n)}}}),ai=Nf(qf,Wf),um=(function(...t){const e=Nf(qf,Gg,...t);return{toBinary(n){const[r,i]=this.stringify(n),s=new ArrayBuffer(4);return new DataView(s).setUint32(0,r.size),new Blob([s,r,i])},stringify(n){const r=[],i=e.stringify(n,r);return[new Blob(r.map(s=>{const c=new ArrayBuffer(4);return new DataView(c).setUint32(0,"byteLength"in s?s.byteLength:s.size),new Blob([c,s])})),i]},async parse(n,r){let i=0;const s=[],c=await Il(r),l=new DataView(c);for(;i<c.byteLength;){const d=l.getUint32(i);i+=4;const f=c.slice(i,i+d);i+=d,s.push(f)}return e.parse(n,s)},async fromBinary(n){const r=new DataView(await Il(n.slice(0,4))).getUint32(0),i=n.slice(4,r+4),s=await(function(c){return new Promise((l,d)=>{const f=new FileReader;f.onabort=g=>d(new Error("file read aborted")),f.onerror=g=>d(g.target.error),f.onload=g=>l(g.target.result),f.readAsText(c)})})(n.slice(r+4));return await this.parse(s,i)}}})(Wf);class ya extends Error{constructor(e,n){super(n||`${e.status} ${e.statusText}`),this.httpStatus=e.status}get name(){return"HttpError"}}function fm(t,e,n){const r=[];for(let i of n){const{table:s,muts:c}=i,l=t.tables.find(g=>g.name===s);if(!l)throw new Error(`Internal error: table ${s} not found in DBCore schema`);const{primaryKey:d}=l;let f=i;c.forEach((g,p)=>{const m=!d.outbound&&(g.type==="upsert"||g.type==="insert");g.keys.forEach((b,S)=>{if(Array.isArray(b)){f===i&&(f=Dl(i,m));const x=f.muts[p],N=JSON.stringify(b);x.keys[S]=N}else if(b[0]==="#"){f===i&&(f=Dl(i,m));const x=f.muts[p];if(!e.isLoggedIn)throw new Error("Internal error: Cannot sync private IDs before authenticated");const N=`${b}:${e.userId}`;x.keys[S]=N,m&&Ce.setByKeyPath(x.values[S],d.keyPath,N)}})}),r.push(f)}return r}function Dl(t,e){return Object.assign(Object.assign({},t),{muts:e?t.muts.map(n=>n.type!=="insert"&&n.type!=="upsert"||!n.values?Object.assign(Object.assign({},n),{keys:n.keys.slice()}):Object.assign(Object.assign({},n),{keys:n.keys.slice(),values:n.values.slice()})):t.muts.map(n=>Object.assign(Object.assign({},n),{keys:n.keys.slice()}))})}let ga=new WeakMap;function Vf(t){return Q(this,void 0,void 0,function*(){var e,n;const r=((n=(e=ga.get(t))===null||e===void 0?void 0:e.getTime())!==null&&n!==void 0?n:0)-Date.now();r>0&&(yield new Promise(i=>setTimeout(i,r)))})}function dm(t,e,n,r,i,s,c,l,d){return Q(this,void 0,void 0,function*(){const f={Accept:"application/json, application/x-bison, application/x-bison-stream","Content-Type":"application/tson"},g=yield Ks(i),p=g==null?void 0:g.accessToken;p&&(f.Authorization=`Bearer ${p}`);const m={v:2,dbID:n==null?void 0:n.remoteDbId,clientIdentity:l,schema:c||{},lastPull:n?{serverRevision:n.serverRevision,yServerRevision:n.yServerRevision,realms:n.realms,inviteRealms:n.inviteRealms}:void 0,baseRevs:r,changes:fm(i.dx.core.schema,d,t),y:e,dxcv:i.cloud.version};i.syncStateChangedEvent.next({phase:"pushing"});const b=ai.stringify(m),S=yield fetch(`${s}/sync`,{method:"post",headers:f,credentials:"include",body:b});if(i.syncStateChangedEvent.next({phase:"pulling"}),(function(x,N){const U=N.headers.get("Ratelimit-Limit"),M=N.headers.get("Ratelimit-Remaining"),V=N.headers.get("Ratelimit-Reset");if(U&&M&&V){const q=Number(U),K=Math.max(0,Number(M)),ie=Number(V);if(K<q/2){const Z=Math.ceil(ie/(K+1));ga.set(x,new Date(Date.now()+1e3*Z))}else ga.delete(x)}})(i,S),!S.ok)throw new ya(S);if(S.headers.get("content-type")==="application/x-bison")return um.fromBinary(yield S.blob());{const x=yield S.text();return ai.parse(x)}})}function Br(t){if(t!=null&&t.cancelled)throw new Ce.AbortError("Operation was cancelled")}let or=!1;function Hf(t,e,n,r){return Q(this,void 0,void 0,function*(){yield t.$baseRevs.bulkPut(Object.keys(e).filter(i=>e[i].markedForSync).map(i=>({tableName:i,clientRev:(n[i]||0)+1,serverRev:r}))),yield t.$baseRevs.where("tableName").noneOf(Object.keys(e).filter(i=>e[i].markedForSync)).delete()})}function ma(t,e={}){for(const{table:n,muts:r}of t){const i=r.length>0?r[r.length-1].rev:null;e[n]=i||e[n]||0}return e}function hm(t,e,n){return Q(this,void 0,void 0,function*(){const r=yield t.bulkGet(e),i=[],s=[];e.forEach((c,l)=>{const d=r[l];if(d){for(const[f,g]of Object.entries(n[l]))if(f===t.schema.primKey.keyPath){if(As(g,c)!==0)throw new Error("Cannot change primary key")}else Ce.setByKeyPath(d,f,g);i.push(c),s.push(d)}}),yield t.schema.primKey.keyPath==null?t.bulkPut(s,i):t.bulkPut(s)})}function zf(t,e){return Q(this,void 0,void 0,function*(){for(const{table:n,muts:r}of t){if(!e.dx._allTables[n])continue;const i=e.table(n),{primaryKey:s}=i.core.schema,c=l=>{switch(l[0]){case"[":if(l.endsWith("]"))try{return JSON.parse(l)}catch{}return l;case"#":return l.endsWith(":"+e.cloud.currentUserId)?l.substr(0,l.length-e.cloud.currentUserId.length-1):l;default:return l}};for(const l of r){const d=l.keys.map(c);switch(l.type){case"insert":s.outbound?yield i.bulkAdd(l.values,d):(d.forEach((f,g)=>{Ce.setByKeyPath(l.values[g],s.keyPath,f)}),yield i.bulkAdd(l.values));break;case"upsert":s.outbound?yield i.bulkPut(l.values,d):(d.forEach((f,g)=>{Ce.setByKeyPath(l.values[g],s.keyPath,f)}),yield i.bulkPut(l.values));break;case"modify":d.length===1?yield i.update(d[0],l.changeSpec):yield i.where(":id").anyOf(d).modify(l.changeSpec);break;case"update":yield hm(i,d,l.changeSpecs);break;case"delete":yield i.bulkDelete(d)}}}})}typeof self<"u"&&typeof navigator<"u"&&(or=navigator.onLine,self.addEventListener("online",()=>or=!0),self.addEventListener("offline",()=>or=!1));const wn="dexie-cloud-syncer";function Yf(t,e){return t.where("i").between(e,1/0,!0).toArray()}function Gr(t,e,n){var r,i,s;if(!t.dx._allTables[e])return;const c=(s=(i=(r=t.table(e))===null||r===void 0?void 0:r.schema.yProps)===null||i===void 0?void 0:i.find(l=>l.prop===n))===null||s===void 0?void 0:s.updatesTable;return c&&t.dx._allTables[c]?t.table(c):void 0}function Gf(t,e){return Q(this,void 0,void 0,function*(){var n;const r={};let i,s=!1;for(const c of t)try{switch(c.type){case"u-s":{const l=Gr(e,c.table,c.prop);if(l){const d={k:c.k,u:c.u};c.r&&(d.r=c.r,i=c.r),r[l.name]=yield l.add(d)}break}case"u-ack":{const l=Gr(e,c.table,c.prop);l&&(yield e.transaction("rw",l,d=>Q(this,void 0,void 0,function*(){let f=yield d.table(l.name).get(wn);yield d.table(l.name).put(Object.assign(Object.assign({},f||{i:wn}),{unsentFrom:Math.max((f==null?void 0:f.unsentFrom)||1,c.i+1)}))})));break}case"u-reject":{const l=Gr(e,c.table,c.prop);if(!l)break;const d=(n=yield l.get(c.i))===null||n===void 0?void 0:n.k;if(d!=null){yield e.transaction("rw",l,g=>(g.idbtrans._rejecting_y_ypdate=!0,l.where("i").aboveOrEqual(c.i).filter(p=>As(p.k,d)===0&&!(1&~(p.f||0))).delete()));const f=ft.getDocCache(e.dx).find(c.table,d,c.prop);f&&f.destroy()}break}case"in-sync":{const l=ft.getDocCache(e.dx).find(c.table,c.k,c.prop);l&&!l.isSynced&&l.emit("sync",[!0,l]);break}case"y-complete-sync-done":i=c.yServerRev;break;case"outdated-server-rev":s=!0}}catch{}return{receivedUntils:r,resyncNeeded:s,yServerRevision:i}})}function pm(t,e,n){return Q(this,arguments,void 0,function*(r,i,{yDownloadedRealms:s,realms:c}){if(s&&c&&c.every(g=>s[g]==="*"))return;const l=yield Ks(r),d={"Content-Type":"application/json",Accept:"application/octet-stream"};l&&(d.Authorization=`Bearer ${l.accessToken}`);const f=yield fetch(`${i}/y/download`,{body:ai.stringify({downloadedRealms:s||{}}),method:"POST",headers:d,credentials:"include"});if(!f.ok)throw new Error(`Failed to download Yjs documents from server. Status: ${f.status}`);yield(async function(g,...p){let m=g();for(let b=0;b<p.length;b++)m=p[b](m);for await(const b of m);})((function(g){return async function*(){if(!g.body)throw new Error("Response body is not readable");const p=g.body.getReader();try{for(;;){const{done:m,value:b}=await p.read();if(m)return;yield b}}finally{p.releaseLock()}}})(f),Vg,function(g){return Lg(this,arguments,function*(){var p,m,b,S;let x=null,N=null,U=null,M=[];function V(Z){return Q(this,void 0,void 0,function*(){const he=M[M.length-1];if(M.length>0){if(!x||!N||!U)throw new Error(`Protocol error from ${i}/y/download`);const ne=Gr(r,N,U);ne&&(yield ne.bulkAdd(M)),M=[]}x&&(N&&U&&he||Z)&&(yield r.$syncState.update("syncState",ne=>{const J=ne.yDownloadedRealms||{};J[x]=Z?"*":{tbl:N,prop:U,key:he.k},ne.yDownloadedRealms=J}))})}try{try{for(var q,K=!0,ie=Mg(g);!(p=(q=yield Kt(ie.next())).done);K=!0){S=q.value,K=!1;const Z=new wr(S);for(;Uu(Z);)switch(ur(Z)){case 1:yield Kt(V(!0)),x=It(Z);break;case 2:yield Kt(V(!1)),N=It(Z),U=It(Z);break;case 3:{const he=bn(Z),ne=st(Z);M.push({k:he,u:ne});break}}yield Kt(V(!1))}}catch(Z){m={error:Z}}finally{try{K||p||!(b=ie.return)||(yield Kt(b.call(ie)))}finally{if(m)throw m.error}}yield Kt(V(!0))}catch(Z){throw Z instanceof Ce.DexieError||(yield Kt(V(!1))),Z}})})})}const Jf="currentSyncWorker";function Fs(t,e,n,r){return Xf(t,e,n,r).then(i=>(r!=null&&r.justCheckIfNeeded||t.syncStateChangedEvent.next({phase:"in-sync"}),i)).catch(i=>Q(this,void 0,void 0,function*(){return r!=null&&r.justCheckIfNeeded?Promise.reject(i):or&&(r!=null&&r.retryImmediatelyOnFetchError)&&(i==null?void 0:i.name)==="TypeError"&&/fetch/.test(i==null?void 0:i.message)?(t.syncStateChangedEvent.next({phase:"error",error:i}),yield new Promise(s=>setTimeout(s,500)),yield Fs(t,e,n,Object.assign(Object.assign({},r),{retryImmediatelyOnFetchError:!1}))):(yield t.$syncState.update("syncState",{timestamp:new Date,error:""+i}),t.syncStateChangedEvent.next({phase:or?"error":"offline",error:new Error(""+(i==null?void 0:i.message)||i)}),Promise.reject(i))}))}function Xf(t,e,n){return Q(this,arguments,void 0,function*(r,i,s,{isInitialSync:c,cancelToken:l,justCheckIfNeeded:d,purpose:f}={isInitialSync:!1}){var g;if(!(!((g=r.cloud.options)===null||g===void 0)&&g.databaseUrl))throw new Error("Internal error: sync must not be called when no databaseUrl is configured");const{databaseUrl:p}=i,m=yield r.getCurrentUser(),b=m.isLoggedIn?ls(r):[],S=b.map(le=>r.table(qa(le.name))),x=yield r.getPersistedSyncState(),N=m.isLoggedIn,U=N?(function(le,ae){const H=(ae==null?void 0:ae.syncedTables)||[];return ls(le).filter(de=>!H.includes(de.name))})(r,x):[];Br(l);const M=U.length>0;if(M){if(d)return!0;yield r.transaction("rw",U,le=>Q(this,void 0,void 0,function*(){le.idbtrans.disableChangeTracking=!0,le.idbtrans.disableAccessControl=!0,yield(function(ae,H,de){return Q(this,void 0,void 0,function*(){const ue=new Set(de||[]);for(const pe of ae)pe.name==="members"?yield pe.toCollection().modify(ce=>{ue.has(ce.realmId)||ce.userId&&ce.userId!==ht.userId||(ce.userId=H.userId)}):pe.name==="roles"||(pe.name==="realms"?yield pe.toCollection().modify(ce=>{ue.has(ce.realmId)||ce.owner!==void 0&&ce.owner!==ht.userId||(ce.owner=H.userId)}):yield pe.toCollection().modify(ce=>{ce.realmId&&ue.has(ce.realmId)||(ce.owner&&ce.owner!==ht.userId||(ce.owner=H.userId),ce.realmId&&ce.realmId!==ht.userId||(ce.realmId=H.userId))}))})})(U,m,x==null?void 0:x.realms)})),Br(l)}const[V,q,K,{yMessages:ie,lastUpdateIds:Z}]=yield r.transaction("r",r.tables,()=>Q(this,void 0,void 0,function*(){const le=yield r.getPersistedSyncState();let ae=yield r.$baseRevs.toArray();ae=ae.filter(ue=>b.some(pe=>pe.name===ue.tableName));let H=yield da(S,r);const de=yield(function(ue,pe){return Q(this,void 0,void 0,function*(){const ce=[],ke={};for(const Pe of pe)if(Pe.schema.yProps)for(const at of Pe.schema.yProps){const ze=ue.table(at.updatesTable),Ge=yield ze.get(wn),qe=(Ge==null?void 0:Ge.unsentFrom)||1,ct=(Ge==null?void 0:Ge.receivedUntil)||0,G=Math.min(qe,ct+1),Ze=yield Yf(ze,G);Ze.length>0&&(ke[ze.name]=Ze[Ze.length-1].i);const ge={};for(const Se of Ze){const Ae=!(1&~(Se.f||0));if(Ae&&Se.i<qe)continue;const je=JSON.stringify(Se.k)+"/"+Ae;let gt=ge[je];gt?(gt.u.push(Se.u),gt.i=Math.max(Se.i,gt.i)):(ge[je]=gt={i:Se.i,k:Se.k,isLocal:Ae,u:[]},gt.u.push(Se.u))}for(const{k:Se,isLocal:Ae,u:je,i:gt}of Object.values(ge)){const xn=je.length===1?je[0]:gs(je);if(Ae)ce.push({type:"u-c",table:Pe.name,prop:at.prop,k:Se,u:xn,i:gt});else{const Pt=lf(xn);ce.push({type:"sv",table:Pe.name,prop:at.prop,k:Se,sv:Pt})}}}return{yMessages:ce,lastUpdateIds:ke}})})(r,b);if(Br(l),M){const ue=[...(x==null?void 0:x.realms)||[],...(x==null?void 0:x.inviteRealms)||[]],pe=yield(function(ce,ke,Pe,at){return Q(this,void 0,void 0,function*(){const ze=`upload-${Lf(8)}`;if(ke.isLoggedIn&&ce.length>0){const Ge=new Set(at||[]);return(yield Promise.all(ce.map(qe=>Q(this,void 0,void 0,function*(){const{extractKey:ct}=qe.core.schema.primaryKey;if(!ct)return{table:qe.name,muts:[]};const G=Pe[qe.name],Ze=G!=null&&G.generatedGlobalId?qe.filter(Se=>{return ct(Se),!Ge.has(Se.realmId||"")&&(Ae=ct(Se),!(je=G==null?void 0:G.idPrefix)||typeof Ae=="string"&&Ae.startsWith(je));var Ae,je}):qe.filter(Se=>{const Ae=ct(Se);return!Ge.has(Se.realmId||"")&&Va(Ae)}),ge=yield Ze.toArray();if(ge.length>0){const Se={type:"upsert",values:ge,keys:ge.map(ct),userId:ke.userId,txid:ze};return{table:qe.name,muts:[Se]}}return{table:qe.name,muts:[]}})))).filter(qe=>qe.muts.length>0)}return[]})})(U,m,s,ue);return Br(l),H=H.concat(pe),[H,le,ae,de]}return[H,le,ae,de]})),he=V.some(le=>le.muts.some(ae=>ae.keys.length>0))||ie.some(le=>le.type==="u-c");if(d)return he;if(f==="push"&&!he)return!1;const ne=ma(V,q==null?void 0:q.latestRevisions),J=(q==null?void 0:q.clientIdentity)||$g(16);Br(l);const re=yield dm(V,ie,q,K,r,p,s,J,m),{done:we,newSyncState:ee}=yield r.transaction("rw",r.tables,le=>Q(this,void 0,void 0,function*(){le.idbtrans.disableChangeTracking=!0,le.idbtrans.disableAccessControl=!0;for(const pe of Object.keys(s))re.schema[pe]&&(s[pe]=re.schema[pe]);yield r.$syncState.put(s,"schema");const ae=yield da(S,r,{since:ne});for(const pe of S){const ce=Uf(pe.name);if(ae.some(ke=>ke.table===ce&&ke.muts.length>0)){if(ne[ce]){const ke=ne[ce]||0;yield Promise.all([pe.where("rev").belowOrEqual(ke).delete(),r.$baseRevs.where(":id").between([ce,-1/0],[ce,ke+1],!0,!0).reverse().offset(1).delete()])}}else yield Promise.all([pe.clear(),r.$baseRevs.where({tableName:ce}).delete()])}ma(ae,ne),yield Hf(r,s,ne,re.serverRevision);const H=yield r.getPersistedSyncState();yield(function(pe,ce,ke){return Q(this,void 0,void 0,function*(){const Pe=new Set,at=new Set,ze=ke?ke.realms:[],Ge=ke?ke.inviteRealms:[],qe=new Set(ce.realms),ct=new Set(ce.realms.concat(ce.inviteRealms));for(const G of ze)qe.has(G)||(at.add(G),ct.has(G)||Pe.add(G));for(const G of Ge.concat(ze))ct.has(G)||Pe.add(G);if(Pe.size>0||at.size>0){const G=ls(pe);for(const Ze of G){let ge=["realms","members","roles"].includes(Ze.name)?Pe:at;ge.size!==0&&(Ze.schema.indexes.some(Se=>Se.keyPath==="realmId"||Array.isArray(Se.keyPath)&&Se.keyPath[0]==="realmId")?yield Ze.where("realmId").anyOf([...ge]).delete():yield Ze.filter(Se=>!!(Se!=null&&Se.realmId)&&ge.has(Se.realmId)).delete())}}if(at.size>0&&(ke!=null&&ke.yDownloadedRealms))for(const G of at)delete ke.yDownloadedRealms[G]})})(r,re,H);const de=H||{syncedTables:[],latestRevisions:{},realms:[],inviteRealms:[],clientIdentity:J};N&&(de.syncedTables=b.map(pe=>pe.name).concat(U.map(pe=>pe.name))),de.latestRevisions=ne,de.remoteDbId=re.dbId,de.initiallySynced=!0,de.realms=re.realms,de.inviteRealms=re.inviteRealms,de.serverRevision=re.serverRevision,de.yServerRevision=re.serverRevision,de.timestamp=new Date,delete de.error;const ue=Qf(re.changes,ae);if(yield zf(ue,r),re.yMessages){const{receivedUntils:pe,resyncNeeded:ce,yServerRevision:ke}=yield Gf(re.yMessages,r);ke&&(de.yServerRevision=ke),yield(function(Pe,at,ze){return Q(this,void 0,void 0,function*(){var Ge,qe,ct,G,Ze;const ge={};for(const[Ae,je]of Object.entries(Pe))(Ge=ge[Ae])!==null&&Ge!==void 0||(ge[Ae]={}),ge[Ae].unsentFrom=je+1;for(const[Ae,je]of Object.entries(at))(qe=ge[Ae])!==null&&qe!==void 0||(ge[Ae]={}),ge[Ae].receivedUntil=je;const Se=Object.values(ze.dx._dbSchema).filter(Ae=>Ae.yProps).map(Ae=>Ae.yProps.map(je=>je.updatesTable)).flat();for(const Ae of Se){const je=ge[Ae],gt=(ct=je==null?void 0:je.unsentFrom)!==null&&ct!==void 0?ct:1,xn=(Ze=(G=je==null?void 0:je.receivedUntil)!==null&&G!==void 0?G:(yield ze.table(Ae).where("i").between(1,1/0).reverse().limit(1).primaryKeys())[0])!==null&&Ze!==void 0?Ze:0;yield ze.transaction("rw",Ae,()=>Q(this,void 0,void 0,function*(){const Pt=yield ze.table(Ae).get(wn);Pt?(Pt.unsentFrom=Math.max(gt,Pt.unsentFrom||1),Pt.receivedUntil=Math.max(xn,Pt.receivedUntil||0),yield ze.table(Ae).put(Pt)):yield ze.table(Ae).add({i:wn,unsentFrom:gt,receivedUntil:xn})}))}})})(Z,pe,r),ce&&(de.yDownloadedRealms={})}return r.$syncState.put(de,"syncState"),{done:ae.length===0,newSyncState:de}}));if(!we)return yield Vf(r),yield Xf(r,i,s,{isInitialSync:c,cancelToken:l});const me=Object.values(s).some(le=>{var ae;return(ae=le.yProps)===null||ae===void 0?void 0:ae.length}),ve=!!re.yMessages;if(me&&ve)try{yield pm(r,p,ee)}catch{}return r.syncCompleteEvent.next(),!1})}function Qf(t,e){const n={};Sl(n,t);const r={};return Sl(r,e),(function(i,s){var c,l,d;for(const[f,g]of Object.entries(s))for(const[p,m]of Object.entries(g))switch(m.type){case"ups":{const b=(c=i[f])==null?void 0:c[p];if(b)switch(b.type){case"ups":case"upd":delete i[f][p]}}break;case"del":(l=i[f])==null||delete l[p];break;case"upd":{const b=(d=i[f])==null?void 0:d[p];if(b)switch(b.type){case"ups":for(const[S,x]of Object.entries(m.mod))Ss(b.val,S,x);break;case"del":break;case"upd":for(const S of Object.keys(m.mod))delete b.mod[S]}break}}})(n,r),(function(i,s){const c={};for(const[d,f]of Object.entries(i))for(const[g,p]of Object.entries(f)){const m=c[d]||(c[d]={});(m[p.type]||(m[p.type]=[])).push({key:g,...p})}const l=[];for(const[d,f]of Object.entries(c)){const g={table:d,muts:[]};for(const[p,m]of Object.entries(f))switch(p){case"ups":{const b={type:"upsert",keys:m.map(S=>S.key),values:m.map(S=>S.val),txid:s};g.muts.push(b);break}case"upd":{const b={type:"update",keys:m.map(S=>S.key),changeSpecs:m.map(S=>S.mod),txid:s};g.muts.push(b);break}case"del":{const b={type:"delete",keys:m.map(S=>S.key),txid:s};g.muts.push(b);break}}l.push(g)}return l})(n)}function ym(t){const e=[],n=new Rt(!0),r=new Rt(null);let i=!1,s=new Array(10).fill(0);return r.subscribe(()=>Q(this,void 0,void 0,function*(){if(!i&&e.length>0){i=!0,s.shift(),s.push(Date.now()),n.next(!1);try{yield(function(){return Q(this,void 0,void 0,function*(){for(var c,l,d,f,g,p;e.length>0;){const m=e.shift();try{yield Un(t.cloud.syncState.pipe(Et(({phase:S})=>S==="in-sync"||S==="error")));const b=t.cloud.persistedSyncState.value;if(!m)continue;switch(m.type){case"token-expired":const S=t.cloud.currentUser.value,x=yield Bs(t.cloud.options.databaseUrl,S);yield t.table("$logins").update(S.userId,{accessToken:x.accessToken,accessTokenExpiration:x.accessTokenExpiration,claims:x.claims,license:x.license,data:x.data});break;case"realm-added":!((c=b==null?void 0:b.realms)===null||c===void 0)&&c.includes(m.realm)||!((l=b==null?void 0:b.inviteRealms)===null||l===void 0)&&l.includes(m.realm)||(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-accepted":!((d=b==null?void 0:b.realms)===null||d===void 0)&&d.includes(m.realm)||(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-removed":(!((f=b==null?void 0:b.realms)===null||f===void 0)&&f.includes(m.realm)||!((g=b==null?void 0:b.inviteRealms)===null||g===void 0)&&g.includes(m.realm))&&(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realms-changed":yield t.cloud.sync({purpose:"pull",wait:!0});break;case"changes":if(((p=t.cloud.syncState.value)===null||p===void 0?void 0:p.phase)==="error"){Xt(t,"pull");break}yield t.transaction("rw",t.dx.tables,N=>Q(this,void 0,void 0,function*(){N.idbtrans.disableChangeTracking=!0,N.idbtrans.disableAccessControl=!0;const[U,M,V]=yield Promise.all([t.getSchema(),t.getPersistedSyncState(),t.getCurrentUser()]);if(!M||!U||!V)return;if(m.baseRev!==M.serverRevision)return void(typeof m.baseRev!="string"||typeof M.serverRevision!="bigint"&&typeof M.serverRevision!="object"||Xt(t,"pull"));if((yield Ce.waitFor(fa(M)))!==m.realmSetHash)return void Xt(t,"pull");let q=[];if(V.isLoggedIn){const K=ls(t).map(ie=>t.table(qa(ie.name)));q=yield da(K,t)}if(m.changes.length>0){const K=Qf(m.changes,q);yield zf(K,t)}M.latestRevisions=ma(q,M.latestRevisions),M.serverRevision=m.newRev,yield Hf(t,U,M.latestRevisions,m.newRev),yield t.$syncState.put(M,"syncState")}))}}catch{}}})})()}finally{s[s.length-1]-s[0]<1e4&&(yield new Promise(c=>setTimeout(c,1e3))),i=!1,n.next(!0)}}})),{enqueue:function(c){e.push(c),r.next(null)},readyToServe:n}}const Tl=new WeakMap,Gi={members:"@id, [userId+realmId], [email+realmId], realmId",roles:"[realmId+name]",realms:"@realmId",$jobs:"",$syncState:"",$baseRevs:"[tableName+clientRev]",$logins:"claims.sub, lastLogin"};let gm=0;function Nt(t){"vip"in t&&(t=t.vip);let e=Tl.get(t.cloud);if(!e){const n=new Bn;let r=new Yi(`syncstatechanged-${t.name}`),i=new Yi(`synccomplete-${t.name}`);n.id=++gm;let s=!1;e={get name(){return t.name},close:()=>t.close(),transaction:t.transaction.bind(t),table:t.table.bind(t),get tables(){return t.tables},cloud:t.cloud,get $jobs(){return t.table("$jobs")},get $syncState(){return t.table("$syncState")},get $baseRevs(){return t.table("$baseRevs")},get $logins(){return t.table("$logins")},get realms(){return t.realms},get members(){return t.members},get roles(){return t.roles},get initiallySynced(){return s},localSyncEvent:n,get syncStateChangedEvent(){return r},get syncCompleteEvent(){return i},dx:t},Object.assign(e,{getCurrentUser:()=>e.$logins.toArray().then(l=>l.find(d=>d.isLoggedIn)||ht),getPersistedSyncState:()=>e.$syncState.get("syncState"),getSchema:()=>e.$syncState.get("schema").then(l=>{if(l)for(const d of e.tables)d.schema.primKey&&d.schema.primKey.keyPath&&l[d.name]&&(l[d.name].primaryKey=mm(d.schema.primKey.keyPath));return l}),getOptions:()=>e.$syncState.get("options"),setInitiallySynced(l){s=l},reconfigure(){r=new Yi(`syncstatechanged-${t.name}`),i=new Yi(`synccomplete-${t.name}`)}}),e.messageConsumer=ym(e),e.messageProducer=new Bn,Tl.set(t.cloud,e)}return e}function mm(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}const Rl=new WeakMap;class Ha{constructor(e,n){Rl.set(this,e),Object.assign(this,n)}static load(e,n){return e.table("$logins").get(n).then(r=>new Ha(e,r||{userId:n,claims:{sub:n},lastLogin:new Date(0)}))}save(){return Q(this,void 0,void 0,function*(){Rl.get(this).table("$logins").put(this)})}}function Zf(t,e){return Un(_t(t).pipe(Et(e)))}function ed(t){return Q(this,void 0,void 0,function*(){const e=yield va(t);if(e){if(!(yield(function(n,r,i){return Q(this,void 0,void 0,function*(){const s=[{type:"warning",messageCode:"LOGOUT_CONFIRMATION",message:`{numUnsyncedChanges} unsynced changes will get lost!
                Logout anyway?`,messageParams:{currentUserId:r,numUnsyncedChanges:i.toString()}}];return yield mi(n,{type:"logout-confirmation",title:"Confirm Logout",alerts:s,fields:{},submitLabel:"Confirm logout",cancelLabel:"Cancel"}).then(()=>!0).catch(()=>!1)})})(t.cloud.userInteraction,t.cloud.currentUserId,e)))throw new Error("User cancelled logout due to unsynced changes");yield va(t,{deleteUnsyncedData:!0})}})}function va(t){return Q(this,arguments,void 0,function*(e,{deleteUnsyncedData:n=!1}={}){const[r,i]=yield e.dx.transaction("rw",e.dx.tables,s=>Q(this,void 0,void 0,function*(){const c=s.idbtrans;c.disableChangeTracking=!0,c.disableAccessControl=!0;const l=s.storeNames.filter(f=>f.endsWith("_mutations")),d=(yield Promise.all(l.map(f=>s.table(f).count()))).reduce((f,g)=>f+g,0);if(d>0&&!n)return[d,!1];e.$syncState.delete("syncState");for(const f of e.dx.tables)f.name!=="$jobs"&&f.name!=="$syncState"&&f.clear();return[d,!0]}));return i&&(yield Zf(e.cloud.currentUser,s=>s.userId===ht.userId),yield e.cloud.sync({purpose:"pull",wait:!0})),r})}const Pl={access_denied:"Access was denied by the authentication provider.",invalid_state:"The authentication response could not be verified. Please try again.",email_not_verified:"Your email address must be verified before you can log in.",expired_code:"The authentication code has expired. Please try again.",provider_error:"An error occurred with the authentication provider.",network_error:"A network error occurred during authentication. Please check your connection and try again."};class Bt extends Error{constructor(e,n,r){super(r||Pl[e]),this.name="OAuthError",this.code=e,this.provider=n}get userMessage(){return Pl[this.code]||this.message}}const Ji={providers:[],otpEnabled:!0};function vm(t){typeof sessionStorage<"u"&&sessionStorage.setItem("dexie-cloud-oauth-provider",t.provider);const e=(function(n){const r=new URL(`${n.databaseUrl}/oauth/login/${n.provider}`),i=n.redirectUri||(typeof window<"u"?window.location.href:"");return i&&r.searchParams.set("redirect_uri",i),r.toString()})(t);window.location.href=e}function bm(t){const{userInteraction:e}=t.cloud;return function(n){return Q(this,arguments,void 0,function*({public_key:r,hints:i}){var s,c;let l;const d=(s=t.cloud.options)===null||s===void 0?void 0:s.databaseUrl;if(!d)throw new Error("No database URL given.");if(i!=null&&i.oauthCode&&i.provider)return yield(function(p){return Q(this,void 0,void 0,function*(){const{databaseUrl:m,code:b,publicKey:S,scopes:x=["ACCESS_DB"]}=p,N={grant_type:"authorization_code",code:b,public_key:S,scopes:x};try{const U=yield fetch(`${m}/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N),mode:"cors"});if(!U.ok){if(U.status===400||U.status===401)try{const q=yield U.json();if(q.type==="error")throw q.messageCode==="INVALID_OTP"?new Bt("expired_code",void 0,q.message):new Ln(q)}catch(q){if(q instanceof Bt||q instanceof Ln)throw q}const V=yield U.text().catch(()=>U.statusText);throw new Bt("provider_error",void 0,`Token exchange failed: ${U.status} ${V}`)}const M=yield U.json();if(M.type==="error")throw new Ln(M);if(M.type!=="tokens")throw new Bt("provider_error",void 0,`Unexpected response type: ${M.type}`);return M}catch(U){throw U instanceof Bt||U instanceof Ln?U:U instanceof TypeError?new Bt("network_error"):U}})})({databaseUrl:d,code:i.oauthCode,publicKey:r,scopes:["ACCESS_DB"]});if(i!=null&&i.provider)throw jl(t,i.provider),new ha(i.provider);if((i==null?void 0:i.grant_type)==="demo")l={demo_user:yield Cl(e,"Enter a demo user email",(i==null?void 0:i.email)||(i==null?void 0:i.userId)),grant_type:"demo",scopes:["ACCESS_DB"],public_key:r};else if(i!=null&&i.otpId&&i.otp)l={grant_type:"otp",otp_id:i.otpId,otp:i.otp,scopes:["ACCESS_DB"],public_key:r};else{const p=((c=t.cloud.options)===null||c===void 0?void 0:c.socialAuth)!==!1,m=yield(function(S){return Q(this,arguments,void 0,function*(x,N=!0){if(!N)return Ji;try{const U=yield fetch(`${x}/auth-providers`,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});return U.status===404?Ji:U.ok?yield U.json():Ji}catch{return Ji}})})(d,p);if(m.providers.length>0){const S=yield(function(x,N,U){return Q(this,arguments,void 0,function*(M,V,q,K="Choose login method",ie=[]){const Z=[...yield Promise.all(V.map(Hg))];return q&&Z.push({name:"otp",value:"email",displayName:"Continue with email",iconSvg:'<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 6L12 13 2 6"/></svg>',styleHint:"otp"}),new Promise((he,ne)=>{const J={type:"generic",title:K,alerts:ie,options:Z,fields:{},submitLabel:"",cancelLabel:"Cancel",onSubmit:re=>{M.next(void 0),he("otp"in re?{type:"otp"}:"provider"in re?{type:"provider",provider:re.provider}:{type:"otp"})},onCancel:()=>{M.next(void 0),ne(new Ce.AbortError("User cancelled"))}};M.next(J)})})})(e,m.providers,m.otpEnabled,"Sign in");if(S.type==="provider")throw jl(t,S.provider),new ha(S.provider)}const b=yield Cl(e,"Enter email address",i==null?void 0:i.email);l=/@demo.local$/.test(b)?{demo_user:b,grant_type:"demo",scopes:["ACCESS_DB"],public_key:r}:{email:b,grant_type:"otp",scopes:["ACCESS_DB"]}}const f=yield fetch(`${d}/token`,{body:JSON.stringify(l),method:"post",headers:{"Content-Type":"application/json",mode:"cors"}});if(f.status!==200){const p=yield f.text();throw yield xs(e,"Token request failed",{type:"error",messageCode:"GENERIC_ERROR",message:p,messageParams:{}}).catch(()=>{}),new ya(f,p)}const g=yield f.json();if(g.type==="tokens"||g.type==="error")return g;if(l.grant_type==="otp"&&"email"in l){if(g.type!=="otp-sent")throw new Error(`Unexpected response from ${d}/token`);const p=yield El(e,l.email),m=Object.assign(Object.assign({},l),{otp:p||"",otp_id:g.otp_id,public_key:r});let b=yield fetch(`${d}/token`,{body:JSON.stringify(m),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});for(;b.status===401;){const S=yield b.text();m.otp=yield El(e,l.email,{type:"error",messageCode:"INVALID_OTP",message:S,messageParams:{}}),b=yield fetch(`${d}/token`,{body:JSON.stringify(m),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})}if(b.status!==200){const S=yield b.text();throw new ya(b,S)}return yield b.json()}throw new Error(`Unexpected response from ${d}/token`)})}}function jl(t,e){var n,r;const i=(n=t.cloud.options)===null||n===void 0?void 0:n.databaseUrl;if(!i)throw new Error("No database URL given.");vm({databaseUrl:i,provider:e,redirectUri:((r=t.cloud.options)===null||r===void 0?void 0:r.oauthRedirectUri)||(typeof window<"u"?window.location.href:void 0)})}function Xi(t,...e){globalThis.console[t](...e)}function Qi(t,e){return Q(this,void 0,void 0,function*(){var n;const r=yield t.getCurrentUser(),i=r.userId;if(r.isLoggedIn&&(!e||!e.email&&!e.userId)){if((((n=r.license)===null||n===void 0?void 0:n.status)||"ok")==="ok"&&r.accessToken&&(!r.accessTokenExpiration||r.accessTokenExpiration.getTime()>Date.now()))return!1;if(r.refreshToken&&(!r.refreshTokenExpiration||r.refreshTokenExpiration.getTime()>Date.now()))return yield Ks(t),!1}const s=new Ha(t,{claims:{},lastLogin:new Date(0)});try{yield zg(t.cloud.options.databaseUrl,s,t.cloud.options.fetchTokens||bm(t),t.cloud.userInteraction,e)}catch(c){if(c.name==="OAuthRedirectError")return!1;throw c}return i!==ht.userId&&s.userId!==i&&(yield ed(t)),yield(function(c,l){return Q(this,void 0,void 0,function*(){const d=c.table("$logins");yield c.transaction("rw",d,f=>Q(this,void 0,void 0,function*(){const g=yield d.toArray();yield Promise.all(g.filter(p=>p.userId!==l.userId&&p.isLoggedIn).map(p=>(p.isLoggedIn=!1,d.put(p)))),l.isLoggedIn=!0,l.lastLogin=new Date;try{yield l.save()}catch(p){try{p.name==="DataCloneError"&&(Xi("debug","Login context property names:",Object.keys(l)),Xi("debug","Login context property names:",Object.keys(l)),Xi("debug","Login context:",l),Xi("debug","Login context JSON:",JSON.stringify(l)))}catch{}throw p}})),yield Zf(c.cloud.currentUser,f=>f.userId===l.userId)})})(t,s),Xt(t,"pull"),s.userId!==i})}const wm=typeof InstallTrigger<"u",td=typeof navigator<"u"&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\/|Edge\//.test(navigator.userAgent),_m=td?[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]:NaN,nd=td&&_m<=605||wm,km=typeof self<"u"&&"clients"in self&&!self.document,{toString:Sm}={};function Ul(t){return Sm.call(t).slice(8,-1)}function Vo(t,e){var n;return e.type==="delete"?e.keys:((n=e.keys)===null||n===void 0?void 0:n.slice())||e.values.map(t.extractKey)}function xm(t,e){return(1&e?t[0].toUpperCase():t[0].toLowerCase())+(2&e?t[1].toUpperCase():t[1].toLowerCase())+(4&e?t[2].toUpperCase():t[2].toLowerCase())}const Cm=/b|c|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|x|y|z/i;function Em(t){return t>="A"&&t<="Z"}let Gt=0;function rd(t,e){const n=new Uint8Array(18),r=new Uint8Array(n.buffer,0,6),i=Date.now();Gt>=i?++Gt:Gt=i,r[0]=Gt/1099511627776,r[1]=Gt/4294967296,r[2]=Gt/16777216,r[3]=Gt/65536,r[4]=Gt/256,r[5]=Gt;const s=new Uint8Array(n.buffer,6);return crypto.getRandomValues(s),t+Kf(new Uint8Array(n.buffer))+(e||"")}function Om(t){return{stack:"dbcore",name:"idGenerationMiddleware",level:1,create:e=>Object.assign(Object.assign({},e),{table:n=>{const r=e.table(n);return Object.assign(Object.assign({},r),{mutate:i=>{var s,c;const l=i.trans;if(l.mode==="versionchange"&&(l.disableChangeTracking=!0,l.disableAccessControl=!0),l.disableChangeTracking)return r.mutate(i);if(i.type==="add"||i.type==="put"){const d=(s=t.cloud.schema)===null||s===void 0?void 0:s[n];if(d!=null&&d.generatedGlobalId){if(!((c=t.cloud.options)===null||c===void 0)&&c.databaseUrl&&!t.initiallySynced){const f=Vo(r.schema.primaryKey,i);return r.getMany({keys:f,trans:i.trans,cache:"immutable"}).then(g=>{if(g.length<f.length)throw new Error("Unable to create new objects without an initial sync having been performed.");return r.mutate(i)})}return(function(f,g){let p=null;const m=Vo(r.schema.primaryKey,f);return m.forEach((b,S)=>{if(b===void 0){const x=f.values[S].realmId||t.cloud.currentUserId,N=x.substr(x.length-3);m[S]=rd(g,N),r.schema.primaryKey.outbound||(p||(p=f.values.slice()),p[S]=Ce.deepClone(p[S]),Ce.setByKeyPath(p[S],r.schema.primaryKey.keyPath,m[S]))}else if(typeof b!="string"||!b.startsWith(g)&&!b.startsWith("#"+g))throw new Ce.ConstraintError(`The ID "${b}" is not valid for table "${n}". Primary '@' keys requires the key to be prefixed with "${g}" (or "#${g}).
If you want to generate IDs programmatically, remove '@' from the schema to get rid of this constraint. Dexie Cloud supports custom IDs as long as they are random and globally unique.`)}),r.mutate(Object.assign(Object.assign({},f),{keys:m,values:p||f.values}))})(i,d.idPrefix)}d!=null&&d.markedForSync&&Vo(r.schema.primaryKey,i).forEach((f,g)=>{if(!Va(f)){const p=Array.isArray(f)?f.map(Ul).join(","):Ul(f);throw new Ce.ConstraintError(`Invalid primary key type ${p} for table ${n}. Tables marked for sync has primary keys of type string or Array of string (and optional numbers)`)}})}return r.mutate(i)}})}})}}let Im=0;function Fr(t,e){return function(n){const{readers:r,writers:i}=n.trans[e]||(n.trans[e]={writers:[],readers:[]}),s=i.length,c=(s>0?i[s-1].then(()=>t(n),()=>t(n)):t(n)).finally(()=>{r.splice(r.indexOf(c))});return r.push(c),c}}function Am(t,e){return function(n){const{readers:r,writers:i}=n.trans[e]||(n.trans[e]={writers:[],readers:[]});let s=(i.length>0?i[i.length-1].then(()=>t(n),()=>t(n)):r.length>0?(c=r,new Promise(l=>{c.length===0&&l([]);let d=c.length;const f=new Array(d);c.forEach((g,p)=>Promise.resolve(g).then(m=>f[p]={status:"fulfilled",value:m},m=>f[p]={status:"rejected",reason:m}).then(()=>--d||l(f)))})).then(()=>t(n)):t(n)).finally(()=>{i.shift()});var c;return i.push(s),s}}const er=new Rt(new Set);function ci(t){var e,n,r,i;return((e=t.cloud.options)===null||e===void 0?void 0:e.disableEagerSync)||((r=(n=t.cloud.currentUser.value)===null||n===void 0?void 0:n.license)===null||r===void 0?void 0:r.status)!=="ok"||!(!((i=t.cloud.options)===null||i===void 0)&&i.databaseUrl)}function Dm({currentUserObservable:t,db:e}){return{stack:"dbcore",name:"MutationTrackingMiddleware",level:1,create:n=>{const r=new Set(n.schema.tables.map(c=>c.name)),i=n.schema.tables.filter(c=>!/^\$/.test(c.name)),s=new Map;for(const c of i){const l=`$${c.name}_mutations`;r.has(l)&&s.set(c.name,n.table(l))}return Object.assign(Object.assign({},n),{transaction:(c,l)=>{let d;if(l==="readwrite"){const f=c.filter(g=>{var p,m;return(m=(p=e.cloud.schema)===null||p===void 0?void 0:p[g])===null||m===void 0?void 0:m.markedForSync}).map(g=>qa(g));d=n.transaction([...c,...f],l)}else d=n.transaction(c,l);if(l==="readwrite"){d.txid=Lf(16),d.opCount=0,d.currentUser=t.value,er.value.add(d),er.next(er.value);const f=()=>{d.removeEventListener("complete",g),d.removeEventListener("error",f),d.removeEventListener("abort",f),er.value.delete(d),er.next(er.value)},g=()=>{d.mutationsAdded&&!ci(e)&&Xt(e,"push"),f()};d.addEventListener("complete",g),d.addEventListener("error",f),d.addEventListener("abort",f)}return d},table:c=>{const l=n.table(c);if(/^\$/.test(c))return c.endsWith("_mutations")?Object.assign(Object.assign({},l),{mutate:p=>(p.type!=="add"&&p.type!=="put"||(p.trans.mutationsAdded=!0),l.mutate(p))}):c==="$logins"?Object.assign(Object.assign({},l),{mutate:p=>l.mutate(p).then(m=>(p.trans.mutationsAdded=!0,m)).catch(m=>Promise.reject(m))}):l;const{schema:d}=l,f=s.get(c);return f?(function(p){const m="$lock"+ ++Im;return Object.assign(Object.assign({},p),{count:Fr(p.count,m),get:Fr(p.get,m),getMany:Fr(p.getMany,m),openCursor:Fr(p.openCursor,m),query:Fr(p.query,m),mutate:Am(p.mutate,m)})})(Object.assign(Object.assign({},l),{mutate:p=>{var m,b,S;const x=p.trans;return x.txid?x.disableChangeTracking?l.mutate(p):!((b=(m=e.cloud.schema)===null||m===void 0?void 0:m[c])===null||b===void 0)&&b.markedForSync&&(!((S=x.currentUser)===null||S===void 0)&&S.isLoggedIn)?p.type==="deleteRange"?l.query({query:{range:p.range,index:d.primaryKey},trans:p.trans,values:!1}).then(N=>g({type:"delete",keys:N.result,trans:p.trans,criteria:{index:null,range:p.range}})):g(p):l.mutate(p):l.mutate(p)}})):l;function g(p){var m,b;const S=p.trans,x=(b=(m=e.cloud.options)===null||m===void 0?void 0:m.unsyncedProperties)===null||b===void 0?void 0:b[c],{txid:N,currentUser:{userId:U}}=S,{type:M}=p,V=++S.opCount;function q(K){if(!x)return K;let ie=K;for(const Z of Object.keys(K))x.some(he=>Z===he||Z.startsWith(he+"."))&&(ie===K&&(ie=Object.assign({},K)),delete ie[Z]);return ie}return l.mutate(p).then(K=>{var ie;const{numFailures:Z,failures:he}=K;let ne=M==="delete"?p.keys:K.results,J="values"in p?p.values:[],re="changeSpec"in p?p.changeSpec:void 0,we="updates"in p?p.updates:void 0,ee=!(!we||!("upsert"in p))&&p.upsert;if(Z&&(ne=ne.filter((ae,H)=>!he[H]),J=J.filter((ae,H)=>!he[H])),x){if(J=J.map(ae=>{const H=Object.assign({},ae);for(const de of x)delete H[de];return H}),re&&(re=q(re),Object.keys(re).length===0))return K;if(we){let ae=we.changeSpecs.map(q),H={keys:[],changeSpecs:[]};const de=new ih;let ue=!1;if(!ee){for(let pe=0,ce=ae.length;pe<ce;++pe)Object.keys(ae[pe]).length>0?(H.keys.push(we.keys[pe]),H.changeSpecs.push(ae[pe]),de.addKey(we.keys[pe])):ue=!0;if(we=H,ue){let pe=[],ce=[];for(let ke=0,Pe=ne.length;ke<Pe;++ke)de.hasKey(ne[ke])&&(pe.push(ne[ke]),ce.push(J[ke]));ne=pe,J=ce}}}}const me=Date.now();let ve="criteria"in p&&p.criteria?Object.assign(Object.assign({},p.criteria),{index:p.criteria.index===d.primaryKey.keyPath?null:p.criteria.index}):void 0;if(x&&(ve!=null&&ve.index)){const ae=(ie=d.indexes.find(H=>H.name===ve.index))===null||ie===void 0?void 0:ie.keyPath;(ae?typeof ae=="string"?[ae]:ae:[]).some(H=>x==null?void 0:x.includes(H))&&(ve=void 0)}const le=p.type==="delete"?{type:"delete",ts:me,opNo:V,keys:ne,criteria:ve,txid:N,userId:U}:p.type==="add"?{type:"insert",ts:me,opNo:V,keys:ne,txid:N,userId:U,values:J}:ee&&we?{type:"upsert",ts:me,opNo:V,keys:ne,values:J,changeSpecs:we.changeSpecs.filter((ae,H)=>!he[H]),txid:N,userId:U}:ve&&re?{type:"modify",ts:me,opNo:V,keys:ne,criteria:ve,changeSpec:re,txid:N,userId:U}:re?{type:"update",ts:me,opNo:V,keys:ne,changeSpecs:ne.map(()=>re),txid:N,userId:U}:we?{type:"update",ts:me,opNo:V,keys:we.keys,changeSpecs:we.changeSpecs,txid:N,userId:U}:{type:"upsert",ts:me,opNo:V,keys:ne,values:J,txid:N,userId:U};return"isAdditionalChunk"in p&&p.isAdditionalChunk&&(le.isAdditionalChunk=!0),ne.length>0||ve?f.mutate({type:"add",trans:S,values:[le]}).then(()=>(S.mutationsAdded=!0,K)):K})}}})}}}function Tm(t,e){return function(n,r){var i;const s=Object.assign(Object.assign({},Gi),n);Object.keys(Gi).forEach(f=>{const g=s[f];if(g==null)throw new Error(`Cannot delete table ${f} as it is needed for access control of Dexie Cloud`);if(!n[f])return;const p=g.split(",").map(S=>S.trim()),m=Gi[f].split(",").map(S=>S.trim()),b=new Set(p.map(S=>S.replace(/([&*]|\+\+)/g,"")));if(p[0]!==m[0])throw new Error(`Cannot override primary key of table ${f}. Please declare it as {${f}: ${JSON.stringify(Gi[f])}`);for(let S=1;S<m.length;++S){const x=m[S];b.has(x.replace(/([&*]|\+\+)/g,""))||(s[f]+=`,${x}`)}});const c=e.cloud.schema||(e.cloud.schema={}),l=new Set;Object.keys(s).forEach(f=>{var g;const p=(g=s[f])===null||g===void 0?void 0:g.trim(),m=c[f]||(c[f]={});p!=null?(/^\@/.test(p)&&(s[f]=s[f].substr(1),m.generatedGlobalId=!0,m.idPrefix=(function(b,S){let x=b[0].toLocaleLowerCase();for(let N=1,U=b.length;N<U&&x.length<3;++N)(Cm.test(b[N])||Em(b[N]))&&(x+=b[N].toLowerCase());for(;S.has(x);){if(/\d/g.test(x)){if(x=x.substr(0,x.length-1)+(x[x.length-1]+1),!(x.length>3))continue;x=x.substr(0,3)}else if(x.length<3){x+="2";continue}let N=1,U=x;for(;S.has(U)&&N<8;)U=xm(x,N),++N;if(N<8)x=U;else{let M=x.charCodeAt(2)+1&127;x=x.substr(0,2)+String.fromCharCode(M)}}return x})(f,l),l.add(m.idPrefix)),/^\$/.test(f)||(s[`$${f}_mutations`]="++rev",m.markedForSync=!0),m.deleted&&(m.deleted=!1)):(m.deleted=!0,m.markedForSync=!1,s[`$${f}_mutations`]=null)});const d=t.call(this,s,r);for(const[f,g]of Object.entries(r))if(!((i=g.yProps)===null||i===void 0)&&i.length){const p=c[f];p&&(p.yProps=g.yProps.map(m=>m.prop))}return d}}function id(t,e,n){return typeof navigator<"u"&&navigator.locks?navigator.locks.request(t.name+"|"+e,n):n()}const Jr=new Rt(!0),ba=new Rt(!0);Jr.pipe(ut(t=>t?Zt(!0):Zt(!1).pipe(Ou(2e4))),Iu()).subscribe(ba);const sd=typeof document<"u"?Ft(document,"visibilitychange"):Zt({}),Rm=sd.pipe(Et(()=>document.visibilityState==="hidden")),Pm=sd.pipe(Et(()=>document.visibilityState==="visible")),od=typeof window<"u"?Ds(Pm,Ft(window,"mousedown"),Ft(window,"mousemove"),Ft(window,"keydown"),Ft(window,"wheel"),Ft(window,"touchmove")):Zt({});typeof document<"u"&&Ds(Zt(!0),Rm,od).pipe(bt(()=>document.visibilityState==="visible"),ea(t=>{Jr.value!==t&&Jr.next(t)}),ut(t=>t?Zt(0).pipe(Ou(16e4),ea(()=>Jr.next(!1))):Zt(0))).subscribe(()=>{});class jm extends Error{constructor(){super(...arguments),this.name="TokenExpiredError"}}const ad=new WeakMap,Ll=new WeakMap;function cd(t){let e=Ll.get(t);return e||(e=new Bn,Ll.set(t,e)),e}class Um extends Xe{constructor(e,n,r,i,s,c,l,d){super(f=>new Mm(e,n,r,i,s,d,f,c,l))}}let Lm=0;class Mm extends yr{constructor(e,n,r,i,s,c,l,d,f){super(()=>this.teardown()),this.id=++Lm,this.subscriptions=new Set,this.reconnecting=!1,this.db=e,this.databaseUrl=e.cloud.options.databaseUrl,this.rev=n,this.yrev=r,this.realmSetHash=i,this.clientIdentity=s,this.user=c,this.subscriber=l,this.lastUserActivity=new Date,this.messageProducer=d,this.webSocketStatus=f,this.connect()}teardown(){this.disconnect()}disconnect(){if(this.webSocketStatus.next("disconnected"),this.pinger&&(clearInterval(this.pinger),this.pinger=null),this.ws)try{this.ws.close()}catch{}this.ws=null;for(const e of this.subscriptions)e.unsubscribe();this.subscriptions.clear()}reconnect(){if(!this.reconnecting){this.reconnecting=!0;try{this.disconnect()}catch{}this.connect().catch(()=>{}).then(()=>this.reconnecting=!1)}}connect(){return Q(this,void 0,void 0,function*(){if(this.lastServerActivity=new Date,this.pauseUntil&&this.pauseUntil>new Date)return;if(this.ws)throw new Error("Called connect() when a connection is already open");if(!this.databaseUrl)throw new Error("Cannot connect without a database URL");if(this.closed)return;const e=this.user.accessTokenExpiration;if(e&&e<new Date)return void this.subscriber.error(new jm);this.webSocketStatus.next("connecting"),this.pinger=setInterval(()=>Q(this,void 0,void 0,function*(){if(this.closed)this.teardown();else if(this.ws)try{this.ws.send(JSON.stringify({type:"ping"})),setTimeout(()=>{this.pinger&&(this.closed?this.teardown():this.lastServerActivity<new Date(Date.now()-2e4)&&this.reconnect())},2e4)}catch{this.reconnect()}else this.reconnect()}),3e4);const n=new URL(this.databaseUrl);n.protocol=n.protocol==="http:"?"ws":"wss";const r=new URLSearchParams;if(this.subscriber.closed)return;r.set("v","2"),this.rev&&r.set("rev",this.rev),this.yrev&&r.set("yrev",this.yrev),r.set("realmsHash",this.realmSetHash),r.set("clientId",this.clientIdentity),r.set("dxcv",this.db.cloud.version),this.user.accessToken&&r.set("token",this.user.accessToken);const i=this.ws=new WebSocket(`${n}/changes?${r}`);i.binaryType="arraybuffer",i.onclose=s=>{this.pinger&&this.reconnect()},i.onmessage=s=>{if(this.pinger){this.lastServerActivity=new Date;try{const c=typeof s.data=="string"?ai.parse(s.data):(function(l){const d=new wr(l),f=It(d);if(f==="outdated-server-rev")return{type:f};if(f==="y-complete-sync-done")return{type:f,yServerRev:It(d)};const g=It(d),p=It(d);switch(f){case"u-ack":case"u-reject":return{type:f,table:g,prop:p,i:Number(rl(d))};default:{const m=bn(d);switch(f){case"in-sync":case"doc-close":return{type:f,table:g,prop:p,k:m};case"aware":return{type:f,table:g,prop:p,k:m,u:st(d)};case"doc-open":return{type:f,table:g,prop:p,k:m,serverRev:bn(d),sv:bn(d)};case"sv":return{type:f,table:g,prop:p,k:m,sv:st(d)};case"u-c":return{type:f,table:g,prop:p,k:m,u:st(d),i:Number(rl(d))};case"u-s":return{type:f,table:g,prop:p,k:m,u:st(d),r:d.pos<d.arr.length&&It(d)||void 0};default:throw new TypeError(`Unknown message type: ${f}`)}}}})(new Uint8Array(s.data));if(c.type==="error")throw new Error(`Error message from dexie-cloud: ${c.error}`);if(c.type==="aware"){const l=ft.getDocCache(this.db.dx).find(c.table,c.k,c.prop);if(l){const d=(f=>ad.get(f))(l);d&&jg(d,c.u,"server")}}else if(c.type!=="pong")if(c.type==="doc-open"){const l=ft.getDocCache(this.db.dx).find(c.table,c.k,c.prop);l&&cd(l).next()}else c.type==="u-ack"||c.type==="u-reject"||c.type==="u-s"||c.type==="in-sync"||c.type==="outdated-server-rev"||c.type==="y-complete-sync-done"?Gf([c],this.db).then(l=>Q(this,[l],void 0,function*({resyncNeeded:d,yServerRevision:f,receivedUntils:g}){if(f&&(yield this.db.$syncState.update("syncState",{yServerRevision:f})),c.type==="u-s"&&g){const p=Gr(this.db,c.table,c.prop);if(p){const m=g[p.name];m&&(yield p.update(wn,{receivedUntil:m}))}}d&&(yield this.db.cloud.sync({purpose:"pull",wait:!0}))})):this.subscriber.next(c)}catch(c){this.subscriber.error(c)}}};try{let s=!1;yield new Promise((c,l)=>{i.onopen=d=>{s=!0,c(null)},i.onerror=d=>{if(s)this.reconnect();else{const f=d.error||new Error("WebSocket Error");this.subscriber.error(f),this.webSocketStatus.next("error"),l(f)}}}),this.subscriptions.add(this.messageProducer.subscribe(c=>{var l,d;this.closed||(c.type==="ready"&&this.webSocketStatus.value!=="connected"&&this.webSocketStatus.next("connected"),c.type==="ready"?(this.rev=c.rev,(l=this.ws)===null||l===void 0||l.send(ai.stringify(c))):(d=this.ws)===null||d===void 0||d.send((function(f){const g=new vr;switch(Ot(g,f.type),"table"in f&&Ot(g,f.table),"prop"in f&&Ot(g,f.prop),f.type){case"u-ack":case"u-reject":Qc(g,BigInt(f.i));break;case"outdated-server-rev":break;case"y-complete-sync-done":Ot(g,f.yServerRev);break;default:switch(vn(g,f.k),f.type){case"aware":it(g,f.u);break;case"doc-open":vn(g,f.serverRev),vn(g,f.sv);break;case"doc-close":break;case"sv":it(g,f.sv);break;case"u-c":it(g,f.u),Qc(g,BigInt(f.i));break;case"u-s":it(g,f.u),Ot(g,f.r||"")}}return wt(g)})(c)))})),this.user.isLoggedIn&&!ci(this.db)&&this.subscriptions.add((function(c){const l=Wa(c.tables.filter(d=>{var f,g;return((g=(f=c.cloud.schema)===null||f===void 0?void 0:f[d.name])===null||g===void 0?void 0:g.markedForSync)&&d.schema.yProps}).map(d=>d.schema.yProps.map(f=>({table:d.name,ydocProp:f.prop,updatesTable:f.updatesTable}))));return Ds(...l.map(({table:d,ydocProp:f,updatesTable:g})=>{const p=c.table(g);return _t(p.get(wn)).pipe(ut(m=>{let b=(m==null?void 0:m.unsentFrom)||1;return _t(gn(()=>Q(this,void 0,void 0,function*(){return(yield Yf(p,b)).filter(S=>S.f&&1&S.f).map(S=>({type:"u-c",table:d,prop:f,k:S.k,u:S.u,i:S.i}))}))).pipe(ea(S=>{S.length>0&&(b=S.at(-1).i+1)}))}))})).pipe(di(d=>d))})(this.db).subscribe(this.db.messageProducer))}catch{this.pauseUntil=new Date(Date.now()+6e4)}})}}class Nm extends Error{constructor(e){super(e==="expired"?"License expired":e==="deactivated"?"User deactivated":"Invalid license"),this.name="InvalidLicenseError",e&&(this.license=e)}}function Km(t){return Q(this,void 0,void 0,function*(){var e;yield(e=3e3,new Promise(n=>setTimeout(n,e))),yield Un(od)})}function Ml(t){return Q(this,void 0,void 0,function*(){var e;return!(!(!((e=t.cloud.options)===null||e===void 0)&&e.databaseUrl)||!t.cloud.schema)&&(yield Fs(t,t.cloud.options,t.cloud.schema,{justCheckIfNeeded:!0}))})}const Zi=new WeakMap;function za(t,e,n,r){const i=Zi.get(t);if(i){if(i.pull||(r==null?void 0:r.purpose)==="push")return i.promise;{let c=!1;const l=t.cloud.syncState.subscribe(d=>{d.phase==="pulling"&&(c=!0)});return i.promise.then(()=>{l.unsubscribe()}).catch(d=>(l.unsubscribe(),Promise.reject(d))).then(()=>{if(!c)return za(t,e,n,r)})}}const s=(function(){return Q(this,void 0,void 0,function*(){try{yield Vf(t),yield id(t,Jf,()=>Fs(t,e,n,r)),Zi.delete(t)}catch(c){throw Zi.delete(t),c}})})();return Zi.set(t,{promise:s,pull:(r==null?void 0:r.purpose)!=="push"}),s}function Bm(t,e,n){let r=null,i={cancelled:!1},s=0,c=0;function l(b=1){setTimeout(()=>{const S=d?"pull":"push";c=Date.now(),za(t,e,n,{cancelToken:i,retryImmediatelyOnFetchError:!0,purpose:S}).then(()=>{if(i.cancelled)m();else if(d||f)return d=!1,f=!1,l();g=!1,s=0,c=0}).catch(x=>{if(i.cancelled)m(),g=!1,s=0,c=0;else if(b<5){const N=1e3*[0,20,40,300,900][b];s=Date.now()+N,c=0,setTimeout(()=>l(b+1),N)}else g=!1,s=0,c=0})},0)}let d=!1,f=!1,g=!1;const p=b=>{i.cancelled||(b==="pull"&&(d=!0),b==="push"&&(f=!0),g?s||c>0&&Date.now():(g=!0,l()))},m=()=>{i.cancelled=!0,r&&r.unsubscribe()};return{start:()=>{r=t.localSyncEvent.subscribe(({purpose:b})=>{p(b||"pull")})},stop:m}}function Ho(t,e){if(t&&e&&e.unsyncedTables)for(const n of e.unsyncedTables)t[n]&&(t[n].markedForSync=!1)}var $s,Ne,ld,jn,Nl,ud,fd,dd,Ya,wa,_a,li={},hd=[],Fm=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,qs=Array.isArray;function Qt(t,e){for(var n in e)t[n]=e[n];return t}function Ga(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Oe(t,e,n){var r,i,s,c={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:c[s]=e[s];if(arguments.length>2&&(c.children=arguments.length>3?$s.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)c[s]===void 0&&(c[s]=t.defaultProps[s]);return us(t,c,r,i,null)}function us(t,e,n,r,i){var s={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++ld,__i:-1,__u:0};return i==null&&Ne.vnode!=null&&Ne.vnode(s),s}function Nn(t){return t.children}function Xr(t,e){this.props=t,this.context=e}function pr(t,e){if(e==null)return t.__?pr(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?pr(t):null}function pd(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return pd(t)}}function Kl(t){(!t.__d&&(t.__d=!0)&&jn.push(t)&&!Cs.__r++||Nl!=Ne.debounceRendering)&&((Nl=Ne.debounceRendering)||ud)(Cs)}function Cs(){for(var t,e,n,r,i,s,c,l=1;jn.length;)jn.length>l&&jn.sort(fd),t=jn.shift(),l=jn.length,t.__d&&(n=void 0,r=void 0,i=(r=(e=t).__v).__e,s=[],c=[],e.__P&&((n=Qt({},r)).__v=r.__v+1,Ne.vnode&&Ne.vnode(n),Ja(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??pr(r),!!(32&r.__u),c),n.__v=r.__v,n.__.__k[n.__i]=n,md(s,n,c),r.__e=r.__=null,n.__e!=i&&pd(n)));Cs.__r=0}function yd(t,e,n,r,i,s,c,l,d,f,g){var p,m,b,S,x,N,U,M=r&&r.__k||hd,V=e.length;for(d=(function(q,K,ie,Z,he){var ne,J,re,we,ee,me=ie.length,ve=me,le=0;for(q.__k=new Array(he),ne=0;ne<he;ne++)(J=K[ne])!=null&&typeof J!="boolean"&&typeof J!="function"?(typeof J=="string"||typeof J=="number"||typeof J=="bigint"||J.constructor==String?J=q.__k[ne]=us(null,J,null,null,null):qs(J)?J=q.__k[ne]=us(Nn,{children:J},null,null,null):J.constructor==null&&J.__b>0?J=q.__k[ne]=us(J.type,J.props,J.key,J.ref?J.ref:null,J.__v):q.__k[ne]=J,we=ne+le,J.__=q,J.__b=q.__b+1,(ee=J.__i=$m(J,ie,we,ve))!=-1&&(ve--,(re=ie[ee])&&(re.__u|=2)),re==null||re.__v==null?(ee==-1&&(he>me?le--:he<me&&le++),typeof J.type!="function"&&(J.__u|=4)):ee!=we&&(ee==we-1?le--:ee==we+1?le++:(ee>we?le--:le++,J.__u|=4))):q.__k[ne]=null;if(ve)for(ne=0;ne<me;ne++)(re=ie[ne])!=null&&!(2&re.__u)&&(re.__e==Z&&(Z=pr(re)),bd(re,re));return Z})(n,e,M,d,V),p=0;p<V;p++)(b=n.__k[p])!=null&&(m=b.__i==-1?li:M[b.__i]||li,b.__i=p,N=Ja(t,b,m,i,s,c,l,d,f,g),S=b.__e,b.ref&&m.ref!=b.ref&&(m.ref&&Xa(m.ref,null,b),g.push(b.ref,b.__c||S,b)),x==null&&S!=null&&(x=S),(U=!!(4&b.__u))||m.__k===b.__k?d=gd(b,d,t,U):typeof b.type=="function"&&N!==void 0?d=N:S&&(d=S.nextSibling),b.__u&=-7);return n.__e=x,d}function gd(t,e,n,r){var i,s;if(typeof t.type=="function"){for(i=t.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=t,e=gd(i[s],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=pr(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function $m(t,e,n,r){var i,s,c,l=t.key,d=t.type,f=e[n],g=f!=null&&!(2&f.__u);if(f===null&&l==null||g&&l==f.key&&d==f.type)return n;if(r>(g?1:0)){for(i=n-1,s=n+1;i>=0||s<e.length;)if((f=e[c=i>=0?i--:s++])!=null&&!(2&f.__u)&&l==f.key&&d==f.type)return c}return-1}function Bl(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Fm.test(e)?n:n+"px"}function es(t,e,n,r,i){var s,c;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||Bl(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||Bl(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(dd,"$1")),c=e.toLowerCase(),e=c in t||e=="onFocusOut"||e=="onFocusIn"?c.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?r?n.u=r.u:(n.u=Ya,t.addEventListener(e,s?_a:wa,s)):t.removeEventListener(e,s?_a:wa,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Fl(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=Ya++;else if(e.t<n.u)return;return n(Ne.event?Ne.event(e):e)}}}function Ja(t,e,n,r,i,s,c,l,d,f){var g,p,m,b,S,x,N,U,M,V,q,K,ie,Z,he,ne,J,re=e.type;if(e.constructor!=null)return null;128&n.__u&&(d=!!(32&n.__u),s=[l=e.__e=n.__e]),(g=Ne.__b)&&g(e);e:if(typeof re=="function")try{if(U=e.props,M="prototype"in re&&re.prototype.render,V=(g=re.contextType)&&r[g.__c],q=g?V?V.props.value:g.__:r,n.__c?N=(p=e.__c=n.__c).__=p.__E:(M?e.__c=p=new re(U,q):(e.__c=p=new Xr(U,q),p.constructor=re,p.render=Wm),V&&V.sub(p),p.state||(p.state={}),p.__n=r,m=p.__d=!0,p.__h=[],p._sb=[]),M&&p.__s==null&&(p.__s=p.state),M&&re.getDerivedStateFromProps!=null&&(p.__s==p.state&&(p.__s=Qt({},p.__s)),Qt(p.__s,re.getDerivedStateFromProps(U,p.__s))),b=p.props,S=p.state,p.__v=e,m)M&&re.getDerivedStateFromProps==null&&p.componentWillMount!=null&&p.componentWillMount(),M&&p.componentDidMount!=null&&p.__h.push(p.componentDidMount);else{if(M&&re.getDerivedStateFromProps==null&&U!==b&&p.componentWillReceiveProps!=null&&p.componentWillReceiveProps(U,q),e.__v==n.__v||!p.__e&&p.shouldComponentUpdate!=null&&p.shouldComponentUpdate(U,p.__s,q)===!1){for(e.__v!=n.__v&&(p.props=U,p.state=p.__s,p.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(we){we&&(we.__=e)}),K=0;K<p._sb.length;K++)p.__h.push(p._sb[K]);p._sb=[],p.__h.length&&c.push(p);break e}p.componentWillUpdate!=null&&p.componentWillUpdate(U,p.__s,q),M&&p.componentDidUpdate!=null&&p.__h.push(function(){p.componentDidUpdate(b,S,x)})}if(p.context=q,p.props=U,p.__P=t,p.__e=!1,ie=Ne.__r,Z=0,M){for(p.state=p.__s,p.__d=!1,ie&&ie(e),g=p.render(p.props,p.state,p.context),he=0;he<p._sb.length;he++)p.__h.push(p._sb[he]);p._sb=[]}else do p.__d=!1,ie&&ie(e),g=p.render(p.props,p.state,p.context),p.state=p.__s;while(p.__d&&++Z<25);p.state=p.__s,p.getChildContext!=null&&(r=Qt(Qt({},r),p.getChildContext())),M&&!m&&p.getSnapshotBeforeUpdate!=null&&(x=p.getSnapshotBeforeUpdate(b,S)),ne=g,g!=null&&g.type===Nn&&g.key==null&&(ne=vd(g.props.children)),l=yd(t,qs(ne)?ne:[ne],e,n,r,i,s,c,l,d,f),p.base=e.__e,e.__u&=-161,p.__h.length&&c.push(p),N&&(p.__E=p.__=null)}catch(we){if(e.__v=null,d||s!=null)if(we.then){for(e.__u|=d?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;s[s.indexOf(l)]=null,e.__e=l}else{for(J=s.length;J--;)Ga(s[J]);ka(e)}else e.__e=n.__e,e.__k=n.__k,we.then||ka(e);Ne.__e(we,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):l=e.__e=qm(n.__e,e,n,r,i,s,c,d,f);return(g=Ne.diffed)&&g(e),128&e.__u?void 0:l}function ka(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(ka)}function md(t,e,n){for(var r=0;r<n.length;r++)Xa(n[r],n[++r],n[++r]);Ne.__c&&Ne.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(s){s.call(i)})}catch(s){Ne.__e(s,i.__v)}})}function vd(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:qs(t)?t.map(vd):Qt({},t)}function qm(t,e,n,r,i,s,c,l,d){var f,g,p,m,b,S,x,N=n.props||li,U=e.props,M=e.type;if(M=="svg"?i="http://www.w3.org/2000/svg":M=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(f=0;f<s.length;f++)if((b=s[f])&&"setAttribute"in b==!!M&&(M?b.localName==M:b.nodeType==3)){t=b,s[f]=null;break}}if(t==null){if(M==null)return document.createTextNode(U);t=document.createElementNS(i,M,U.is&&U),l&&(Ne.__m&&Ne.__m(e,s),l=!1),s=null}if(M==null)N===U||l&&t.data==U||(t.data=U);else{if(s=s&&$s.call(t.childNodes),!l&&s!=null)for(N={},f=0;f<t.attributes.length;f++)N[(b=t.attributes[f]).name]=b.value;for(f in N)if(b=N[f],f!="children"){if(f=="dangerouslySetInnerHTML")p=b;else if(!(f in U)){if(f=="value"&&"defaultValue"in U||f=="checked"&&"defaultChecked"in U)continue;es(t,f,null,b,i)}}for(f in U)b=U[f],f=="children"?m=b:f=="dangerouslySetInnerHTML"?g=b:f=="value"?S=b:f=="checked"?x=b:l&&typeof b!="function"||N[f]===b||es(t,f,b,N[f],i);if(g)l||p&&(g.__html==p.__html||g.__html==t.innerHTML)||(t.innerHTML=g.__html),e.__k=[];else if(p&&(t.innerHTML=""),yd(e.type=="template"?t.content:t,qs(m)?m:[m],e,n,r,M=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,c,s?s[0]:n.__k&&pr(n,0),l,d),s!=null)for(f=s.length;f--;)Ga(s[f]);l||(f="value",M=="progress"&&S==null?t.removeAttribute("value"):S!=null&&(S!==t[f]||M=="progress"&&!S||M=="option"&&S!=N[f])&&es(t,f,S,N[f],i),f="checked",x!=null&&x!=t[f]&&es(t,f,x,N[f],i))}return t}function Xa(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(i){Ne.__e(i,n)}}function bd(t,e,n){var r,i;if(Ne.unmount&&Ne.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||Xa(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){Ne.__e(s,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&bd(r[i],e,n||typeof t.type!="function");n||Ga(t.__e),t.__c=t.__=t.__e=void 0}function Wm(t,e,n){return this.constructor(t,n)}function $l(t,e,n){var r,i,s;e==document&&(e=document.documentElement),Ne.__&&Ne.__(t,e),r=e.__k,i=[],s=[],Ja(e,t=e.__k=Oe(Nn,null,[t]),r||li,li,e.namespaceURI,r?null:e.firstChild?$s.call(e.childNodes):null,i,r?r.__e:e.firstChild,!1,s),md(i,t,s)}$s=hd.slice,Ne={__e:function(t,e,n,r){for(var i,s,c;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(t)),c=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,r||{}),c=i.__d),c)return i.__E=i}catch(l){t=l}throw t}},ld=0,Xr.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Qt({},this.state),typeof t=="function"&&(t=t(Qt({},n),this.props)),t&&Qt(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Kl(this))},Xr.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Kl(this))},Xr.prototype.render=Nn,jn=[],ud=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,fd=function(t,e){return t.__v.__b-e.__v.__b},Cs.__r=0,dd=/(PointerCapture)$|Capture$/i,Ya=0,wa=Fl(!1),_a=Fl(!0);const Be={Alert:{error:{color:"red",fontWeight:"bold"},warning:{color:"#f80",fontWeight:"bold"},info:{color:"black"}},Darken:{position:"fixed",top:0,left:0,opacity:.5,backgroundColor:"#000",width:"100vw",height:"100vh",zIndex:150,webkitBackdropFilter:"blur(2px)",backdropFilter:"blur(2px)"},DialogOuter:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:150,alignItems:"center",display:"flex",justifyContent:"center",padding:"16px",boxSizing:"border-box"},DialogInner:{position:"relative",color:"#222",backgroundColor:"#fff",padding:"24px",marginBottom:"2em",maxWidth:"400px",width:"100%",maxHeight:"90%",overflowY:"auto",border:"3px solid #3d3d5d",borderRadius:"8px",boxShadow:"0 0 80px 10px #666",fontFamily:"sans-serif",boxSizing:"border-box"},Input:{height:"35px",width:"100%",maxWidth:"100%",borderColor:"#ccf4",outline:"none",fontSize:"16px",padding:"8px",boxSizing:"border-box",backgroundColor:"#f9f9f9",borderRadius:"4px",border:"1px solid #ccc",marginTop:"6px",fontFamily:"inherit"},Button:{padding:"10px 20px",margin:"0 4px",border:"1px solid #d1d5db",borderRadius:"6px",backgroundColor:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#374151",transition:"all 0.2s ease"},PrimaryButton:{padding:"10px 20px",margin:"0 4px",border:"1px solid #3b82f6",borderRadius:"6px",backgroundColor:"#3b82f6",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s ease"},ButtonsDiv:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"24px",paddingTop:"20px"},Label:{display:"block",marginBottom:"12px",fontSize:"14px",fontWeight:"500",color:"#333"},WindowHeader:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600",color:"#333",borderBottom:"1px solid #eee",paddingBottom:"10px"},ProviderButton:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"12px 16px",marginBottom:"10px",border:"1px solid #d1d5db",borderRadius:"6px",backgroundColor:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#374151",transition:"all 0.2s ease",gap:"12px"},ProviderButtonIcon:{width:"20px",height:"20px",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center"},ProviderButtonText:{flex:1,textAlign:"left"},ProviderGoogle:{backgroundColor:"#ffffff",border:"1px solid #dadce0",color:"#3c4043"},ProviderGitHub:{backgroundColor:"#24292e",border:"1px solid #24292e",color:"#ffffff"},ProviderMicrosoft:{backgroundColor:"#ffffff",border:"1px solid #8c8c8c",color:"#5e5e5e"},ProviderApple:{backgroundColor:"#000000",border:"1px solid #000000",color:"#ffffff"},ProviderCustom:{backgroundColor:"#4f46e5",border:"1px solid #4f46e5",color:"#ffffff"},Divider:{display:"flex",alignItems:"center",margin:"20px 0",color:"#6b7280",fontSize:"13px"},DividerLine:{flex:1,height:"1px",backgroundColor:"#e5e7eb"},DividerText:{padding:"0 12px",color:"#9ca3af"},OtpButton:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"12px 16px",border:"1px solid #d1d5db",borderRadius:"6px",backgroundColor:"#f9fafb",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#374151",transition:"all 0.2s ease",gap:"12px"}};function Vm({children:t,className:e}){return Oe("div",{className:`dexie-dialog ${e||""}`},Oe("div",{style:Be.Darken}),Oe("div",{style:Be.DialogOuter},Oe("div",{style:Be.DialogInner},t)))}var ui,He,zo,ql,Es=0,wd=[],Ye=Ne,Wl=Ye.__b,Vl=Ye.__r,Hl=Ye.diffed,zl=Ye.__c,Yl=Ye.unmount,Gl=Ye.__;function Qa(t,e){Ye.__h&&Ye.__h(He,t,Es||e),Es=0;var n=He.__H||(He.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function Hm(t){return Es=1,(function(e,n){var r=Qa(ui++,2);if(r.t=e,!r.__c&&(r.__=[Xl(void 0,n),function(l){var d=r.__N?r.__N[0]:r.__[0],f=r.t(d,l);d!==f&&(r.__N=[f,r.__[1]],r.__c.setState({}))}],r.__c=He,!He.__f)){var i=function(l,d,f){if(!r.__c.__H)return!0;var g=r.__c.__H.__.filter(function(m){return!!m.__c});if(g.every(function(m){return!m.__N}))return!s||s.call(this,l,d,f);var p=r.__c.props!==l;return g.forEach(function(m){if(m.__N){var b=m.__[0];m.__=m.__N,m.__N=void 0,b!==m.__[0]&&(p=!0)}}),s&&s.call(this,l,d,f)||p};He.__f=!0;var s=He.shouldComponentUpdate,c=He.componentWillUpdate;He.componentWillUpdate=function(l,d,f){if(this.__e){var g=s;s=void 0,i(l,d,f),s=g}c&&c.call(this,l,d,f)},He.shouldComponentUpdate=i}return r.__N||r.__})(Xl,t)}function zm(t){return Es=5,(function(e,n){var r=Qa(ui++,7);return _d(r.__H,n)&&(r.__=e(),r.__H=n,r.__h=e),r.__})(function(){return{current:t}},[])}function Ym(){for(var t;t=wd.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(fs),t.__H.__h.forEach(Sa),t.__H.__h=[]}catch(e){t.__H.__h=[],Ye.__e(e,t.__v)}}Ye.__b=function(t){He=null,Wl&&Wl(t)},Ye.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Gl&&Gl(t,e)},Ye.__r=function(t){Vl&&Vl(t),ui=0;var e=(He=t.__c).__H;e&&(zo===He?(e.__h=[],He.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(fs),e.__h.forEach(Sa),e.__h=[],ui=0)),zo=He},Ye.diffed=function(t){Hl&&Hl(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(wd.push(e)!==1&&ql===Ye.requestAnimationFrame||((ql=Ye.requestAnimationFrame)||Gm)(Ym)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),zo=He=null},Ye.__c=function(t,e){e.some(function(n){try{n.__h.forEach(fs),n.__h=n.__h.filter(function(r){return!r.__||Sa(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],Ye.__e(r,n.__v)}}),zl&&zl(t,e)},Ye.unmount=function(t){Yl&&Yl(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{fs(r)}catch(i){e=i}}),n.__H=void 0,e&&Ye.__e(e,n.__v))};var Jl=typeof requestAnimationFrame=="function";function Gm(t){var e,n=function(){clearTimeout(r),Jl&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);Jl&&(e=requestAnimationFrame(n))}function fs(t){var e=He,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),He=e}function Sa(t){var e=He;t.__c=t.__(),He=e}function _d(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Xl(t,e){return typeof e=="function"?e(t):e}function Ql({option:t,onClick:e}){const{displayName:n,iconUrl:r,iconSvg:i,styleHint:s,value:c}=t,l=(function(g){const p=Object.assign({},Be.ProviderButton);if(!g)return p;switch(g){case"google":return Object.assign(Object.assign({},p),Be.ProviderGoogle);case"github":return Object.assign(Object.assign({},p),Be.ProviderGitHub);case"microsoft":return Object.assign(Object.assign({},p),Be.ProviderMicrosoft);case"apple":return Object.assign(Object.assign({},p),Be.ProviderApple);case"otp":return Object.assign({},Be.OtpButton);case"custom-oauth2":return Object.assign(Object.assign({},p),Be.ProviderCustom);default:return p}})(s),d=l.color||"#000000",f=i?i.replace(/fill="currentColor"/gi,`fill="${d}"`).replace(/fill='currentColor'/gi,`fill='${d}'`).replace(/stroke="currentColor"/gi,`stroke="${d}"`).replace(/stroke='currentColor'/gi,`stroke='${d}'`):null;return Oe("button",{type:"button",style:l,onClick:e,class:"dxc-option-btn"+(s?` dxc-option-${s}`:""),"aria-label":n},f?Oe("span",{style:Be.ProviderButtonIcon,"aria-hidden":"true",dangerouslySetInnerHTML:{__html:f}}):r?Oe("img",{src:r,alt:"",style:Be.ProviderButtonIcon,"aria-hidden":"true"}):null,Oe("span",{style:Be.ProviderButtonText},n))}function Zl(){return Oe("div",{style:Be.Divider},Oe("div",{style:Be.DividerLine}),Oe("span",{style:Be.DividerText},"or"),Oe("div",{style:Be.DividerLine}))}function Jm({title:t,alerts:e,fields:n,options:r,submitLabel:i,cancelLabel:s,onCancel:c,onSubmit:l}){const[d,f]=Hm({}),g=zm(null);(function(U,M){var V=Qa(ui++,4);!Ye.__s&&_d(V.__H,M)&&(V.__=U,V.u=M,He.__h.push(V))})(()=>{var U;return(U=g.current)===null||U===void 0?void 0:U.focus()},[]);const p=Object.entries(n||{}),m=p.length>0,b=r&&r.length>0,S=new Map;if(r)for(const U of r){const M=S.get(U.name)||[];M.push(U),S.set(U.name,M)}const x=S.size>1,N=U=>{l({[U.name]:U.value})};return Oe(Vm,{className:"dxc-login-dlg"},Oe(Nn,null,Oe("h3",{style:Be.WindowHeader},t),e.map((U,M)=>Oe("p",{key:M,style:Be.Alert[U.type]},(function({message:V,messageCode:q,messageParams:K}){return V.replace(/\{\w+\}/gi,ie=>K[ie.substring(1,ie.length-1)])})(U))),b&&Oe("div",{class:"dxc-options"},x?Array.from(S.entries()).map(([U,M],V)=>Oe(Nn,{key:U},V>0&&Oe(Zl,null),M.map(q=>Oe(Ql,{key:`${q.name}-${q.value}`,option:q,onClick:()=>N(q)})))):r.map(U=>Oe(Ql,{key:`${U.name}-${U.value}`,option:U,onClick:()=>N(U)}))),b&&m&&Oe(Zl,null),m&&Oe("form",{onSubmit:U=>{U.preventDefault(),l(d)}},p.map(([U,{type:M,label:V,placeholder:q}],K)=>Oe("label",{style:Be.Label,key:K},V?`${V}: `:"",Oe("input",{ref:K===0?g:void 0,type:M,name:U,autoComplete:"on",style:Be.Input,autoFocus:!0,placeholder:q,value:d[U]||"",onInput:ie=>{var Z;const he=(function(J,re){switch(J){case"email":return re.toLowerCase();case"otp":return re.toUpperCase();default:return re}})(M,(Z=ie.target)===null||Z===void 0?void 0:Z.value);let ne=Object.assign(Object.assign({},d),{[U]:he});f(ne),M==="otp"&&(he==null?void 0:he.trim().length)===8&&l(ne)}}))))),Oe("div",{style:Be.ButtonsDiv},Oe(Nn,null,i&&(m||!b&&!m)&&Oe("button",{type:"submit",style:Be.PrimaryButton,onClick:()=>l(d)},i),s&&Oe("button",{style:Be.Button,onClick:c},s))))}class eu extends Xr{constructor(e){super(e),this.observer=n=>this.setState({userInteraction:n}),this.state={userInteraction:void 0}}componentDidMount(){this.subscription=_t(this.props.db.cloud.userInteraction).subscribe(this.observer)}componentWillUnmount(){this.subscription&&(this.subscription.unsubscribe(),delete this.subscription)}render(e,{userInteraction:n}){return n?Oe(Jm,Object.assign({},n)):null}}function vi(t){const e=new WeakMap;return n=>{let r=e.get(n);return r||(r=t(n),e.set(n,r)),r}}const Os=vi(t=>new Rt(ht));function Ws(t,e){let n=e,r=_t(t).pipe(bt(s=>n=s),cp({resetOnRefCountZero:()=>Eu(1e3)}));const i=new Xe(s=>{let c=!1;const l=r.subscribe({next(d){c=!0,s.next(d)},error(d){s.error(d)},complete(){s.complete()}});return c||l.closed||s.next(n),l});return i.getValue=()=>n,i}const kd=vi(t=>Ws(gn(()=>t.roles.where({realmId:"rlm-public"}).toArray().then(e=>{const n={};for(const r of e.slice().sort((i,s)=>(i.sortOrder||0)-(s.sortOrder||0)))n[r.name]=r;return n})),{})),Sd=vi(t=>Ws(Os(t._novip).pipe(ut(e=>gn(()=>t.transaction("r","realms","members",()=>Promise.all([t.members.where({userId:e.userId}).toArray(),t.realms.toArray(),e.userId]).then(([n,r,i])=>({selfMembers:n,realms:r,userId:i})))))),{selfMembers:[],realms:[],get userId(){return t.cloud.currentUserId}}));function Xm(...t){return t.length===0?{}:t.reduce((n,r)=>{const i=Object.assign({},n);for(const[s,c]of Object.entries(r))if(s in i&&i[s]){if(i[s]==="*")continue;if(c==="*")i[s]="*";else if(Array.isArray(c)&&Array.isArray(i[s])){const l=i,d=l[s];l[s]=[...new Set([...d,...c])]}else if(typeof c=="object"&&c&&typeof i[s]=="object"){const l=i[s];for(const[d,f]of Object.entries(c))l[d]!=="*"&&(f==="*"?l[d]="*":Array.isArray(l[d])&&Array.isArray(f)&&(l[d]=[...new Set([...l[d],...f])]))}}else i[s]=r[s];return i})}const xd=vi(t=>(function(e,n){let r;const i=e.pipe(bt(s=>r=n(s)));return i.getValue=()=>r!==void 0?r:r=n(e.getValue()),i})(Ws(Zr([Sd(t._novip),kd(t._novip)]).pipe(bt(([{selfMembers:e,realms:n,userId:r},i])=>({selfMembers:e,realms:n,userId:r,globalRoles:i}))),{selfMembers:[],realms:[],userId:ht.userId,globalRoles:{}}),({selfMembers:e,realms:n,userId:r,globalRoles:i})=>n.map(c=>{const l=e.filter(g=>g.realmId===c.realmId),d=l.map(g=>g.permissions).filter(g=>g),f=Wa(l.map(g=>g.roles).filter(g=>g)).map(g=>i[g]).filter(g=>g).map(g=>g.permissions);return Object.assign(Object.assign({},c),{permissions:c.owner===r?{manage:"*"}:Xm(...d,...f)})}).reduce((c,l)=>Object.assign(Object.assign({},c),{[l.realmId]:l}),{[r]:{realmId:r,owner:r,name:r,permissions:{manage:"*"}}})));class tu{constructor(e,n,r){this.permissions=e||{},this.tableName=n,this.isOwner=r}add(...e){var n;return this.permissions.manage==="*"||!!(!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))||this.permissions.add==="*"||!!e.every(r=>{var i;return(i=this.permissions.add)===null||i===void 0?void 0:i.includes(r)})}update(...e){var n,r;if(this.isOwner||this.permissions.manage==="*"||!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))return!0;if(this.permissions.update==="*")return e.every(s=>s!=="owner");const i=(r=this.permissions.update)===null||r===void 0?void 0:r[this.tableName];return i==="*"?e.every(s=>s!=="owner"):e.every(s=>i==null?void 0:i.some(c=>c===s||c==="*"&&s!=="owner"))}delete(){var e;return!(!this.isOwner&&this.permissions.manage!=="*")||!!(!((e=this.permissions.manage)===null||e===void 0)&&e.includes(this.tableName))}}const Qm=vi(t=>{const e=Os(t._novip).pipe(ut(i=>gn(()=>t.members.where({email:i.email||""}).toArray()))),n=xd(t._novip),r=Sd(t._novip);return Ws(Zr([e,r,n]).pipe(bt(([i,s,c])=>{const l=(g,p)=>Object.assign(Object.assign({},g),{[p.id]:Object.assign(Object.assign({},p),{realm:c[p.realmId]})}),d=i.reduce(l,{}),f=s.selfMembers.reduce(l,d);return Object.values(f).filter(g=>!g.accepted).map(g=>Object.assign(Object.assign({},g),{accept(){return Q(this,void 0,void 0,function*(){yield t.members.update(g.id,{accepted:new Date})})},reject(){return Q(this,void 0,void 0,function*(){yield t.members.update(g.id,{rejected:new Date})})}}))})),[])});function Zm(t){return e=>{var n;const r=e.doc;if(!r)throw new Error("Internal error: DexieYProvider.createYHandler called without a doc. This is unexpected.");const{parentTable:i}=r.meta||{};if(!(!((n=t.cloud.schema)===null||n===void 0)&&n[i].markedForSync))return;let s;Object.defineProperty(e,"awareness",{get:()=>s||(s=(function(c,l,d){const{parentTable:f,parentId:g,parentProp:p,updatesTable:m}=l.meta,b=new Rg(l),S=cd(l);return b.on("update",({added:x,updated:N,removed:U},M)=>{const V=x.concat(N).concat(U),q=c.cloud.currentUser.value;if(M!=="server"&&q.isLoggedIn&&!ci(c)){const K=Pg(b,V);c.messageProducer.next({type:"aware",table:f,prop:p,k:l.meta.parentId,u:K}),d.destroyed&&c.messageProducer.next({type:"doc-close",table:f,prop:p,k:l.meta.parentId})}}),b.on("destroy",()=>{Pf(b,[l.clientID],"provider destroyed")}),Q(this,void 0,void 0,function*(){if(d.destroyed)return;let x=!1,N=1;const U=Zr([c.cloud.webSocketStatus,S.pipe(Au(null))]).subscribe(([V])=>{if(d.destroyed)return;x=V==="connected";const q=c.cloud.currentUser.value;V==="connected"&&q.isLoggedIn&&!ci(c)&&(++N,M().catch(K=>{}))});function M(){return Q(this,void 0,void 0,function*(){const V=N,q=c.table(m),K=c.$syncState,[ie,Z]=yield c.transaction("r",K,q,()=>Q(this,void 0,void 0,function*(){const J=yield q.get(wn),re=yield K.get("syncState");return[(J==null?void 0:J.receivedUntil)||0,(re==null?void 0:re.yServerRevision)||(re==null?void 0:re.serverRevision)]}));if(d.destroyed||N!==V||!x)return;const he={type:"doc-open",table:f,prop:p,k:g,serverRev:Z},ne=yield q.where("i").between(ie,1/0,!1).filter(J=>As(J.k,g)===0&&!(1&(J.f||0))).toArray();if(!d.destroyed&&N===V&&x){if(ne.length>0){const J=gs(ne.map(we=>we.u)),re=lf(J);he.sv=re}c.messageProducer.next(he)}})}d.addCleanupHandler(U)}),b})(t,r,e),ad.set(r,s),s)})}}function ev(t){const e=typeof window<"u"?window.location.href:"";if(!e)return null;const n=new URL(e).searchParams.get("dxc-auth");if(!n)return null;let r;try{const d=(function(f){const g=(f+"=".repeat((4-f.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/");return atob(g)})(n);r=JSON.parse(d)}catch{return null}const{code:i,provider:s,state:c,error:l}=r;if(l)throw l.toLowerCase().includes("access_denied")||l.toLowerCase().includes("access denied")?new Bt("access_denied",s,l):l.toLowerCase().includes("email")&&l.toLowerCase().includes("verif")?new Bt("email_not_verified",s,l):new Bt("provider_error",s,l);return i&&s&&c?{code:i,provider:s,state:c}:null}function nu(){var t;if(typeof window>"u"||!(!((t=window.history)===null||t===void 0)&&t.replaceState))return;const e=new URL(window.location.href);if(!e.searchParams.has("dxc-auth"))return;e.searchParams.delete("dxc-auth");const n=e.pathname+(e.searchParams.toString()?`?${e.searchParams.toString()}`:"")+e.hash;window.history.replaceState(null,"",n)}const tv={nameSuffix:!0};function xa(t){const e=t.name,n=Os(t),r=[];let i=!1,s=null,c=null,l=null;t.on("ready",m=>Q(this,void 0,void 0,function*(){try{yield(function(b){return Q(this,void 0,void 0,function*(){var S,x,N,U,M,V,q;d=!1;const K=Nt(b);typeof window<"u"&&typeof document<"u"&&(!((S=K.cloud.options)===null||S===void 0)&&S.customLoginGui||r.push((function(ee){let me=!1;const ve=document.createElement("div");return document.body?(document.body.appendChild(ve),$l(Oe(eu,{db:ee.vip}),ve)):addEventListener("DOMContentLoaded",()=>{me||(document.body.appendChild(ve),$l(Oe(eu,{db:ee.vip}),ve))}),{unsubscribe(){try{ve.remove()}catch{}me=!0},get closed(){return me}}})(b))),K.cloud.isServiceWorkerDB||r.push((function(ee){let me=ee.cloud.webSocketStatus.value;const ve=ee.cloud.webSocketStatus.pipe(ut(le=>{const ae=me;me=le;const H=Zt(le);switch(le){case"disconnected":return Jr.value?H.pipe(zc(500)):H;case"connecting":return ae==="not-started"||ae==="error"?H:H.pipe(zc(4e3));default:return H}}));return Zr([ve,ee.syncStateChangedEvent.pipe(Au({phase:"initial"})),Os(ee.dx._novip),ba]).pipe(bt(([le,ae,H,de])=>{var ue;if(!((ue=H.license)===null||ue===void 0)&&ue.status&&H.license.status!=="ok")return{phase:"offline",status:"offline",license:H.license.status};let{phase:pe,error:ce,progress:ke}=ae,Pe=le;return pe==="error"&&(Pe="error"),le==="not-started"&&(pe!=="pushing"&&pe!=="pulling"||(Pe="connecting")),ee.cloud.syncState.value.phase!=="error"||ae.phase!=="pushing"&&ae.phase!=="pulling"||(Pe="connecting"),de||(Pe="disconnected"),{phase:pe,error:ce,progress:ke,status:or?Pe:"offline",license:"ok"}}))})(K).subscribe(b.cloud.syncState)),r.push(K.syncCompleteEvent.subscribe(g)),K.tables.every(ee=>ee.core)||(function(){throw new Ce.SchemaError("Version increment needed to allow dexie-cloud change tracking")})();const ie="serviceWorker"in navigator?yield navigator.serviceWorker.getRegistrations():[],[Z,he]=yield K.transaction("rw",K.$syncState,()=>Q(this,void 0,void 0,function*(){var ee,me;const{options:ve,schema:le}=K.cloud,[ae,H,de]=yield Promise.all([K.getOptions(),K.getSchema(),K.getPersistedSyncState()]);if(i){if(!ae||JSON.stringify(ae)!==JSON.stringify(ve)){if(!ve)throw new Error("Internal error");const ue=Object.assign({},ve);delete ue.fetchTokens,delete ue.awarenessProtocol,yield K.$syncState.put(ue,"options")}}else K.cloud.options=ae||null;if(!((ee=K.cloud.options)===null||ee===void 0)&&ee.tryUseServiceWorker&&"serviceWorker"in navigator&&ie.length>0&&!nd?K.cloud.usingServiceWorker=!0:(!((me=K.cloud.options)===null||me===void 0)&&me.tryUseServiceWorker&&K.cloud.isServiceWorkerDB,K.cloud.usingServiceWorker=!1),Ho(le,K.cloud.options),Ho(H,K.cloud.options),le){if(!H||JSON.stringify(H)!==JSON.stringify(le)){const ue=H||{};for(const[pe,ce]of Object.entries(le)){const ke=ue[pe];ke?(ke.markedForSync=ce.markedForSync,ce.deleted=ke.deleted,ke.generatedGlobalId=ce.generatedGlobalId):ue[pe]=Object.assign({},ce)}yield K.$syncState.put(ue,"schema"),Object.assign(le,ue)}}else K.cloud.schema=H||null;return[de==null?void 0:de.initiallySynced,de==null?void 0:de.realms]}));if(Z&&K.setInitiallySynced(!0),(function(ee){var me,ve;for(const le of ee.tables)if(!((ve=(me=ee.cloud.schema)===null||me===void 0?void 0:me[le.name])===null||ve===void 0)&&ve.markedForSync){if(le.schema.primKey.auto)throw new Ce.SchemaError(`Table ${le.name} is both autoIncremented and synced. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(le.name)}]}) to blacklist it from sync`);if(!le.schema.primKey.keyPath)throw new Ce.SchemaError(`Table ${le.name} cannot be both synced and outbound. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(le.name)}]}) to blacklist it from sync`)}})(K),f(),!K.cloud.isServiceWorkerDB){r.push(gn(()=>K.getCurrentUser()).subscribe(n)),r.push(gn(()=>K.getPersistedSyncState()).subscribe(K.cloud.persistedSyncState)),yield Un(Zr([n.pipe(Yc(1),tr(1)),K.cloud.persistedSyncState.pipe(Yc(1),tr(1))]));const ee=Zm(K);ft.on.new.subscribe(ee),K.dx.once("close",()=>{ft.on.new.unsubscribe(ee)})}let ne=!1,J=yield K.getCurrentUser();if(c&&!K.cloud.isServiceWorkerDB){const ee=c;c=null,yield xs(K.cloud.userInteraction,"Authentication Error",{type:"error",messageCode:"GENERIC_ERROR",message:ee.message,messageParams:{provider:ee.provider||"unknown"}})}if(s&&!K.cloud.isServiceWorkerDB){const{code:ee,provider:me}=s;s=null;try{ne=yield Qi(K,{oauthCode:ee,provider:me}),J=yield K.getCurrentUser()}catch{}}const re=(x=K.cloud.options)===null||x===void 0?void 0:x.requireAuth;re&&(K.cloud.isServiceWorkerDB?yield Un(n.pipe(Et(ee=>!!ee.isLoggedIn),tr(1))):typeof re=="object"?(!J.isLoggedIn||re.userId&&J.userId!==re.userId||re.email&&J.email!==re.email)&&(ne=yield Qi(K,re)):J.isLoggedIn||(ne=yield Qi(K))),!J.isLoggedIn||he&&he.includes(J.userId)||(ne=!0),l&&l.stop(),l=null,f();const we=((N=K.cloud.options)===null||N===void 0?void 0:N.databaseUrl)&&(!Z||ne);we&&(yield(function(ee,me,ve){return Q(this,void 0,void 0,function*(){yield id(ee,Jf,()=>Fs(ee,me,ve,{isInitialSync:!0}))})})(K,K.cloud.options,K.cloud.schema),K.setInitiallySynced(!0)),f(),K.cloud.usingServiceWorker&&(!((U=K.cloud.options)===null||U===void 0)&&U.databaseUrl)?(we||jf(K,"push").catch(()=>{}),(function(ee){return Q(this,void 0,void 0,function*(){var me;try{const{periodicSync:ve}=yield navigator.serviceWorker.ready;if(ve)try{yield ve.register(`dexie-cloud:${ee.name}`,(me=ee.cloud.options)===null||me===void 0?void 0:me.periodicSync)}catch{}}catch{}})})(K).catch(()=>{})):!((M=K.cloud.options)===null||M===void 0)&&M.databaseUrl&&K.cloud.schema&&!K.cloud.isServiceWorkerDB&&(l=Bm(K,K.cloud.options,K.cloud.schema),l.start(),we||Xt(K,"push")),f(),K.cloud.isServiceWorkerDB||r.push(Ft(self,"online").subscribe(()=>{K.syncStateChangedEvent.next({phase:"not-in-sync"}),ci(K)||Xt(K,"push")}),Ft(self,"offline").subscribe(()=>{K.syncStateChangedEvent.next({phase:"offline"})})),!(!((V=K.cloud.options)===null||V===void 0)&&V.databaseUrl)||!((q=K.cloud.options)===null||q===void 0)&&q.disableWebSocket||km||r.push((function(ee){var me;if(!(!((me=ee.cloud.options)===null||me===void 0)&&me.databaseUrl))throw new Error("No database URL to connect WebSocket to");const ve=ee.messageConsumer.readyToServe.pipe(Et(ae=>ae),ut(()=>ee.getPersistedSyncState()),Et(ae=>ae&&ae.serverRevision),ut(ae=>Q(this,void 0,void 0,function*(){return{type:"ready",rev:ae.serverRevision,realmSetHash:yield fa(ae)}}))),le=Ds(ve,ee.messageProducer);return(function ae(){return ee.cloud.persistedSyncState.pipe(Et(H=>H==null?void 0:H.serverRevision),tr(1),ut(H=>ee.cloud.currentUser.pipe(bt(de=>[de,H]))),ut(([H,de])=>ba.pipe(bt(ue=>[ue?H:null,de]))),ut(([H,de])=>H!=null&&H.isLoggedIn&&!(de!=null&&de.realms.includes(H.userId))?ee.cloud.persistedSyncState.pipe(Et(ue=>(ue==null?void 0:ue.realms.includes(H.userId))||!1),tr(1),bt(ue=>[H,ue])):new Rt([H,de])),ut(H=>Q(this,[H],void 0,function*([de,ue]){return[de,yield fa(ue)]})),Iu(([H,de],[ue,pe])=>H===ue&&de===pe),ut(([H,de])=>{var ue;return!((ue=ee.cloud.persistedSyncState)===null||ue===void 0)&&ue.value?H?new Um(ee,ee.cloud.persistedSyncState.value.serverRevision,ee.cloud.persistedSyncState.value.yServerRevision,de,ee.cloud.persistedSyncState.value.clientIdentity,le,ee.cloud.webSocketStatus,H):_t([]):ae()}),Zo(H=>(H==null?void 0:H.name)==="TokenExpiredError"?Zt(!0).pipe(ut(()=>Q(this,void 0,void 0,function*(){const de=yield ee.getCurrentUser(),ue=yield Bs(ee.cloud.options.databaseUrl,de);yield ee.table("$logins").update(de.userId,{accessToken:ue.accessToken,accessTokenExpiration:ue.accessTokenExpiration,claims:ue.claims,license:ue.license,data:ue.data})})),ut(()=>ae())):qc(()=>H)),Zo(H=>(ee.cloud.webSocketStatus.next("error"),H instanceof Nm?qc(()=>H):_t(Km()).pipe(ut(()=>ae())))))})().subscribe({next:ae=>{ae&&ee.messageConsumer.enqueue(ae)},error:ae=>{},complete:()=>{}})})(K))})})(m)}catch{}}),!0);let d=!1;function f(){if(d)throw new Ce.DatabaseClosedError}t.once("close",()=>{r.forEach(m=>m.unsubscribe()),r.splice(0,r.length),d=!0,l&&l.stop(),l=null,n.next(ht)});const g=new Bn;var p;t.cloud={version:"4.3.3",options:Object.assign({},tv),schema:null,get currentUserId(){return n.value.userId||ht.userId},currentUser:n,syncState:new Rt({phase:"initial",status:"not-started"}),events:{syncComplete:g},persistedSyncState:new Rt(void 0),userInteraction:new Rt(void 0),webSocketStatus:new Rt("not-started"),login(m){return Q(this,void 0,void 0,function*(){const b=Nt(t);yield b.cloud.sync(),yield Qi(b,m)})},invites:Qm(t),roles:kd(t),configure(m){if(m=t.cloud.options=Object.assign(Object.assign({},t.cloud.options),m),i=!0,m.databaseUrl&&m.nameSuffix&&(t.name=`${e}-${(function(b){const S=new URL(b);return S.pathname==="/"?S.hostname.split(".")[0]:S.pathname.split("/")[1]})(m.databaseUrl)}`,Nt(t).reconfigure()),Ho(t.cloud.schema,t.cloud.options),typeof window<"u"&&window.location)try{const b=ev();b&&(nu(),s={code:b.code,provider:b.provider})}catch(b){nu(),b instanceof Bt&&(c=b)}},logout(){return Q(this,arguments,void 0,function*({force:m}={}){m?yield va(Nt(t),{deleteUnsyncedData:!0}):yield ed(Nt(t))})},sync(){return Q(this,arguments,void 0,function*({wait:m,purpose:b}={wait:!0,purpose:"push"}){var S;m===void 0&&(m=!0);const x=Nt(t);if((((S=x.cloud.currentUser.value.license)===null||S===void 0?void 0:S.status)||"ok")!=="ok"&&(yield Ks(x)),b==="pull"){const N=x.cloud.persistedSyncState.value;if(Xt(x,b),m){const U=yield Un(x.cloud.persistedSyncState.pipe(Et(M=>(M==null?void 0:M.timestamp)!=null&&(!N||M.timestamp>N.timestamp))));if(U!=null&&U.error)throw new Error("Sync error: "+U.error)}}else if(yield Ml(x)){const N=x.cloud.persistedSyncState.value;Xt(x,b),m&&(yield Un(_t(gn(()=>Q(this,void 0,void 0,function*(){const U=yield Ml(x),M=yield x.getPersistedSyncState();if((M==null?void 0:M.timestamp)!==(N==null?void 0:N.timestamp)&&(M!=null&&M.error))throw new Error("Sync error: "+M.error);return U}))).pipe(Et(U=>!U))))}})},permissions:(m,b)=>(function(S,x,N){if(!x)throw new TypeError("Cannot check permissions of undefined or null. A Dexie Cloud object with realmId and owner expected.");const{owner:U,realmId:M}=x;if(!N){if(typeof x.table!="function")throw new TypeError("Missing 'table' argument to permissions and table could not be extracted from entity");N=x.table()}const V=xd(S),q=ie=>{const Z=ie[M||S.cloud.currentUserId];return Z?new tu(Z.permissions,N,M===void 0||M===S.cloud.currentUserId||U===S.cloud.currentUserId):new tu({},N,!U||U===S.cloud.currentUserId)},K=V.pipe(bt(q));return K.getValue=()=>q(V.getValue()),K})(t._novip,m,b)},t.Version.prototype._parseStoresSpec=Ce.override(t.Version.prototype._parseStoresSpec,m=>Tm(m,t)),t.Table.prototype.newId=function({colocateWith:m}={}){const b=m&&m.substr(m.length-3);return rd(t.cloud.schema[this.name].idPrefix||"",b)},t.Table.prototype.idPrefix=function(){var m,b;return((b=(m=this.db.cloud.schema)===null||m===void 0?void 0:m[this.name])===null||b===void 0?void 0:b.idPrefix)||""},t.use(Dm({currentUserObservable:t.cloud.currentUser,db:Nt(t)})),t.use((p=Nt(t),{stack:"dbcore",name:"implicitPropSetterMiddleware",level:1,create:m=>Object.assign(Object.assign({},m),{table:b=>{const S=m.table(b);return Object.assign(Object.assign({},S),{mutate:x=>{var N,U,M,V,q,K;const ie=x.trans;if(ie.disableChangeTracking)return S.mutate(x);const Z=(U=(N=ie.currentUser)===null||N===void 0?void 0:N.userId)!==null&&U!==void 0?U:ht.userId;if(!((V=(M=p.cloud.schema)===null||M===void 0?void 0:M[b])===null||V===void 0)&&V.markedForSync&&(x.type==="add"||x.type==="put")){if(b==="members")for(const he of x.values)typeof he.email=="string"&&(he.email=he.email.trim().toLowerCase());for(const he of x.values){he.owner||(he.owner=Z),he.realmId||(he.realmId=Z);const ne=(K=(q=S.schema.primaryKey).extractKey)===null||K===void 0?void 0:K.call(q,he);typeof ne=="string"&&ne[0]==="#"&&x.type==="put"&&(delete x.criteria,delete x.changeSpec,x.upsert||delete x.updates,he.$ts=Date.now())}}return S.mutate(x)}})}})})),t.use(Om(Nt(t)))}xa.version="4.3.3",Ce.Cloud=xa;const $r=new Map;function ru(t){return t.startsWith("dexie-cloud:")&&t.split(":")[1]}const ts=new Map;function Yo(t,e){let n=ts.get(t+"/"+e);return n||(n=(function r(i,s){return Q(this,void 0,void 0,function*(){var c;let l=$r.get(i);if(!l){const f=new Ce(i,{addons:[xa]});if(l=Nt(f),l.cloud.isServiceWorkerDB=!0,f.on("versionchange",d),yield l.dx.open(),$r.get(i))return l.close(),yield r(i,s);$r.set(i,l)}if(!((c=l.cloud.options)===null||c===void 0)&&c.databaseUrl&&l.cloud.schema)try{yield za(l,l.cloud.options,l.cloud.schema,{retryImmediatelyOnFetchError:!0,purpose:s})}catch(f){if(d(),f.name!==Ce.errnames.NoSuchDatabase)throw f}function d(){return l.dx.on.versionchange.unsubscribe(d),$r.get(l.name)===l&&$r.delete(l.name),l.dx.close(),!1}})})(t,e).then(()=>{ts.delete(t+"/"+e)}).catch(r=>(ts.delete(t+"/"+e),Promise.reject(r))),ts.set(t+"/"+e,n)),n}nd||(self.addEventListener("sync",t=>{const e=ru(t.tag);e&&t.waitUntil(Yo(e,"push"))}),self.addEventListener("periodicsync",t=>{const e=ru(t.tag);e&&t.waitUntil(Yo(e,"pull"))}),self.addEventListener("message",t=>{if(t.data.type==="dexie-cloud-sync"){const{dbName:e}=t.data,n=(r=1)=>Yo(e,t.data.purpose||"pull").catch(i=>Q(void 0,void 0,void 0,function*(){if(r===3)throw i;var s;yield(s=6e4,new Promise(c=>setTimeout(c,s))),n(r+1)}));"waitUntil"in t?t.waitUntil(n().catch(r=>{})):n().catch(r=>{})}}));try{self["workbox:core:7.3.0"]&&_()}catch{}const nv=(t,...e)=>{let n=t;return e.length>0&&(n+=` :: ${JSON.stringify(e)}`),n},rv=nv;class yt extends Error{constructor(e,n){const r=rv(e,n);super(r),this.name=e,this.details=n}}const Jt={googleAnalytics:"googleAnalytics",precache:"precache-v2",prefix:"workbox",runtime:"runtime",suffix:typeof registration<"u"?registration.scope:""},Go=t=>[Jt.prefix,t,Jt.suffix].filter(e=>e&&e.length>0).join("-"),iv=t=>{for(const e of Object.keys(Jt))t(e)},Vs={updateDetails:t=>{iv(e=>{typeof t[e]=="string"&&(Jt[e]=t[e])})},getGoogleAnalyticsName:t=>t||Go(Jt.googleAnalytics),getPrecacheName:t=>t||Go(Jt.precache),getPrefix:()=>Jt.prefix,getRuntimeName:t=>t||Go(Jt.runtime),getSuffix:()=>Jt.suffix};function iu(t,e){const n=e();return t.waitUntil(n),n}try{self["workbox:precaching:7.3.0"]&&_()}catch{}const sv="__WB_REVISION__";function ov(t){if(!t)throw new yt("add-to-cache-list-unexpected-type",{entry:t});if(typeof t=="string"){const s=new URL(t,location.href);return{cacheKey:s.href,url:s.href}}const{revision:e,url:n}=t;if(!n)throw new yt("add-to-cache-list-unexpected-type",{entry:t});if(!e){const s=new URL(n,location.href);return{cacheKey:s.href,url:s.href}}const r=new URL(n,location.href),i=new URL(n,location.href);return r.searchParams.set(sv,e),{cacheKey:r.href,url:i.href}}class av{constructor(){this.updatedURLs=[],this.notUpdatedURLs=[],this.handlerWillStart=async({request:e,state:n})=>{n&&(n.originalRequest=e)},this.cachedResponseWillBeUsed=async({event:e,state:n,cachedResponse:r})=>{if(e.type==="install"&&n&&n.originalRequest&&n.originalRequest instanceof Request){const i=n.originalRequest.url;r?this.notUpdatedURLs.push(i):this.updatedURLs.push(i)}return r}}}class cv{constructor({precacheController:e}){this.cacheKeyWillBeUsed=async({request:n,params:r})=>{const i=(r==null?void 0:r.cacheKey)||this._precacheController.getCacheKeyForURL(n.url);return i?new Request(i,{headers:n.headers}):n},this._precacheController=e}}let qr;function lv(){if(qr===void 0){const t=new Response("");if("body"in t)try{new Response(t.body),qr=!0}catch{qr=!1}qr=!1}return qr}async function uv(t,e){let n=null;if(t.url&&(n=new URL(t.url).origin),n!==self.location.origin)throw new yt("cross-origin-copy-response",{origin:n});const r=t.clone(),s={headers:new Headers(r.headers),status:r.status,statusText:r.statusText},c=lv()?r.body:await r.blob();return new Response(c,s)}const fv=t=>new URL(String(t),location.href).href.replace(new RegExp(`^${location.origin}`),"");function su(t,e){const n=new URL(t);for(const r of e)n.searchParams.delete(r);return n.href}async function dv(t,e,n,r){const i=su(e.url,n);if(e.url===i)return t.match(e,r);const s=Object.assign(Object.assign({},r),{ignoreSearch:!0}),c=await t.keys(e,s);for(const l of c){const d=su(l.url,n);if(i===d)return t.match(l,r)}}class hv{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}const pv=new Set;async function yv(){for(const t of pv)await t()}function gv(t){return new Promise(e=>setTimeout(e,t))}try{self["workbox:strategies:7.3.0"]&&_()}catch{}function ns(t){return typeof t=="string"?new Request(t):t}class mv{constructor(e,n){this._cacheKeys={},Object.assign(this,n),this.event=n.event,this._strategy=e,this._handlerDeferred=new hv,this._extendLifetimePromises=[],this._plugins=[...e.plugins],this._pluginStateMap=new Map;for(const r of this._plugins)this._pluginStateMap.set(r,{});this.event.waitUntil(this._handlerDeferred.promise)}async fetch(e){const{event:n}=this;let r=ns(e);if(r.mode==="navigate"&&n instanceof FetchEvent&&n.preloadResponse){const c=await n.preloadResponse;if(c)return c}const i=this.hasCallback("fetchDidFail")?r.clone():null;try{for(const c of this.iterateCallbacks("requestWillFetch"))r=await c({request:r.clone(),event:n})}catch(c){if(c instanceof Error)throw new yt("plugin-error-request-will-fetch",{thrownErrorMessage:c.message})}const s=r.clone();try{let c;c=await fetch(r,r.mode==="navigate"?void 0:this._strategy.fetchOptions);for(const l of this.iterateCallbacks("fetchDidSucceed"))c=await l({event:n,request:s,response:c});return c}catch(c){throw i&&await this.runCallbacks("fetchDidFail",{error:c,event:n,originalRequest:i.clone(),request:s.clone()}),c}}async fetchAndCachePut(e){const n=await this.fetch(e),r=n.clone();return this.waitUntil(this.cachePut(e,r)),n}async cacheMatch(e){const n=ns(e);let r;const{cacheName:i,matchOptions:s}=this._strategy,c=await this.getCacheKey(n,"read"),l=Object.assign(Object.assign({},s),{cacheName:i});r=await caches.match(c,l);for(const d of this.iterateCallbacks("cachedResponseWillBeUsed"))r=await d({cacheName:i,matchOptions:s,cachedResponse:r,request:c,event:this.event})||void 0;return r}async cachePut(e,n){const r=ns(e);await gv(0);const i=await this.getCacheKey(r,"write");if(!n)throw new yt("cache-put-with-no-response",{url:fv(i.url)});const s=await this._ensureResponseSafeToCache(n);if(!s)return!1;const{cacheName:c,matchOptions:l}=this._strategy,d=await self.caches.open(c),f=this.hasCallback("cacheDidUpdate"),g=f?await dv(d,i.clone(),["__WB_REVISION__"],l):null;try{await d.put(i,f?s.clone():s)}catch(p){if(p instanceof Error)throw p.name==="QuotaExceededError"&&await yv(),p}for(const p of this.iterateCallbacks("cacheDidUpdate"))await p({cacheName:c,oldResponse:g,newResponse:s.clone(),request:i,event:this.event});return!0}async getCacheKey(e,n){const r=`${e.url} | ${n}`;if(!this._cacheKeys[r]){let i=e;for(const s of this.iterateCallbacks("cacheKeyWillBeUsed"))i=ns(await s({mode:n,request:i,event:this.event,params:this.params}));this._cacheKeys[r]=i}return this._cacheKeys[r]}hasCallback(e){for(const n of this._strategy.plugins)if(e in n)return!0;return!1}async runCallbacks(e,n){for(const r of this.iterateCallbacks(e))await r(n)}*iterateCallbacks(e){for(const n of this._strategy.plugins)if(typeof n[e]=="function"){const r=this._pluginStateMap.get(n);yield s=>{const c=Object.assign(Object.assign({},s),{state:r});return n[e](c)}}}waitUntil(e){return this._extendLifetimePromises.push(e),e}async doneWaiting(){for(;this._extendLifetimePromises.length;){const e=this._extendLifetimePromises.splice(0),r=(await Promise.allSettled(e)).find(i=>i.status==="rejected");if(r)throw r.reason}}destroy(){this._handlerDeferred.resolve(null)}async _ensureResponseSafeToCache(e){let n=e,r=!1;for(const i of this.iterateCallbacks("cacheWillUpdate"))if(n=await i({request:this.request,response:n,event:this.event})||void 0,r=!0,!n)break;return r||n&&n.status!==200&&(n=void 0),n}}class vv{constructor(e={}){this.cacheName=Vs.getRuntimeName(e.cacheName),this.plugins=e.plugins||[],this.fetchOptions=e.fetchOptions,this.matchOptions=e.matchOptions}handle(e){const[n]=this.handleAll(e);return n}handleAll(e){e instanceof FetchEvent&&(e={event:e,request:e.request});const n=e.event,r=typeof e.request=="string"?new Request(e.request):e.request,i="params"in e?e.params:void 0,s=new mv(this,{event:n,request:r,params:i}),c=this._getResponse(s,r,n),l=this._awaitComplete(c,s,r,n);return[c,l]}async _getResponse(e,n,r){await e.runCallbacks("handlerWillStart",{event:r,request:n});let i;try{if(i=await this._handle(n,e),!i||i.type==="error")throw new yt("no-response",{url:n.url})}catch(s){if(s instanceof Error){for(const c of e.iterateCallbacks("handlerDidError"))if(i=await c({error:s,event:r,request:n}),i)break}if(!i)throw s}for(const s of e.iterateCallbacks("handlerWillRespond"))i=await s({event:r,request:n,response:i});return i}async _awaitComplete(e,n,r,i){let s,c;try{s=await e}catch{}try{await n.runCallbacks("handlerDidRespond",{event:i,request:r,response:s}),await n.doneWaiting()}catch(l){l instanceof Error&&(c=l)}if(await n.runCallbacks("handlerDidComplete",{event:i,request:r,response:s,error:c}),n.destroy(),c)throw c}}class yn extends vv{constructor(e={}){e.cacheName=Vs.getPrecacheName(e.cacheName),super(e),this._fallbackToNetwork=e.fallbackToNetwork!==!1,this.plugins.push(yn.copyRedirectedCacheableResponsesPlugin)}async _handle(e,n){const r=await n.cacheMatch(e);return r||(n.event&&n.event.type==="install"?await this._handleInstall(e,n):await this._handleFetch(e,n))}async _handleFetch(e,n){let r;const i=n.params||{};if(this._fallbackToNetwork){const s=i.integrity,c=e.integrity,l=!c||c===s;r=await n.fetch(new Request(e,{integrity:e.mode!=="no-cors"?c||s:void 0})),s&&l&&e.mode!=="no-cors"&&(this._useDefaultCacheabilityPluginIfNeeded(),await n.cachePut(e,r.clone()))}else throw new yt("missing-precache-entry",{cacheName:this.cacheName,url:e.url});return r}async _handleInstall(e,n){this._useDefaultCacheabilityPluginIfNeeded();const r=await n.fetch(e);if(!await n.cachePut(e,r.clone()))throw new yt("bad-precaching-response",{url:e.url,status:r.status});return r}_useDefaultCacheabilityPluginIfNeeded(){let e=null,n=0;for(const[r,i]of this.plugins.entries())i!==yn.copyRedirectedCacheableResponsesPlugin&&(i===yn.defaultPrecacheCacheabilityPlugin&&(e=r),i.cacheWillUpdate&&n++);n===0?this.plugins.push(yn.defaultPrecacheCacheabilityPlugin):n>1&&e!==null&&this.plugins.splice(e,1)}}yn.defaultPrecacheCacheabilityPlugin={async cacheWillUpdate({response:t}){return!t||t.status>=400?null:t}};yn.copyRedirectedCacheableResponsesPlugin={async cacheWillUpdate({response:t}){return t.redirected?await uv(t):t}};class bv{constructor({cacheName:e,plugins:n=[],fallbackToNetwork:r=!0}={}){this._urlsToCacheKeys=new Map,this._urlsToCacheModes=new Map,this._cacheKeysToIntegrities=new Map,this._strategy=new yn({cacheName:Vs.getPrecacheName(e),plugins:[...n,new cv({precacheController:this})],fallbackToNetwork:r}),this.install=this.install.bind(this),this.activate=this.activate.bind(this)}get strategy(){return this._strategy}precache(e){this.addToCacheList(e),this._installAndActiveListenersAdded||(self.addEventListener("install",this.install),self.addEventListener("activate",this.activate),this._installAndActiveListenersAdded=!0)}addToCacheList(e){const n=[];for(const r of e){typeof r=="string"?n.push(r):r&&r.revision===void 0&&n.push(r.url);const{cacheKey:i,url:s}=ov(r),c=typeof r!="string"&&r.revision?"reload":"default";if(this._urlsToCacheKeys.has(s)&&this._urlsToCacheKeys.get(s)!==i)throw new yt("add-to-cache-list-conflicting-entries",{firstEntry:this._urlsToCacheKeys.get(s),secondEntry:i});if(typeof r!="string"&&r.integrity){if(this._cacheKeysToIntegrities.has(i)&&this._cacheKeysToIntegrities.get(i)!==r.integrity)throw new yt("add-to-cache-list-conflicting-integrities",{url:s});this._cacheKeysToIntegrities.set(i,r.integrity)}if(this._urlsToCacheKeys.set(s,i),this._urlsToCacheModes.set(s,c),n.length>0){const l=`Workbox is precaching URLs without revision info: ${n.join(", ")}
This is generally NOT safe. Learn more at https://bit.ly/wb-precache`;console.warn(l)}}}install(e){return iu(e,async()=>{const n=new av;this.strategy.plugins.push(n);for(const[s,c]of this._urlsToCacheKeys){const l=this._cacheKeysToIntegrities.get(c),d=this._urlsToCacheModes.get(s),f=new Request(s,{integrity:l,cache:d,credentials:"same-origin"});await Promise.all(this.strategy.handleAll({params:{cacheKey:c},request:f,event:e}))}const{updatedURLs:r,notUpdatedURLs:i}=n;return{updatedURLs:r,notUpdatedURLs:i}})}activate(e){return iu(e,async()=>{const n=await self.caches.open(this.strategy.cacheName),r=await n.keys(),i=new Set(this._urlsToCacheKeys.values()),s=[];for(const c of r)i.has(c.url)||(await n.delete(c),s.push(c.url));return{deletedURLs:s}})}getURLsToCacheKeys(){return this._urlsToCacheKeys}getCachedURLs(){return[...this._urlsToCacheKeys.keys()]}getCacheKeyForURL(e){const n=new URL(e,location.href);return this._urlsToCacheKeys.get(n.href)}getIntegrityForCacheKey(e){return this._cacheKeysToIntegrities.get(e)}async matchPrecache(e){const n=e instanceof Request?e.url:e,r=this.getCacheKeyForURL(n);if(r)return(await self.caches.open(this.strategy.cacheName)).match(r)}createHandlerBoundToURL(e){const n=this.getCacheKeyForURL(e);if(!n)throw new yt("non-precached-url",{url:e});return r=>(r.request=new Request(e),r.params=Object.assign({cacheKey:n},r.params),this.strategy.handle(r))}}let Jo;const Cd=()=>(Jo||(Jo=new bv),Jo);try{self["workbox:routing:7.3.0"]&&_()}catch{}const Ed="GET",Is=t=>t&&typeof t=="object"?t:{handle:t};class Qr{constructor(e,n,r=Ed){this.handler=Is(n),this.match=e,this.method=r}setCatchHandler(e){this.catchHandler=Is(e)}}class wv extends Qr{constructor(e,n,r){const i=({url:s})=>{const c=e.exec(s.href);if(c&&!(s.origin!==location.origin&&c.index!==0))return c.slice(1)};super(i,n,r)}}class _v{constructor(){this._routes=new Map,this._defaultHandlerMap=new Map}get routes(){return this._routes}addFetchListener(){self.addEventListener("fetch",(e=>{const{request:n}=e,r=this.handleRequest({request:n,event:e});r&&e.respondWith(r)}))}addCacheListener(){self.addEventListener("message",(e=>{if(e.data&&e.data.type==="CACHE_URLS"){const{payload:n}=e.data,r=Promise.all(n.urlsToCache.map(i=>{typeof i=="string"&&(i=[i]);const s=new Request(...i);return this.handleRequest({request:s,event:e})}));e.waitUntil(r),e.ports&&e.ports[0]&&r.then(()=>e.ports[0].postMessage(!0))}}))}handleRequest({request:e,event:n}){const r=new URL(e.url,location.href);if(!r.protocol.startsWith("http"))return;const i=r.origin===location.origin,{params:s,route:c}=this.findMatchingRoute({event:n,request:e,sameOrigin:i,url:r});let l=c&&c.handler;const d=e.method;if(!l&&this._defaultHandlerMap.has(d)&&(l=this._defaultHandlerMap.get(d)),!l)return;let f;try{f=l.handle({url:r,request:e,event:n,params:s})}catch(p){f=Promise.reject(p)}const g=c&&c.catchHandler;return f instanceof Promise&&(this._catchHandler||g)&&(f=f.catch(async p=>{if(g)try{return await g.handle({url:r,request:e,event:n,params:s})}catch(m){m instanceof Error&&(p=m)}if(this._catchHandler)return this._catchHandler.handle({url:r,request:e,event:n});throw p})),f}findMatchingRoute({url:e,sameOrigin:n,request:r,event:i}){const s=this._routes.get(r.method)||[];for(const c of s){let l;const d=c.match({url:e,sameOrigin:n,request:r,event:i});if(d)return l=d,(Array.isArray(l)&&l.length===0||d.constructor===Object&&Object.keys(d).length===0||typeof d=="boolean")&&(l=void 0),{route:c,params:l}}return{}}setDefaultHandler(e,n=Ed){this._defaultHandlerMap.set(n,Is(e))}setCatchHandler(e){this._catchHandler=Is(e)}registerRoute(e){this._routes.has(e.method)||this._routes.set(e.method,[]),this._routes.get(e.method).push(e)}unregisterRoute(e){if(!this._routes.has(e.method))throw new yt("unregister-route-but-not-found-with-method",{method:e.method});const n=this._routes.get(e.method).indexOf(e);if(n>-1)this._routes.get(e.method).splice(n,1);else throw new yt("unregister-route-route-not-registered")}}let Wr;const kv=()=>(Wr||(Wr=new _v,Wr.addFetchListener(),Wr.addCacheListener()),Wr);function Sv(t,e,n){let r;if(typeof t=="string"){const s=new URL(t,location.href),c=({url:l})=>l.href===s.href;r=new Qr(c,e,n)}else if(t instanceof RegExp)r=new wv(t,e,n);else if(typeof t=="function")r=new Qr(t,e,n);else if(t instanceof Qr)r=t;else throw new yt("unsupported-route-type",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});return kv().registerRoute(r),r}function xv(t,e=[]){for(const n of[...t.searchParams.keys()])e.some(r=>r.test(n))&&t.searchParams.delete(n);return t}function*Cv(t,{ignoreURLParametersMatching:e=[/^utm_/,/^fbclid$/],directoryIndex:n="index.html",cleanURLs:r=!0,urlManipulation:i}={}){const s=new URL(t,location.href);s.hash="",yield s.href;const c=xv(s,e);if(yield c.href,n&&c.pathname.endsWith("/")){const l=new URL(c.href);l.pathname+=n,yield l.href}if(r){const l=new URL(c.href);l.pathname+=".html",yield l.href}if(i){const l=i({url:s});for(const d of l)yield d.href}}class Ev extends Qr{constructor(e,n){const r=({request:i})=>{const s=e.getURLsToCacheKeys();for(const c of Cv(i.url,n)){const l=s.get(c);if(l){const d=e.getIntegrityForCacheKey(l);return{cacheKey:l,integrity:d}}}};super(r,e.strategy)}}function Ov(t){const e=Cd(),n=new Ev(e,t);Sv(n)}const Iv="-precache-",Av=async(t,e=Iv)=>{const r=(await self.caches.keys()).filter(i=>i.includes(e)&&i.includes(self.registration.scope)&&i!==t);return await Promise.all(r.map(i=>self.caches.delete(i))),r};function Dv(){self.addEventListener("activate",(t=>{const e=Vs.getPrecacheName();t.waitUntil(Av(e).then(n=>{}))}))}function Tv(t){Cd().precache(t)}function Rv(t,e){Tv(t),Ov(e)}console.log("ð Service Worker starting (built at 2026-01-23T09:40:32.462Z)");Rv([{"revision":"85907bd3aded464fcf4509ced5cc23a8","url":"index.html"},{"revision":null,"url":"assets/index-D0d1whyP.js"},{"revision":null,"url":"assets/index-BZwqqHxY.css"},{"revision":"0ea25c17ba9443457d913d6be03fea55","url":"dexie-icon-192x192.png"},{"revision":"f1749b24004626d4cb2f90aee4e442d2","url":"dexie-icon-512x512.png"},{"revision":"fc723c843a0b8a137167d3d63dda4e28","url":"dexie-icon-64x64.gif"},{"revision":"863c49ac89a611a8eef92f08ca81eb5f","url":"manifest.webmanifest"}]);Dv();self.addEventListener("install",t=>{self.skipWaiting()});
//# sourceMappingURL=sw.js.map
