var Qd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zd(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var rs={exports:{}},eh=rs.exports,Pc;function th(){return Pc||(Pc=1,(function(t,e){((n,r)=>{t.exports=r()})(eh,function(){var n=function(o,a){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(u,h){u.__proto__=h}:function(u,h){for(var y in h)Object.prototype.hasOwnProperty.call(h,y)&&(u[y]=h[y])}))(o,a)},r=function(){return(r=Object.assign||function(o){for(var a,u=1,h=arguments.length;u<h;u++)for(var y in a=arguments[u])Object.prototype.hasOwnProperty.call(a,y)&&(o[y]=a[y]);return o}).apply(this,arguments)};function i(o,a,u){for(var h,y=0,m=a.length;y<m;y++)!h&&y in a||((h=h||Array.prototype.slice.call(a,0,y))[y]=a[y]);return o.concat(h||Array.prototype.slice.call(a))}var s=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Qd,c=Object.keys,l=Array.isArray;function f(o,a){return typeof a=="object"&&c(a).forEach(function(u){o[u]=a[u]}),o}typeof Promise>"u"||s.Promise||(s.Promise=Promise);var d=Object.getPrototypeOf,g={}.hasOwnProperty;function p(o,a){return g.call(o,a)}function v(o,a){typeof a=="function"&&(a=a(d(o))),(typeof Reflect>"u"?c:Reflect.ownKeys)(a).forEach(function(u){S(o,u,a[u])})}var b=Object.defineProperty;function S(o,a,u,h){b(o,a,f(u&&p(u,"get")&&typeof u.get=="function"?{get:u.get,set:u.set,configurable:!0}:{value:u,configurable:!0,writable:!0},h))}function A(o){return{from:function(a){return o.prototype=Object.create(a.prototype),S(o.prototype,"constructor",o),{extend:v.bind(null,o.prototype)}}}}var N=Object.getOwnPropertyDescriptor,U=[].slice;function K(o,a,u){return U.call(o,a,u)}function W(o,a){return a(o)}function L(o){if(!o)throw new Error("Assertion Failed")}function ae(o){s.setImmediate?setImmediate(o):setTimeout(o,0)}function te(o,a){if(typeof a=="string"&&p(o,a))return o[a];if(!a)return o;if(typeof a!="string"){for(var u=[],h=0,y=a.length;h<y;++h){var m=te(o,a[h]);u.push(m)}return u}var w,k=a.indexOf(".");return k===-1||(w=o[a.substr(0,k)])==null?void 0:te(w,a.substr(k+1))}function G(o,a,u){if(o&&a!==void 0&&!("isFrozen"in Object&&Object.isFrozen(o)))if(typeof a!="string"&&"length"in a){L(typeof u!="string"&&"length"in u);for(var h=0,y=a.length;h<y;++h)G(o,a[h],u[h])}else{var m,w,k=a.indexOf(".");k!==-1?(m=a.substr(0,k),(k=a.substr(k+1))===""?u===void 0?l(o)&&!isNaN(parseInt(m))?o.splice(m,1):delete o[m]:o[m]=u:G(w=(w=o[m])&&p(o,m)?w:o[m]={},k,u)):u===void 0?l(o)&&!isNaN(parseInt(a))?o.splice(a,1):delete o[a]:o[a]=u}}function ye(o){var a,u={};for(a in o)p(o,a)&&(u[a]=o[a]);return u}var ne=[].concat;function X(o){return ne.apply([],o)}var ue="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(X([8,16,32,64].map(function(o){return["Int","Uint","Float"].map(function(a){return a+o+"Array"})}))).filter(function(o){return s[o]}),se=new Set(ue.map(function(o){return s[o]})),V=null;function ge(o){return V=new WeakMap,o=(function a(u){if(!u||typeof u!="object")return u;var h=V.get(u);if(h)return h;if(l(u)){h=[],V.set(u,h);for(var y=0,m=u.length;y<m;++y)h.push(a(u[y]))}else if(se.has(u.constructor))h=u;else{var w,k=d(u);for(w in h=k===Object.prototype?{}:Object.create(k),V.set(u,h),u)p(u,w)&&(h[w]=a(u[w]))}return h})(o),V=null,o}var be={}.toString;function me(o){return be.call(o).slice(8,-1)}var le=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Y=typeof le=="symbol"?function(o){var a;return o!=null&&(a=o[le])&&a.apply(o)}:function(){return null};function ce(o,a){a=o.indexOf(a),0<=a&&o.splice(a,1)}var ie={};function Ce(o){var a,u,h,y;if(arguments.length===1){if(l(o))return o.slice();if(this===ie&&typeof o=="string")return[o];if(y=Y(o))for(u=[];!(h=y.next()).done;)u.push(h.value);else{if(o==null)return[o];if(typeof(a=o.length)!="number")return[o];for(u=new Array(a);a--;)u[a]=o[a]}}else for(a=arguments.length,u=new Array(a);a--;)u[a]=arguments[a];return u}var he=typeof Symbol<"u"?function(o){return o[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},ue=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],mt=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(ue),_e={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Fe(o,a){this.name=o,this.message=a}function at(o,a){return o+". Errors: "+Object.keys(a).map(function(u){return a[u].toString()}).filter(function(u,h,y){return y.indexOf(u)===h}).join(`
`)}function ze(o,a,u,h){this.failures=a,this.failedKeys=h,this.successCount=u,this.message=at(o,a)}function Ge(o,a){this.name="BulkError",this.failures=Object.keys(a).map(function(u){return a[u]}),this.failuresByPos=a,this.message=at(o,this.failures)}A(Fe).from(Error).extend({toString:function(){return this.name+": "+this.message}}),A(ze).from(Fe),A(Ge).from(Fe);var qe=mt.reduce(function(o,a){return o[a]=a+"Error",o},{}),ct=Fe,J=mt.reduce(function(o,a){var u=a+"Error";function h(y,m){this.name=u,y?typeof y=="string"?(this.message="".concat(y).concat(m?`
 `+m:""),this.inner=m||null):typeof y=="object"&&(this.message="".concat(y.name," ").concat(y.message),this.inner=y):(this.message=_e[a]||u,this.inner=null)}return A(h).from(ct),o[a]=h,o},{}),Ze=(J.Syntax=SyntaxError,J.Type=TypeError,J.Range=RangeError,ue.reduce(function(o,a){return o[a+"Error"]=J[a],o},{}));ue=mt.reduce(function(o,a){return["Syntax","Type","Range"].indexOf(a)===-1&&(o[a+"Error"]=J[a]),o},{});function pe(){}function ke(o){return o}function Ae(o,a){return o==null||o===ke?a:function(u){return a(o(u))}}function Pe(o,a){return function(){o.apply(this,arguments),a.apply(this,arguments)}}function gt(o,a){return o===pe?a:function(){var u=o.apply(this,arguments),h=(u!==void 0&&(arguments[0]=u),this.onsuccess),y=this.onerror,m=(this.onsuccess=null,this.onerror=null,a.apply(this,arguments));return h&&(this.onsuccess=this.onsuccess?Pe(h,this.onsuccess):h),y&&(this.onerror=this.onerror?Pe(y,this.onerror):y),m!==void 0?m:u}}function xn(o,a){return o===pe?a:function(){o.apply(this,arguments);var u=this.onsuccess,h=this.onerror;this.onsuccess=this.onerror=null,a.apply(this,arguments),u&&(this.onsuccess=this.onsuccess?Pe(u,this.onsuccess):u),h&&(this.onerror=this.onerror?Pe(h,this.onerror):h)}}function Pt(o,a){return o===pe?a:function(y){var h=o.apply(this,arguments),y=(f(y,h),this.onsuccess),m=this.onerror,w=(this.onsuccess=null,this.onerror=null,a.apply(this,arguments));return y&&(this.onsuccess=this.onsuccess?Pe(y,this.onsuccess):y),m&&(this.onerror=this.onerror?Pe(m,this.onerror):m),h===void 0?w===void 0?void 0:w:f(h,w)}}function Ed(o,a){return o===pe?a:function(){return a.apply(this,arguments)!==!1&&o.apply(this,arguments)}}function Ws(o,a){return o===pe?a:function(){var u=o.apply(this,arguments);if(u&&typeof u.then=="function"){for(var h=this,y=arguments.length,m=new Array(y);y--;)m[y]=arguments[y];return u.then(function(){return a.apply(h,m)})}return a.apply(this,arguments)}}ue.ModifyError=ze,ue.DexieError=Fe,ue.BulkError=Ge;var jt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Qa(o){jt=o}var xr={},Za=100,Cr=typeof Promise>"u"?[]:(mt=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[Cr=crypto.subtle.digest("SHA-512",new Uint8Array([0])),d(Cr),mt]:[mt,d(mt),mt]),mt=Cr[0],Qn=Cr[1],Qn=Qn&&Qn.then,Cn=mt&&mt.constructor,Hs=!!Cr[2],Er=function(o,a){Or.push([o,a]),bi&&(queueMicrotask(Id),bi=!1)},zs=!0,bi=!0,En=[],wi=[],Ys=ke,an={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:pe,pgp:!1,env:{},finalize:pe},fe=an,Or=[],On=0,_i=[];function Q(o){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var a=this._PSD=fe;if(typeof o!="function"){if(o!==xr)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Js(this,this._value)}else this._state=null,this._value=null,++a.ref,(function u(h,y){try{y(function(m){if(h._state===null){if(m===h)throw new TypeError("A promise cannot be resolved with itself.");var w=h._lib&&Wn();m&&typeof m.then=="function"?u(h,function(k,E){m instanceof Q?m._then(k,E):m.then(k,E)}):(h._state=!0,h._value=m,tc(h)),w&&Hn()}},Js.bind(null,h))}catch(m){Js(h,m)}})(this,o)}var Gs={get:function(){var o=fe,a=Ci;function u(h,y){var m=this,w=!o.global&&(o!==fe||a!==Ci),k=w&&!ln(),E=new Q(function(P,O){Xs(m,new ec(rc(h,o,w,k),rc(y,o,w,k),P,O,o))});return this._consoleTask&&(E._consoleTask=this._consoleTask),E}return u.prototype=xr,u},set:function(o){S(this,"then",o&&o.prototype===xr?Gs:{get:function(){return o},set:Gs.set})}};function ec(o,a,u,h,y){this.onFulfilled=typeof o=="function"?o:null,this.onRejected=typeof a=="function"?a:null,this.resolve=u,this.reject=h,this.psd=y}function Js(o,a){var u,h;wi.push(a),o._state===null&&(u=o._lib&&Wn(),a=Ys(a),o._state=!1,o._value=a,h=o,En.some(function(y){return y._value===h._value})||En.push(h),tc(o),u)&&Hn()}function tc(o){var a=o._listeners;o._listeners=[];for(var u=0,h=a.length;u<h;++u)Xs(o,a[u]);var y=o._PSD;--y.ref||y.finalize(),On===0&&(++On,Er(function(){--On==0&&Qs()},[]))}function Xs(o,a){if(o._state===null)o._listeners.push(a);else{var u=o._state?a.onFulfilled:a.onRejected;if(u===null)return(o._state?a.resolve:a.reject)(o._value);++a.psd.ref,++On,Er(Od,[u,o,a])}}function Od(o,a,u){try{var h,y=a._value;!a._state&&wi.length&&(wi=[]),h=jt&&a._consoleTask?a._consoleTask.run(function(){return o(y)}):o(y),a._state||wi.indexOf(y)!==-1||(m=>{for(var w=En.length;w;)if(En[--w]._value===m._value)return En.splice(w,1)})(a),u.resolve(h)}catch(m){u.reject(m)}finally{--On==0&&Qs(),--u.psd.ref||u.psd.finalize()}}function Id(){In(an,function(){Wn()&&Hn()})}function Wn(){var o=zs;return bi=zs=!1,o}function Hn(){var o,a,u;do for(;0<Or.length;)for(o=Or,Or=[],u=o.length,a=0;a<u;++a){var h=o[a];h[0].apply(null,h[1])}while(0<Or.length);bi=zs=!0}function Qs(){for(var o=En,a=(En=[],o.forEach(function(h){h._PSD.onunhandled.call(null,h._value,h)}),_i.slice(0)),u=a.length;u;)a[--u]()}function ki(o){return new Q(xr,!1,o)}function Ne(o,a){var u=fe;return function(){var h=Wn(),y=fe;try{return un(u,!0),o.apply(this,arguments)}catch(m){a&&a(m)}finally{un(y,!1),h&&Hn()}}}v(Q.prototype,{then:Gs,_then:function(o,a){Xs(this,new ec(null,null,o,a,fe))},catch:function(o){var a,u;return arguments.length===1?this.then(null,o):(a=o,u=arguments[1],typeof a=="function"?this.then(null,function(h){return(h instanceof a?u:ki)(h)}):this.then(null,function(h){return(h&&h.name===a?u:ki)(h)}))},finally:function(o){return this.then(function(a){return Q.resolve(o()).then(function(){return a})},function(a){return Q.resolve(o()).then(function(){return ki(a)})})},timeout:function(o,a){var u=this;return o<1/0?new Q(function(h,y){var m=setTimeout(function(){return y(new J.Timeout(a))},o);u.then(h,y).finally(clearTimeout.bind(null,m))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&S(Q.prototype,Symbol.toStringTag,"Dexie.Promise"),an.env=nc(),v(Q,{all:function(){var o=Ce.apply(null,arguments).map(Ei);return new Q(function(a,u){o.length===0&&a([]);var h=o.length;o.forEach(function(y,m){return Q.resolve(y).then(function(w){o[m]=w,--h||a(o)},u)})})},resolve:function(o){return o instanceof Q?o:o&&typeof o.then=="function"?new Q(function(a,u){o.then(a,u)}):new Q(xr,!0,o)},reject:ki,race:function(){var o=Ce.apply(null,arguments).map(Ei);return new Q(function(a,u){o.map(function(h){return Q.resolve(h).then(a,u)})})},PSD:{get:function(){return fe},set:function(o){return fe=o}},totalEchoes:{get:function(){return Ci}},newPSD:cn,usePSD:In,scheduler:{get:function(){return Er},set:function(o){Er=o}},rejectionMapper:{get:function(){return Ys},set:function(o){Ys=o}},follow:function(o,a){return new Q(function(u,h){return cn(function(y,m){var w=fe;w.unhandleds=[],w.onunhandled=m,w.finalize=Pe(function(){var k,E=this;k=function(){E.unhandleds.length===0?y():m(E.unhandleds[0])},_i.push(function P(){k(),_i.splice(_i.indexOf(P),1)}),++On,Er(function(){--On==0&&Qs()},[])},w.finalize),o()},a,u,h)})}}),Cn&&(Cn.allSettled&&S(Q,"allSettled",function(){var o=Ce.apply(null,arguments).map(Ei);return new Q(function(a){o.length===0&&a([]);var u=o.length,h=new Array(u);o.forEach(function(y,m){return Q.resolve(y).then(function(w){return h[m]={status:"fulfilled",value:w}},function(w){return h[m]={status:"rejected",reason:w}}).then(function(){return--u||a(h)})})})}),Cn.any&&typeof AggregateError<"u"&&S(Q,"any",function(){var o=Ce.apply(null,arguments).map(Ei);return new Q(function(a,u){o.length===0&&u(new AggregateError([]));var h=o.length,y=new Array(h);o.forEach(function(m,w){return Q.resolve(m).then(function(k){return a(k)},function(k){y[w]=k,--h||u(new AggregateError(y))})})})}),Cn.withResolvers)&&(Q.withResolvers=Cn.withResolvers);var et={awaits:0,echoes:0,id:0},Ad=0,Si=[],xi=0,Ci=0,Dd=0;function cn(o,w,u,h){var y=fe,m=Object.create(y),w=(m.parent=y,m.ref=0,m.global=!1,m.id=++Dd,an.env,m.env=Hs?{Promise:Q,PromiseProp:{value:Q,configurable:!0,writable:!0},all:Q.all,race:Q.race,allSettled:Q.allSettled,any:Q.any,resolve:Q.resolve,reject:Q.reject}:{},w&&f(m,w),++y.ref,m.finalize=function(){--this.parent.ref||this.parent.finalize()},In(m,o,u,h));return m.ref===0&&m.finalize(),w}function zn(){return et.id||(et.id=++Ad),++et.awaits,et.echoes+=Za,et.id}function ln(){return!!et.awaits&&(--et.awaits==0&&(et.id=0),et.echoes=et.awaits*Za,!0)}function Ei(o){return et.echoes&&o&&o.constructor===Cn?(zn(),o.then(function(a){return ln(),a},function(a){return ln(),Ve(a)})):o}function Td(){var o=Si[Si.length-1];Si.pop(),un(o,!1)}function un(o,a){var u,h,y=fe;(a?!et.echoes||xi++&&o===fe:!xi||--xi&&o===fe)||queueMicrotask(a?(function(m){++Ci,et.echoes&&--et.echoes!=0||(et.echoes=et.awaits=et.id=0),Si.push(fe),un(m,!0)}).bind(null,o):Td),o!==fe&&(fe=o,y===an&&(an.env=nc()),Hs)&&(u=an.env.Promise,h=o.env,y.global||o.global)&&(Object.defineProperty(s,"Promise",h.PromiseProp),u.all=h.all,u.race=h.race,u.resolve=h.resolve,u.reject=h.reject,h.allSettled&&(u.allSettled=h.allSettled),h.any)&&(u.any=h.any)}function nc(){var o=s.Promise;return Hs?{Promise:o,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:o.all,race:o.race,allSettled:o.allSettled,any:o.any,resolve:o.resolve,reject:o.reject}:{}}function In(o,a,u,h,y){var m=fe;try{return un(o,!0),a(u,h,y)}finally{un(m,!1)}}function rc(o,a,u,h){return typeof o!="function"?o:function(){var y=fe;u&&zn(),un(a,!0);try{return o.apply(this,arguments)}finally{un(y,!1),h&&queueMicrotask(ln)}}}function Zs(o){Promise===Cn&&et.echoes===0?xi===0?o():enqueueNativeMicroTask(o):setTimeout(o,0)}(""+Qn).indexOf("[native code]")===-1&&(zn=ln=pe);var Ve=Q.reject,An="ï¿¿",Wt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ic="String expected.",Yn=[],Oi="__dbnames",eo="readonly",to="readwrite";function Dn(o,a){return o?a?function(){return o.apply(this,arguments)&&a.apply(this,arguments)}:o:a}var sc={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ii(o){return typeof o!="string"||/\./.test(o)?function(a){return a}:function(a){return a[o]===void 0&&o in a&&delete(a=ge(a))[o],a}}function oc(){throw J.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function Se(o,a){try{var u=ac(o),h=ac(a);if(u!==h)return u==="Array"?1:h==="Array"?-1:u==="binary"?1:h==="binary"?-1:u==="string"?1:h==="string"?-1:u==="Date"?1:h!=="Date"?NaN:-1;switch(u){case"number":case"Date":case"string":return a<o?1:o<a?-1:0;case"binary":for(var y=cc(o),m=cc(a),w=y.length,k=m.length,E=w<k?w:k,P=0;P<E;++P)if(y[P]!==m[P])return y[P]<m[P]?-1:1;return w===k?0:w<k?-1:1;case"Array":for(var O=o,x=a,D=O.length,T=x.length,I=D<T?D:T,C=0;C<I;++C){var j=Se(O[C],x[C]);if(j!==0)return j}return D===T?0:D<T?-1:1}}catch{}return NaN}function ac(o){var a=typeof o;return a=="object"&&(ArrayBuffer.isView(o)||(a=me(o))==="ArrayBuffer")?"binary":a}function cc(o){return o instanceof Uint8Array?o:ArrayBuffer.isView(o)?new Uint8Array(o.buffer,o.byteOffset,o.byteLength):new Uint8Array(o)}function Ai(o,a,u){var h=o.schema.yProps;return h?(a&&0<u.numFailures&&(a=a.filter(function(y,m){return!u.failures[m]})),Promise.all(h.map(function(y){return y=y.updatesTable,a?o.db.table(y).where("k").anyOf(a).delete():o.db.table(y).clear()})).then(function(){return u})):u}lc.prototype.execute=function(o){var a=this["@@propmod"];if(a.add!==void 0){var u=a.add;if(l(u))return i(i([],l(o)?o:[],!0),u).sort();if(typeof u=="number")return(Number(o)||0)+u;if(typeof u=="bigint")try{return BigInt(o)+u}catch{return BigInt(0)+u}throw new TypeError("Invalid term ".concat(u))}if(a.remove!==void 0){var h=a.remove;if(l(h))return l(o)?o.filter(function(y){return!h.includes(y)}).sort():[];if(typeof h=="number")return Number(o)-h;if(typeof h=="bigint")try{return BigInt(o)-h}catch{return BigInt(0)-h}throw new TypeError("Invalid subtrahend ".concat(h))}return u=(u=a.replacePrefix)==null?void 0:u[0],u&&typeof o=="string"&&o.startsWith(u)?a.replacePrefix[1]+o.substring(u.length):o};var Ir=lc;function lc(o){this["@@propmod"]=o}function uc(o,a){for(var u=c(a),h=u.length,y=!1,m=0;m<h;++m){var w=u[m],k=a[w],E=te(o,w);k instanceof Ir?(G(o,w,k.execute(E)),y=!0):E!==k&&(G(o,w,k),y=!0)}return y}Le.prototype._trans=function(o,a,u){var h=this._tx||fe.trans,y=this.name,m=jt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(o==="readonly"?"read":"write"," ").concat(this.name));function w(P,O,x){if(x.schema[y])return a(x.idbtrans,x);throw new J.NotFound("Table "+y+" not part of transaction")}var k=Wn();try{var E=h&&h.db._novip===this.db._novip?h===fe.trans?h._promise(o,w,u):cn(function(){return h._promise(o,w,u)},{trans:h,transless:fe.transless||fe}):(function P(O,x,D,T){if(O.idbdb&&(O._state.openComplete||fe.letThrough||O._vip)){var I=O._createTransaction(x,D,O._dbSchema);try{I.create(),O._state.PR1398_maxLoop=3}catch(C){return C.name===qe.InvalidState&&O.isOpen()&&0<--O._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),O.close({disableAutoOpen:!1}),O.open().then(function(){return P(O,x,D,T)})):Ve(C)}return I._promise(x,function(C,j){return cn(function(){return fe.trans=I,T(C,j,I)})}).then(function(C){if(x==="readwrite")try{I.idbtrans.commit()}catch{}return x==="readonly"?C:I._completion.then(function(){return C})})}if(O._state.openComplete)return Ve(new J.DatabaseClosed(O._state.dbOpenError));if(!O._state.isBeingOpened){if(!O._state.autoOpen)return Ve(new J.DatabaseClosed);O.open().catch(pe)}return O._state.dbReadyPromise.then(function(){return P(O,x,D,T)})})(this.db,o,[this.name],w);return m&&(E._consoleTask=m,E=E.catch(function(P){return console.trace(P),Ve(P)})),E}finally{k&&Hn()}},Le.prototype.get=function(o,a){var u=this;return o&&o.constructor===Object?this.where(o).first(a):o==null?Ve(new J.Type("Invalid argument to Table.get()")):this._trans("readonly",function(h){return u.core.get({trans:h,key:o}).then(function(y){return u.hook.reading.fire(y)})}).then(a)},Le.prototype.where=function(o){if(typeof o=="string")return new this.db.WhereClause(this,o);if(l(o))return new this.db.WhereClause(this,"[".concat(o.join("+"),"]"));var a=c(o);if(a.length===1)return this.where(a[0]).equals(o[a[0]]);var u=this.schema.indexes.concat(this.schema.primKey).filter(function(k){if(k.compound&&a.every(function(P){return 0<=k.keyPath.indexOf(P)})){for(var E=0;E<a.length;++E)if(a.indexOf(k.keyPath[E])===-1)return!1;return!0}return!1}).sort(function(k,E){return k.keyPath.length-E.keyPath.length})[0];if(u&&this.db._maxKey!==An)return w=u.keyPath.slice(0,a.length),this.where(w).equals(w.map(function(k){return o[k]}));!u&&jt&&console.warn("The query ".concat(JSON.stringify(o)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(a.join("+"),"]"));var h=this.schema.idxByName;function y(k,E){return Se(k,E)===0}var w=a.reduce(function(O,E){var P=O[0],O=O[1],x=h[E],D=o[E];return[P||x,P||!x?Dn(O,x&&x.multi?function(T){return T=te(T,E),l(T)&&T.some(function(I){return y(D,I)})}:function(T){return y(D,te(T,E))}):O]},[null,null]),m=w[0],w=w[1];return m?this.where(m.name).equals(o[m.keyPath]).filter(w):u?this.filter(w):this.where(a).equals("")},Le.prototype.filter=function(o){return this.toCollection().and(o)},Le.prototype.count=function(o){return this.toCollection().count(o)},Le.prototype.offset=function(o){return this.toCollection().offset(o)},Le.prototype.limit=function(o){return this.toCollection().limit(o)},Le.prototype.each=function(o){return this.toCollection().each(o)},Le.prototype.toArray=function(o){return this.toCollection().toArray(o)},Le.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Le.prototype.orderBy=function(o){return new this.db.Collection(new this.db.WhereClause(this,l(o)?"[".concat(o.join("+"),"]"):o))},Le.prototype.reverse=function(){return this.toCollection().reverse()},Le.prototype.mapToClass=function(o){for(var a=this.db,u=this.name,h=((this.schema.mappedClass=o).prototype instanceof oc&&(o=(w=>{var k=O,E=w;if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");function P(){this.constructor=k}function O(){return w!==null&&w.apply(this,arguments)||this}return n(k,E),k.prototype=E===null?Object.create(E):(P.prototype=E.prototype,new P),Object.defineProperty(O.prototype,"db",{get:function(){return a},enumerable:!1,configurable:!0}),O.prototype.table=function(){return u},O})(o)),new Set),y=o.prototype;y;y=d(y))Object.getOwnPropertyNames(y).forEach(function(w){return h.add(w)});function m(w){if(!w)return w;var k,E=Object.create(o.prototype);for(k in w)if(!h.has(k))try{E[k]=w[k]}catch{}return E}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=m,this.hook("reading",m),o},Le.prototype.defineClass=function(){return this.mapToClass(function(o){f(this,o)})},Le.prototype.add=function(o,a){var u=this,h=this.schema.primKey,y=h.auto,m=h.keyPath,w=o;return m&&y&&(w=Ii(m)(o)),this._trans("readwrite",function(k){return u.core.mutate({trans:k,type:"add",keys:a!=null?[a]:null,values:[w]})}).then(function(k){return k.numFailures?Q.reject(k.failures[0]):k.lastResult}).then(function(k){if(m)try{G(o,m,k)}catch{}return k})},Le.prototype.upsert=function(o,a){var u=this,h=this.schema.primKey.keyPath;return this._trans("readwrite",function(y){return u.core.get({trans:y,key:o}).then(function(m){var w=m??{};return uc(w,a),h&&G(w,h,o),u.core.mutate({trans:y,type:"put",values:[w],keys:[o],upsert:!0,updates:{keys:[o],changeSpecs:[a]}}).then(function(k){return k.numFailures?Q.reject(k.failures[0]):!!m})})})},Le.prototype.update=function(o,a){return typeof o!="object"||l(o)?this.where(":id").equals(o).modify(a):(o=te(o,this.schema.primKey.keyPath))===void 0?Ve(new J.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(o).modify(a)},Le.prototype.put=function(o,a){var u=this,h=this.schema.primKey,y=h.auto,m=h.keyPath,w=o;return m&&y&&(w=Ii(m)(o)),this._trans("readwrite",function(k){return u.core.mutate({trans:k,type:"put",values:[w],keys:a!=null?[a]:null})}).then(function(k){return k.numFailures?Q.reject(k.failures[0]):k.lastResult}).then(function(k){if(m)try{G(o,m,k)}catch{}return k})},Le.prototype.delete=function(o){var a=this;return this._trans("readwrite",function(u){return a.core.mutate({trans:u,type:"delete",keys:[o]}).then(function(h){return Ai(a,[o],h)}).then(function(h){return h.numFailures?Q.reject(h.failures[0]):void 0})})},Le.prototype.clear=function(){var o=this;return this._trans("readwrite",function(a){return o.core.mutate({trans:a,type:"deleteRange",range:sc}).then(function(u){return Ai(o,null,u)})}).then(function(a){return a.numFailures?Q.reject(a.failures[0]):void 0})},Le.prototype.bulkGet=function(o){var a=this;return this._trans("readonly",function(u){return a.core.getMany({keys:o,trans:u}).then(function(h){return h.map(function(y){return a.hook.reading.fire(y)})})})},Le.prototype.bulkAdd=function(o,a,u){var h=this,y=Array.isArray(a)?a:void 0,m=(u=u||(y?void 0:a))?u.allKeys:void 0;return this._trans("readwrite",function(w){var k=h.schema.primKey,P=k.auto,k=k.keyPath;if(k&&y)throw new J.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(y&&y.length!==o.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var E=o.length,P=k&&P?o.map(Ii(k)):o;return h.core.mutate({trans:w,type:"add",keys:y,values:P,wantResults:m}).then(function(O){var x=O.numFailures,D=O.failures;if(x===0)return m?O.results:O.lastResult;throw new Ge("".concat(h.name,".bulkAdd(): ").concat(x," of ").concat(E," operations failed"),D)})})},Le.prototype.bulkPut=function(o,a,u){var h=this,y=Array.isArray(a)?a:void 0,m=(u=u||(y?void 0:a))?u.allKeys:void 0;return this._trans("readwrite",function(w){var k=h.schema.primKey,P=k.auto,k=k.keyPath;if(k&&y)throw new J.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(y&&y.length!==o.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var E=o.length,P=k&&P?o.map(Ii(k)):o;return h.core.mutate({trans:w,type:"put",keys:y,values:P,wantResults:m}).then(function(O){var x=O.numFailures,D=O.failures;if(x===0)return m?O.results:O.lastResult;throw new Ge("".concat(h.name,".bulkPut(): ").concat(x," of ").concat(E," operations failed"),D)})})},Le.prototype.bulkUpdate=function(o){var a=this,u=this.core,h=o.map(function(w){return w.key}),y=o.map(function(w){return w.changes}),m=[];return this._trans("readwrite",function(w){return u.getMany({trans:w,keys:h,cache:"clone"}).then(function(k){var E=[],P=[],O=(o.forEach(function(x,D){var T=x.key,I=x.changes,C=k[D];if(C){for(var j=0,M=Object.keys(I);j<M.length;j++){var R=M[j],B=I[R];if(R===a.schema.primKey.keyPath){if(Se(B,T)!==0)throw new J.Constraint("Cannot update primary key in bulkUpdate()")}else G(C,R,B)}m.push(D),E.push(T),P.push(C)}}),E.length);return u.mutate({trans:w,type:"put",keys:E,values:P,updates:{keys:h,changeSpecs:y}}).then(function(x){var D=x.numFailures,T=x.failures;if(D===0)return O;for(var I=0,C=Object.keys(T);I<C.length;I++){var j,M=C[I],R=m[Number(M)];R!=null&&(j=T[M],delete T[M],T[R]=j)}throw new Ge("".concat(a.name,".bulkUpdate(): ").concat(D," of ").concat(O," operations failed"),T)})})})},Le.prototype.bulkDelete=function(o){var a=this,u=o.length;return this._trans("readwrite",function(h){return a.core.mutate({trans:h,type:"delete",keys:o}).then(function(y){return Ai(a,o,y)})}).then(function(h){var y=h.numFailures,m=h.failures;if(y===0)return h.lastResult;throw new Ge("".concat(a.name,".bulkDelete(): ").concat(y," of ").concat(u," operations failed"),m)})};var fc=Le;function Le(){}function Ar(o){function a(w,k){if(k){for(var E=arguments.length,P=new Array(E-1);--E;)P[E-1]=arguments[E];return u[w].subscribe.apply(null,P),o}if(typeof w=="string")return u[w]}var u={};a.addEventType=m;for(var h=1,y=arguments.length;h<y;++h)m(arguments[h]);return a;function m(w,k,E){var P,O;if(typeof w!="object")return k=k||Ed,O={subscribers:[],fire:E=E||pe,subscribe:function(x){O.subscribers.indexOf(x)===-1&&(O.subscribers.push(x),O.fire=k(O.fire,x))},unsubscribe:function(x){O.subscribers=O.subscribers.filter(function(D){return D!==x}),O.fire=O.subscribers.reduce(k,E)}},u[w]=a[w]=O;c(P=w).forEach(function(x){var D=P[x];if(l(D))m(x,P[x][0],P[x][1]);else{if(D!=="asap")throw new J.InvalidArgument("Invalid event config");var T=m(x,ke,function(){for(var I=arguments.length,C=new Array(I);I--;)C[I]=arguments[I];T.subscribers.forEach(function(j){ae(function(){j.apply(null,C)})})})}})}}function Dr(o,a){return A(a).from({prototype:o}),a}function Gn(o,a){return!(o.filter||o.algorithm||o.or)&&(a?o.justLimit:!o.replayFilter)}function no(o,a){o.filter=Dn(o.filter,a)}function ro(o,a,u){var h=o.replayFilter;o.replayFilter=h?function(){return Dn(h(),a())}:a,o.justLimit=u&&!h}function Di(o,a){if(o.isPrimKey)return a.primaryKey;var u=a.getIndexByKeyPath(o.index);if(u)return u;throw new J.Schema("KeyPath "+o.index+" on object store "+a.name+" is not indexed")}function dc(o,a,u){var h=Di(o,a.schema);return a.openCursor({trans:u,values:!o.keysOnly,reverse:o.dir==="prev",unique:!!o.unique,query:{index:h,range:o.range}})}function Ti(o,a,u,h){var y,m,w=o.replayFilter?Dn(o.filter,o.replayFilter()):o.filter;return o.or?(y={},m=function(k,E,P){var O,x;w&&!w(E,P,function(D){return E.stop(D)},function(D){return E.fail(D)})||((x=""+(O=E.primaryKey))=="[object ArrayBuffer]"&&(x=""+new Uint8Array(O)),p(y,x))||(y[x]=!0,a(k,E,P))},Promise.all([o.or._iterate(m,u),hc(dc(o,h,u),o.algorithm,m,!o.keysOnly&&o.valueMapper)])):hc(dc(o,h,u),Dn(o.algorithm,w),a,!o.keysOnly&&o.valueMapper)}function hc(o,a,u,h){var y=Ne(h?function(m,w,k){return u(h(m),w,k)}:u);return o.then(function(m){if(m)return m.start(function(){var w=function(){return m.continue()};a&&!a(m,function(k){return w=k},function(k){m.stop(k),w=pe},function(k){m.fail(k),w=pe})||y(m.value,m,function(k){return w=k}),w()})})}De.prototype._read=function(o,a){var u=this._ctx;return u.error?u.table._trans(null,Ve.bind(null,u.error)):u.table._trans("readonly",o).then(a)},De.prototype._write=function(o){var a=this._ctx;return a.error?a.table._trans(null,Ve.bind(null,a.error)):a.table._trans("readwrite",o,"locked")},De.prototype._addAlgorithm=function(o){var a=this._ctx;a.algorithm=Dn(a.algorithm,o)},De.prototype._iterate=function(o,a){return Ti(this._ctx,o,a,this._ctx.table.core)},De.prototype.clone=function(o){var a=Object.create(this.constructor.prototype),u=Object.create(this._ctx);return o&&f(u,o),a._ctx=u,a},De.prototype.raw=function(){return this._ctx.valueMapper=null,this},De.prototype.each=function(o){var a=this._ctx;return this._read(function(u){return Ti(a,o,u,a.table.core)})},De.prototype.count=function(o){var a=this;return this._read(function(u){var h,y=a._ctx,m=y.table.core;return Gn(y,!0)?m.count({trans:u,query:{index:Di(y,m.schema),range:y.range}}).then(function(w){return Math.min(w,y.limit)}):(h=0,Ti(y,function(){return++h,!1},u,m).then(function(){return h}))}).then(o)},De.prototype.sortBy=function(o,a){var u=o.split(".").reverse(),h=u[0],y=u.length-1;function m(E,P){return P?m(E[u[P]],P-1):E[h]}var w=this._ctx.dir==="next"?1:-1;function k(E,P){return Se(m(E,y),m(P,y))*w}return this.toArray(function(E){return E.sort(k)}).then(a)},De.prototype.toArray=function(o){var a=this;return this._read(function(u){var h,y,m,w=a._ctx;return w.dir==="next"&&Gn(w,!0)&&0<w.limit?(h=w.valueMapper,y=Di(w,w.table.core.schema),w.table.core.query({trans:u,limit:w.limit,values:!0,query:{index:y,range:w.range}}).then(function(k){return k=k.result,h?k.map(h):k})):(m=[],Ti(w,function(k){return m.push(k)},u,w.table.core).then(function(){return m}))},o)},De.prototype.offset=function(o){var a=this._ctx;return o<=0||(a.offset+=o,Gn(a)?ro(a,function(){var u=o;return function(h,y){return u===0||(u===1?--u:y(function(){h.advance(u),u=0}),!1)}}):ro(a,function(){var u=o;return function(){return--u<0}})),this},De.prototype.limit=function(o){return this._ctx.limit=Math.min(this._ctx.limit,o),ro(this._ctx,function(){var a=o;return function(u,h,y){return--a<=0&&h(y),0<=a}},!0),this},De.prototype.until=function(o,a){return no(this._ctx,function(u,h,y){return!o(u.value)||(h(y),a)}),this},De.prototype.first=function(o){return this.limit(1).toArray(function(a){return a[0]}).then(o)},De.prototype.last=function(o){return this.reverse().first(o)},De.prototype.filter=function(o){var a;return no(this._ctx,function(u){return o(u.value)}),(a=this._ctx).isMatch=Dn(a.isMatch,o),this},De.prototype.and=function(o){return this.filter(o)},De.prototype.or=function(o){return new this.db.WhereClause(this._ctx.table,o,this)},De.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},De.prototype.desc=function(){return this.reverse()},De.prototype.eachKey=function(o){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(u,h){o(h.key,h)})},De.prototype.eachUniqueKey=function(o){return this._ctx.unique="unique",this.eachKey(o)},De.prototype.eachPrimaryKey=function(o){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(u,h){o(h.primaryKey,h)})},De.prototype.keys=function(o){var a=this._ctx,u=(a.keysOnly=!a.isMatch,[]);return this.each(function(h,y){u.push(y.key)}).then(function(){return u}).then(o)},De.prototype.primaryKeys=function(o){var a=this._ctx;if(a.dir==="next"&&Gn(a,!0)&&0<a.limit)return this._read(function(h){var y=Di(a,a.table.core.schema);return a.table.core.query({trans:h,values:!1,limit:a.limit,query:{index:y,range:a.range}})}).then(function(h){return h.result}).then(o);a.keysOnly=!a.isMatch;var u=[];return this.each(function(h,y){u.push(y.primaryKey)}).then(function(){return u}).then(o)},De.prototype.uniqueKeys=function(o){return this._ctx.unique="unique",this.keys(o)},De.prototype.firstKey=function(o){return this.limit(1).keys(function(a){return a[0]}).then(o)},De.prototype.lastKey=function(o){return this.reverse().firstKey(o)},De.prototype.distinct=function(){var o,a=this._ctx,a=a.index&&a.table.schema.idxByName[a.index];return a&&a.multi&&(o={},no(this._ctx,function(h){var h=h.primaryKey.toString(),y=p(o,h);return o[h]=!0,!y})),this},De.prototype.modify=function(o){var a=this,u=this._ctx;return this._write(function(h){function y(C,j){var M=j.failures;D+=C-j.numFailures;for(var R=0,B=c(M);R<B.length;R++){var F=B[R];x.push(M[F])}}var m=typeof o=="function"?o:function(C){return uc(C,o)},w=u.table.core,O=w.schema.primaryKey,k=O.outbound,E=O.extractKey,P=200,O=a.db._options.modifyChunkSize,x=(O&&(P=typeof O=="object"?O[w.name]||O["*"]||200:O),[]),D=0,T=[],I=o===pc;return a.clone().primaryKeys().then(function(C){function j(R){var B=Math.min(P,C.length-R),F=C.slice(R,R+B);return(I?Promise.resolve([]):w.getMany({trans:h,keys:F,cache:"immutable"})).then(function(H){var z=[],$=[],re=k?[]:null,ee=I?F:[];if(!I)for(var q=0;q<B;++q){var oe=H[q],Ee={value:ge(oe),primKey:C[R+q]};m.call(Ee,Ee.value,Ee)!==!1&&(Ee.value==null?ee.push(C[R+q]):k||Se(E(oe),E(Ee.value))===0?($.push(Ee.value),k&&re.push(C[R+q])):(ee.push(C[R+q]),z.push(Ee.value)))}return Promise.resolve(0<z.length&&w.mutate({trans:h,type:"add",values:z}).then(function(Te){for(var de in Te.failures)ee.splice(parseInt(de),1);y(z.length,Te)})).then(function(){return(0<$.length||M&&typeof o=="object")&&w.mutate({trans:h,type:"put",keys:re,values:$,criteria:M,changeSpec:typeof o!="function"&&o,isAdditionalChunk:0<R}).then(function(Te){return y($.length,Te)})}).then(function(){return(0<ee.length||M&&I)&&w.mutate({trans:h,type:"delete",keys:ee,criteria:M,isAdditionalChunk:0<R}).then(function(Te){return Ai(u.table,ee,Te)}).then(function(Te){return y(ee.length,Te)})}).then(function(){return C.length>R+B&&j(R+P)})})}var M=Gn(u)&&u.limit===1/0&&(typeof o!="function"||I)&&{index:u.index,range:u.range};return j(0).then(function(){if(0<x.length)throw new ze("Error modifying one or more objects",x,D,T);return C.length})})})},De.prototype.delete=function(){var o=this._ctx,a=o.range;return!Gn(o)||o.table.schema.yProps||!o.isPrimKey&&a.type!==3?this.modify(pc):this._write(function(u){var h=o.table.core.schema.primaryKey,y=a;return o.table.core.count({trans:u,query:{index:h,range:y}}).then(function(m){return o.table.core.mutate({trans:u,type:"deleteRange",range:y}).then(function(E){var k=E.failures,E=E.numFailures;if(E)throw new ze("Could not delete some values",Object.keys(k).map(function(P){return k[P]}),m-E);return m-E})})})};var Rd=De;function De(){}var pc=function(o,a){return a.value=null};function Pd(o,a){return o<a?-1:o===a?0:1}function jd(o,a){return a<o?-1:o===a?0:1}function vt(o,a,u){return o=o instanceof gc?new o.Collection(o):o,o._ctx.error=new(u||TypeError)(a),o}function Jn(o){return new o.Collection(o,function(){return yc("")}).limit(0)}function Ri(T,a,u,h){var y,m,w,k,E,P,O,x=u.length;if(!u.every(function(C){return typeof C=="string"}))return vt(T,ic);function D(C){y=C==="next"?function(M){return M.toUpperCase()}:function(M){return M.toLowerCase()},m=C==="next"?function(M){return M.toLowerCase()}:function(M){return M.toUpperCase()},w=C==="next"?Pd:jd;var j=u.map(function(M){return{lower:m(M),upper:y(M)}}).sort(function(M,R){return w(M.lower,R.lower)});k=j.map(function(M){return M.upper}),E=j.map(function(M){return M.lower}),O=(P=C)==="next"?"":h}D("next");var T=new T.Collection(T,function(){return fn(k[0],E[x-1]+h)}),I=(T._ondirectionchange=function(C){D(C)},0);return T._addAlgorithm(function(C,j,M){var R=C.key;if(typeof R=="string"){var B=m(R);if(a(B,E,I))return!0;for(var F=null,H=I;H<x;++H){var z=(($,re,ee,q,oe,Ee)=>{for(var Te=Math.min($.length,q.length),de=-1,we=0;we<Te;++we){var Be=re[we];if(Be!==q[we])return oe($[we],ee[we])<0?$.substr(0,we)+ee[we]+ee.substr(we+1):oe($[we],q[we])<0?$.substr(0,we)+q[we]+ee.substr(we+1):0<=de?$.substr(0,de)+re[de]+ee.substr(de+1):null;oe($[we],Be)<0&&(de=we)}return Te<q.length&&Ee==="next"?$+ee.substr($.length):Te<$.length&&Ee==="prev"?$.substr(0,ee.length):de<0?null:$.substr(0,de)+q[de]+ee.substr(de+1)})(R,B,k[H],E[H],w,P);z===null&&F===null?I=H+1:(F===null||0<w(F,z))&&(F=z)}j(F!==null?function(){C.continue(F+O)}:M)}return!1}),T}function fn(o,a,u,h){return{type:2,lower:o,upper:a,lowerOpen:u,upperOpen:h}}function yc(o){return{type:1,lower:o,upper:o}}Object.defineProperty(tt.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),tt.prototype.between=function(o,a,u,h){u=u!==!1,h=h===!0;try{return 0<this._cmp(o,a)||this._cmp(o,a)===0&&(u||h)&&(!u||!h)?Jn(this):new this.Collection(this,function(){return fn(o,a,!u,!h)})}catch{return vt(this,Wt)}},tt.prototype.equals=function(o){return o==null?vt(this,Wt):new this.Collection(this,function(){return yc(o)})},tt.prototype.above=function(o){return o==null?vt(this,Wt):new this.Collection(this,function(){return fn(o,void 0,!0)})},tt.prototype.aboveOrEqual=function(o){return o==null?vt(this,Wt):new this.Collection(this,function(){return fn(o,void 0,!1)})},tt.prototype.below=function(o){return o==null?vt(this,Wt):new this.Collection(this,function(){return fn(void 0,o,!1,!0)})},tt.prototype.belowOrEqual=function(o){return o==null?vt(this,Wt):new this.Collection(this,function(){return fn(void 0,o)})},tt.prototype.startsWith=function(o){return typeof o!="string"?vt(this,ic):this.between(o,o+An,!0,!0)},tt.prototype.startsWithIgnoreCase=function(o){return o===""?this.startsWith(o):Ri(this,function(a,u){return a.indexOf(u[0])===0},[o],An)},tt.prototype.equalsIgnoreCase=function(o){return Ri(this,function(a,u){return a===u[0]},[o],"")},tt.prototype.anyOfIgnoreCase=function(){var o=Ce.apply(ie,arguments);return o.length===0?Jn(this):Ri(this,function(a,u){return u.indexOf(a)!==-1},o,"")},tt.prototype.startsWithAnyOfIgnoreCase=function(){var o=Ce.apply(ie,arguments);return o.length===0?Jn(this):Ri(this,function(a,u){return u.some(function(h){return a.indexOf(h)===0})},o,An)},tt.prototype.anyOf=function(){var o,a,u=this,h=Ce.apply(ie,arguments),y=this._cmp;try{h.sort(y)}catch{return vt(this,Wt)}return h.length===0?Jn(this):((o=new this.Collection(this,function(){return fn(h[0],h[h.length-1])}))._ondirectionchange=function(m){y=m==="next"?u._ascending:u._descending,h.sort(y)},a=0,o._addAlgorithm(function(m,w,k){for(var E=m.key;0<y(E,h[a]);)if(++a===h.length)return w(k),!1;return y(E,h[a])===0||(w(function(){m.continue(h[a])}),!1)}),o)},tt.prototype.notEqual=function(o){return this.inAnyRange([[-1/0,o],[o,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},tt.prototype.noneOf=function(){var o=Ce.apply(ie,arguments);if(o.length===0)return new this.Collection(this);try{o.sort(this._ascending)}catch{return vt(this,Wt)}var a=o.reduce(function(u,h){return u?u.concat([[u[u.length-1][1],h]]):[[-1/0,h]]},null);return a.push([o[o.length-1],this.db._maxKey]),this.inAnyRange(a,{includeLowers:!1,includeUppers:!1})},tt.prototype.inAnyRange=function(o,M){var u=this,h=this._cmp,y=this._ascending,m=this._descending,w=this._min,k=this._max;if(o.length===0)return Jn(this);if(!o.every(function(R){return R[0]!==void 0&&R[1]!==void 0&&y(R[0],R[1])<=0}))return vt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",J.InvalidArgument);var E=!M||M.includeLowers!==!1,P=M&&M.includeUppers===!0,O,x=y;function D(R,B){return x(R[0],B[0])}try{(O=o.reduce(function(R,B){for(var F=0,H=R.length;F<H;++F){var z=R[F];if(h(B[0],z[1])<0&&0<h(B[1],z[0])){z[0]=w(z[0],B[0]),z[1]=k(z[1],B[1]);break}}return F===H&&R.push(B),R},[])).sort(D)}catch{return vt(this,Wt)}var T=0,I=P?function(R){return 0<y(R,O[T][1])}:function(R){return 0<=y(R,O[T][1])},C=E?function(R){return 0<m(R,O[T][0])}:function(R){return 0<=m(R,O[T][0])},j=I,M=new this.Collection(this,function(){return fn(O[0][0],O[O.length-1][1],!E,!P)});return M._ondirectionchange=function(R){x=R==="next"?(j=I,y):(j=C,m),O.sort(D)},M._addAlgorithm(function(R,B,F){for(var H,z=R.key;j(z);)if(++T===O.length)return B(F),!1;return!I(H=z)&&!C(H)||(u._cmp(z,O[T][1])===0||u._cmp(z,O[T][0])===0||B(function(){x===y?R.continue(O[T][0]):R.continue(O[T][1])}),!1)}),M},tt.prototype.startsWithAnyOf=function(){var o=Ce.apply(ie,arguments);return o.every(function(a){return typeof a=="string"})?o.length===0?Jn(this):this.inAnyRange(o.map(function(a){return[a,a+An]})):vt(this,"startsWithAnyOf() only works with strings")};var gc=tt;function tt(){}function Ut(o){return Ne(function(a){return Tr(a),o(a.target.error),!1})}function Tr(o){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault()}var Rr="storagemutated",io="x-storagemutated-1",dn=Ar(null,Rr),Ud=(Lt.prototype._lock=function(){return L(!fe.global),++this._reculock,this._reculock!==1||fe.global||(fe.lockOwnerFor=this),this},Lt.prototype._unlock=function(){if(L(!fe.global),--this._reculock==0)for(fe.global||(fe.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var o=this._blockedFuncs.shift();try{In(o[1],o[0])}catch{}}return this},Lt.prototype._locked=function(){return this._reculock&&fe.lockOwnerFor!==this},Lt.prototype.create=function(o){var a=this;if(this.mode){var u=this.db.idbdb,h=this.db._state.dbOpenError;if(L(!this.idbtrans),!o&&!u)switch(h&&h.name){case"DatabaseClosedError":throw new J.DatabaseClosed(h);case"MissingAPIError":throw new J.MissingAPI(h.message,h);default:throw new J.OpenFailed(h)}if(!this.active)throw new J.TransactionInactive;L(this._completion._state===null),(o=this.idbtrans=o||(this.db.core||u).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Ne(function(y){Tr(y),a._reject(o.error)}),o.onabort=Ne(function(y){Tr(y),a.active&&a._reject(new J.Abort(o.error)),a.active=!1,a.on("abort").fire(y)}),o.oncomplete=Ne(function(){a.active=!1,a._resolve(),"mutatedParts"in o&&dn.storagemutated.fire(o.mutatedParts)})}return this},Lt.prototype._promise=function(o,a,u){var h,y=this;return o==="readwrite"&&this.mode!=="readwrite"?Ve(new J.ReadOnly("Transaction is readonly")):this.active?this._locked()?new Q(function(m,w){y._blockedFuncs.push([function(){y._promise(o,a,u).then(m,w)},fe])}):u?cn(function(){var m=new Q(function(w,k){y._lock();var E=a(w,k,y);E&&E.then&&E.then(w,k)});return m.finally(function(){return y._unlock()}),m._lib=!0,m}):((h=new Q(function(m,w){var k=a(m,w,y);k&&k.then&&k.then(m,w)}))._lib=!0,h):Ve(new J.TransactionInactive)},Lt.prototype._root=function(){return this.parent?this.parent._root():this},Lt.prototype.waitFor=function(o){var a,u=this._root(),h=Q.resolve(o),y=(u._waitingFor?u._waitingFor=u._waitingFor.then(function(){return h}):(u._waitingFor=h,u._waitingQueue=[],a=u.idbtrans.objectStore(u.storeNames[0]),(function m(){for(++u._spinCount;u._waitingQueue.length;)u._waitingQueue.shift()();u._waitingFor&&(a.get(-1/0).onsuccess=m)})()),u._waitingFor);return new Q(function(m,w){h.then(function(k){return u._waitingQueue.push(Ne(m.bind(null,k)))},function(k){return u._waitingQueue.push(Ne(w.bind(null,k)))}).finally(function(){u._waitingFor===y&&(u._waitingFor=null)})})},Lt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))},Lt.prototype.table=function(o){var a=this._memoizedTables||(this._memoizedTables={});if(p(a,o))return a[o];var u=this.schema[o];if(u)return(u=new this.db.Table(o,u,this)).core=this.db.core.table(o),a[o]=u;throw new J.NotFound("Table "+o+" not part of transaction")},Lt);function Lt(){}function so(o,a,u,h,y,m,w,k){return{name:o,keyPath:a,unique:u,multi:h,auto:y,compound:m,src:(u&&!w?"&":"")+(h?"*":"")+(y?"++":"")+mc(a),type:k}}function mc(o){return typeof o=="string"?o:o?"["+[].join.call(o,"+")+"]":""}function oo(o,a,u){return{name:o,primKey:a,indexes:u,mappedClass:null,idxByName:(h=function(y){return[y.name,y]},u.reduce(function(y,m,w){return m=h(m,w),m&&(y[m[0]]=m[1]),y},{}))};var h}var Pr=function(o){try{return o.only([[]]),Pr=function(){return[[]]},[[]]}catch{return Pr=function(){return An},An}};function ao(o){return o==null?function(){}:typeof o=="string"?(a=o).split(".").length===1?function(u){return u[a]}:function(u){return te(u,a)}:function(u){return te(u,o)};var a}function vc(o){return[].slice.call(o)}var Ld=0;function jr(o){return o==null?":id":typeof o=="string"?o:"[".concat(o.join("+"),"]")}function Md(o,a,E){function h(I){if(I.type===3)return null;if(I.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var x=I.lower,D=I.upper,T=I.lowerOpen,I=I.upperOpen;return x===void 0?D===void 0?null:a.upperBound(D,!!I):D===void 0?a.lowerBound(x,!!T):a.bound(x,D,!!T,!!I)}function y(O){var x,D=O.name;return{name:D,schema:O,mutate:function(T){var I=T.trans,C=T.type,j=T.keys,M=T.values,R=T.range;return new Promise(function(B,F){B=Ne(B);var H=I.objectStore(D),z=H.keyPath==null,$=C==="put"||C==="add";if(!$&&C!=="delete"&&C!=="deleteRange")throw new Error("Invalid operation type: "+C);var re,ee=(j||M||{length:1}).length;if(j&&M&&j.length!==M.length)throw new Error("Given keys array must have same length as given values array.");if(ee===0)return B({numFailures:0,failures:{},results:[],lastResult:void 0});function q($e){++Te,Tr($e)}var oe=[],Ee=[],Te=0;if(C==="deleteRange"){if(R.type===4)return B({numFailures:Te,failures:Ee,results:[],lastResult:void 0});R.type===3?oe.push(re=H.clear()):oe.push(re=H.delete(h(R)))}else{var z=$?z?[M,j]:[M,null]:[j,null],de=z[0],we=z[1];if($)for(var Be=0;Be<ee;++Be)oe.push(re=we&&we[Be]!==void 0?H[C](de[Be],we[Be]):H[C](de[Be])),re.onerror=q;else for(Be=0;Be<ee;++Be)oe.push(re=H[C](de[Be])),re.onerror=q}function Ct($e){$e=$e.target.result,oe.forEach(function(Pn,Eo){return Pn.error!=null&&(Ee[Eo]=Pn.error)}),B({numFailures:Te,failures:Ee,results:C==="delete"?j:oe.map(function(Pn){return Pn.result}),lastResult:$e})}re.onerror=function($e){q($e),Ct($e)},re.onsuccess=Ct})},getMany:function(T){var I=T.trans,C=T.keys;return new Promise(function(j,M){j=Ne(j);for(var R,B=I.objectStore(D),F=C.length,H=new Array(F),z=0,$=0,re=function(oe){oe=oe.target,H[oe._pos]=oe.result,++$===z&&j(H)},ee=Ut(M),q=0;q<F;++q)C[q]!=null&&((R=B.get(C[q]))._pos=q,R.onsuccess=re,R.onerror=ee,++z);z===0&&j(H)})},get:function(T){var I=T.trans,C=T.key;return new Promise(function(j,M){j=Ne(j);var R=I.objectStore(D).get(C);R.onsuccess=function(B){return j(B.target.result)},R.onerror=Ut(M)})},query:(x=k,function(T){return new Promise(function(I,C){I=Ne(I);var j,M,R,$=T.trans,B=T.values,F=T.limit,z=T.query,H=F===1/0?void 0:F,re=z.index,z=z.range,$=$.objectStore(D),$=re.isPrimaryKey?$:$.index(re.name),re=h(z);if(F===0)return I({result:[]});x?((z=B?$.getAll(re,H):$.getAllKeys(re,H)).onsuccess=function(ee){return I({result:ee.target.result})},z.onerror=Ut(C)):(j=0,M=!B&&"openKeyCursor"in $?$.openKeyCursor(re):$.openCursor(re),R=[],M.onsuccess=function(ee){var q=M.result;return!q||(R.push(B?q.value:q.primaryKey),++j===F)?I({result:R}):void q.continue()},M.onerror=Ut(C))})}),openCursor:function(T){var I=T.trans,C=T.values,j=T.query,M=T.reverse,R=T.unique;return new Promise(function(B,F){B=Ne(B);var $=j.index,H=j.range,z=I.objectStore(D),z=$.isPrimaryKey?z:z.index($.name),$=M?R?"prevunique":"prev":R?"nextunique":"next",re=!C&&"openKeyCursor"in z?z.openKeyCursor(h(H),$):z.openCursor(h(H),$);re.onerror=Ut(F),re.onsuccess=Ne(function(ee){var q,oe,Ee,Te,de=re.result;de?(de.___id=++Ld,de.done=!1,q=de.continue.bind(de),oe=(oe=de.continuePrimaryKey)&&oe.bind(de),Ee=de.advance.bind(de),Te=function(){throw new Error("Cursor not stopped")},de.trans=I,de.stop=de.continue=de.continuePrimaryKey=de.advance=function(){throw new Error("Cursor not started")},de.fail=Ne(F),de.next=function(){var we=this,Be=1;return this.start(function(){return Be--?we.continue():we.stop()}).then(function(){return we})},de.start=function(we){function Be(){if(re.result)try{we()}catch($e){de.fail($e)}else de.done=!0,de.start=function(){throw new Error("Cursor behind last entry")},de.stop()}var Ct=new Promise(function($e,Pn){$e=Ne($e),re.onerror=Ut(Pn),de.fail=Pn,de.stop=function(Eo){de.stop=de.continue=de.continuePrimaryKey=de.advance=Te,$e(Eo)}});return re.onsuccess=Ne(function($e){re.onsuccess=Be,Be()}),de.continue=q,de.continuePrimaryKey=oe,de.advance=Ee,Be(),Ct},B(de)):B(null)},F)})},count:function(T){var I=T.query,C=T.trans,j=I.index,M=I.range;return new Promise(function(R,B){var F=C.objectStore(D),F=j.isPrimaryKey?F:F.index(j.name),H=h(M),H=H?F.count(H):F.count();H.onsuccess=Ne(function(z){return R(z.target.result)}),H.onerror=Ut(B)})}}}m=E,w=vc((E=o).objectStoreNames);var m,E={schema:{name:E.name,tables:w.map(function(O){return m.objectStore(O)}).map(function(O){var x=O.keyPath,D=O.autoIncrement,I=l(x),T={},I={name:O.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:x==null,compound:I,keyPath:x,autoIncrement:D,unique:!0,extractKey:ao(x)},indexes:vc(O.indexNames).map(function(C){return O.index(C)}).map(function(R){var B=R.name,j=R.unique,M=R.multiEntry,R=R.keyPath,B={name:B,compound:l(R),keyPath:R,unique:j,multiEntry:M,extractKey:ao(R)};return T[jr(R)]=B}),getIndexByKeyPath:function(C){return T[jr(C)]}};return T[":id"]=I.primaryKey,x!=null&&(T[jr(x)]=I.primaryKey),I})},hasGetAll:0<w.length&&"getAll"in m.objectStore(w[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},w=E.schema,k=E.hasGetAll,E=w.tables.map(y),P={};return E.forEach(function(O){return P[O.name]=O}),{stack:"dbcore",transaction:o.transaction.bind(o),table:function(O){if(P[O])return P[O];throw new Error("Table '".concat(O,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Pr(a),schema:w}}function Nd(o,a,u,h){return u=u.IDBKeyRange,a=Md(a,u,h),{dbcore:o.dbcore.reduce(function(y,m){return m=m.create,r(r({},y),m(y))},a)}}function Pi(o,a){var u=a.db,u=Nd(o._middlewares,u,o._deps,a);o.core=u.dbcore,o.tables.forEach(function(h){var y=h.name;o.core.schema.tables.some(function(m){return m.name===y})&&(h.core=o.core.table(y),o[y]instanceof o.Table)&&(o[y].core=h.core)})}function ji(o,a,u,h){u.forEach(function(y){var m=h[y];a.forEach(function(w){var k=(function E(P,O){return N(P,O)||(P=d(P))&&E(P,O)})(w,y);(!k||"value"in k&&k.value===void 0)&&(w===o.Transaction.prototype||w instanceof o.Transaction?S(w,y,{get:function(){return this.table(y)},set:function(E){b(this,y,{value:E,writable:!0,configurable:!0,enumerable:!0})}}):w[y]=new o.Table(y,m))})})}function co(o,a){a.forEach(function(u){for(var h in u)u[h]instanceof o.Table&&delete u[h]})}function Kd(o,a){return o._cfg.version-a._cfg.version}function Bd(o,a,u,h){var y=o._dbSchema,m=(u.objectStoreNames.contains("$meta")&&!y.$meta&&(y.$meta=oo("$meta",wc("")[0],[]),o._storeNames.push("$meta")),o._createTransaction("readwrite",o._storeNames,y)),w=(m.create(u),m._completion.catch(h),m._reject.bind(m)),k=fe.transless||fe;cn(function(){if(fe.trans=m,fe.transless=k,a!==0)return Pi(o,u),P=a,((E=m).storeNames.includes("$meta")?E.table("$meta").get("version").then(function(O){return O??P}):Q.resolve(P)).then(function(j){var x=o,D=j,T=m,I=u,C=[],j=x._versions,M=x._dbSchema=Li(0,x.idbdb,I);return(j=j.filter(function(R){return R._cfg.version>=D})).length===0?Q.resolve():(j.forEach(function(R){C.push(function(){var B,F,H,z=M,$=R._cfg.dbschema,re=(Mi(x,z,I),Mi(x,$,I),M=x._dbSchema=$,lo(z,$)),ee=(re.add.forEach(function(q){uo(I,q[0],q[1].primKey,q[1].indexes)}),re.change.forEach(function(q){if(q.recreate)throw new J.Upgrade("Not yet support for changing primary key");var oe=I.objectStore(q.name);q.add.forEach(function(Ee){return Ui(oe,Ee)}),q.change.forEach(function(Ee){oe.deleteIndex(Ee.name),Ui(oe,Ee)}),q.del.forEach(function(Ee){return oe.deleteIndex(Ee)})}),R._cfg.contentUpgrade);if(ee&&R._cfg.version>D)return Pi(x,I),T._memoizedTables={},B=ye($),re.del.forEach(function(q){B[q]=z[q]}),co(x,[x.Transaction.prototype]),ji(x,[x.Transaction.prototype],c(B),B),T.schema=B,(F=he(ee))&&zn(),$=Q.follow(function(){var q;(H=ee(T))&&F&&(q=ln.bind(null,null),H.then(q,q))}),H&&typeof H.then=="function"?Q.resolve(H):$.then(function(){return H})}),C.push(function(B){var F,H,z=R._cfg.dbschema;F=z,H=B,[].slice.call(H.db.objectStoreNames).forEach(function($){return F[$]==null&&H.db.deleteObjectStore($)}),co(x,[x.Transaction.prototype]),ji(x,[x.Transaction.prototype],x._storeNames,x._dbSchema),T.schema=x._dbSchema}),C.push(function(B){x.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(x.idbdb.version/10)===R._cfg.version?(x.idbdb.deleteObjectStore("$meta"),delete x._dbSchema.$meta,x._storeNames=x._storeNames.filter(function(F){return F!=="$meta"})):B.objectStore("$meta").put(R._cfg.version,"version"))})}),(function R(){return C.length?Q.resolve(C.shift()(T.idbtrans)).then(R):Q.resolve()})().then(function(){bc(M,I)}))}).catch(w);var E,P;c(y).forEach(function(O){uo(u,O,y[O].primKey,y[O].indexes)}),Pi(o,u),Q.follow(function(){return o.on.populate.fire(m)}).catch(w)})}function Fd(o,a){bc(o._dbSchema,a),a.db.version%10!=0||a.objectStoreNames.contains("$meta")||a.db.createObjectStore("$meta").add(Math.ceil(a.db.version/10-1),"version");var u=Li(0,o.idbdb,a);Mi(o,o._dbSchema,a);for(var h=0,y=lo(u,o._dbSchema).change;h<y.length;h++){var m=(w=>{if(w.change.length||w.recreate)return console.warn("Unable to patch indexes of table ".concat(w.name," because it has changes on the type of index or primary key.")),{value:void 0};var k=a.objectStore(w.name);w.add.forEach(function(E){jt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(w.name,".").concat(E.src)),Ui(k,E)})})(y[h]);if(typeof m=="object")return m.value}}function lo(o,a){var u,h={del:[],add:[],change:[]};for(u in o)a[u]||h.del.push(u);for(u in a){var y=o[u],m=a[u];if(y){var w={name:u,def:m,recreate:!1,del:[],add:[],change:[]};if(""+(y.primKey.keyPath||"")!=""+(m.primKey.keyPath||"")||y.primKey.auto!==m.primKey.auto)w.recreate=!0,h.change.push(w);else{var k=y.idxByName,E=m.idxByName,P=void 0;for(P in k)E[P]||w.del.push(P);for(P in E){var O=k[P],x=E[P];O?O.src!==x.src&&w.change.push(x):w.add.push(x)}(0<w.del.length||0<w.add.length||0<w.change.length)&&h.change.push(w)}}else h.add.push([u,m])}return h}function uo(o,a,u,h){var y=o.db.createObjectStore(a,u.keyPath?{keyPath:u.keyPath,autoIncrement:u.auto}:{autoIncrement:u.auto});h.forEach(function(m){return Ui(y,m)})}function bc(o,a){c(o).forEach(function(u){a.db.objectStoreNames.contains(u)||(jt&&console.debug("Dexie: Creating missing table",u),uo(a,u,o[u].primKey,o[u].indexes))})}function Ui(o,a){o.createIndex(a.name,a.keyPath,{unique:a.unique,multiEntry:a.multi})}function Li(o,a,u){var h={};return K(a.objectStoreNames,0).forEach(function(y){for(var m=u.objectStore(y),w=so(mc(P=m.keyPath),P||"",!0,!1,!!m.autoIncrement,P&&typeof P!="string",!0),k=[],E=0;E<m.indexNames.length;++E){var O=m.index(m.indexNames[E]),P=O.keyPath,O=so(O.name,P,!!O.unique,!!O.multiEntry,!1,P&&typeof P!="string",!1);k.push(O)}h[y]=oo(y,w,k)}),h}function Mi(o,a,u){for(var h=u.db.objectStoreNames,y=0;y<h.length;++y){var m=h[y],w=u.objectStore(m);o._hasGetAll="getAll"in w;for(var k=0;k<w.indexNames.length;++k){var E,P=w.indexNames[k],O=w.index(P).keyPath,O=typeof O=="string"?O:"["+K(O).join("+")+"]";a[m]&&(E=a[m].idxByName[O])&&(E.name=P,delete a[m].idxByName[O],a[m].idxByName[P]=E)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(o._hasGetAll=!1)}function wc(o){return o.split(",").map(function(a,u){var y=a.split(":"),h=(h=y[1])==null?void 0:h.trim(),y=(a=y[0].trim()).replace(/([&*]|\+\+)/g,""),m=/^\[/.test(y)?y.match(/^\[(.*)\]$/)[1].split("+"):y;return so(y,m||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),l(m),u===0,h)})}Xn.prototype._createTableSchema=oo,Xn.prototype._parseIndexSyntax=wc,Xn.prototype._parseStoresSpec=function(o,a){var u=this;c(o).forEach(function(h){if(o[h]!==null){var y=u._parseIndexSyntax(o[h]),m=y.shift();if(!m)throw new J.Schema("Invalid schema for table "+h+": "+o[h]);if(m.unique=!0,m.multi)throw new J.Schema("Primary key cannot be multiEntry*");y.forEach(function(w){if(w.auto)throw new J.Schema("Only primary key can be marked as autoIncrement (++)");if(!w.keyPath)throw new J.Schema("Index must have a name and cannot be an empty string")}),m=u._createTableSchema(h,m,y),a[h]=m}})},Xn.prototype.stores=function(u){var a=this.db,u=(this._cfg.storesSource=this._cfg.storesSource?f(this._cfg.storesSource,u):u,a._versions),h={},y={};return u.forEach(function(m){f(h,m._cfg.storesSource),y=m._cfg.dbschema={},m._parseStoresSpec(h,y)}),a._dbSchema=y,co(a,[a._allTables,a,a.Transaction.prototype]),ji(a,[a._allTables,a,a.Transaction.prototype,this._cfg.tables],c(y),y),a._storeNames=c(y),this},Xn.prototype.upgrade=function(o){return this._cfg.contentUpgrade=Ws(this._cfg.contentUpgrade||pe,o),this};var $d=Xn;function Xn(){}function fo(o,a){var u=o._dbNamesDB;return u||(u=o._dbNamesDB=new Ht(Oi,{addons:[],indexedDB:o,IDBKeyRange:a})).version(1).stores({dbnames:"name"}),u.table("dbnames")}function ho(o){return o&&typeof o.databases=="function"}function po(o){return cn(function(){return fe.letThrough=!0,o()})}function yo(o){return!("from"in o)}var lt=function(o,a){var u;if(!this)return u=new lt,o&&"d"in o&&f(u,o),u;f(this,arguments.length?{d:1,from:o,to:1<arguments.length?a:o}:{d:0})};function Ur(o,a,u){var h=Se(a,u);if(!isNaN(h)){if(0<h)throw RangeError();if(yo(o))return f(o,{from:a,to:u,d:1});var h=o.l,y=o.r;if(Se(u,o.from)<0)return h?Ur(h,a,u):o.l={from:a,to:u,d:1,l:null,r:null},kc(o);if(0<Se(a,o.to))return y?Ur(y,a,u):o.r={from:a,to:u,d:1,l:null,r:null},kc(o);Se(a,o.from)<0&&(o.from=a,o.l=null,o.d=y?y.d+1:1),0<Se(u,o.to)&&(o.to=u,o.r=null,o.d=o.l?o.l.d+1:1),a=!o.r,h&&!o.l&&Lr(o,h),y&&a&&Lr(o,y)}}function Lr(o,a){yo(a)||(function u(h,y){var m=y.from,w=y.l,k=y.r;Ur(h,m,y.to),w&&u(h,w),k&&u(h,k)})(o,a)}function _c(o,a){var u=Ni(a),h=u.next();if(!h.done)for(var y=h.value,m=Ni(o),w=m.next(y.from),k=w.value;!h.done&&!w.done;){if(Se(k.from,y.to)<=0&&0<=Se(k.to,y.from))return!0;Se(y.from,k.from)<0?y=(h=u.next(k.from)).value:k=(w=m.next(y.from)).value}return!1}function Ni(o){var a=yo(o)?null:{s:0,n:o};return{next:function(u){for(var h=0<arguments.length;a;)switch(a.s){case 0:if(a.s=1,h)for(;a.n.l&&Se(u,a.n.from)<0;)a={up:a,n:a.n.l,s:1};else for(;a.n.l;)a={up:a,n:a.n.l,s:1};case 1:if(a.s=2,!h||Se(u,a.n.to)<=0)return{value:a.n,done:!1};case 2:if(a.n.r){a.s=3,a={up:a,n:a.n.r,s:0};continue}case 3:a=a.up}return{done:!0}}}}function kc(o){var a,u,h,y=(((y=o.r)==null?void 0:y.d)||0)-(((y=o.l)==null?void 0:y.d)||0),y=1<y?"r":y<-1?"l":"";y&&(a=y=="r"?"l":"r",u=r({},o),h=o[y],o.from=h.from,o.to=h.to,o[y]=h[y],u[y]=h[a],(o[a]=u).d=Sc(u)),o.d=Sc(o)}function Sc(u){var a=u.r,u=u.l;return(a?u?Math.max(a.d,u.d):a.d:u?u.d:0)+1}function Ki(o,a){return c(a).forEach(function(u){o[u]?Lr(o[u],a[u]):o[u]=(function h(y){var m,w,k={};for(m in y)p(y,m)&&(w=y[m],k[m]=!w||typeof w!="object"||se.has(w.constructor)?w:h(w));return k})(a[u])}),o}function go(o,a){return o.all||a.all||Object.keys(o).some(function(u){return a[u]&&_c(a[u],o[u])})}v(lt.prototype,((mt={add:function(o){return Lr(this,o),this},addKey:function(o){return Ur(this,o,o),this},addKeys:function(o){var a=this;return o.forEach(function(u){return Ur(a,u,u)}),this},hasKey:function(o){var a=Ni(this).next(o).value;return a&&Se(a.from,o)<=0&&0<=Se(a.to,o)}})[le]=function(){return Ni(this)},mt));var Tn={},mo={},vo=!1;function Bi(o){Ki(mo,o),vo||(vo=!0,setTimeout(function(){vo=!1,bo(mo,!(mo={}))},0))}function bo(o,a){a===void 0&&(a=!1);var u=new Set;if(o.all)for(var h=0,y=Object.values(Tn);h<y.length;h++)xc(k=y[h],o,u,a);else for(var m in o){var w,k,m=/^idb\:\/\/(.*)\/(.*)\//.exec(m);m&&(w=m[1],m=m[2],k=Tn["idb://".concat(w,"/").concat(m)])&&xc(k,o,u,a)}u.forEach(function(E){return E()})}function xc(o,a,u,h){for(var y=[],m=0,w=Object.entries(o.queries.query);m<w.length;m++){for(var k=w[m],E=k[0],P=[],O=0,x=k[1];O<x.length;O++){var D=x[O];go(a,D.obsSet)?D.subscribers.forEach(function(j){return u.add(j)}):h&&P.push(D)}h&&y.push([E,P])}if(h)for(var T=0,I=y;T<I.length;T++){var C=I[T],E=C[0],P=C[1];o.queries.query[E]=P}}function qd(o){var a=o._state,u=o._deps.indexedDB;if(a.isBeingOpened||o.idbdb)return a.dbReadyPromise.then(function(){return a.dbOpenError?Ve(a.dbOpenError):o});a.isBeingOpened=!0,a.dbOpenError=null,a.openComplete=!1;var h=a.openCanceller,y=Math.round(10*o.verno),m=!1;function w(){if(a.openCanceller!==h)throw new J.DatabaseClosed("db.open() was cancelled")}function k(){return new Q(function(D,T){if(w(),!u)throw new J.MissingAPI;var I=o.name,C=a.autoSchema||!y?u.open(I):u.open(I,y);if(!C)throw new J.MissingAPI;C.onerror=Ut(T),C.onblocked=Ne(o._fireOnBlocked),C.onupgradeneeded=Ne(function(j){var M;O=C.transaction,a.autoSchema&&!o._options.allowEmptyDB?(C.onerror=Tr,O.abort(),C.result.close(),(M=u.deleteDatabase(I)).onsuccess=M.onerror=Ne(function(){T(new J.NoSuchDatabase("Database ".concat(I," doesnt exist")))})):(O.onerror=Ut(T),M=j.oldVersion>Math.pow(2,62)?0:j.oldVersion,x=M<1,o.idbdb=C.result,m&&Fd(o,O),Bd(o,M/10,O,T))},T),C.onsuccess=Ne(function(){O=null;var j,M,R,B,F,H,z=o.idbdb=C.result,$=K(z.objectStoreNames);if(0<$.length)try{var re=z.transaction((F=$).length===1?F[0]:F,"readonly");if(a.autoSchema)H=z,B=re,(R=o).verno=H.version/10,B=R._dbSchema=Li(0,H,B),R._storeNames=K(H.objectStoreNames,0),ji(R,[R._allTables],c(B),B);else if(Mi(o,o._dbSchema,re),M=re,((M=lo(Li(0,(j=o).idbdb,M),j._dbSchema)).add.length||M.change.some(function(ee){return ee.add.length||ee.change.length}))&&!m)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),z.close(),y=z.version+1,m=!0,D(k());Pi(o,re)}catch{}Yn.push(o),z.onversionchange=Ne(function(ee){a.vcFired=!0,o.on("versionchange").fire(ee)}),z.onclose=Ne(function(){o.close({disableAutoOpen:!1})}),x&&($=o._deps,F=I,ho(H=$.indexedDB)||F===Oi||fo(H,$.IDBKeyRange).put({name:F}).catch(pe)),D()},T)}).catch(function(D){switch(D==null?void 0:D.name){case"UnknownError":if(0<a.PR1398_maxLoop)return a.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),k();break;case"VersionError":if(0<y)return y=0,k()}return Q.reject(D)})}var E,P=a.dbReadyResolve,O=null,x=!1;return Q.race([h,(typeof navigator>"u"?Q.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(D){function T(){return indexedDB.databases().finally(D)}E=setInterval(T,100),T()}).finally(function(){return clearInterval(E)}):Promise.resolve()).then(k)]).then(function(){return w(),a.onReadyBeingFired=[],Q.resolve(po(function(){return o.on.ready.fire(o.vip)})).then(function D(){var T;if(0<a.onReadyBeingFired.length)return T=a.onReadyBeingFired.reduce(Ws,pe),a.onReadyBeingFired=[],Q.resolve(po(function(){return T(o.vip)})).then(D)})}).finally(function(){a.openCanceller===h&&(a.onReadyBeingFired=null,a.isBeingOpened=!1)}).catch(function(D){a.dbOpenError=D;try{O&&O.abort()}catch{}return h===a.openCanceller&&o._close(),Ve(D)}).finally(function(){a.openComplete=!0,P()}).then(function(){var D;return x&&(D={},o.tables.forEach(function(T){T.schema.indexes.forEach(function(I){I.name&&(D["idb://".concat(o.name,"/").concat(T.name,"/").concat(I.name)]=new lt(-1/0,[[[]]]))}),D["idb://".concat(o.name,"/").concat(T.name,"/")]=D["idb://".concat(o.name,"/").concat(T.name,"/:dels")]=new lt(-1/0,[[[]]])}),dn(Rr).fire(D),bo(D,!0)),o})}function wo(o){function a(m){return o.next(m)}var u=y(a),h=y(function(m){return o.throw(m)});function y(m){return function(k){var k=m(k),E=k.value;return k.done?E:E&&typeof E.then=="function"?E.then(u,h):l(E)?Promise.all(E).then(u,h):u(E)}}return y(a)()}function Fi(o,a,u){for(var h=l(o)?o.slice():[o],y=0;y<u;++y)h.push(a);return h}var Vd={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(o){return r(r({},o),{table:function(h){var u=o.table(h),h=u.schema,y={},m=[];function w(D,T,I){var R=jr(D),C=y[R]=y[R]||[],j=D==null?0:typeof D=="string"?1:D.length,M=0<T,R=r(r({},I),{name:M?"".concat(R,"(virtual-from:").concat(I.name,")"):I.name,lowLevelIndex:I,isVirtual:M,keyTail:T,keyLength:j,extractKey:ao(D),unique:!M&&I.unique});return C.push(R),R.isPrimaryKey||m.push(R),1<j&&w(j===2?D[0]:D.slice(0,j-1),T+1,I),C.sort(function(B,F){return B.keyTail-F.keyTail}),R}var k=w(h.primaryKey.keyPath,0,h.primaryKey);y[":id"]=[k];for(var E=0,P=h.indexes;E<P.length;E++){var O=P[E];w(O.keyPath,0,O)}function x(D){var T,I=D.query.index;return I.isVirtual?r(r({},D),{query:{index:I.lowLevelIndex,range:(T=D.query.range,I=I.keyTail,{type:T.type===1?2:T.type,lower:Fi(T.lower,T.lowerOpen?o.MAX_KEY:o.MIN_KEY,I),lowerOpen:!0,upper:Fi(T.upper,T.upperOpen?o.MIN_KEY:o.MAX_KEY,I),upperOpen:!0})}}):D}return r(r({},u),{schema:r(r({},h),{primaryKey:k,indexes:m,getIndexByKeyPath:function(D){return(D=y[jr(D)])&&D[0]}}),count:function(D){return u.count(x(D))},query:function(D){return u.query(x(D))},openCursor:function(D){var T=D.query.index,I=T.keyTail,C=T.keyLength;return T.isVirtual?u.openCursor(x(D)).then(function(M){return M&&j(M)}):u.openCursor(D);function j(M){return Object.create(M,{continue:{value:function(R){R!=null?M.continue(Fi(R,D.reverse?o.MAX_KEY:o.MIN_KEY,I)):D.unique?M.continue(M.key.slice(0,C).concat(D.reverse?o.MIN_KEY:o.MAX_KEY,I)):M.continue()}},continuePrimaryKey:{value:function(R,B){M.continuePrimaryKey(Fi(R,o.MAX_KEY,I),B)}},primaryKey:{get:function(){return M.primaryKey}},key:{get:function(){var R=M.key;return C===1?R[0]:R.slice(0,C)}},value:{get:function(){return M.value}}})}}})}})}};function _o(o,a,u,h){return u=u||{},h=h||"",c(o).forEach(function(y){var m,w,k;p(a,y)?(m=o[y],w=a[y],typeof m=="object"&&typeof w=="object"&&m&&w?(k=me(m))!==me(w)?u[h+y]=a[y]:k==="Object"?_o(m,w,u,h+y+"."):m!==w&&(u[h+y]=a[y]):m!==w&&(u[h+y]=a[y])):u[h+y]=void 0}),c(a).forEach(function(y){p(o,y)||(u[h+y]=a[y])}),u}function ko(o,a){return a.type==="delete"?a.keys:a.keys||a.values.map(o.extractKey)}var Wd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(o){return r(r({},o),{table:function(a){var u=o.table(a),h=u.schema.primaryKey;return r(r({},u),{mutate:function(y){var m=fe.trans,w=m.table(a).hook,k=w.deleting,E=w.creating,P=w.updating;switch(y.type){case"add":if(E.fire===pe)break;return m._promise("readwrite",function(){return O(y)},!0);case"put":if(E.fire===pe&&P.fire===pe)break;return m._promise("readwrite",function(){return O(y)},!0);case"delete":if(k.fire===pe)break;return m._promise("readwrite",function(){return O(y)},!0);case"deleteRange":if(k.fire===pe)break;return m._promise("readwrite",function(){return(function x(D,T,I){return u.query({trans:D,values:!1,query:{index:h,range:T},limit:I}).then(function(C){var j=C.result;return O({type:"delete",keys:j,trans:D}).then(function(M){return 0<M.numFailures?Promise.reject(M.failures[0]):j.length<I?{failures:[],numFailures:0,lastResult:void 0}:x(D,r(r({},T),{lower:j[j.length-1],lowerOpen:!0}),I)})})})(y.trans,y.range,1e4)},!0)}return u.mutate(y);function O(x){var D,T,I,C=fe.trans,j=x.keys||ko(h,x);if(j)return(x=x.type==="add"||x.type==="put"?r(r({},x),{keys:j}):r({},x)).type!=="delete"&&(x.values=i([],x.values)),x.keys&&(x.keys=i([],x.keys)),D=u,I=j,((T=x).type==="add"?Promise.resolve([]):D.getMany({trans:T.trans,keys:I,cache:"immutable"})).then(function(M){var R=j.map(function(B,F){var H,z,$,re=M[F],ee={onerror:null,onsuccess:null};return x.type==="delete"?k.fire.call(ee,B,re,C):x.type==="add"||re===void 0?(H=E.fire.call(ee,B,x.values[F],C),B==null&&H!=null&&(x.keys[F]=B=H,h.outbound||G(x.values[F],h.keyPath,B))):(H=_o(re,x.values[F]),(z=P.fire.call(ee,H,B,re,C))&&($=x.values[F],Object.keys(z).forEach(function(q){p($,q)?$[q]=z[q]:G($,q,z[q])}))),ee});return u.mutate(x).then(function(B){for(var F=B.failures,H=B.results,z=B.numFailures,B=B.lastResult,$=0;$<j.length;++$){var re=(H||j)[$],ee=R[$];re==null?ee.onerror&&ee.onerror(F[$]):ee.onsuccess&&ee.onsuccess(x.type==="put"&&M[$]?x.values[$]:re)}return{failures:F,results:H,numFailures:z,lastResult:B}}).catch(function(B){return R.forEach(function(F){return F.onerror&&F.onerror(B)}),Promise.reject(B)})});throw new Error("Keys missing")}}})}})}};function Cc(o,a,u){try{if(!a||a.keys.length<o.length)return null;for(var h=[],y=0,m=0;y<a.keys.length&&m<o.length;++y)Se(a.keys[y],o[m])===0&&(h.push(u?ge(a.values[y]):a.values[y]),++m);return h.length===o.length?h:null}catch{return null}}var Hd={stack:"dbcore",level:-1,create:function(o){return{table:function(a){var u=o.table(a);return r(r({},u),{getMany:function(h){var y;return h.cache?(y=Cc(h.keys,h.trans._cache,h.cache==="clone"))?Q.resolve(y):u.getMany(h).then(function(m){return h.trans._cache={keys:h.keys,values:h.cache==="clone"?ge(m):m},m}):u.getMany(h)},mutate:function(h){return h.type!=="add"&&(h.trans._cache=null),u.mutate(h)}})}}}};function Ec(o,a){return o.trans.mode==="readonly"&&!!o.subscr&&!o.trans.explicit&&o.trans.db._options.cache!=="disabled"&&!a.schema.primaryKey.outbound}function Oc(o,a){switch(o){case"query":return a.values&&!a.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var zd={stack:"dbcore",level:0,name:"Observability",create:function(o){var a=o.schema.name,u=new lt(o.MIN_KEY,o.MAX_KEY);return r(r({},o),{transaction:function(h,y,m){if(fe.subscr&&y!=="readonly")throw new J.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(fe.querier));return o.transaction(h,y,m)},table:function(h){function y(j){var C,j=j.query;return[C=j.index,new lt((C=(j=j.range).lower)!=null?C:o.MIN_KEY,(C=j.upper)!=null?C:o.MAX_KEY)]}var m=o.table(h),w=m.schema,k=w.primaryKey,E=w.indexes,P=k.extractKey,O=k.outbound,x=k.autoIncrement&&E.filter(function(I){return I.compound&&I.keyPath.includes(k.keyPath)}),D=r(r({},m),{mutate:function(I){function C(oe){return oe="idb://".concat(a,"/").concat(h,"/").concat(oe),F[oe]||(F[oe]=new lt)}var j,M,R,B=I.trans,F=I.mutatedParts||(I.mutatedParts={}),H=C(""),z=C(":dels"),$=I.type,ee=I.type==="deleteRange"?[I.range]:I.type==="delete"?[I.keys]:I.values.length<50?[ko(k,I).filter(function(oe){return oe}),I.values]:[],re=ee[0],ee=ee[1],q=I.trans._cache;return l(re)?(H.addKeys(re),($=$==="delete"||re.length===ee.length?Cc(re,q):null)||z.addKeys(re),($||ee)&&(j=C,M=$,R=ee,w.indexes.forEach(function(oe){var Ee=j(oe.name||"");function Te(we){return we!=null?oe.extractKey(we):null}function de(we){oe.multiEntry&&l(we)?we.forEach(function(Be){return Ee.addKey(Be)}):Ee.addKey(we)}(M||R).forEach(function(we,$e){var Ct=M&&Te(M[$e]),$e=R&&Te(R[$e]);Se(Ct,$e)!==0&&(Ct!=null&&de(Ct),$e!=null)&&de($e)})}))):re?(ee={from:(q=re.lower)!=null?q:o.MIN_KEY,to:($=re.upper)!=null?$:o.MAX_KEY},z.add(ee),H.add(ee)):(H.add(u),z.add(u),w.indexes.forEach(function(oe){return C(oe.name).add(u)})),m.mutate(I).then(function(oe){return!re||I.type!=="add"&&I.type!=="put"||(H.addKeys(oe.results),x&&x.forEach(function(Ee){for(var Te=I.values.map(function(Ct){return Ee.extractKey(Ct)}),de=Ee.keyPath.findIndex(function(Ct){return Ct===k.keyPath}),we=0,Be=oe.results.length;we<Be;++we)Te[we][de]=oe.results[we];C(Ee.name).addKeys(Te)})),B.mutatedParts=Ki(B.mutatedParts||{},F),oe})}}),T={get:function(I){return[k,new lt(I.key)]},getMany:function(I){return[k,new lt().addKeys(I.keys)]},count:y,query:y,openCursor:y};return c(T).forEach(function(I){D[I]=function(C){var j=fe.subscr,M=!!j,R=Ec(fe,m)&&Oc(I,C)?C.obsSet={}:j;if(M){var B,j=function(ee){return ee="idb://".concat(a,"/").concat(h,"/").concat(ee),R[ee]||(R[ee]=new lt)},F=j(""),H=j(":dels"),M=T[I](C),z=M[0],M=M[1];if((I==="query"&&z.isPrimaryKey&&!C.values?H:j(z.name||"")).add(M),!z.isPrimaryKey){if(I!=="count")return B=I==="query"&&O&&C.values&&m.query(r(r({},C),{values:!1})),m[I].apply(this,arguments).then(function(ee){if(I==="query"){if(O&&C.values)return B.then(function(Te){return Te=Te.result,F.addKeys(Te),ee});var q=C.values?ee.result.map(P):ee.result;(C.values?F:H).addKeys(q)}else{var oe,Ee;if(I==="openCursor")return Ee=C.values,(oe=ee)&&Object.create(oe,{key:{get:function(){return H.addKey(oe.primaryKey),oe.key}},primaryKey:{get:function(){var Te=oe.primaryKey;return H.addKey(Te),Te}},value:{get:function(){return Ee&&F.addKey(oe.primaryKey),oe.value}}})}return ee});H.add(u)}}return m[I].apply(this,arguments)}}),D}})}};function Ic(o,a,u){var h;return u.numFailures===0?a:a.type==="deleteRange"||(h=a.keys?a.keys.length:"values"in a&&a.values?a.values.length:1,u.numFailures===h)?null:(h=r({},a),l(h.keys)&&(h.keys=h.keys.filter(function(y,m){return!(m in u.failures)})),"values"in h&&l(h.values)&&(h.values=h.values.filter(function(y,m){return!(m in u.failures)})),h)}function So(o,a){return u=o,((h=a).lower===void 0||(h.lowerOpen?0<Se(u,h.lower):0<=Se(u,h.lower)))&&(u=o,(h=a).upper===void 0||(h.upperOpen?Se(u,h.upper)<0:Se(u,h.upper)<=0));var u,h}function Ac(o,a,u,h,y,m){var w,k,E,P,O,x;return!u||u.length===0||(w=a.query.index,k=w.multiEntry,E=a.query.range,P=h.schema.primaryKey.extractKey,O=w.extractKey,x=(w.lowLevelIndex||w).extractKey,(h=u.reduce(function(D,T){var I=D,C=[];if(T.type==="add"||T.type==="put")for(var j=new lt,M=T.values.length-1;0<=M;--M){var R,B=T.values[M],F=P(B);!j.hasKey(F)&&(R=O(B),k&&l(R)?R.some(function(ee){return So(ee,E)}):So(R,E))&&(j.addKey(F),C.push(B))}switch(T.type){case"add":var H=new lt().addKeys(a.values?D.map(function(q){return P(q)}):D),I=D.concat(a.values?C.filter(function(q){return q=P(q),!H.hasKey(q)&&(H.addKey(q),!0)}):C.map(function(q){return P(q)}).filter(function(q){return!H.hasKey(q)&&(H.addKey(q),!0)}));break;case"put":var z=new lt().addKeys(T.values.map(function(q){return P(q)}));I=D.filter(function(q){return!z.hasKey(a.values?P(q):q)}).concat(a.values?C:C.map(function(q){return P(q)}));break;case"delete":var $=new lt().addKeys(T.keys);I=D.filter(function(q){return!$.hasKey(a.values?P(q):q)});break;case"deleteRange":var re=T.range;I=D.filter(function(q){return!So(P(q),re)})}return I},o))===o)?o:(h.sort(function(D,T){return Se(x(D),x(T))||Se(P(D),P(T))}),a.limit&&a.limit<1/0&&(h.length>a.limit?h.length=a.limit:o.length===a.limit&&h.length<a.limit&&(y.dirty=!0)),m?Object.freeze(h):h)}function Dc(o,a){return Se(o.lower,a.lower)===0&&Se(o.upper,a.upper)===0&&!!o.lowerOpen==!!a.lowerOpen&&!!o.upperOpen==!!a.upperOpen}function Yd(o,a){return((u,h,y,m)=>{if(u===void 0)return h!==void 0?-1:0;if(h===void 0)return 1;if((u=Se(u,h))===0){if(y&&m)return 0;if(y)return 1;if(m)return-1}return u})(o.lower,a.lower,o.lowerOpen,a.lowerOpen)<=0&&0<=((u,h,y,m)=>{if(u===void 0)return h!==void 0?1:0;if(h===void 0)return-1;if((u=Se(u,h))===0){if(y&&m)return 0;if(y)return-1;if(m)return 1}return u})(o.upper,a.upper,o.upperOpen,a.upperOpen)}function Gd(o,a,u,h){o.subscribers.add(u),h.addEventListener("abort",function(){var y,m;o.subscribers.delete(u),o.subscribers.size===0&&(y=o,m=a,setTimeout(function(){y.subscribers.size===0&&ce(m,y)},3e3))})}var Jd={stack:"dbcore",level:0,name:"Cache",create:function(o){var a=o.schema.name;return r(r({},o),{transaction:function(u,h,y){var m,w,k=o.transaction(u,h,y);return h==="readwrite"&&(y=(m=new AbortController).signal,k.addEventListener("abort",(w=function(E){return function(){if(m.abort(),h==="readwrite"){for(var P=new Set,O=0,x=u;O<x.length;O++){var D=x[O],T=Tn["idb://".concat(a,"/").concat(D)];if(T){var I=o.table(D),C=T.optimisticOps.filter(function(oe){return oe.trans===k});if(k._explicit&&E&&k.mutatedParts)for(var j=0,M=Object.values(T.queries.query);j<M.length;j++)for(var R=0,B=(z=M[j]).slice();R<B.length;R++)go(($=B[R]).obsSet,k.mutatedParts)&&(ce(z,$),$.subscribers.forEach(function(oe){return P.add(oe)}));else if(0<C.length){T.optimisticOps=T.optimisticOps.filter(function(oe){return oe.trans!==k});for(var F=0,H=Object.values(T.queries.query);F<H.length;F++)for(var z,$,re,ee=0,q=(z=H[F]).slice();ee<q.length;ee++)($=q[ee]).res!=null&&k.mutatedParts&&(E&&!$.dirty?(re=Object.isFrozen($.res),re=Ac($.res,$.req,C,I,$,re),$.dirty?(ce(z,$),$.subscribers.forEach(function(oe){return P.add(oe)})):re!==$.res&&($.res=re,$.promise=Q.resolve({result:re}))):($.dirty&&ce(z,$),$.subscribers.forEach(function(oe){return P.add(oe)})))}}}P.forEach(function(oe){return oe()})}}})(!1),{signal:y}),k.addEventListener("error",w(!1),{signal:y}),k.addEventListener("complete",w(!0),{signal:y})),k},table:function(u){var h=o.table(u),y=h.schema.primaryKey;return r(r({},h),{mutate:function(m){var w,k=fe.trans;return!y.outbound&&k.db._options.cache!=="disabled"&&!k.explicit&&k.idbtrans.mode==="readwrite"&&(w=Tn["idb://".concat(a,"/").concat(u)])?(k=h.mutate(m),m.type!=="add"&&m.type!=="put"||!(50<=m.values.length||ko(y,m).some(function(E){return E==null}))?(w.optimisticOps.push(m),m.mutatedParts&&Bi(m.mutatedParts),k.then(function(E){0<E.numFailures&&(ce(w.optimisticOps,m),(E=Ic(0,m,E))&&w.optimisticOps.push(E),m.mutatedParts)&&Bi(m.mutatedParts)}),k.catch(function(){ce(w.optimisticOps,m),m.mutatedParts&&Bi(m.mutatedParts)})):k.then(function(E){var P=Ic(0,r(r({},m),{values:m.values.map(function(O,x){var D;return E.failures[x]?O:(G(D=(D=y.keyPath)!=null&&D.includes(".")?ge(O):r({},O),y.keyPath,E.results[x]),D)})}),E);w.optimisticOps.push(P),queueMicrotask(function(){return m.mutatedParts&&Bi(m.mutatedParts)})}),k):h.mutate(m)},query:function(m){var w,k,E,P,O,x,D;return Ec(fe,h)&&Oc("query",m)?(w=((E=fe.trans)==null?void 0:E.db._options.cache)==="immutable",k=(E=fe).requery,E=E.signal,x=((T,I,C,j)=>{var M=Tn["idb://".concat(T,"/").concat(I)];if(!M)return[];if(!(T=M.queries[C]))return[null,!1,M,null];var R=T[(j.query?j.query.index.name:null)||""];if(!R)return[null,!1,M,null];switch(C){case"query":var B=R.find(function(F){return F.req.limit===j.limit&&F.req.values===j.values&&Dc(F.req.query.range,j.query.range)});return B?[B,!0,M,R]:[R.find(function(F){return("limit"in F.req?F.req.limit:1/0)>=j.limit&&(!j.values||F.req.values)&&Yd(F.req.query.range,j.query.range)}),!1,M,R];case"count":return B=R.find(function(F){return Dc(F.req.query.range,j.query.range)}),[B,!!B,M,R]}})(a,u,"query",m),D=x[0],P=x[2],O=x[3],D&&x[1]?D.obsSet=m.obsSet:(x=h.query(m).then(function(T){var I=T.result;if(D&&(D.res=I),w){for(var C=0,j=I.length;C<j;++C)Object.freeze(I[C]);Object.freeze(I)}else T.result=ge(I);return T}).catch(function(T){return O&&D&&ce(O,D),Promise.reject(T)}),D={obsSet:m.obsSet,promise:x,subscribers:new Set,type:"query",req:m,dirty:!1},O?O.push(D):(O=[D],(P=P||(Tn["idb://".concat(a,"/").concat(u)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[m.query.index.name||""]=O)),Gd(D,O,k,E),D.promise.then(function(T){return{result:Ac(T.result,m,P==null?void 0:P.optimisticOps,h,D,w)}})):h.query(m)}})}})}};function $i(o,a){return new Proxy(o,{get:function(u,h,y){return h==="db"?a:Reflect.get(u,h,y)}})}We.prototype.version=function(o){if(isNaN(o)||o<.1)throw new J.Type("Given version is not a positive number");if(o=Math.round(10*o)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,o);var a=this._versions,u=a.filter(function(h){return h._cfg.version===o})[0];return u||(u=new this.Version(o),a.push(u),a.sort(Kd),u.stores({}),this._state.autoSchema=!1),u},We.prototype._whenReady=function(o){var a=this;return this.idbdb&&(this._state.openComplete||fe.letThrough||this._vip)?o():new Q(function(u,h){if(a._state.openComplete)return h(new J.DatabaseClosed(a._state.dbOpenError));if(!a._state.isBeingOpened){if(!a._state.autoOpen)return void h(new J.DatabaseClosed);a.open().catch(pe)}a._state.dbReadyPromise.then(u,h)}).then(o)},We.prototype.use=function(y){var a=y.stack,u=y.create,h=y.level,y=y.name,m=(y&&this.unuse({stack:a,name:y}),this._middlewares[a]||(this._middlewares[a]=[]));return m.push({stack:a,create:u,level:h??10,name:y}),m.sort(function(w,k){return w.level-k.level}),this},We.prototype.unuse=function(o){var a=o.stack,u=o.name,h=o.create;return a&&this._middlewares[a]&&(this._middlewares[a]=this._middlewares[a].filter(function(y){return h?y.create!==h:!!u&&y.name!==u})),this},We.prototype.open=function(){var o=this;return In(an,function(){return qd(o)})},We.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var o=this._state,a=Yn.indexOf(this);if(0<=a&&Yn.splice(a,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}o.isBeingOpened||(o.dbReadyPromise=new Q(function(u){o.dbReadyResolve=u}),o.openCanceller=new Q(function(u,h){o.cancelOpen=h}))},We.prototype.close=function(a){var a=(a===void 0?{disableAutoOpen:!0}:a).disableAutoOpen,u=this._state;a?(u.isBeingOpened&&u.cancelOpen(new J.DatabaseClosed),this._close(),u.autoOpen=!1,u.dbOpenError=new J.DatabaseClosed):(this._close(),u.autoOpen=this._options.autoOpen||u.isBeingOpened,u.openComplete=!1,u.dbOpenError=null)},We.prototype.delete=function(o){var a=this,u=(o===void 0&&(o={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),h=this._state;return new Q(function(y,m){function w(){a.close(o);var k=a._deps.indexedDB.deleteDatabase(a.name);k.onsuccess=Ne(function(){var E,P,O;E=a._deps,P=a.name,ho(O=E.indexedDB)||P===Oi||fo(O,E.IDBKeyRange).delete(P).catch(pe),y()}),k.onerror=Ut(m),k.onblocked=a._fireOnBlocked}if(u)throw new J.InvalidArgument("Invalid closeOptions argument to db.delete()");h.isBeingOpened?h.dbReadyPromise.then(w):w()})},We.prototype.backendDB=function(){return this.idbdb},We.prototype.isOpen=function(){return this.idbdb!==null},We.prototype.hasBeenClosed=function(){var o=this._state.dbOpenError;return o&&o.name==="DatabaseClosed"},We.prototype.hasFailed=function(){return this._state.dbOpenError!==null},We.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(We.prototype,"tables",{get:function(){var o=this;return c(this._allTables).map(function(a){return o._allTables[a]})},enumerable:!1,configurable:!0}),We.prototype.transaction=function(){var o=(function(a,u,h){var y=arguments.length;if(y<2)throw new J.InvalidArgument("Too few arguments");for(var m=new Array(y-1);--y;)m[y-1]=arguments[y];return h=m.pop(),[a,X(m),h]}).apply(this,arguments);return this._transaction.apply(this,o)},We.prototype._transaction=function(o,a,u){var h,y,m=this,w=fe.trans,k=(w&&w.db===this&&o.indexOf("!")===-1||(w=null),o.indexOf("?")!==-1);o=o.replace("!","").replace("?","");try{if(y=a.map(function(P){if(P=P instanceof m.Table?P.name:P,typeof P!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return P}),o=="r"||o===eo)h=eo;else{if(o!="rw"&&o!=to)throw new J.InvalidArgument("Invalid transaction mode: "+o);h=to}if(w){if(w.mode===eo&&h===to){if(!k)throw new J.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");w=null}w&&y.forEach(function(P){if(w&&w.storeNames.indexOf(P)===-1){if(!k)throw new J.SubTransaction("Table "+P+" not included in parent transaction.");w=null}}),k&&w&&!w.active&&(w=null)}}catch(P){return w?w._promise(null,function(O,x){x(P)}):Ve(P)}var E=(function P(O,x,D,T,I){return Q.resolve().then(function(){var R=fe.transless||fe,C=O._createTransaction(x,D,O._dbSchema,T),R=(C.explicit=!0,{trans:C,transless:R});if(T)C.idbtrans=T.idbtrans;else try{C.create(),C.idbtrans._explicit=!0,O._state.PR1398_maxLoop=3}catch(B){return B.name===qe.InvalidState&&O.isOpen()&&0<--O._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),O.close({disableAutoOpen:!1}),O.open().then(function(){return P(O,x,D,null,I)})):Ve(B)}var j,M=he(I),R=(M&&zn(),Q.follow(function(){var B;(j=I.call(C,C))&&(M?(B=ln.bind(null,null),j.then(B,B)):typeof j.next=="function"&&typeof j.throw=="function"&&(j=wo(j)))},R));return(j&&typeof j.then=="function"?Q.resolve(j).then(function(B){return C.active?B:Ve(new J.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):R.then(function(){return j})).then(function(B){return T&&C._resolve(),C._completion.then(function(){return B})}).catch(function(B){return C._reject(B),Ve(B)})})}).bind(null,this,h,y,w,u);return w?w._promise(h,E,"lock"):fe.trans?In(fe.transless,function(){return m._whenReady(E)}):this._whenReady(E)},We.prototype.table=function(o){if(p(this._allTables,o))return this._allTables[o];throw new J.InvalidTable("Table ".concat(o," does not exist"))};var Ht=We;function We(o,a){var u,h,y,m,w,k=this,E=(this._middlewares={},this.verno=0,We.dependencies),E=(this._options=a=r({addons:We.addons,autoOpen:!0,indexedDB:E.indexedDB,IDBKeyRange:E.IDBKeyRange,cache:"cloned"},a),this._deps={indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange},a.addons),P=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:pe,dbReadyPromise:null,cancelOpen:pe,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:a.autoOpen}),O=(P.dbReadyPromise=new Q(function(x){P.dbReadyResolve=x}),P.openCanceller=new Q(function(x,D){P.cancelOpen=D}),this._state=P,this.name=o,this.on=Ar(this,"populate","blocked","versionchange","close",{ready:[Ws,pe]}),this.once=function(x,D){var T=function(){for(var I=[],C=0;C<arguments.length;C++)I[C]=arguments[C];k.on(x).unsubscribe(T),D.apply(k,I)};return k.on(x,T)},this.on.ready.subscribe=W(this.on.ready.subscribe,function(x){return function(D,T){We.vip(function(){var I,C=k._state;C.openComplete?(C.dbOpenError||Q.resolve().then(D),T&&x(D)):C.onReadyBeingFired?(C.onReadyBeingFired.push(D),T&&x(D)):(x(D),I=k,T||x(function j(){I.on.ready.unsubscribe(D),I.on.ready.unsubscribe(j)}))})}}),this.Collection=(u=this,Dr(Rd.prototype,function(j,C){this.db=u;var T=sc,I=null;if(C)try{T=C()}catch(R){I=R}var C=j._ctx,j=C.table,M=j.hook.reading.fire;this._ctx={table:j,index:C.index,isPrimKey:!C.index||j.schema.primKey.keyPath&&C.index===j.schema.primKey.name,range:T,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:I,or:C.or,valueMapper:M!==ke?M:null}})),this.Table=(h=this,Dr(fc.prototype,function(x,D,T){this.db=h,this._tx=T,this.name=x,this.schema=D,this.hook=h._allTables[x]?h._allTables[x].hook:Ar(null,{creating:[gt,pe],reading:[Ae,ke],updating:[Pt,pe],deleting:[xn,pe]})})),this.Transaction=(y=this,Dr(Ud.prototype,function(x,D,T,I,C){var j=this;x!=="readonly"&&D.forEach(function(M){M=(M=T[M])==null?void 0:M.yProps,M&&(D=D.concat(M.map(function(R){return R.updatesTable})))}),this.db=y,this.mode=x,this.storeNames=D,this.schema=T,this.chromeTransactionDurability=I,this.idbtrans=null,this.on=Ar(this,"complete","error","abort"),this.parent=C||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Q(function(M,R){j._resolve=M,j._reject=R}),this._completion.then(function(){j.active=!1,j.on.complete.fire()},function(M){var R=j.active;return j.active=!1,j.on.error.fire(M),j.parent?j.parent._reject(M):R&&j.idbtrans&&j.idbtrans.abort(),Ve(M)})})),this.Version=(m=this,Dr($d.prototype,function(x){this.db=m,this._cfg={version:x,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(w=this,Dr(gc.prototype,function(x,D,T){if(this.db=w,this._ctx={table:x,index:D===":id"?null:D,or:T},this._cmp=this._ascending=Se,this._descending=function(I,C){return Se(C,I)},this._max=function(I,C){return 0<Se(I,C)?I:C},this._min=function(I,C){return Se(I,C)<0?I:C},this._IDBKeyRange=w._deps.IDBKeyRange,!this._IDBKeyRange)throw new J.MissingAPI})),this.on("versionchange",function(x){0<x.newVersion?console.warn("Another connection wants to upgrade database '".concat(k.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(k.name,"'. Closing db now to resume the delete request.")),k.close({disableAutoOpen:!1})}),this.on("blocked",function(x){!x.newVersion||x.newVersion<x.oldVersion?console.warn("Dexie.delete('".concat(k.name,"') was blocked")):console.warn("Upgrade '".concat(k.name,"' blocked by other connection holding version ").concat(x.oldVersion/10))}),this._maxKey=Pr(a.IDBKeyRange),this._createTransaction=function(x,D,T,I){return new k.Transaction(x,D,T,k._options.chromeTransactionDurability,I)},this._fireOnBlocked=function(x){k.on("blocked").fire(x),Yn.filter(function(D){return D.name===k.name&&D!==k&&!D._state.vcFired}).map(function(D){return D.on("versionchange").fire(x)})},this.use(Hd),this.use(Jd),this.use(zd),this.use(Vd),this.use(Wd),new Proxy(this,{get:function(x,D,T){var I;return D==="_vip"||(D==="table"?function(C){return $i(k.table(C),O)}:(I=Reflect.get(x,D,T))instanceof fc?$i(I,O):D==="tables"?I.map(function(C){return $i(C,O)}):D==="_createTransaction"?function(){return $i(I.apply(this,arguments),O)}:I)}}));this.vip=O,E.forEach(function(x){return x(k)})}var qi,Qn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Xd=(xo.prototype.subscribe=function(o,a,u){return this._subscribe(o&&typeof o!="function"?o:{next:o,error:a,complete:u})},xo.prototype[Qn]=function(){return this},xo);function xo(o){this._subscribe=o}try{qi={indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch{qi={indexedDB:null,IDBKeyRange:null}}function Tc(o){var a,u=!1,h=new Xd(function(y){var m=he(o),w,k=!1,E={},P={},O={get closed(){return k},unsubscribe:function(){k||(k=!0,w&&w.abort(),x&&dn.storagemutated.unsubscribe(T))}},x=(y.start&&y.start(O),!1),D=function(){return Zs(I)},T=function(C){Ki(E,C),go(P,E)&&D()},I=function(){var C,j,M;!k&&qi.indexedDB&&(E={},C={},w&&w.abort(),w=new AbortController,M=(R=>{var B=Wn();try{m&&zn();var F=cn(o,R);return F=m?F.finally(ln):F}finally{B&&Hn()}})(j={subscr:C,signal:w.signal,requery:D,querier:o,trans:null}),Promise.resolve(M).then(function(R){u=!0,a=R,k||j.signal.aborted||(E={},(B=>{for(var F in B)if(p(B,F))return;return 1})(P=C)||x||(dn(Rr,T),x=!0),Zs(function(){return!k&&y.next&&y.next(R)}))},function(R){u=!1,["DatabaseClosedError","AbortError"].includes(R==null?void 0:R.name)||k||Zs(function(){k||y.error&&y.error(R)})}))};return setTimeout(D,0),O});return h.hasValue=function(){return u},h.getValue=function(){return a},h}var Rn=Ht;function Co(o){var a=hn;try{hn=!0,dn.storagemutated.fire(o),bo(o,!0)}finally{hn=a}}v(Rn,r(r({},ue),{delete:function(o){return new Rn(o,{addons:[]}).delete()},exists:function(o){return new Rn(o,{addons:[]}).open().then(function(a){return a.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(o){try{return a=Rn.dependencies,u=a.indexedDB,a=a.IDBKeyRange,(ho(u)?Promise.resolve(u.databases()).then(function(h){return h.map(function(y){return y.name}).filter(function(y){return y!==Oi})}):fo(u,a).toCollection().primaryKeys()).then(o)}catch{return Ve(new J.MissingAPI)}var a,u},defineClass:function(){return function(o){f(this,o)}},ignoreTransaction:function(o){return fe.trans?In(fe.transless,o):o()},vip:po,async:function(o){return function(){try{var a=wo(o.apply(this,arguments));return a&&typeof a.then=="function"?a:Q.resolve(a)}catch(u){return Ve(u)}}},spawn:function(o,a,u){try{var h=wo(o.apply(u,a||[]));return h&&typeof h.then=="function"?h:Q.resolve(h)}catch(y){return Ve(y)}},currentTransaction:{get:function(){return fe.trans||null}},waitFor:function(o,a){return o=Q.resolve(typeof o=="function"?Rn.ignoreTransaction(o):o).timeout(a||6e4),fe.trans?fe.trans.waitFor(o):o},Promise:Q,debug:{get:function(){return jt},set:function(o){Qa(o)}},derive:A,extend:f,props:v,override:W,Events:Ar,on:dn,liveQuery:Tc,extendObservabilitySet:Ki,getByKeyPath:te,setByKeyPath:G,delByKeyPath:function(o,a){typeof a=="string"?G(o,a,void 0):"length"in a&&[].map.call(a,function(u){G(o,u,void 0)})},shallowClone:ye,deepClone:ge,getObjectDiff:_o,cmp:Se,asap:ae,minKey:-1/0,addons:[],connections:Yn,errnames:qe,dependencies:qi,cache:Tn,semVer:"4.3.0",version:"4.3.0".split(".").map(function(o){return parseInt(o)}).reduce(function(o,a,u){return o+a/Math.pow(10,2*u)})})),Rn.maxKey=Pr(Rn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(dn(Rr,function(o){hn||(o=new CustomEvent(io,{detail:o}),hn=!0,dispatchEvent(o),hn=!1)}),addEventListener(io,function(o){o=o.detail,hn||Co(o)}));var Zn,hn=!1,Rc=function(){};return typeof BroadcastChannel<"u"&&((Rc=function(){(Zn=new BroadcastChannel(io)).onmessage=function(o){return o.data&&Co(o.data)}})(),typeof Zn.unref=="function"&&Zn.unref(),dn(Rr,function(o){hn||Zn.postMessage(o)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(o){if(!Ht.disableBfCache&&o.persisted){jt&&console.debug("Dexie: handling persisted pagehide"),Zn!=null&&Zn.close();for(var a=0,u=Yn;a<u.length;a++)u[a].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(o){!Ht.disableBfCache&&o.persisted&&(jt&&console.debug("Dexie: handling persisted pageshow"),Rc(),Co({all:new lt(-1/0,[[]])}))})),Q.rejectionMapper=function(o,a){return!o||o instanceof Fe||o instanceof TypeError||o instanceof SyntaxError||!o.name||!Ze[o.name]?o:(a=new Ze[o.name](a||o.message,o),"stack"in o&&S(a,"stack",{get:function(){return this.inner.stack}}),a)},Qa(jt),r(Ht,Object.freeze({__proto__:null,Dexie:Ht,Entity:oc,PropModification:Ir,RangeSet:lt,add:function(o){return new Ir({add:o})},cmp:Se,default:Ht,liveQuery:Tc,mergeRanges:Lr,rangesOverlap:_c,remove:function(o){return new Ir({remove:o})},replacePrefix:function(o,a){return new Ir({replacePrefix:[o,a]})}}),{default:Ht}),Ht})})(rs)),rs.exports}var nh=th();const Jo=Zd(nh),jc=Symbol.for("Dexie"),xe=globalThis[jc]||(globalThis[jc]=Jo);if(Jo.semVer!==xe.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Jo.semVer} and ${xe.semVer}`);const{liveQuery:gn,mergeRanges:Rv,rangesOverlap:Pv,RangeSet:rh,cmp:Is,Entity:jv,PropModification:Uc,replacePrefix:Uv,add:Lv,remove:Mv,DexieYProvider:Nv}=xe;var Xo=function(t,e){return Xo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Xo(t,e)};function nn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Xo(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function ih(t,e,n,r){function i(s){return s instanceof n?s:new n(function(c){c(s)})}return new(n||(n=Promise))(function(s,c){function l(g){try{d(r.next(g))}catch(p){c(p)}}function f(g){try{d(r.throw(g))}catch(p){c(p)}}function d(g){g.done?s(g.value):i(g.value).then(l,f)}d((r=r.apply(t,e||[])).next())})}function su(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,c=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return c.next=l(0),c.throw=l(1),c.return=l(2),typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(d){return function(g){return f([d,g])}}function f(d){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,d[0]&&(n=0)),n;)try{if(r=1,i&&(s=d[0]&2?i.return:d[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,d[1])).done)return s;switch(i=0,s&&(d=[d[0]&2,s.value]),d[0]){case 0:case 1:s=d;break;case 4:return n.label++,{value:d[1],done:!1};case 5:n.label++,i=d[1],d=[0];continue;case 7:d=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(d[0]===6||d[0]===2)){n=0;continue}if(d[0]===3&&(!s||d[1]>s[0]&&d[1]<s[3])){n.label=d[1];break}if(d[0]===6&&n.label<s[1]){n.label=s[1],s=d;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(d);break}s[2]&&n.ops.pop(),n.trys.pop();continue}d=e.call(t,n)}catch(g){d=[6,g],i=0}finally{r=s=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function ar(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kn(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],c;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(l){c={error:l}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(c)throw c.error}}return s}function cr(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function rr(t){return this instanceof rr?(this.v=t,this):new rr(t)}function sh(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",c),i[Symbol.asyncIterator]=function(){return this},i;function c(b){return function(S){return Promise.resolve(S).then(b,p)}}function l(b,S){r[b]&&(i[b]=function(A){return new Promise(function(N,U){s.push([b,A,N,U])>1||f(b,A)})},S&&(i[b]=S(i[b])))}function f(b,S){try{d(r[b](S))}catch(A){v(s[0][3],A)}}function d(b){b.value instanceof rr?Promise.resolve(b.value.v).then(g,p):v(s[0][2],b)}function g(b){f("next",b)}function p(b){f("throw",b)}function v(b,S){b(S),s.shift(),s.length&&f(s[0][0],s[0][1])}}function oh(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ar=="function"?ar(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(c){return new Promise(function(l,f){c=t[s](c),i(l,f,c.done,c.value)})}}function i(s,c,l,f){Promise.resolve(f).then(function(d){s({value:d,done:l})},c)}}function Re(t){return typeof t=="function"}function xa(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Oo=xa(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function ds(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var yr=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var l=ar(c),f=l.next();!f.done;f=l.next()){var d=f.value;d.remove(this)}}catch(A){e={error:A}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}else c.remove(this);var g=this.initialTeardown;if(Re(g))try{g()}catch(A){s=A instanceof Oo?A.errors:[A]}var p=this._finalizers;if(p){this._finalizers=null;try{for(var v=ar(p),b=v.next();!b.done;b=v.next()){var S=b.value;try{Lc(S)}catch(A){s=s??[],A instanceof Oo?s=cr(cr([],Kn(s)),Kn(A.errors)):s.push(A)}}}catch(A){r={error:A}}finally{try{b&&!b.done&&(i=v.return)&&i.call(v)}finally{if(r)throw r.error}}}if(s)throw new Oo(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Lc(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&ds(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&ds(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),ou=yr.EMPTY;function au(t){return t instanceof yr||t&&"closed"in t&&Re(t.remove)&&Re(t.add)&&Re(t.unsubscribe)}function Lc(t){Re(t)?t():t.unsubscribe()}var ah={Promise:void 0},ch={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,cr([t,e],Kn(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function cu(t){ch.setTimeout(function(){throw t})}function Mc(){}function is(t){t()}var Ca=(function(t){nn(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,au(n)&&n.add(r)):r.destination=fh,r}return e.create=function(n,r,i){return new lr(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(yr),lh=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Vi(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Vi(r)}else Vi(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Vi(n)}},t})(),lr=(function(t){nn(e,t);function e(n,r,i){var s=t.call(this)||this,c;return Re(n)||!n?c={next:n??void 0,error:r??void 0,complete:i??void 0}:c=n,s.destination=new lh(c),s}return e})(Ca);function Vi(t){cu(t)}function uh(t){throw t}var fh={closed:!0,next:Mc,error:uh,complete:Mc},Ea=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function gr(t){return t}function dh(t){return t.length===0?gr:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var Xe=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=ph(e)?e:new lr(e,n,r);return is(function(){var c=i,l=c.operator,f=c.source;s.add(l?l.call(s,f):f?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=Nc(n),new n(function(i,s){var c=new lr({next:function(l){try{e(l)}catch(f){s(f),c.unsubscribe()}},error:s,complete:i});r.subscribe(c)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Ea]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return dh(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Nc(e),new e(function(r,i){var s;n.subscribe(function(c){return s=c},function(c){return i(c)},function(){return r(s)})})},t.create=function(e){return new t(e)},t})();function Nc(t){var e;return(e=t??ah.Promise)!==null&&e!==void 0?e:Promise}function hh(t){return t&&Re(t.next)&&Re(t.error)&&Re(t.complete)}function ph(t){return t&&t instanceof Ca||hh(t)&&au(t)}function yh(t){return Re(t==null?void 0:t.lift)}function xt(t){return function(e){if(yh(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function St(t,e,n,r,i){return new gh(t,e,n,r,i)}var gh=(function(t){nn(e,t);function e(n,r,i,s,c,l){var f=t.call(this,n)||this;return f.onFinalize=c,f.shouldUnsubscribe=l,f._next=r?function(d){try{r(d)}catch(g){n.error(g)}}:t.prototype._next,f._error=s?function(d){try{s(d)}catch(g){n.error(g)}finally{this.unsubscribe()}}:t.prototype._error,f._complete=i?function(){try{i()}catch(d){n.error(d)}finally{this.unsubscribe()}}:t.prototype._complete,f}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e})(Ca),mh=xa(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Bn=(function(t){nn(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new Kc(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new mh},e.prototype.next=function(n){var r=this;is(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var c=ar(r.currentObservers),l=c.next();!l.done;l=c.next()){var f=l.value;f.next(n)}}catch(d){i={error:d}}finally{try{l&&!l.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;is(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;is(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,c=i.isStopped,l=i.observers;return s||c?ou:(this.currentObservers=null,l.push(n),new yr(function(){r.currentObservers=null,ds(l,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,c=r.isStopped;i?n.error(s):c&&n.complete()},e.prototype.asObservable=function(){var n=new Xe;return n.source=this,n},e.create=function(n,r){return new Kc(n,r)},e})(Xe),Kc=(function(t){nn(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:ou},e})(Bn),Rt=(function(t){nn(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(Bn),vh={now:function(){return Date.now()}},bh=(function(t){nn(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e})(yr),Bc={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,cr([t,e],Kn(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},wh=(function(t){nn(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,c=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(c,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(c,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),Bc.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&Bc.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(c){i=!0,s=c||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ds(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e})(bh),Fc=(function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=vh.now,t})(),_h=(function(t){nn(e,t);function e(n,r){r===void 0&&(r=Fc.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e})(Fc),Oa=new _h(wh),kh=Oa,lu=new Xe(function(t){return t.complete()});function uu(t){return t&&Re(t.schedule)}function Ia(t){return t[t.length-1]}function Sh(t){return Re(Ia(t))?t.pop():void 0}function fi(t){return uu(Ia(t))?t.pop():void 0}function xh(t,e){return typeof Ia(t)=="number"?t.pop():e}var Aa=(function(t){return t&&typeof t.length=="number"&&typeof t!="function"});function fu(t){return Re(t==null?void 0:t.then)}function du(t){return Re(t[Ea])}function hu(t){return Symbol.asyncIterator&&Re(t==null?void 0:t[Symbol.asyncIterator])}function pu(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Ch(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var yu=Ch();function gu(t){return Re(t==null?void 0:t[yu])}function mu(t){return sh(this,arguments,function(){var n,r,i,s;return su(this,function(c){switch(c.label){case 0:n=t.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,rr(n.read())];case 3:return r=c.sent(),i=r.value,s=r.done,s?[4,rr(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,rr(i)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function vu(t){return Re(t==null?void 0:t.getReader)}function Tt(t){if(t instanceof Xe)return t;if(t!=null){if(du(t))return Eh(t);if(Aa(t))return Oh(t);if(fu(t))return Ih(t);if(hu(t))return bu(t);if(gu(t))return Ah(t);if(vu(t))return Dh(t)}throw pu(t)}function Eh(t){return new Xe(function(e){var n=t[Ea]();if(Re(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Oh(t){return new Xe(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function Ih(t){return new Xe(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,cu)})}function Ah(t){return new Xe(function(e){var n,r;try{for(var i=ar(t),s=i.next();!s.done;s=i.next()){var c=s.value;if(e.next(c),e.closed)return}}catch(l){n={error:l}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function bu(t){return new Xe(function(e){Th(t,e).catch(function(n){return e.error(n)})})}function Dh(t){return bu(mu(t))}function Th(t,e){var n,r,i,s;return ih(this,void 0,void 0,function(){var c,l;return su(this,function(f){switch(f.label){case 0:f.trys.push([0,5,6,11]),n=oh(t),f.label=1;case 1:return[4,n.next()];case 2:if(r=f.sent(),!!r.done)return[3,4];if(c=r.value,e.next(c),e.closed)return[2];f.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=f.sent(),i={error:l},[3,11];case 6:return f.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:f.sent(),f.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function mn(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function wu(t,e){return e===void 0&&(e=0),xt(function(n,r){n.subscribe(St(r,function(i){return mn(r,t,function(){return r.next(i)},e)},function(){return mn(r,t,function(){return r.complete()},e)},function(i){return mn(r,t,function(){return r.error(i)},e)}))})}function _u(t,e){return e===void 0&&(e=0),xt(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function Rh(t,e){return Tt(t).pipe(_u(e),wu(e))}function Ph(t,e){return Tt(t).pipe(_u(e),wu(e))}function jh(t,e){return new Xe(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function Uh(t,e){return new Xe(function(n){var r;return mn(n,e,function(){r=t[yu](),mn(n,e,function(){var i,s,c;try{i=r.next(),s=i.value,c=i.done}catch(l){n.error(l);return}c?n.complete():n.next(s)},0,!0)}),function(){return Re(r==null?void 0:r.return)&&r.return()}})}function ku(t,e){if(!t)throw new Error("Iterable cannot be null");return new Xe(function(n){mn(n,e,function(){var r=t[Symbol.asyncIterator]();mn(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function Lh(t,e){return ku(mu(t),e)}function Mh(t,e){if(t!=null){if(du(t))return Rh(t,e);if(Aa(t))return jh(t,e);if(fu(t))return Ph(t,e);if(hu(t))return ku(t,e);if(gu(t))return Uh(t,e);if(vu(t))return Lh(t,e)}throw pu(t)}function _t(t,e){return e?Mh(t,e):Tt(t)}function Zt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fi(t);return _t(t,n)}function $c(t,e){var n=Re(t)?t:function(){return t},r=function(i){return i.error(n())};return new Xe(r)}var Nh=xa(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function Un(t,e){return new Promise(function(n,r){var i=new lr({next:function(s){n(s),i.unsubscribe()},error:r,complete:function(){r(new Nh)}});t.subscribe(i)})}function Kh(t){return t instanceof Date&&!isNaN(t)}function bt(t,e){return xt(function(n,r){var i=0;n.subscribe(St(r,function(s){r.next(t.call(e,s,i++))}))})}var Bh=Array.isArray;function Fh(t,e){return Bh(e)?t.apply(void 0,cr([],Kn(e))):t(e)}function Su(t){return bt(function(e){return Fh(t,e)})}var $h=Array.isArray,qh=Object.getPrototypeOf,Vh=Object.prototype,Wh=Object.keys;function Hh(t){if(t.length===1){var e=t[0];if($h(e))return{args:e,keys:null};if(zh(e)){var n=Wh(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function zh(t){return t&&typeof t=="object"&&qh(t)===Vh}function Yh(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function Zr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fi(t),r=Sh(t),i=Hh(t),s=i.args,c=i.keys;if(s.length===0)return _t([],n);var l=new Xe(Gh(s,n,c?function(f){return Yh(c,f)}:gr));return r?l.pipe(Su(r)):l}function Gh(t,e,n){return n===void 0&&(n=gr),function(r){qc(e,function(){for(var i=t.length,s=new Array(i),c=i,l=i,f=function(g){qc(e,function(){var p=_t(t[g],e),v=!1;p.subscribe(St(r,function(b){s[g]=b,v||(v=!0,l--),l||r.next(n(s.slice()))},function(){--c||r.complete()}))},r)},d=0;d<i;d++)f(d)},r)}}function qc(t,e,n){t?mn(n,t,e):e()}function Jh(t,e,n,r,i,s,c,l){var f=[],d=0,g=0,p=!1,v=function(){p&&!f.length&&!d&&e.complete()},b=function(A){return d<r?S(A):f.push(A)},S=function(A){d++;var N=!1;Tt(n(A,g++)).subscribe(St(e,function(U){e.next(U)},function(){N=!0},void 0,function(){if(N)try{d--;for(var U=function(){var K=f.shift();c||S(K)};f.length&&d<r;)U();v()}catch(K){e.error(K)}}))};return t.subscribe(St(e,b,function(){p=!0,v()})),function(){}}function di(t,e,n){return n===void 0&&(n=1/0),Re(e)?di(function(r,i){return bt(function(s,c){return e(r,s,i,c)})(Tt(t(r,i)))},n):(typeof e=="number"&&(n=e),xt(function(r,i){return Jh(r,i,t,n)}))}function xu(t){return t===void 0&&(t=1/0),di(gr,t)}function Xh(){return xu(1)}function Vc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Xh()(_t(t,fi(t)))}var Qh=["addListener","removeListener"],Zh=["addEventListener","removeEventListener"],ep=["on","off"];function Bt(t,e,n,r){if(Re(n)&&(r=n,n=void 0),r)return Bt(t,e,n).pipe(Su(r));var i=Kn(rp(t)?Zh.map(function(l){return function(f){return t[l](e,f,n)}}):tp(t)?Qh.map(Wc(t,e)):np(t)?ep.map(Wc(t,e)):[],2),s=i[0],c=i[1];if(!s&&Aa(t))return di(function(l){return Bt(l,e,n)})(Tt(t));if(!s)throw new TypeError("Invalid event target");return new Xe(function(l){var f=function(){for(var d=[],g=0;g<arguments.length;g++)d[g]=arguments[g];return l.next(1<d.length?d:d[0])};return s(f),function(){return c(f)}})}function Wc(t,e){return function(n){return function(r){return t[n](e,r)}}}function tp(t){return Re(t.addListener)&&Re(t.removeListener)}function np(t){return Re(t.on)&&Re(t.off)}function rp(t){return Re(t.addEventListener)&&Re(t.removeEventListener)}function Cu(t,e,n){t===void 0&&(t=0),n===void 0&&(n=kh);var r=-1;return e!=null&&(uu(e)?n=e:r=e),new Xe(function(i){var s=Kh(t)?+t-n.now():t;s<0&&(s=0);var c=0;return n.schedule(function(){i.closed||(i.next(c++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function As(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fi(t),r=xh(t,1/0),i=t;return i.length?i.length===1?Tt(i[0]):xu(r)(_t(i,n)):lu}function Et(t,e){return xt(function(n,r){var i=0;n.subscribe(St(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function Qo(t){return xt(function(e,n){var r=null,i=!1,s;r=e.subscribe(St(n,void 0,void 0,function(c){s=Tt(t(c,Qo(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function Hc(t,e){return e===void 0&&(e=Oa),xt(function(n,r){var i=null,s=null,c=null,l=function(){if(i){i.unsubscribe(),i=null;var d=s;s=null,r.next(d)}};function f(){var d=c+t,g=e.now();if(g<d){i=this.schedule(void 0,d-g),r.add(i);return}l()}n.subscribe(St(r,function(d){s=d,c=e.now(),i||(i=e.schedule(f,t),r.add(i))},function(){l(),r.complete()},void 0,function(){s=i=null}))})}function tr(t){return t<=0?function(){return lu}:xt(function(e,n){var r=0;e.subscribe(St(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function ip(t){return bt(function(){return t})}function sp(t,e){return di(function(n,r){return Tt(t(n,r)).pipe(tr(1),ip(n))})}function Eu(t,e){e===void 0&&(e=Oa);var n=Cu(t,e);return sp(function(){return n})}function Ou(t,e){return e===void 0&&(e=gr),t=t??op,xt(function(n,r){var i,s=!0;n.subscribe(St(r,function(c){var l=e(c);(s||!t(i,l))&&(s=!1,i=l,r.next(c))}))})}function op(t,e){return t===e}function ap(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new Bn}:e,r=t.resetOnError,i=r===void 0?!0:r,s=t.resetOnComplete,c=s===void 0?!0:s,l=t.resetOnRefCountZero,f=l===void 0?!0:l;return function(d){var g,p,v,b=0,S=!1,A=!1,N=function(){p==null||p.unsubscribe(),p=void 0},U=function(){N(),g=v=void 0,S=A=!1},K=function(){var W=g;U(),W==null||W.unsubscribe()};return xt(function(W,L){b++,!A&&!S&&N();var ae=v=v??n();L.add(function(){b--,b===0&&!A&&!S&&(p=Io(K,f))}),ae.subscribe(L),!g&&b>0&&(g=new lr({next:function(te){return ae.next(te)},error:function(te){A=!0,N(),p=Io(U,i,te),ae.error(te)},complete:function(){S=!0,N(),p=Io(U,c),ae.complete()}}),Tt(W).subscribe(g))})(d)}}function Io(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(e===!0){t();return}if(e!==!1){var i=new lr({next:function(){i.unsubscribe(),t()}});return Tt(e.apply(void 0,cr([],Kn(n)))).subscribe(i)}}function zc(t){return Et(function(e,n){return t<=n})}function Iu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fi(t);return xt(function(r,i){(n?Vc(t,r,n):Vc(t,r)).subscribe(i)})}function ut(t,e){return xt(function(n,r){var i=null,s=0,c=!1,l=function(){return c&&!i&&r.complete()};n.subscribe(St(r,function(f){i==null||i.unsubscribe();var d=0,g=s++;Tt(t(f,g)).subscribe(i=St(r,function(p){return r.next(e?e(f,p,g,d++):p)},function(){i=null,l()}))},function(){c=!0,l()}))})}function Zo(t,e,n){var r=Re(t)||e||n?{next:t,error:e,complete:n}:t;return r?xt(function(i,s){var c;(c=r.subscribe)===null||c===void 0||c.call(r);var l=!0;i.subscribe(St(s,function(f){var d;(d=r.next)===null||d===void 0||d.call(r,f),s.next(f)},function(){var f;l=!1,(f=r.complete)===null||f===void 0||f.call(r),s.complete()},function(f){var d;l=!1,(d=r.error)===null||d===void 0||d.call(r,f),s.error(f)},function(){var f,d;l&&((f=r.unsubscribe)===null||f===void 0||f.call(r)),(d=r.finalize)===null||d===void 0||d.call(r)}))}):gr}const tn=Math.floor,ss=Math.abs,Au=(t,e)=>t<e?t:e,mr=(t,e)=>t>e?t:e,Du=t=>t!==0?t<0:1/t<0,Yc=1,Gc=2,Ao=4,Do=8,ei=32,en=64,kt=128,Ds=31,ea=63,Mn=127,cp=2147483647,Tu=Number.MAX_SAFE_INTEGER,lp=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&tn(t)===t),Fn=()=>new Set,To=t=>t[t.length-1],up=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},_n=Array.from,fp=Array.isArray,dp=t=>t.toLowerCase(),hp=/^\s*/g,pp=t=>t.replace(hp,""),yp=/([A-Z])/g,Jc=(t,e)=>pp(t.replace(yp,n=>`${e}${dp(n)}`)),gp=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},ti=typeof TextEncoder<"u"?new TextEncoder:null,mp=t=>ti.encode(t),vp=ti?mp:gp;let Wr=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Wr&&Wr.decode(new Uint8Array).length===1&&(Wr=null);class vr{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const br=()=>new vr,bp=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},wt=t=>{const e=new Uint8Array(bp(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},wp=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(mr(n,e)*2),t.cpos=0)},nt=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},ta=nt,ve=(t,e)=>{for(;e>Mn;)nt(t,kt|Mn&e),e=tn(e/128);nt(t,Mn&e)},Da=(t,e)=>{const n=Du(e);for(n&&(e=-e),nt(t,(e>ea?kt:0)|(n?en:0)|ea&e),e=tn(e/64);e>0;)nt(t,(e>Mn?kt:0)|Mn&e),e=tn(e/128)},na=new Uint8Array(3e4),_p=na.length/3,kp=(t,e)=>{if(e.length<_p){const n=ti.encodeInto(e,na).written||0;ve(t,n);for(let r=0;r<n;r++)nt(t,na[r])}else it(t,vp(e))},Sp=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;ve(t,r);for(let i=0;i<r;i++)nt(t,n.codePointAt(i))},Ot=ti&&ti.encodeInto?kp:Sp,xp=(t,e)=>hi(t,wt(e)),hi=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=Au(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(mr(n*2,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},it=(t,e)=>{ve(t,e.byteLength),hi(t,e)},Ts=(t,e)=>{wp(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Cp=(t,e)=>Ts(t,4).setFloat32(0,e,!1),Ep=(t,e)=>Ts(t,8).setFloat64(0,e,!1),Op=(t,e)=>Ts(t,8).setBigInt64(0,e,!1),Xc=(t,e)=>Ts(t,8).setBigUint64(0,e,!1),Qc=new DataView(new ArrayBuffer(4)),Ip=t=>(Qc.setFloat32(0,t),Qc.getFloat32(0)===t),vn=(t,e)=>{switch(typeof e){case"string":nt(t,119),Ot(t,e);break;case"number":lp(e)&&ss(e)<=cp?(nt(t,125),Da(t,e)):Ip(e)?(nt(t,124),Cp(t,e)):(nt(t,123),Ep(t,e));break;case"bigint":nt(t,122),Op(t,e);break;case"object":if(e===null)nt(t,126);else if(fp(e)){nt(t,117),ve(t,e.length);for(let n=0;n<e.length;n++)vn(t,e[n])}else if(e instanceof Uint8Array)nt(t,116),it(t,e);else{nt(t,118);const n=Object.keys(e);ve(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];Ot(t,i),vn(t,e[i])}}break;case"boolean":nt(t,e?120:121);break;default:nt(t,127)}};class Zc extends vr{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ve(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const el=t=>{t.count>0&&(Da(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ve(t.encoder,t.count-2))};class os{constructor(){this.encoder=new vr,this.s=0,this.count=0}write(e){this.s===e?this.count++:(el(this),this.count=1,this.s=e)}toUint8Array(){return el(this),wt(this.encoder)}}const tl=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Da(t.encoder,e),t.count>1&&ve(t.encoder,t.count-2)}};class Ro{constructor(){this.encoder=new vr,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(tl(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return tl(this),wt(this.encoder)}}class Ap{constructor(){this.sarr=[],this.s="",this.lensE=new os}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new vr;return this.sarr.push(this.s),this.s="",Ot(e,this.sarr.join("")),hi(e,this.lensE.toUint8Array()),wt(e)}}const kn=t=>new Error(t),Ft=()=>{throw kn("Method unimplemented")},$t=()=>{throw kn("Unexpected case")},Ru=kn("Unexpected end of array"),Pu=kn("Integer out of Range");class wr{constructor(e){this.arr=e,this.pos=0}}const pi=t=>new wr(t),ju=t=>t.pos!==t.arr.length,Dp=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},st=t=>Dp(t,je(t)),ur=t=>t.arr[t.pos++],je=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&Mn)*n,n*=128,i<kt)return e;if(e>Tu)throw Pu}throw Ru},Ta=t=>{let e=t.arr[t.pos++],n=e&ea,r=64;const i=(e&en)>0?-1:1;if((e&kt)===0)return i*n;const s=t.arr.length;for(;t.pos<s;){if(e=t.arr[t.pos++],n=n+(e&Mn)*r,r*=128,e<kt)return i*n;if(n>Tu)throw Pu}throw Ru},Tp=t=>{let e=je(t);if(e===0)return"";{let n=String.fromCodePoint(ur(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(ur(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Rp=t=>Wr.decode(st(t)),It=Wr?Rp:Tp,Rs=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},Pp=t=>Rs(t,4).getFloat32(0,!1),jp=t=>Rs(t,8).getFloat64(0,!1),Up=t=>Rs(t,8).getBigInt64(0,!1),nl=t=>Rs(t,8).getBigUint64(0,!1),Lp=[t=>{},t=>null,Ta,Pp,jp,Up,t=>!1,t=>!0,It,t=>{const e=je(t),n={};for(let r=0;r<e;r++){const i=It(t);n[i]=bn(t)}return n},t=>{const e=je(t),n=[];for(let r=0;r<e;r++)n.push(bn(t));return n},st],bn=t=>Lp[127-ur(t)](t);class rl extends wr{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),ju(this)?this.count=je(this)+1:this.count=-1),this.count--,this.s}}class as extends wr{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Ta(this);const e=Du(this.s);this.count=1,e&&(this.s=-this.s,this.count=je(this)+2)}return this.count--,this.s}}class Po extends wr{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Ta(this),n=e&1;this.diff=tn(e/2),this.count=1,n&&(this.count=je(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Mp{constructor(e){this.decoder=new as(e),this.str=It(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const pt=()=>new Map,ra=t=>{const e=pt();return t.forEach((n,r)=>{e.set(r,n)}),e},rn=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Np=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},Kp=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1};class Bp{constructor(){this._observers=pt()}on(e,n){return rn(this._observers,e,Fn).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return _n((this._observers.get(e)||pt()).values()).forEach(r=>r(...n))}destroy(){this._observers=pt()}}class Fp{constructor(){this._observers=pt()}on(e,n){rn(this._observers,e,Fn).add(n)}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return _n((this._observers.get(e)||pt()).values()).forEach(r=>r(...n))}destroy(){this._observers=pt()}}const $p=crypto.getRandomValues.bind(crypto),Uu=()=>$p(new Uint32Array(1))[0],qp="10000000-1000-4000-8000"+-1e11,Vp=()=>qp.replace(/[018]/g,t=>(t^Uu()&15>>t/4).toString(16)),hs=Date.now,il=t=>new Promise(t);Promise.all.bind(Promise);const sl=t=>t===void 0?null:t;class Wp{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Lu=new Wp,Hp=!0;try{typeof localStorage<"u"&&localStorage&&(Lu=localStorage,Hp=!1)}catch{}const zp=Lu,Yp=Object.assign,Mu=Object.keys,Gp=(t,e)=>{for(const n in t)e(t[n],n)},ol=t=>Mu(t).length,al=t=>Mu(t).length,Jp=t=>{for(const e in t)return!1;return!0},Xp=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Nu=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Qp=(t,e)=>t===e||al(t)===al(e)&&Xp(t,(n,r)=>(n!==void 0||Nu(e,r))&&e[r]===n),Zp=Object.freeze,Ku=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Ku(t[e])}return Zp(t)},cl=Symbol("Equality"),Ra=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Ra(t,e,n+1)}},Hr=(t,e)=>{if(t===e)return!0;if(t==null||e==null||t.constructor!==e.constructor)return!1;if(t[cl]!=null)return t[cl](e);switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:{if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break}case Set:{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break}case Map:{if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!Hr(t.get(n),e.get(n)))return!1;break}case Object:if(ol(t)!==ol(e))return!1;for(const n in t)if(!Nu(t,n)||!Hr(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Hr(t[n],e[n]))return!1;break;default:return!1}return!0},ey=(t,e)=>e.includes(t);var Bu={};const ni=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Mt;const ty=()=>{if(Mt===void 0)if(ni){Mt=pt();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Mt.set(e,""),e=r):e!==null&&(Mt.set(e,r),e=null)}e!==null&&Mt.set(e,"")}else typeof location=="object"?(Mt=pt(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Mt.set(`--${Jc(e,"-")}`,n),Mt.set(`-${Jc(e,"-")}`,n)}})):Mt=pt();return Mt},ia=t=>ty().has(t),ps=t=>sl(ni?Bu[t.toUpperCase().replaceAll("-","_")]:zp.getItem(t)),Fu=t=>ia("--"+t)||ps(t)!==null;Fu("production");const ny=ni&&ey(Bu.FORCE_COLOR,["true","1","2"]),ry=ny||!ia("--no-colors")&&!Fu("no-color")&&(!ni||process.stdout.isTTY)&&(!ni||ia("--color")||ps("COLORTERM")!==null||(ps("TERM")||"").includes("color"));class iy{constructor(e,n){this.left=e,this.right=n}}const zt=(t,e)=>new iy(t,e);typeof DOMParser<"u"&&new DOMParser;const sy=t=>Np(t,(e,n)=>`${n}:${e};`).join(""),sn=Symbol,$u=sn(),qu=sn(),oy=sn(),ay=sn(),cy=sn(),Vu=sn(),ly=sn(),Pa=sn(),uy=sn(),fy=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const s=t[r];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const s=t[r];s instanceof Symbol||n.push(s)}return n},dy={[$u]:zt("font-weight","bold"),[qu]:zt("font-weight","normal"),[oy]:zt("color","blue"),[cy]:zt("color","green"),[ay]:zt("color","grey"),[Vu]:zt("color","red"),[ly]:zt("color","purple"),[Pa]:zt("color","orange"),[uy]:zt("color","black")},hy=t=>{var c;t.length===1&&((c=t[0])==null?void 0:c.constructor)===Function&&(t=t[0]());const e=[],n=[],r=pt();let i=[],s=0;for(;s<t.length;s++){const l=t[s],f=dy[l];if(f!==void 0)r.set(f.left,f.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){const d=sy(r);s>0||d.length>0?(e.push("%c"+l),n.push(d)):e.push(l)}else break}}for(s>0&&(i=n,i.unshift(e.join("")));s<t.length;s++){const l=t[s];l instanceof Symbol||i.push(l)}return i},Wu=ry?hy:fy,py=(...t)=>{console.log(...Wu(t)),Hu.forEach(e=>e.print(t))},yy=(...t)=>{console.warn(...Wu(t)),t.unshift(Pa),Hu.forEach(e=>e.print(t))},Hu=Fn(),zu=t=>({[Symbol.iterator](){return this},next:t}),gy=(t,e)=>zu(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),jo=(t,e)=>zu(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class Yu{constructor(e,n){this.clock=e,this.len=n}}class Ps{constructor(){this.clients=new Map}}const Gu=(t,e,n)=>e.clients.forEach((r,i)=>{const s=t.doc.store.clients.get(i);if(s!=null){const c=s[s.length-1],l=c.id.clock+c.length;for(let f=0,d=r[f];f<r.length&&d.clock<l;d=r[++f])sf(t,s,d.clock,d.len,n)}}),my=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=tn((n+r)/2),s=t[i],c=s.clock;if(c<=e){if(e<c+s.len)return i;n=i+1}else r=i-1}return null},Ju=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&my(n,e.clock)!==null},ja=t=>{t.clients.forEach(e=>{e.sort((i,s)=>i.clock-s.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],s=e[n];i.clock+i.len>=s.clock?i.len=mr(i.len,s.clock+s.len-i.clock):(r<n&&(e[r]=s),r++)}e.length=r})},vy=t=>{const e=new Ps;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let c=n+1;c<t.length;c++)up(s,t[c].clients.get(i)||[]);e.clients.set(i,s)}});return ja(e),e},ys=(t,e,n,r)=>{rn(t.clients,e,()=>[]).push(new Yu(n,r))},Ua=(t,e)=>{ve(t.restEncoder,e.clients.size),_n(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),ve(t.restEncoder,n);const i=r.length;ve(t.restEncoder,i);for(let s=0;s<i;s++){const c=r[s];t.writeDsClock(c.clock),t.writeDsLen(c.len)}})},by=t=>{const e=new Ps,n=je(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=je(t.restDecoder),s=je(t.restDecoder);if(s>0){const c=rn(e.clients,i,()=>[]);for(let l=0;l<s;l++)c.push(new Yu(t.readDsClock(),t.readDsLen()))}}return e},ll=(t,e,n)=>{const r=new Ps,i=je(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const c=je(t.restDecoder),l=je(t.restDecoder),f=n.clients.get(c)||[],d=rt(n,c);for(let g=0;g<l;g++){const p=t.readDsClock(),v=p+t.readDsLen();if(p<d){d<v&&ys(r,c,d,v-d);let b=qt(f,p),S=f[b];for(!S.deleted&&S.id.clock<p&&(f.splice(b+1,0,ks(e,S,p-S.id.clock)),b++);b<f.length&&(S=f[b++],S.id.clock<v);)S.deleted||(v<S.id.clock+S.length&&f.splice(b,0,ks(e,S,v-S.id.clock)),S.delete(e))}else ys(r,c,p,v-p)}}if(r.clients.size>0){const s=new js;return ve(s.restEncoder,0),Ua(s,r),s.toUint8Array()}return null},Xu=Uu;class _r extends Bp{constructor({guid:e=Vp(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:s=null,autoLoad:c=!1,shouldLoad:l=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Xu(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new nf,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=c,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=il(d=>{this.on("load",()=>{this.isLoaded=!0,d(this)})});const f=()=>il(d=>{const g=p=>{(p===void 0||p===!0)&&(this.off("sync",g),d())};this.on("sync",g)});this.on("sync",d=>{d===!1&&this.isSynced&&(this.whenSynced=f()),this.isSynced=d===void 0||d===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=f()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Ue(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(_n(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Ue(this,e,n)}get(e,n=ot){const r=rn(this.share,e,()=>{const s=new n;return s._integrate(this,null),s}),i=r.constructor;if(n!==ot&&i!==n)if(i===ot){const s=new n;s._map=r._map,r._map.forEach(c=>{for(;c!==null;c=c.left)c.parent=s}),s._start=r._start;for(let c=s._start;c!==null;c=c.right)c.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,sr)}getText(e=""){return this.get(e,dr)}getMap(e=""){return this.get(e,fr)}getXmlElement(e=""){return this.get(e,hr)}getXmlFragment(e=""){return this.get(e,$n)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,_n(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new _r({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Ue(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class wy{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=je(this.restDecoder),this.dsCurrVal}readDsLen(){const e=je(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class ri extends wy{constructor(e){super(e),this.keys=[],je(e),this.keyClockDecoder=new Po(st(e)),this.clientDecoder=new as(st(e)),this.leftClockDecoder=new Po(st(e)),this.rightClockDecoder=new Po(st(e)),this.infoDecoder=new rl(st(e),ur),this.stringDecoder=new Mp(st(e)),this.parentInfoDecoder=new rl(st(e),ur),this.typeRefDecoder=new as(st(e)),this.lenDecoder=new as(st(e))}readLeftID(){return new ir(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ir(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return bn(this.restDecoder)}readBuf(){return st(this.restDecoder)}readJSON(){return bn(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class _y{constructor(){this.restEncoder=br()}toUint8Array(){return wt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ve(this.restEncoder,e)}writeDsLen(e){ve(this.restEncoder,e)}}class ky extends _y{writeLeftID(e){ve(this.restEncoder,e.client),ve(this.restEncoder,e.clock)}writeRightID(e){ve(this.restEncoder,e.client),ve(this.restEncoder,e.clock)}writeClient(e){ve(this.restEncoder,e)}writeInfo(e){ta(this.restEncoder,e)}writeString(e){Ot(this.restEncoder,e)}writeParentInfo(e){ve(this.restEncoder,e?1:0)}writeTypeRef(e){ve(this.restEncoder,e)}writeLen(e){ve(this.restEncoder,e)}writeAny(e){vn(this.restEncoder,e)}writeBuf(e){it(this.restEncoder,e)}writeJSON(e){Ot(this.restEncoder,JSON.stringify(e))}writeKey(e){Ot(this.restEncoder,e)}}class Qu{constructor(){this.restEncoder=br(),this.dsCurrVal=0}toUint8Array(){return wt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,ve(this.restEncoder,n)}writeDsLen(e){e===0&&$t(),ve(this.restEncoder,e-1),this.dsCurrVal+=e}}class js extends Qu{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Ro,this.clientEncoder=new os,this.leftClockEncoder=new Ro,this.rightClockEncoder=new Ro,this.infoEncoder=new Zc(ta),this.stringEncoder=new Ap,this.parentInfoEncoder=new Zc(ta),this.typeRefEncoder=new os,this.lenEncoder=new os}toUint8Array(){const e=br();return ve(e,0),it(e,this.keyClockEncoder.toUint8Array()),it(e,this.clientEncoder.toUint8Array()),it(e,this.leftClockEncoder.toUint8Array()),it(e,this.rightClockEncoder.toUint8Array()),it(e,wt(this.infoEncoder)),it(e,this.stringEncoder.toUint8Array()),it(e,wt(this.parentInfoEncoder)),it(e,this.typeRefEncoder.toUint8Array()),it(e,this.lenEncoder.toUint8Array()),hi(e,wt(this.restEncoder)),wt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){vn(this.restEncoder,e)}writeBuf(e){it(this.restEncoder,e)}writeJSON(e){vn(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const Sy=(t,e,n,r)=>{r=mr(r,e[0].id.clock);const i=qt(e,r);ve(t.restEncoder,e.length-i),t.writeClient(n),ve(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let c=i+1;c<e.length;c++)e[c].write(t,0)},Zu=(t,e,n)=>{const r=new Map;n.forEach((i,s)=>{rt(e,s)>i&&r.set(s,i)}),La(e).forEach((i,s)=>{n.has(s)||r.set(s,0)}),ve(t.restEncoder,r.size),_n(r.entries()).sort((i,s)=>s[0]-i[0]).forEach(([i,s])=>{Sy(t,e.clients.get(i),i,s)})},xy=(t,e)=>{const n=pt(),r=je(t.restDecoder);for(let i=0;i<r;i++){const s=je(t.restDecoder),c=new Array(s),l=t.readClient();let f=je(t.restDecoder);n.set(l,{i:0,refs:c});for(let d=0;d<s;d++){const g=t.readInfo();switch(Ds&g){case 0:{const p=t.readLen();c[d]=new At(Ie(l,f),p),f+=p;break}case 10:{const p=je(t.restDecoder);c[d]=new Dt(Ie(l,f),p),f+=p;break}default:{const p=(g&(en|kt))===0,v=new Je(Ie(l,f),null,(g&kt)===kt?t.readLeftID():null,null,(g&en)===en?t.readRightID():null,p?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,p&&(g&ei)===ei?t.readString():null,Ef(t,g));c[d]=v,f+=v.length}}}}return n},Cy=(t,e,n)=>{const r=[];let i=_n(n.keys()).sort((b,S)=>b-S);if(i.length===0)return null;const s=()=>{if(i.length===0)return null;let b=n.get(i[i.length-1]);for(;b.refs.length===b.i;)if(i.pop(),i.length>0)b=n.get(i[i.length-1]);else return null;return b};let c=s();if(c===null)return null;const l=new nf,f=new Map,d=(b,S)=>{const A=f.get(b);(A==null||A>S)&&f.set(b,S)};let g=c.refs[c.i++];const p=new Map,v=()=>{for(const b of r){const S=b.id.client,A=n.get(S);A?(A.i--,l.clients.set(S,A.refs.slice(A.i)),n.delete(S),A.i=0,A.refs=[]):l.clients.set(S,[b]),i=i.filter(N=>N!==S)}r.length=0};for(;;){if(g.constructor!==Dt){const S=rn(p,g.id.client,()=>rt(e,g.id.client))-g.id.clock;if(S<0)r.push(g),d(g.id.client,g.id.clock-1),v();else{const A=g.getMissing(t,e);if(A!==null){r.push(g);const N=n.get(A)||{refs:[],i:0};if(N.refs.length===N.i)d(A,rt(e,A)),v();else{g=N.refs[N.i++];continue}}else(S===0||S<g.length)&&(g.integrate(t,S),p.set(g.id.client,g.id.clock+g.length))}}if(r.length>0)g=r.pop();else if(c!==null&&c.i<c.refs.length)g=c.refs[c.i++];else{if(c=s(),c===null)break;g=c.refs[c.i++]}}if(l.clients.size>0){const b=new js;return Zu(b,l,new Map),ve(b.restEncoder,0),{missing:f,update:b.toUint8Array()}}return null},Ey=(t,e)=>Zu(t,e.doc.store,e.beforeState),Oy=(t,e,n,r=new ri(t))=>Ue(e,i=>{i.local=!1;let s=!1;const c=i.doc,l=c.store,f=xy(r,c),d=Cy(i,l,f),g=l.pendingStructs;if(g){for(const[v,b]of g.missing)if(b<rt(l,v)){s=!0;break}if(d){for(const[v,b]of d.missing){const S=g.missing.get(v);(S==null||S>b)&&g.missing.set(v,b)}g.update=gs([g.update,d.update])}}else l.pendingStructs=d;const p=ll(r,i,l);if(l.pendingDs){const v=new ri(pi(l.pendingDs));je(v.restDecoder);const b=ll(v,i,l);p&&b?l.pendingDs=gs([p,b]):l.pendingDs=p||b}else l.pendingDs=p;if(s){const v=l.pendingStructs.update;l.pendingStructs=null,ef(i.doc,v)}},n,!1),ef=(t,e,n,r=ri)=>{const i=pi(e);Oy(i,t,n,new r(i))};class Iy{constructor(){this.l=[]}}const ul=()=>new Iy,fl=(t,e)=>t.l.push(e),dl=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},tf=(t,e,n)=>Ra(t.l,[e,n]);class ir{constructor(e,n){this.client=e,this.clock=n}}const Wi=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Ie=(t,e)=>new ir(t,e),Ay=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw $t()},nr=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Ju(e.ds,t.id),sa=(t,e)=>{const n=rn(t.meta,sa,Fn),r=t.doc.store;n.has(e)||(e.sv.forEach((i,s)=>{i<rt(r,s)&&Sn(t,Ie(s,i))}),Gu(t,e.ds,i=>{}),n.add(e))};class nf{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const La=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},rt=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},rf=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw $t()}n.push(e)},qt=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let c=tn(e/(s+i.length-1)*r);for(;n<=r;){if(i=t[c],s=i.id.clock,s<=e){if(e<s+i.length)return c;n=c+1}else r=c-1;c=tn((n+r)/2)}throw $t()},Dy=(t,e)=>{const n=t.clients.get(e.client);return n[qt(n,e.clock)]},Uo=Dy,oa=(t,e,n)=>{const r=qt(e,n),i=e[r];return i.id.clock<n&&i instanceof Je?(e.splice(r+1,0,ks(t,i,n-i.id.clock)),r+1):r},Sn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[oa(t,n,e.clock)]},hl=(t,e,n)=>{const r=e.clients.get(n.client),i=qt(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==At&&r.splice(i+1,0,ks(t,s,n.clock-s.id.clock+1)),s},Ty=(t,e,n)=>{const r=t.clients.get(e.id.client);r[qt(r,e.id.clock)]=n},sf=(t,e,n,r,i)=>{if(r===0)return;const s=n+r;let c=oa(t,e,n),l;do l=e[c++],s<l.id.clock+l.length&&oa(t,e,s),i(l);while(c<e.length&&e[c].id.clock<s)};class Ry{constructor(e,n,r){this.doc=e,this.deleteSet=new Ps,this.beforeState=La(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const pl=(t,e)=>e.deleteSet.clients.size===0&&!Kp(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(ja(e.deleteSet),Ey(t,e),Ua(t,e.deleteSet),!0),yl=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&rn(t.changed,e,Fn).add(n)},cs=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof Je&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const s=e-i;return s&&t.splice(e+1-s,s),s},Py=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const s=e.clients.get(r);for(let c=i.length-1;c>=0;c--){const l=i[c],f=l.clock+l.len;for(let d=qt(s,l.clock),g=s[d];d<s.length&&g.id.clock<f;g=s[++d]){const p=s[d];if(l.clock+l.len<=p.id.clock)break;p instanceof Je&&p.deleted&&!p.keep&&n(p)&&p.gc(e,!1)}}}},jy=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let s=n.length-1;s>=0;s--){const c=n[s],l=Au(i.length-1,1+qt(i,c.clock+c.len-1));for(let f=l,d=i[f];f>0&&d.id.clock>=c.clock;d=i[f])f-=1+cs(i,f)}})},of=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,c=n._mergeStructs;try{ja(s),n.afterState=La(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const l=[];n.changed.forEach((f,d)=>l.push(()=>{(d._item===null||!d._item.deleted)&&d._callObserver(n,f)})),l.push(()=>{n.changedParentTypes.forEach((f,d)=>{d._dEH.l.length>0&&(d._item===null||!d._item.deleted)&&(f=f.filter(g=>g.target._item===null||!g.target._item.deleted),f.forEach(g=>{g.currentTarget=d,g._path=null}),f.sort((g,p)=>g.path.length-p.path.length),tf(d._dEH,f,n))})}),l.push(()=>r.emit("afterTransaction",[n,r])),Ra(l,[]),n._needFormattingCleanup&&Qy(n)}finally{r.gc&&Py(s,i,r.gcFilter),jy(s,i),n.afterState.forEach((g,p)=>{const v=n.beforeState.get(p)||0;if(v!==g){const b=i.clients.get(p),S=mr(qt(b,v),1);for(let A=b.length-1;A>=S;)A-=1+cs(b,A)}});for(let g=c.length-1;g>=0;g--){const{client:p,clock:v}=c[g].id,b=i.clients.get(p),S=qt(b,v);S+1<b.length&&cs(b,S+1)>1||S>0&&cs(b,S)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(py(Pa,$u,"[yjs] ",qu,Vu,"Changed the client-id because another client seems to be using it."),r.clientID=Xu()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const g=new ky;pl(g,n)&&r.emit("update",[g.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const g=new js;pl(g,n)&&r.emit("updateV2",[g.toUint8Array(),n.origin,r,n])}const{subdocsAdded:l,subdocsLoaded:f,subdocsRemoved:d}=n;(l.size>0||d.size>0||f.size>0)&&(l.forEach(g=>{g.clientID=r.clientID,g.collectionid==null&&(g.collectionid=r.collectionid),r.subdocs.add(g)}),d.forEach(g=>r.subdocs.delete(g)),r.emit("subdocs",[{loaded:f,added:l,removed:d},r,n]),d.forEach(g=>g.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):of(t,e+1)}}},Ue=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,c=null;t._transaction===null&&(s=!0,t._transaction=new Ry(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{c=e(t._transaction)}finally{if(s){const l=t._transaction===i[0];t._transaction=null,l&&of(i,0)}}return c};function*Uy(t){const e=je(t.restDecoder);for(let n=0;n<e;n++){const r=je(t.restDecoder),i=t.readClient();let s=je(t.restDecoder);for(let c=0;c<r;c++){const l=t.readInfo();if(l===10){const f=je(t.restDecoder);yield new Dt(Ie(i,s),f),s+=f}else if((Ds&l)!==0){const f=(l&(en|kt))===0,d=new Je(Ie(i,s),null,(l&kt)===kt?t.readLeftID():null,null,(l&en)===en?t.readRightID():null,f?t.readParentInfo()?t.readString():t.readLeftID():null,f&&(l&ei)===ei?t.readString():null,Ef(t,l));yield d,s+=d.length}else{const f=t.readLen();yield new At(Ie(i,s),f),s+=f}}}}class af{constructor(e,n){this.gen=Uy(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Dt);return this.curr}}class Ly{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const cf=(t,e=Qu,n=ri)=>{const r=new e,i=new af(new n(pi(t)),!1);let s=i.curr;if(s!==null){let c=0,l=s.id.client,f=s.id.clock!==0,d=f?0:s.id.clock+s.length;for(;s!==null;s=i.next())l!==s.id.client&&(d!==0&&(c++,ve(r.restEncoder,l),ve(r.restEncoder,d)),l=s.id.client,d=0,f=s.id.clock!==0),s.constructor===Dt&&(f=!0),f||(d=s.id.clock+s.length);d!==0&&(c++,ve(r.restEncoder,l),ve(r.restEncoder,d));const g=br();return ve(g,c),xp(g,r.restEncoder),r.restEncoder=g,r.toUint8Array()}else return ve(r.restEncoder,0),r.toUint8Array()},My=(t,e)=>{if(t.constructor===At){const{client:n,clock:r}=t.id;return new At(Ie(n,r+e),t.length-e)}else if(t.constructor===Dt){const{client:n,clock:r}=t.id;return new Dt(Ie(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new Je(Ie(r,i+e),null,Ie(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},gs=(t,e=ri,n=js)=>{if(t.length===1)return t[0];const r=t.map(g=>new e(pi(g)));let i=r.map(g=>new af(g,!0)),s=null;const c=new n,l=new Ly(c);for(;i=i.filter(v=>v.curr!==null),i.sort((v,b)=>{if(v.curr.id.client===b.curr.id.client){const S=v.curr.id.clock-b.curr.id.clock;return S===0?v.curr.constructor===b.curr.constructor?0:v.curr.constructor===Dt?1:-1:S}else return b.curr.id.client-v.curr.id.client}),i.length!==0;){const g=i[0],p=g.curr.id.client;if(s!==null){let v=g.curr,b=!1;for(;v!==null&&v.id.clock+v.length<=s.struct.id.clock+s.struct.length&&v.id.client>=s.struct.id.client;)v=g.next(),b=!0;if(v===null||v.id.client!==p||b&&v.id.clock>s.struct.id.clock+s.struct.length)continue;if(p!==s.struct.id.client)Mr(l,s.struct,s.offset),s={struct:v,offset:0},g.next();else if(s.struct.id.clock+s.struct.length<v.id.clock)if(s.struct.constructor===Dt)s.struct.length=v.id.clock+v.length-s.struct.id.clock;else{Mr(l,s.struct,s.offset);const S=v.id.clock-s.struct.id.clock-s.struct.length;s={struct:new Dt(Ie(p,s.struct.id.clock+s.struct.length),S),offset:0}}else{const S=s.struct.id.clock+s.struct.length-v.id.clock;S>0&&(s.struct.constructor===Dt?s.struct.length-=S:v=My(v,S)),s.struct.mergeWith(v)||(Mr(l,s.struct,s.offset),s={struct:v,offset:0},g.next())}}else s={struct:g.curr,offset:0},g.next();for(let v=g.curr;v!==null&&v.id.client===p&&v.id.clock===s.struct.id.clock+s.struct.length&&v.constructor!==Dt;v=g.next())Mr(l,s.struct,s.offset),s={struct:v,offset:0}}s!==null&&(Mr(l,s.struct,s.offset),s=null),Ny(l);const f=r.map(g=>by(g)),d=vy(f);return Ua(c,d),c.toUint8Array()},lf=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:wt(t.encoder.restEncoder)}),t.encoder.restEncoder=br(),t.written=0)},Mr=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&lf(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ve(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Ny=t=>{lf(t);const e=t.encoder.restEncoder;ve(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];ve(e,r.written),hi(e,r.restEncoder)}},gl="You must not compute changes after the event-handler fired.";class Us{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Ky(this.currentTarget,this.target))}deletes(e){return Ju(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw kn(gl);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const s=n._map.get(i);let c,l;if(this.adds(s)){let f=s.left;for(;f!==null&&this.adds(f);)f=f.left;if(this.deletes(s))if(f!==null&&this.deletes(f))c="delete",l=To(f.content.getContent());else return;else f!==null&&this.deletes(f)?(c="update",l=To(f.content.getContent())):(c="add",l=void 0)}else if(this.deletes(s))c="delete",l=To(s.content.getContent());else return;e.set(i,{action:c,oldValue:l})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw kn(gl);const n=this.target,r=Fn(),i=Fn(),s=[];if(e={added:r,deleted:i,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let l=null;const f=()=>{l&&s.push(l)};for(let d=n._start;d!==null;d=d.right)d.deleted?this.deletes(d)&&!this.adds(d)&&((l===null||l.delete===void 0)&&(f(),l={delete:0}),l.delete+=d.length,i.add(d)):this.adds(d)?((l===null||l.insert===void 0)&&(f(),l={insert:[]}),l.insert=l.insert.concat(d.content.getContent()),r.add(d)):((l===null||l.retain===void 0)&&(f(),l={retain:0}),l.retain+=d.length);l!==null&&l.retain===void 0&&f()}this._changes=e}return e}}const Ky=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},dt=()=>{yy("Invalid access: Add Yjs type to a document before reading data.")},uf=80;let Ma=0;class By{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Ma++}}const Fy=t=>{t.timestamp=Ma++},ff=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Ma++},$y=(t,e,n)=>{if(t.length>=uf){const r=t.reduce((i,s)=>i.timestamp<s.timestamp?i:s);return ff(r,e,n),r}else{const r=new By(e,n);return t.push(r),r}},Ls=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((s,c)=>ss(e-s.index)<ss(e-c.index)?s:c);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,Fy(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&ss(n.index-i)<r.parent.length/uf?(ff(n,r,i),n):$y(t._searchMarker,r,i)},ii=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let s=i.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(i.index-=s.length);if(s===null||s.marker===!0){t.splice(r,1);continue}i.p=s,s.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=mr(e,i.index+n))}},Ms=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;rn(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;tf(r._eH,n,e)};class ot{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ul(),this._dEH=ul(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Ft()}clone(){throw Ft()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){fl(this._eH,e)}observeDeep(e){fl(this._dEH,e)}unobserve(e){dl(this._eH,e)}unobserveDeep(e){dl(this._dEH,e)}toJSON(){}}const df=(t,e,n)=>{t.doc??dt(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){const c=s.content.getContent();if(c.length<=e)e-=c.length;else{for(let l=e;l<c.length&&r>0;l++)i.push(c[l]),r--;e=0}}s=s.right}return i},hf=t=>{t.doc??dt();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},si=(t,e)=>{let n=0,r=t._start;for(t.doc??dt();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let s=0;s<i.length;s++)e(i[s],n++,t)}r=r.right}},pf=(t,e)=>{const n=[];return si(t,(r,i)=>{n.push(e(r,i,t))}),n},qy=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},yf=(t,e)=>{t.doc??dt();const n=Ls(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},ms=(t,e,n,r)=>{let i=n;const s=t.doc,c=s.clientID,l=s.store,f=n===null?e._start:n.right;let d=[];const g=()=>{d.length>0&&(i=new Je(Ie(c,rt(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new qn(d)),i.integrate(t,0),d=[])};r.forEach(p=>{if(p===null)d.push(p);else switch(p.constructor){case Number:case Object:case Boolean:case Array:case String:d.push(p);break;default:switch(g(),p.constructor){case Uint8Array:case ArrayBuffer:i=new Je(Ie(c,rt(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new yi(new Uint8Array(p))),i.integrate(t,0);break;case _r:i=new Je(Ie(c,rt(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new gi(p)),i.integrate(t,0);break;default:if(p instanceof ot)i=new Je(Ie(c,rt(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new on(p)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),g()},gf=()=>kn("Length exceeded!"),mf=(t,e,n,r)=>{if(n>e._length)throw gf();if(n===0)return e._searchMarker&&ii(e._searchMarker,n,r.length),ms(t,e,null,r);const i=n,s=Ls(e,n);let c=e._start;for(s!==null&&(c=s.p,n-=s.index,n===0&&(c=c.prev,n+=c&&c.countable&&!c.deleted?c.length:0));c!==null;c=c.right)if(!c.deleted&&c.countable){if(n<=c.length){n<c.length&&Sn(t,Ie(c.id.client,c.id.clock+n));break}n-=c.length}return e._searchMarker&&ii(e._searchMarker,i,r.length),ms(t,e,c,r)},Vy=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((s,c)=>c.index>s.index?c:s,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return ms(t,e,i,n)},vf=(t,e,n,r)=>{if(r===0)return;const i=n,s=r,c=Ls(e,n);let l=e._start;for(c!==null&&(l=c.p,n-=c.index);l!==null&&n>0;l=l.right)!l.deleted&&l.countable&&(n<l.length&&Sn(t,Ie(l.id.client,l.id.clock+n)),n-=l.length);for(;r>0&&l!==null;)l.deleted||(r<l.length&&Sn(t,Ie(l.id.client,l.id.clock+r)),l.delete(t),r-=l.length),l=l.right;if(r>0)throw gf();e._searchMarker&&ii(e._searchMarker,i,-s+r)},vs=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Na=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,c=s.clientID;let l;if(r==null)l=new qn([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:l=new qn([r]);break;case Uint8Array:l=new yi(r);break;case _r:l=new gi(r);break;default:if(r instanceof ot)l=new on(r);else throw new Error("Unexpected content type")}new Je(Ie(c,rt(s.store,c)),i,i&&i.lastId,null,null,e,n,l).integrate(t,0)},Ka=(t,e)=>{t.doc??dt();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},bf=t=>{const e={};return t.doc??dt(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},wf=(t,e)=>{t.doc??dt();const n=t._map.get(e);return n!==void 0&&!n.deleted},Wy=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&nr(s,e)&&(n[i]=s.content.getContent()[s.length-1])}),n},Hi=t=>(t.doc??dt(),gy(t._map.entries(),e=>!e[1].deleted));class Hy extends Us{}class sr extends ot{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new sr;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new sr}clone(){const e=new sr;return e.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),e}get length(){return this.doc??dt(),this._length}_callObserver(e,n){super._callObserver(e,n),Ms(this,e,new Hy(this,e))}insert(e,n){this.doc!==null?Ue(this.doc,r=>{mf(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Ue(this.doc,n=>{Vy(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Ue(this.doc,r=>{vf(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return yf(this,e)}toArray(){return hf(this)}slice(e=0,n=this.length){return df(this,e,n)}toJSON(){return this.map(e=>e instanceof ot?e.toJSON():e)}map(e){return pf(this,e)}forEach(e){si(this,e)}[Symbol.iterator](){return qy(this)}_write(e){e.writeTypeRef(mg)}}const zy=t=>new sr;class Yy extends Us{constructor(e,n,r){super(e,n),this.keysChanged=r}}class fr extends ot{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new fr}clone(){const e=new fr;return this.forEach((n,r)=>{e.set(r,n instanceof ot?n.clone():n)}),e}_callObserver(e,n){Ms(this,e,new Yy(this,e,n))}toJSON(){this.doc??dt();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof ot?i.toJSON():i}}),e}get size(){return[...Hi(this)].length}keys(){return jo(Hi(this),e=>e[0])}values(){return jo(Hi(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return jo(Hi(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??dt(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ue(this.doc,n=>{vs(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Ue(this.doc,r=>{Na(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Ka(this,e)}has(e){return wf(this,e)}clear(){this.doc!==null?Ue(this.doc,e=>{this.forEach(function(n,r,i){vs(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(vg)}}const Gy=t=>new fr,pn=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Qp(t,e);class aa{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&$t(),this.right.content.constructor){case Qe:this.right.deleted||kr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const ml=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Qe:e.right.deleted||kr(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Sn(t,Ie(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},zi=(t,e,n,r)=>{const i=new Map,s=r?Ls(e,n):null;if(s){const c=new aa(s.p.left,s.p,s.index,i);return ml(t,c,n-s.index)}else{const c=new aa(null,e._start,0,i);return ml(t,c,n)}},_f=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Qe&&pn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach((c,l)=>{const f=n.left,d=n.right,g=new Je(Ie(s,rt(i.store,s)),f,f&&f.lastId,d,d&&d.id,e,null,new Qe(l,c));g.integrate(t,0),n.right=g,n.forward()})},kr=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},kf=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Qe&&pn(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},Sf=(t,e,n,r)=>{const i=t.doc,s=i.clientID,c=new Map;for(const l in r){const f=r[l],d=n.currentAttributes.get(l)??null;if(!pn(d,f)){c.set(l,d);const{left:g,right:p}=n;n.right=new Je(Ie(s,rt(i.store,s)),g,g&&g.lastId,p,p&&p.id,e,null,new Qe(l,f)),n.right.integrate(t,0),n.forward()}}return c},Lo=(t,e,n,r,i)=>{n.currentAttributes.forEach((v,b)=>{i[b]===void 0&&(i[b]=null)});const s=t.doc,c=s.clientID;kf(n,i);const l=Sf(t,e,n,i),f=r.constructor===String?new Vt(r):r instanceof ot?new on(r):new Vn(r);let{left:d,right:g,index:p}=n;e._searchMarker&&ii(e._searchMarker,n.index,f.getLength()),g=new Je(Ie(c,rt(s.store,c)),d,d&&d.lastId,g,g&&g.id,e,null,f),g.integrate(t,0),n.right=g,n.index=p,n.forward(),_f(t,e,n,l)},vl=(t,e,n,r,i)=>{const s=t.doc,c=s.clientID;kf(n,i);const l=Sf(t,e,n,i);e:for(;n.right!==null&&(r>0||l.size>0&&(n.right.deleted||n.right.content.constructor===Qe));){if(!n.right.deleted)switch(n.right.content.constructor){case Qe:{const{key:f,value:d}=n.right.content,g=i[f];if(g!==void 0){if(pn(g,d))l.delete(f);else{if(r===0)break e;l.set(f,d)}n.right.delete(t)}else n.currentAttributes.set(f,d);break}default:r<n.right.length&&Sn(t,Ie(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let f="";for(;r>0;r--)f+=`
`;n.right=new Je(Ie(c,rt(s.store,c)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Vt(f)),n.right.integrate(t,0),n.forward()}_f(t,e,n,l)},xf=(t,e,n,r,i)=>{let s=e;const c=pt();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Qe){const d=s.content;c.set(d.key,d)}s=s.right}let l=0,f=!1;for(;e!==s;){if(n===e&&(f=!0),!e.deleted){const d=e.content;switch(d.constructor){case Qe:{const{key:g,value:p}=d,v=r.get(g)??null;(c.get(g)!==d||v===p)&&(e.delete(t),l++,!f&&(i.get(g)??null)===p&&v!==p&&(v===null?i.delete(g):i.set(g,v))),!f&&!e.deleted&&kr(i,d);break}}}e=e.right}return l},Jy=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Qe){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},Xy=t=>{let e=0;return Ue(t.doc,n=>{let r=t._start,i=t._start,s=pt();const c=ra(s);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Qe:kr(c,i.content);break;default:e+=xf(n,r,i,s,c),s=ra(c),r=i;break}i=i.right}}),e},Qy=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const s=t.beforeState.get(r)||0;i!==s&&sf(t,n.store.clients.get(r),s,i,c=>{!c.deleted&&c.content.constructor===Qe&&c.constructor!==At&&e.add(c.parent)})}Ue(n,r=>{Gu(t,t.deleteSet,i=>{if(i instanceof At||!i.parent._hasFormatting||e.has(i.parent))return;const s=i.parent;i.content.constructor===Qe?e.add(s):Jy(r,i)});for(const i of e)Xy(i)})},bl=(t,e,n)=>{const r=n,i=ra(e.currentAttributes),s=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case on:case Vn:case Vt:n<e.right.length&&Sn(t,Ie(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}s&&xf(t,s,e.right,i,e.currentAttributes);const c=(e.left||e.right).parent;return c._searchMarker&&ii(c._searchMarker,e.index,-r+n),e};class Zy extends Us{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Ue(e,r=>{const i=new Map,s=new Map;let c=this.target._start,l=null;const f={};let d="",g=0,p=0;const v=()=>{if(l!==null){let b=null;switch(l){case"delete":p>0&&(b={delete:p}),p=0;break;case"insert":(typeof d=="object"||d.length>0)&&(b={insert:d},i.size>0&&(b.attributes={},i.forEach((S,A)=>{S!==null&&(b.attributes[A]=S)}))),d="";break;case"retain":g>0&&(b={retain:g},Jp(f)||(b.attributes=Yp({},f))),g=0;break}b&&n.push(b),l=null}};for(;c!==null;){switch(c.content.constructor){case on:case Vn:this.adds(c)?this.deletes(c)||(v(),l="insert",d=c.content.getContent()[0],v()):this.deletes(c)?(l!=="delete"&&(v(),l="delete"),p+=1):c.deleted||(l!=="retain"&&(v(),l="retain"),g+=1);break;case Vt:this.adds(c)?this.deletes(c)||(l!=="insert"&&(v(),l="insert"),d+=c.content.str):this.deletes(c)?(l!=="delete"&&(v(),l="delete"),p+=c.length):c.deleted||(l!=="retain"&&(v(),l="retain"),g+=c.length);break;case Qe:{const{key:b,value:S}=c.content;if(this.adds(c)){if(!this.deletes(c)){const A=i.get(b)??null;pn(A,S)?S!==null&&c.delete(r):(l==="retain"&&v(),pn(S,s.get(b)??null)?delete f[b]:f[b]=S)}}else if(this.deletes(c)){s.set(b,S);const A=i.get(b)??null;pn(A,S)||(l==="retain"&&v(),f[b]=A)}else if(!c.deleted){s.set(b,S);const A=f[b];A!==void 0&&(pn(A,S)?A!==null&&c.delete(r):(l==="retain"&&v(),S===null?delete f[b]:f[b]=S))}c.deleted||(l==="insert"&&v(),kr(i,c.content));break}}c=c.right}for(v();n.length>0;){const b=n[n.length-1];if(b.retain!==void 0&&b.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class dr extends ot{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??dt(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new dr}clone(){const e=new dr;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new Zy(this,e,n);Ms(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??dt();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Vt&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Ue(this.doc,r=>{const i=new aa(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const c=e[s];if(c.insert!==void 0){const l=!n&&typeof c.insert=="string"&&s===e.length-1&&i.right===null&&c.insert.slice(-1)===`
`?c.insert.slice(0,-1):c.insert;(typeof l!="string"||l.length>0)&&Lo(r,this,i,l,c.attributes||{})}else c.retain!==void 0?vl(r,this,i,c.retain,c.attributes||{}):c.delete!==void 0&&bl(r,i,c.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??dt();const i=[],s=new Map,c=this.doc;let l="",f=this._start;function d(){if(l.length>0){const p={};let v=!1;s.forEach((S,A)=>{v=!0,p[A]=S});const b={insert:l};v&&(b.attributes=p),i.push(b),l=""}}const g=()=>{for(;f!==null;){if(nr(f,e)||n!==void 0&&nr(f,n))switch(f.content.constructor){case Vt:{const p=s.get("ychange");e!==void 0&&!nr(f,e)?(p===void 0||p.user!==f.id.client||p.type!=="removed")&&(d(),s.set("ychange",r?r("removed",f.id):{type:"removed"})):n!==void 0&&!nr(f,n)?(p===void 0||p.user!==f.id.client||p.type!=="added")&&(d(),s.set("ychange",r?r("added",f.id):{type:"added"})):p!==void 0&&(d(),s.delete("ychange")),l+=f.content.str;break}case on:case Vn:{d();const p={insert:f.content.getContent()[0]};if(s.size>0){const v={};p.attributes=v,s.forEach((b,S)=>{v[S]=b})}i.push(p);break}case Qe:nr(f,e)&&(d(),kr(s,f.content));break}f=f.right}d()};return e||n?Ue(c,p=>{e&&sa(p,e),n&&sa(p,n),g()},"cleanup"):g(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?Ue(i,s=>{const c=zi(s,this,e,!r);r||(r={},c.currentAttributes.forEach((l,f)=>{r[f]=l})),Lo(s,this,c,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?Ue(i,s=>{const c=zi(s,this,e,!r);Lo(s,this,c,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Ue(r,i=>{bl(i,zi(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?Ue(i,s=>{const c=zi(s,this,e,!1);c.right!==null&&vl(s,this,c,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Ue(this.doc,n=>{vs(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Ue(this.doc,r=>{Na(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Ka(this,e)}getAttributes(){return bf(this)}_write(e){e.writeTypeRef(bg)}}const eg=t=>new dr;class Mo{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??dt()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===hr||n.constructor===$n)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class $n extends ot{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new $n}clone(){const e=new $n;return e.insert(0,this.toArray().map(n=>n instanceof ot?n.clone():n)),e}get length(){return this.doc??dt(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Mo(this,e)}querySelector(e){e=e.toUpperCase();const r=new Mo(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),_n(new Mo(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Ms(this,e,new rg(this,n,e))}toString(){return pf(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),si(this,s=>{i.insertBefore(s.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?Ue(this.doc,r=>{mf(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Ue(this.doc,r=>{const i=e&&e instanceof ot?e._item:e;ms(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(s=>s===e)+1;if(i===0&&e!==null)throw kn("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?Ue(this.doc,r=>{vf(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return hf(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return yf(this,e)}slice(e=0,n=this.length){return df(this,e,n)}forEach(e){si(this,e)}_write(e){e.writeTypeRef(_g)}}const tg=t=>new $n;class hr extends $n{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new hr(this.nodeName)}clone(){const e=new hr(this.nodeName),n=this.getAttributes();return Gp(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof ot?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const l in e)r.push(l);r.sort();const i=r.length;for(let l=0;l<i;l++){const f=r[l];n.push(f+'="'+e[f]+'"')}const s=this.nodeName.toLocaleLowerCase(),c=n.length>0?" "+n.join(" "):"";return`<${s}${c}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ue(this.doc,n=>{vs(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Ue(this.doc,r=>{Na(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Ka(this,e)}hasAttribute(e){return wf(this,e)}getAttributes(e){return e?Wy(this,e):bf(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),s=this.getAttributes();for(const c in s){const l=s[c];typeof l=="string"&&i.setAttribute(c,l)}return si(this,c=>{i.appendChild(c.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(wg),e.writeKey(this.nodeName)}}const ng=t=>new hr(t.readKey());class rg extends Us{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class bs extends fr{constructor(e){super(),this.hookName=e}_copy(){return new bs(this.hookName)}clone(){const e=new bs(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let s;return i!==void 0?s=i.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(kg),e.writeKey(this.hookName)}}const ig=t=>new bs(t.readKey());class ws extends dr{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new ws}clone(){const e=new ws;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const s=[];for(const c in e.attributes[i])s.push({key:c,value:e.attributes[i][c]});s.sort((c,l)=>c.key<l.key?-1:1),n.push({nodeName:i,attrs:s})}n.sort((i,s)=>i.nodeName<s.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const s=n[i];r+=`<${s.nodeName}`;for(let c=0;c<s.attrs.length;c++){const l=s.attrs[c];r+=` ${l.key}="${l.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(Sg)}}const sg=t=>new ws;class Ba{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Ft()}mergeWith(e){return!1}write(e,n,r){throw Ft()}integrate(e,n){throw Ft()}}const og=0;class At extends Ba{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),rf(e.doc.store,this)}write(e,n){e.writeInfo(og),e.writeLen(this.length-n)}getMissing(e,n){return null}}class yi{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new yi(this.content)}splice(e){throw Ft()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const ag=t=>new yi(t.readBuf());class oi{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new oi(this.len)}splice(e){const n=new oi(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){ys(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const cg=t=>new oi(t.readLen()),Cf=(t,e)=>new _r({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class gi{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new gi(Cf(this.doc.guid,this.opts))}splice(e){throw Ft()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const lg=t=>new gi(Cf(t.readString(),t.readAny()));class Vn{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Vn(this.embed)}splice(e){throw Ft()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const ug=t=>new Vn(t.readJSON());class Qe{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Qe(this.key,this.value)}splice(e){throw Ft()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const fg=t=>new Qe(t.readKey(),t.readJSON());class _s{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new _s(this.arr)}splice(e){const n=new _s(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const dg=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new _s(n)},hg=ps("node_env")==="development";class qn{constructor(e){this.arr=e,hg&&Ku(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new qn(this.arr)}splice(e){const n=new qn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const s=this.arr[i];e.writeAny(s)}}getRef(){return 8}}const pg=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new qn(n)};class Vt{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Vt(this.str)}splice(e){const n=new Vt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"ï¿½",n.str="ï¿½"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const yg=t=>new Vt(t.readString()),gg=[zy,Gy,eg,ng,tg,ig,sg],mg=0,vg=1,bg=2,wg=3,_g=4,kg=5,Sg=6;class on{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new on(this.type._copy())}splice(e){throw Ft()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const xg=t=>new on(gg[t.readTypeRef()](t)),ks=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new Je(Ie(r,i+n),e,Ie(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ie(e.redone.client,e.redone.clock+n)),e.right=s,s.right!==null&&(s.right.left=s),t._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=n,s};class Je extends Ba{constructor(e,n,r,i,s,c,l,f){super(e,f.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=s,this.parent=c,this.parentSub=l,this.redone=null,this.content=f,this.info=this.content.isCountable()?Gc:0}set marker(e){(this.info&Do)>0!==e&&(this.info^=Do)}get marker(){return(this.info&Do)>0}get keep(){return(this.info&Yc)>0}set keep(e){this.keep!==e&&(this.info^=Yc)}get countable(){return(this.info&Gc)>0}get deleted(){return(this.info&Ao)>0}set deleted(e){this.deleted!==e&&(this.info^=Ao)}markDeleted(){this.info|=Ao}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=rt(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=rt(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ir&&this.id.client!==this.parent.client&&this.parent.clock>=rt(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=hl(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Sn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===At||this.right&&this.right.constructor===At)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===Je?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===Je&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ir){const r=Uo(n,this.parent);r.constructor===At?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=hl(e,e.doc.store,Ie(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const s=new Set,c=new Set;for(;i!==null&&i!==this.right;){if(c.add(i),s.add(i),Wi(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,s.clear();else if(Wi(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&c.has(Uo(e.doc.store,i.origin)))s.has(Uo(e.doc.store,i.origin))||(r=i,s.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),rf(e.doc.store,this),this.content.integrate(e,this),yl(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new At(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ie(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Wi(e.origin,this.lastId)&&this.right===e&&Wi(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),ys(e.deleteSet,this.id.client,this.id.clock,this.length),yl(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw $t();this.content.gc(e),n?Ty(e,this,new At(this.id,this.length)):this.content=new oi(this.length)}write(e,n){const r=n>0?Ie(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,s=this.parentSub,c=this.content.getRef()&Ds|(r===null?0:kt)|(i===null?0:en)|(s===null?0:ei);if(e.writeInfo(c),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const l=this.parent;if(l._item!==void 0){const f=l._item;if(f===null){const d=Ay(l);e.writeParentInfo(!0),e.writeString(d)}else e.writeParentInfo(!1),e.writeLeftID(f.id)}else l.constructor===String?(e.writeParentInfo(!0),e.writeString(l)):l.constructor===ir?(e.writeParentInfo(!1),e.writeLeftID(l)):$t();s!==null&&e.writeString(s)}this.content.write(e,n)}}const Ef=(t,e)=>Cg[e&Ds](t),Cg=[()=>{$t()},cg,dg,ag,yg,ug,fg,xg,pg,lg,()=>{$t()}],Eg=10;class Dt extends Ba{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){$t()}write(e,n){e.writeInfo(Eg),ve(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const Of=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},If="__ $YJS$ __";Of[If]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Of[If]=!0;const No=new FinalizationRegistry(({cache:t,key:e})=>{delete t[e]});function Af(t){var e,n;return(e=(n=t._novip)._docCache)!==null&&e!==void 0?e:n._docCache={cache:{},get size(){return Object.keys(this.cache).length},find(r,i,s){const c=Ko(r,i,s),l=this.cache[c];return l?l.deref():void 0},add(r){var i;const{parentTable:s,parentId:c,parentProp:l}=r.meta;if(!s||!l||c==null)throw new Error("Missing Dexie-related metadata in Y.Doc");const f=Ko(s,c,l),d=(i=this.cache[f])===null||i===void 0?void 0:i.deref();d&&No.unregister(d),this.cache[f]=new WeakRef(r),No.register(r,{cache:this.cache,key:f},r)},delete(r){No.unregister(r);const i=Ko(r.meta.parentTable,r.meta.parentId,r.meta.parentProp),s=this.cache[i];(s==null?void 0:s.deref())===r&&delete this.cache[i]}}}const zr=new WeakSet;function ca(t){if(zr.has(t))throw new Error(`Y.Doc ${t.meta.parentId} has been destroyed`)}function Ko(t,e,n){return`${t}[${e}].${n}`}function Og(t,e,n,r,i,s){let c=e.find(n,s,r);return c||(c=new _r({meta:{db:t,updatesTable:i,parentProp:r,parentTable:n,parentId:s}}),e.add(c),c.on("destroy",()=>{zr.add(c),e.delete(c)}),c)}const{getByKeyPath:Kv}=xe;let Df=null;function wl(t){Df=t}function Ig(t,e,n,r,i,s){let c=0,l=!0;const f=gn(()=>{ca(e);const p=n.table(i);return Promise.all([(c>0?p.where("i").between(c,1/0,!1).toArray().then(v=>v.filter(b=>Is(b.k,s)===0)):p.where({k:s}).toArray()).then(v=>v),n.table(r).where(":id").equals(s).toArray()])}).subscribe(([p,v])=>{if(p.length>0&&(c=p[p.length-1].i),v.length===0){e.destroy();return}ca(e),p.length>0&&Ue(e,()=>{p.forEach(b=>{try{wl(b),ef(e,b.u)}finally{wl(null)}})},t,!1),l&&(l=!1,e.emit("load",[e]))},p=>{t.on("error").fire(p)}),d=(p,v)=>{v!==t&&n.table(i).add({k:s,u:p,f:1}).then(b=>{b===c-1&&++c}).catch(b=>{t.on("error").fire(b)})},g=()=>{f.unsubscribe(),e.off("updateV2",d),e.off("destroy",g)};return e.on("updateV2",d),e.on("destroy",g),g}function Tf(){}function Ag(t,e){return t===Tf?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then(function(){return e.apply(r,s)})}return e.apply(this,arguments)}}function Dg(t,e){return t===Tf?e:function(){t.apply(this,arguments),e.apply(this,arguments)}}const Nr=new WeakMap;function _l(){return xe.Events(null,"load","sync","error")}class ft{static getOrCreateDocument(e,n,r,i){var s,c;const l=Af(e),f=(c=(s=e.table(n).schema.yProps)===null||s===void 0?void 0:s.find(d=>d.prop===r))===null||c===void 0?void 0:c.updatesTable;if(!f)throw new Error(`Updates table for ${n}.${r} not found`);return Og(e,l,n,r,f,i)}static load(e,n){var r;let i=Nr.get(e);return i?(++i.refCount,(n==null?void 0:n.gracePeriod)!=null&&i.graceTimeout<n.gracePeriod&&(i.graceTimeout=n.gracePeriod),i.graceTimer&&(clearTimeout(i.graceTimer),i.graceTimer=null)):(i=new ft(e),i.graceTimeout=(r=n==null?void 0:n.gracePeriod)!==null&&r!==void 0?r:-1,Nr.set(e,i)),i}static release(e){if(!e||zr.has(e))return;const n=Nr.get(e);n?--n.refCount<=0&&(n.graceTimeout<0?n._release():n.graceTimer||(n.graceTimer=setTimeout(()=>{n.graceTimer=null,n.refCount===0&&n._release()},n.graceTimeout))):e.destroy()}_release(){this.doc&&Promise.resolve(ft.on("beforeunload").fire(this)).finally(()=>{var e;this.refCount===0&&((e=this.doc)===null||e===void 0||e.destroy())})}static for(e){return Nr.get(e)}static get currentUpdateRow(){return Df}get whenLoaded(){return this._whenLoaded||(this._whenLoaded=new Promise((e,n)=>{if(!this.doc){n(new Error("No Y.Doc associated with this provider"));return}this.doc.isLoaded?e():this._error?n(this._error):zr.has(this.doc)?n(new xe.AbortError("Document was destroyed before loaded")):(this.on("load",e),this.on("error",n),this.doc.on("destroy",()=>n(new xe.AbortError("Document was destroyed before loaded"))))})),this._whenLoaded}get whenSynced(){return this._whenSynced||(this._whenSynced=new Promise((e,n)=>{if(!this.doc){n(new Error("No Y.Doc associated with this provider"));return}this.doc.isSynced?e():this._error?n(this._error):zr.has(this.doc)?n(new xe.AbortError("Document was destroyed before synced")):(this.on("sync",e),this.on("error",n),this.doc.on("destroy",()=>n(new xe.AbortError("Document was destroyed before synced"))))})),this._whenSynced}constructor(e){this.refCount=1,this.cleanupHandlers=[],this.graceTimeout=-1,this.doc=null,this.destroyed=!1,this.on=_l(),this.doc=e,this.off=(c,l)=>{var f;return(f=this.on[c])===null||f===void 0?void 0:f.unsubscribe(l)},"dispose"in Symbol&&(this[Symbol.dispose]=()=>ft.release(e)),e.on("load",()=>this.on("load").fire()),e.on("sync",c=>c!==!1&&this.on("sync").fire()),e.on("destroy",this.destroy.bind(this)),this.on("error",c=>{this._error=c});const{db:n,parentTable:r,parentId:i,updatesTable:s}=e.meta||{};if(!n||!r||!s)throw new Error("Missing Dexie-related metadata in Y.Doc. Documents need to be obtained through Y.Doc properties from dexie queries.");if(!n.table(r)||!n.table(s))throw new Error(`Table ${r} or ${s} not found in db`);ca(e),this.stopObserving=Ig(this,e,n,r,s,i),ft.on("new").fire(this)}destroy(){var e,n,r;console.debug(`Y.Doc ${(n=(e=this.doc)===null||e===void 0?void 0:e.meta)===null||n===void 0?void 0:n.parentId} was destroyed`),Nr.delete(this.doc),this.doc=null,this.destroyed=!0,this.refCount=0,(r=this.stopObserving)===null||r===void 0||r.call(this),this.on=_l(),this.cleanupHandlers.forEach(i=>i())}addCleanupHandler(e){this.cleanupHandlers.push(typeof e=="function"?e:()=>e.unsubscribe())}}ft.on=xe.Events(null,{new:[Dg],beforeunload:[Ag]});ft.getDocCache=Af;xe.DexieYProvider?ft=xe.DexieYProvider||ft:xe.DexieYProvider=ft;const Bo=3e4;class Tg extends Fp{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=hs();this.getLocalState()!==null&&Bo/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,s)=>{s!==this.clientID&&Bo<=n-i.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&Rf(this,r,"timeout")},tn(Bo/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const n=this.clientID,r=this.meta.get(n),i=r===void 0?0:r.clock+1,s=this.states.get(n);e===null?this.states.delete(n):this.states.set(n,e),this.meta.set(n,{clock:i,lastUpdated:hs()});const c=[],l=[],f=[],d=[];e===null?d.push(n):s==null?e!=null&&c.push(n):(l.push(n),Hr(s,e)||f.push(n)),(c.length>0||f.length>0||d.length>0)&&this.emit("change",[{added:c,updated:f,removed:d},"local"]),this.emit("update",[{added:c,updated:l,removed:d},"local"])}setLocalStateField(e,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:n})}getStates(){return this.states}}const Rf=(t,e,n)=>{const r=[];for(let i=0;i<e.length;i++){const s=e[i];if(t.states.has(s)){if(t.states.delete(s),s===t.clientID){const c=t.meta.get(s);t.meta.set(s,{clock:c.clock+1,lastUpdated:hs()})}r.push(s)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},Rg=(t,e,n=t.states)=>{const r=e.length,i=br();ve(i,r);for(let s=0;s<r;s++){const c=e[s],l=n.get(c)||null,f=t.meta.get(c).clock;ve(i,c),ve(i,f),Ot(i,JSON.stringify(l))}return wt(i)},Pg=(t,e,n)=>{const r=pi(e),i=hs(),s=[],c=[],l=[],f=[],d=je(r);for(let g=0;g<d;g++){const p=je(r);let v=je(r);const b=JSON.parse(It(r)),S=t.meta.get(p),A=t.states.get(p),N=S===void 0?0:S.clock;(N<v||N===v&&b===null&&t.states.has(p))&&(b===null?p===t.clientID&&t.getLocalState()!=null?v++:t.states.delete(p):t.states.set(p,b),t.meta.set(p,{clock:v,lastUpdated:i}),S===void 0&&b!==null?s.push(p):S!==void 0&&b===null?f.push(p):b!==null&&(Hr(b,A)||l.push(p),c.push(p)))}(s.length>0||l.length>0||f.length>0)&&t.emit("change",[{added:s,updated:l,removed:f},n]),(s.length>0||c.length>0||f.length>0)&&t.emit("update",[{added:s,updated:c,removed:f},n])};function Z(t,e,n,r){return new(n||(n=Promise))(function(i,s){function c(d){try{f(r.next(d))}catch(g){s(g)}}function l(d){try{f(r.throw(d))}catch(g){s(g)}}function f(d){var g;d.done?i(d.value):(g=d.value,g instanceof n?g:new n(function(p){p(g)})).then(c,l)}f((r=r.apply(t,e||[])).next())})}function jg(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Kt(t){return this instanceof Kt?(this.v=t,this):new Kt(t)}function Ug(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",function(p){return function(v){return Promise.resolve(v).then(p,d)}}),r[Symbol.asyncIterator]=function(){return this},r;function c(p,v){i[p]&&(r[p]=function(b){return new Promise(function(S,A){s.push([p,b,S,A])>1||l(p,b)})},v&&(r[p]=v(r[p])))}function l(p,v){try{(function(b){b.value instanceof Kt?Promise.resolve(b.value.v).then(f,d):g(s[0][2],b)})(i[p](v))}catch(b){g(s[0][3],b)}}function f(p){l("next",p)}function d(p){l("throw",p)}function g(p,v){p(v),s.shift(),s.length&&l(s[0][0],s[0][1])}}function Lg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=jg(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(s){return new Promise(function(c,l){(function(f,d,g,p){Promise.resolve(p).then(function(v){f({value:v,done:g})},d)})(c,l,(s=t[i](s)).done,s.value)})}}}const ht={userId:"unauthorized",name:"Unauthorized",claims:{sub:"unauthorized"},lastLogin:new Date(0)};try{Object.freeze(ht),Object.freeze(ht.claims)}catch{}const la={},Yr=typeof self<"u"&&self.document&&typeof navigator<"u"&&navigator.serviceWorker;Yr&&Yr.ready.then(t=>la.registration=t),typeof self<"u"&&"clients"in self&&!self.document&&addEventListener("message",t=>{var e,n;!((n=(e=t.data)===null||e===void 0?void 0:e.type)===null||n===void 0)&&n.startsWith("sw-broadcast-")&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>{var i;return r.id!==((i=t.source)===null||i===void 0?void 0:i.id)&&r.postMessage(t.data)})});class Fo{constructor(e){this.name=e}subscribe(e){if(!Yr)return()=>{};const n=r=>{var i;((i=r.data)===null||i===void 0?void 0:i.type)===`sw-broadcast-${this.name}`&&e(r.data.message)};return Yr.addEventListener("message",n),()=>Yr.removeEventListener("message",n)}postMessage(e){var n;typeof self.clients=="object"?[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:`sw-broadcast-${this.name}`,message:e})):la.registration&&((n=la.registration.active)===null||n===void 0||n.postMessage({type:`sw-broadcast-${this.name}`,message:e}))}}const Kr=globalThis["lbc-events"]||(globalThis["lbc-events"]=new Map);class Yi extends Xe{constructor(e){const n=typeof BroadcastChannel>"u"?new Fo(e):new BroadcastChannel(e);super(r=>{function i(l){r.next(l.detail)}function s(l){r.next(l.data)}let c;(function(l,f){Kr.has(l)?Kr.get(l).push(f):Kr.set(l,[f])})(`lbc-${e}`,i);try{n instanceof Fo?c=n.subscribe(l=>r.next(l)):n.addEventListener("message",s)}catch{}return()=>{(function(l,f){const d=Kr.get(l);if(d){const g=d.indexOf(f);g!==-1&&d.splice(g,1)}})(`lbc-${e}`,i),n instanceof Fo?c():n.removeEventListener("message",s)}}),this.name=e,this.bc=n}next(e){this.bc.postMessage(e),(function(n){const r=Kr.get(n.type);r&&r.forEach(i=>{try{i(n)}catch{}})})(new CustomEvent(`lbc-${this.name}`,{detail:e}))}}function Pf(t,e){return Z(this,void 0,void 0,function*(){try{const n=yield navigator.serviceWorker.ready;if(e==="push"&&n.sync&&(yield n.sync.register(`dexie-cloud:${t.name}`)),!n.active)throw new Error("Failed to trigger sync - there's no active service worker");return void n.active.postMessage({type:"dexie-cloud-sync",dbName:t.name,purpose:e})}catch{}})}function Xt(t,e){t.cloud.usingServiceWorker?Pf(t,e):t.localSyncEvent.next({purpose:e})}const Mg="fromBase64"in Uint8Array,Ng="toBase64"in Uint8Array.prototype,Fa=typeof Buffer<"u"?t=>Buffer.from(t,"base64"):Mg?t=>Uint8Array.fromBase64(t):t=>{const e=atob(t),n=e.length,r=new Uint8Array(n);for(var i=0;i<n;i++)r[i]=e.charCodeAt(i);return r},Sr=typeof Buffer<"u"?t=>ArrayBuffer.isView(t)?Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"):Buffer.from(t).toString("base64"):Ng?t=>(ArrayBuffer.isView(t)?t:new Uint8Array(t)).toBase64():t=>{const e=ArrayBuffer.isView(t)?t:new Uint8Array(t),n=[];for(let r=0,i=e.length;r<i;r+=4096){const s=e.subarray(r,r+4096);n.push(String.fromCharCode.apply(null,s))}return btoa(n.join(""))};function ua(t){return Z(this,arguments,void 0,function*({realms:e,inviteRealms:n}){const r=JSON.stringify([...e.map(c=>({realmId:c,accepted:!0})),...n.map(c=>({realmId:c,accepted:!1}))].sort((c,l)=>c.realmId<l.realmId?-1:c.realmId>l.realmId?1:0)),i=new TextEncoder().encode(r),s=yield crypto.subtle.digest("SHA-1",i);return Sr(s)})}function ls(t){return Object.entries(t.cloud.schema||{}).filter(([,{markedForSync:e}])=>e).map(([e])=>t.tables.filter(({name:n})=>n===e)[0]).filter(e=>e)}function $a(t){return`$${t}_mutations`}function jf(t){var e;const n=(e=/^\$(.*)_mutations$/.exec(t))===null||e===void 0?void 0:e[1];if(!n)throw new Error(`Given mutationTable ${t} is not correct`);return n}const Kg=[].concat;function qa(t){return Kg.apply([],t)}function fa(t,e){return Z(this,arguments,void 0,function*(n,r,{since:i={},limit:s=1/0}={}){const c=yield Promise.all(n.map(p=>Z(this,void 0,void 0,function*(){const v=jf(p.name),b=i[v];let S=b?p.where("rev").above(b):p;s<1/0&&(S=S.limit(s));let A=yield S.toArray();return A=(function(N){return N=N.map(U=>{if(U.type==="modify"&&U.criteria.index===null){const K=Object.assign(Object.assign({},U),{criteria:void 0,changeSpec:void 0,type:"update",keys:U.keys,changeSpecs:[U.changeSpec]});return delete K.criteria,delete K.changeSpec,K}return U}),N})(A),A=(function(N){const U=new Map;for(const K of N)if(K.type==="update"){if(K.keys.length!==1||K.changeSpecs.length!==1)continue;const W=""+K.keys[0],L=K.changeSpecs[0];if(Object.values(L).some(te=>typeof te=="object"&&te&&"@@propmod"in te))continue;let ae=U.get(W);ae?ae.push({txid:K.txid,updateSpec:L}):U.set(W,[{txid:K.txid,updateSpec:L}])}return N=N.filter(K=>{if(K.type!=="update"||K.keys.length!==1||K.changeSpecs.length!==1)return!0;const W=K.changeSpecs[0];if(Object.values(W).some(G=>typeof G=="object"&&G&&"@@propmod"in G))return!0;const L=new Set(Object.keys(K.changeSpecs[0])),ae=""+K.keys[0],te=U.get(ae);if(!te)return!0;for(let G=te.length-1;G>=0;--G){const{txid:ye,updateSpec:ne}=te[G];if(ye===K.txid)break;for(const X of Object.keys(ne))L.delete(X)}return L.size!==0}),N})(A),A.map(N=>({table:v,mut:N}))}))),l=qa(c).sort((p,v)=>p.mut.txid===v.mut.txid?p.mut.opNo-v.mut.opNo:p.mut.ts-v.mut.ts),f=[];let d=null,g=null;for(const{table:p,mut:v}of l)d&&d.table===p&&g===v.txid?d.muts.push(v):(d={table:p,muts:[v]},g=v.txid,f.push(d));return f})}function Uf(t){const e=new Uint8Array(t);if(typeof crypto<"u")crypto.getRandomValues(e);else for(let n=0;n<t;n++)e[n]=Math.floor(256*Math.random());if(typeof Buffer<"u"&&Buffer.from)return Buffer.from(e).toString("base64");if(typeof btoa<"u")return btoa(String.fromCharCode.apply(null,e));throw new Error("No btoa or Buffer available")}const Bg={}.hasOwnProperty;function Ss(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){(function(d){if(!d)throw new Error("Assertion Failed")})(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)Ss(t,e[r],n[r])}else{var s=e.indexOf(".");if(s!==-1){var c=e.substr(0,s),l=e.substr(s+1);if(l==="")n===void 0?Array.isArray(t)?isNaN(parseInt(c))||t.splice(parseInt(c),1):delete t[c]:t[c]=n;else{var f=t[c];f&&(function(d,g){return Bg.call(d,g)})(t,c)||(f=t[c]={}),Ss(f,l,n)}}else n===void 0?Array.isArray(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}const Fg=typeof self<"u"&&typeof crypto<"u"?(t,e=crypto.getRandomValues.bind(crypto))=>{const n=new Uint8Array(t);return e(n),self.btoa(String.fromCharCode.apply(null,n))}:typeof Buffer<"u"?(t,e=$g)=>{const n=Buffer.alloc(t);return e(n),n.toString("base64")}:()=>{throw new Error("No implementation of randomString was found")};function $g(t){for(let e=0;e<t.length;++e)t[e]=Math.floor(256*Math.random())}function Va(t){return typeof t=="string"||!!(Array.isArray(t)&&t.some(e=>Va(e))&&t.every(Lf))}function Lf(t){return typeof t=="string"||typeof t=="number"||Array.isArray(t)&&t.every(Lf)}function qg(t,e,n){const r=t[e]||(t[e]={}),i=n.keys.map(s=>typeof s=="string"?s:JSON.stringify(s));switch(n.type){case"insert":case"upsert":i.forEach((s,c)=>{r[s]={type:"ups",val:n.values[c]}});break;case"update":case"modify":i.forEach((s,c)=>{const l=n.type==="update"?n.changeSpecs[c]:n.changeSpec,f=r[s];if(f)switch(f.type){case"ups":for(const[d,g]of Object.entries(l))Ss(f.val,d,g);break;case"del":break;case"upd":Object.assign(f.mod,l)}else r[s]={type:"upd",mod:l}});break;case"delete":i.forEach(s=>{r[s]={type:"del"}})}return t}function kl(t,e){for(const{table:n,muts:r}of e)for(const i of r)qg(t,n,i)}async function*Vg(t){let e=0,n=new Uint8Array(4),r=0,i=[],s=0;for await(const c of t){const l=new DataView(c.buffer,c.byteOffset,c.byteLength);let f=0;for(;f<c.byteLength;)switch(e){case 0:if(f+4>c.byteLength){for(const d of c.slice(f)){if(r===4)break;n[r++]=d,++f}if(r<4)break}else if(r>0&&r<4)for(const d of c.slice(f,f+4-r))n[r++]=d,++f;case 1:s=r===4?new DataView(n.buffer,0,4).getUint32(0,!1):l.getUint32(f,!1),r?r=0:f+=4;case 2:if(f>=c.byteLength){e=2;break}if(f+s>c.byteLength)i.push(c.slice(f)),s-=c.byteLength-f,e=2,f=c.byteLength;else{if(i.length>0){const d=new Uint8Array(i.reduce((p,v)=>p+v.byteLength,s));let g=0;for(const p of i)d.set(p,g),g+=p.byteLength;d.set(c.slice(f,f+s),g),i=[],yield d}else yield c.slice(f,f+s);f+=s,e=0}}}}class Ln extends Error{constructor({title:e,message:n,messageCode:r,messageParams:i}){super(n),this.name="TokenErrorResponseError",this.title=e,this.messageCode=r,this.messageParams=i}}const $o={},Sl={google:'<svg viewBox="0 0 24 24" width="20" height="20"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>',github:'<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>',microsoft:'<svg viewBox="0 0 24 24" width="20" height="20"><rect fill="#F25022" x="1" y="1" width="10" height="10"/><rect fill="#00A4EF" x="1" y="13" width="10" height="10"/><rect fill="#7FBA00" x="13" y="1" width="10" height="10"/><rect fill="#FFB900" x="13" y="13" width="10" height="10"/></svg>',apple:'<svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/></svg>'};function Wg(t){return Z(this,void 0,void 0,function*(){var e;let n;if(Sl[t.type])n=Sl[t.type];else if(!((e=t.iconUrl)===null||e===void 0)&&e.toLowerCase().endsWith(".svg")){const r=yield(function(i){return Z(this,void 0,void 0,function*(){if($o[i])return $o[i];try{const s=yield fetch(i);if(s.ok){const c=yield s.text();if(c.includes("<svg"))return $o[i]=c,c}}catch{}return null})})(t.iconUrl);r&&(n=r)}return{name:"provider",value:t.name,displayName:`Continue with ${t.displayName}`,iconSvg:n,iconUrl:!n&&t.iconUrl?t.iconUrl:void 0,styleHint:t.type}})}function mi(t,e){return new Promise((n,r)=>{const i=Object.assign(Object.assign({submitLabel:"Submit",cancelLabel:"Cancel"},e),{onSubmit:s=>{t.next(void 0),n(s)},onCancel:()=>{t.next(void 0),r(new xe.AbortError("User cancelled"))}});t.next(i)})}function da(t,e,...n){return mi(t,{type:"message-alert",title:e,alerts:n,fields:{},submitLabel:"OK",cancelLabel:null})}function xl(t,e,n){return Z(this,void 0,void 0,function*(){let r=n||"";for(;!r||!/^[\w-+.]+@([\w-]+\.)+[\w-]{2,10}(\sas\s[\w-+.]+@([\w-]+\.)+[\w-]{2,10})?$/.test(r);)r=(yield mi(t,{type:"email",title:e,alerts:r?[{type:"error",messageCode:"INVALID_EMAIL",message:"Please enter a valid email address",messageParams:{}}]:[],fields:{email:{type:"email",placeholder:"you@somedomain.com"}}})).email;return r})}function Cl(t,e,n){return Z(this,void 0,void 0,function*(){const r=[{type:"info",messageCode:"OTP_SENT",message:"A One-Time password has been sent to {email}",messageParams:{email:e}}];n&&r.push(n);const{otp:i}=yield mi(t,{type:"otp",title:"Enter OTP",alerts:r,fields:{otp:{type:"otp",label:"OTP",placeholder:"Paste OTP here"}}});return i})}function Ns(t){return Z(this,void 0,void 0,function*(){var e,n,r;const i=yield t.getCurrentUser(),{accessToken:s,accessTokenExpiration:c,refreshToken:l,refreshTokenExpiration:f,claims:d}=i;if(!s)return null;if(((e=c==null?void 0:c.getTime())!==null&&e!==void 0?e:1/0)>Date.now()&&(((n=i.license)===null||n===void 0?void 0:n.status)||"ok")==="ok")return i;if(!l)throw new Error("Refresh token missing");if(((r=f==null?void 0:f.getTime())!==null&&r!==void 0?r:1/0)<=Date.now())throw new Error("Refresh token has expired");const g=yield Ks(t.cloud.options.databaseUrl,i);return yield t.table("$logins").update(d.sub,{accessToken:g.accessToken,accessTokenExpiration:g.accessTokenExpiration,claims:g.claims,license:g.license,data:g.data}),g})}function Hg(t,e,n,r,i){return Z(this,void 0,void 0,function*(){return e.accessToken&&e.accessTokenExpiration.getTime()>Date.now()?e:e.refreshToken&&(!e.refreshTokenExpiration||e.refreshTokenExpiration.getTime()>Date.now())?yield Ks(t,e):yield(function(s,c,l,f){return Z(this,void 0,void 0,function*(){if(!crypto.subtle)throw typeof location<"u"&&location.protocol==="http:"?new Error("Dexie Cloud Addon needs to use WebCrypto, but your browser has disabled it due to being served from an insecure location. Please serve it from https or http://localhost:<port> (See https://stackoverflow.com/questions/46670556/how-to-enable-crypto-subtle-for-unsecure-origins-in-chrome/46671627#46671627)"):new Error("This browser does not support WebCrypto.");const{privateKey:d,publicKey:g}=yield crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!1,["sign","verify"]);if(!d||!g)throw new Error("Could not generate RSA keypair");s.nonExportablePrivateKey=d;const p=(function(v){const b=Sr(v);return(function(S){let A=`-----BEGIN PUBLIC KEY-----
`;for(;S.length>0;)A+=S.substring(0,64)+`
`,S=S.substring(64);return A+="-----END PUBLIC KEY-----",A})(b)})(yield crypto.subtle.exportKey("spki",g));s.publicKey=g;try{const v=yield c({public_key:p,hints:f});if(v.type==="error")throw new Ln(v);if(v.type!=="tokens")throw new Error(`Unexpected response type from token endpoint: ${v.type}`);return s.accessToken=v.accessToken,s.accessTokenExpiration=new Date(v.accessTokenExpiration),s.refreshToken=v.refreshToken,v.refreshTokenExpiration&&(s.refreshTokenExpiration=new Date(v.refreshTokenExpiration)),s.userId=v.claims.sub,s.email=v.claims.email,s.name=v.claims.name,s.claims=v.claims,s.license={type:v.userType,status:v.claims.license||"ok"},s.data=v.data,v.evalDaysLeft!=null&&(s.license.evalDaysLeft=v.evalDaysLeft),v.userValidUntil!=null&&(s.license.validUntil=new Date(v.userValidUntil)),v.alerts&&v.alerts.length>0&&(yield mi(l,{type:"message-alert",title:"Authentication Alert",fields:{},alerts:v.alerts})),s}catch(v){if(v instanceof Ln)throw yield da(l,v.title,{type:"error",messageCode:v.messageCode,message:v.message,messageParams:{}}),v;let b="We're having a problem authenticating right now.";throw v instanceof TypeError&&(b=typeof navigator!==void 0&&!navigator.onLine?"You seem to be offline. Please connect to the internet and try again.":xe.debug||typeof location<"u"&&(location.hostname==="localhost"||location.hostname==="127.0.0.1")?`Could not connect to server. Please verify that your origin '${location.origin}' is whitelisted using \`npx dexie-cloud whitelist\``:"Could not connect to server. Please verify the connection.",yield da(l,"Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:b,messageParams:{}}).catch(()=>{})),v}})})(e,n,r,i)})}function Ks(t,e){return Z(this,void 0,void 0,function*(){if(!e.refreshToken)throw new Error("Cannot refresh token - refresh token is missing.");if(!e.nonExportablePrivateKey)throw new Error("login.nonExportablePrivateKey is missing - cannot sign refresh token without a private key.");const n=Date.now(),r="RSASSA-PKCS1-v1_5",i=new TextEncoder().encode(e.refreshToken+n),s=yield crypto.subtle.sign(r,e.nonExportablePrivateKey,i),c=Sr(s),l={grant_type:"refresh_token",refresh_token:e.refreshToken,scopes:["ACCESS_DB"],signature:c,signing_algorithm:r,time_stamp:n},f=yield fetch(`${t}/token`,{body:JSON.stringify(l),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});if(f.status!==200)throw new Error(`RefreshToken: Status ${f.status} from ${t}/token`);const d=yield f.json();if(d.type==="error")throw new Ln(d);return e.accessToken=d.accessToken,e.accessTokenExpiration=d.accessTokenExpiration?new Date(d.accessTokenExpiration):void 0,e.claims=d.claims,e.license={type:d.userType,status:d.claims.license||"ok"},d.evalDaysLeft!=null&&(e.license.evalDaysLeft=d.evalDaysLeft),d.userValidUntil!=null&&(e.license.validUntil=new Date(d.userValidUntil)),d.data&&(e.data=d.data),e})}const{toString:zg}={},El={replace:function(t){const e=Object.keys(t);let n=null;for(let i=0,s=e.length;i<s;++i)e[i][0]==="$"&&(n=n||[],n.push(e[i]));if(!n)return t;const r={...t};for(const i of n)delete r[i];for(const i of n)r["$"+i]=t[i];return r}};function Mf(...t){const e=t.reduce((r,i)=>({...r,...i}),t.reduce((r,i)=>({...i,...r}),{})),n=new WeakMap;return{stringify(r,i,s){return JSON.stringify(r,function(l){const f=this[l],d=(function(g){const p=typeof g;switch(typeof g){case"object":case"function":{if(g===null)return null;const b=Object.getPrototypeOf(g);if(!b)return El;let S=n.get(b);if(S!==void 0)return S;const A=(v=g,zg.call(v).slice(8,-1)),N=Object.entries(e).find(([U,K])=>{var W,L;return(L=(W=K==null?void 0:K.test)===null||W===void 0?void 0:W.call(K,g,A))!==null&&L!==void 0?L:U===A});return S=N==null?void 0:N[1],S||(S=Array.isArray(g)?null:typeof g=="function"?e.function||null:El),n.set(b,S),S}default:return e[p]}var v})(f);return d?d.replace(f,i,e):f},s)},parse(r,i){const s=[];return JSON.parse(r,function(c,l){const f=l==null?void 0:l.$t;if(f){const g=e[f];l=g?g.revive(l,i,e):l}let d=s[s.length-1];if(d&&d[0]===l){l={...l};for(const g of d[1])delete l[g];for(const[g,p]of Object.entries(d[2]))l[g]=p;s.pop()}if(l===void 0||c[0]==="$"&&c!=="$t"){let g,p;d=s[s.length-1],d&&d[0]===this?(g=d[1],p=d[2]):s.push([this,g=[],p={}]),c[0]==="$"&&c!=="$t"?(g.push(c),p[c.substr(1)]=l):p[c]=void 0}return l})}}}const Yg={Blob:{test:(t,e)=>e==="Blob",replace:(t,e)=>{const n=e.length;return e.push(t),{$t:"Blob",mimeType:t.type,i:n}},revive:({i:t,mimeType:e},n)=>new Blob([n[t]],{type:e})}};var Gg={number:{replace:t=>{switch(!0){case isNaN(t):return{$t:"number",v:"NaN"};case t===1/0:return{$t:"number",v:"Infinity"};case t===-1/0:return{$t:"number",v:"-Infinity"};default:return t}},revive:({v:t})=>Number(t)}};const Jg={bigint:{replace:t=>({$t:"bigint",v:""+t}),revive:t=>BigInt(t.v)}};var Xg={Date:{replace:t=>({$t:"Date",v:isNaN(t.getTime())?"NaN":t.toISOString()}),revive:({v:t})=>new Date(t==="NaN"?NaN:Date.parse(t))}},Qg={Set:{replace:t=>({$t:"Set",v:Array.from(t.entries())}),revive:({v:t})=>new Set(t)}},Zg={Map:{replace:t=>({$t:"Map",v:Array.from(t.entries())}),revive:({v:t})=>new Map(t)}};const em=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:void 0;var tm=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","DataView","BigInt64Array","BigUint64Array"].reduce((t,e)=>({...t,[e]:{replace:(n,r,i)=>({$t:e,v:i.ArrayBuffer.replace(n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength),r,i).v}),revive:({v:n},r,i)=>{const s=em[e];return s&&new s(i.ArrayBuffer.revive({v:n},r,i))}}}),{});function Nf(t){return(function(e){for(var n="",r=0,i=e.length;r<i;r++)n+=Kf[e[r]];return n})(Sr(t))}function nm(t){return Fa((function(e){if(typeof e!="string")throw new Error("invalid decoder input: "+e);for(var n="",r=0,i=e.length;r<i;r++)n+=ha[e[r]];return n})(t))}const ha={"-":"=",0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",A:"K",B:"L",C:"M",D:"N",E:"O",F:"P",G:"Q",H:"R",I:"S",J:"T",K:"U",L:"V",M:"W",N:"X",O:"Y",P:"Z",Q:"a",R:"b",S:"c",T:"d",U:"e",V:"f",W:"g",X:"h",Y:"i",Z:"j",_:"k",a:"l",b:"m",c:"n",d:"o",e:"p",f:"q",g:"r",h:"s",i:"t",j:"u",k:"v",l:"w",m:"x",n:"y",o:"z",p:"0",q:"1",r:"2",s:"3",t:"4",u:"5",v:"6",w:"7",x:"8",y:"9",z:"+","|":"/"},Kf={};for(const t of Object.keys(ha))Kf[ha[t]]=t;var rm={ArrayBuffer:{replace:t=>({$t:"ArrayBuffer",v:Nf(t)}),revive:({v:t})=>{const e=nm(t);return e.buffer.byteLength===e.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}}};class qo{constructor(e,n){this.buf=e,this.type=n}}function Bf(t){const e=new XMLHttpRequest;if(e.overrideMimeType("text/plain; charset=x-user-defined"),e.open("GET",URL.createObjectURL(t),!1),e.send(),e.status!==200&&e.status!==0)throw new Error("Bad Blob access: "+e.status);return e.responseText}function Ff(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n);return e.buffer}var im={Blob:{test:(t,e)=>e==="Blob"||t instanceof qo,replace:t=>({$t:"Blob",v:Sr(t instanceof qo?t.buf:Ff(Bf(t))),type:t.type}),revive:({type:t,v:e})=>{const n=Fa(e);return typeof Blob!==void 0?new Blob([n]):new qo(n.buffer,t)}}};const $f={...Gg,...Jg,...Xg,...Qg,...Zg,...tm,...rm,...im};function Ol(t){return new Promise((e,n)=>{const r=new FileReader;r.onabort=i=>n(new Error("file read aborted")),r.onerror=i=>n(i.target.error),r.onload=i=>e(i.target.result),r.readAsArrayBuffer(t)})}var sm={undefined:{replace:()=>({$t:"undefined"}),revive:()=>{}}},om={File:{test:(t,e)=>e==="File",replace:t=>({$t:"File",v:Sr(Ff(Bf(t))),type:t.type,name:t.name,lastModified:new Date(t.lastModified).toISOString()}),revive:({type:t,v:e,name:n,lastModified:r})=>{const i=Fa(e);return new File([i],n,{type:t,lastModified:new Date(r).getTime()})}}};const am=typeof BigInt=="function"&&typeof BigInt(0)=="bigint";class Il{toString(){return this.v}constructor(e){this.v=e}}const cm=am?{}:{bigint:{test:t=>t instanceof Il,replace:t=>Object.assign({$t:"bigint"},t),revive:({v:t})=>new Il(t)}},qf=Object.assign(Object.assign(Object.assign(Object.assign({},sm),cm),om),{PropModification:{test:t=>t instanceof Uc,replace:t=>Object.assign({$t:"PropModification"},t["@@propmod"]),revive:t=>{var{$t:e}=t,n=(function(r,i){var s={};for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&i.indexOf(c)<0&&(s[c]=r[c]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function"){var l=0;for(c=Object.getOwnPropertySymbols(r);l<c.length;l++)i.indexOf(c[l])<0&&Object.prototype.propertyIsEnumerable.call(r,c[l])&&(s[c[l]]=r[c[l]])}return s})(t,["$t"]);return new Uc(n)}}}),ai=Mf($f,qf),lm=(function(...t){const e=Mf($f,Yg,...t);return{toBinary(n){const[r,i]=this.stringify(n),s=new ArrayBuffer(4);return new DataView(s).setUint32(0,r.size),new Blob([s,r,i])},stringify(n){const r=[],i=e.stringify(n,r);return[new Blob(r.map(s=>{const c=new ArrayBuffer(4);return new DataView(c).setUint32(0,"byteLength"in s?s.byteLength:s.size),new Blob([c,s])})),i]},async parse(n,r){let i=0;const s=[],c=await Ol(r),l=new DataView(c);for(;i<c.byteLength;){const f=l.getUint32(i);i+=4;const d=c.slice(i,i+f);i+=f,s.push(d)}return e.parse(n,s)},async fromBinary(n){const r=new DataView(await Ol(n.slice(0,4))).getUint32(0),i=n.slice(4,r+4),s=await(function(c){return new Promise((l,f)=>{const d=new FileReader;d.onabort=g=>f(new Error("file read aborted")),d.onerror=g=>f(g.target.error),d.onload=g=>l(g.target.result),d.readAsText(c)})})(n.slice(r+4));return await this.parse(s,i)}}})(qf);class pa extends Error{constructor(e,n){super(n||`${e.status} ${e.statusText}`),this.httpStatus=e.status}get name(){return"HttpError"}}function um(t,e,n){const r=[];for(let i of n){const{table:s,muts:c}=i,l=t.tables.find(g=>g.name===s);if(!l)throw new Error(`Internal error: table ${s} not found in DBCore schema`);const{primaryKey:f}=l;let d=i;c.forEach((g,p)=>{const v=!f.outbound&&(g.type==="upsert"||g.type==="insert");g.keys.forEach((b,S)=>{if(Array.isArray(b)){d===i&&(d=Al(i,v));const A=d.muts[p],N=JSON.stringify(b);A.keys[S]=N}else if(b[0]==="#"){d===i&&(d=Al(i,v));const A=d.muts[p];if(!e.isLoggedIn)throw new Error("Internal error: Cannot sync private IDs before authenticated");const N=`${b}:${e.userId}`;A.keys[S]=N,v&&xe.setByKeyPath(A.values[S],f.keyPath,N)}})}),r.push(d)}return r}function Al(t,e){return Object.assign(Object.assign({},t),{muts:e?t.muts.map(n=>n.type!=="insert"&&n.type!=="upsert"||!n.values?Object.assign(Object.assign({},n),{keys:n.keys.slice()}):Object.assign(Object.assign({},n),{keys:n.keys.slice(),values:n.values.slice()})):t.muts.map(n=>Object.assign(Object.assign({},n),{keys:n.keys.slice()}))})}let ya=new WeakMap;function Vf(t){return Z(this,void 0,void 0,function*(){var e,n;const r=((n=(e=ya.get(t))===null||e===void 0?void 0:e.getTime())!==null&&n!==void 0?n:0)-Date.now();r>0&&(yield new Promise(i=>setTimeout(i,r)))})}function fm(t,e,n,r,i,s,c,l,f){return Z(this,void 0,void 0,function*(){const d={Accept:"application/json, application/x-bison, application/x-bison-stream","Content-Type":"application/tson"},g=yield Ns(i),p=g==null?void 0:g.accessToken;p&&(d.Authorization=`Bearer ${p}`);const v={v:2,dbID:n==null?void 0:n.remoteDbId,clientIdentity:l,schema:c||{},lastPull:n?{serverRevision:n.serverRevision,yServerRevision:n.yServerRevision,realms:n.realms,inviteRealms:n.inviteRealms}:void 0,baseRevs:r,changes:um(i.dx.core.schema,f,t),y:e,dxcv:i.cloud.version};i.syncStateChangedEvent.next({phase:"pushing"});const b=ai.stringify(v),S=yield fetch(`${s}/sync`,{method:"post",headers:d,credentials:"include",body:b});if(i.syncStateChangedEvent.next({phase:"pulling"}),(function(A,N){const U=N.headers.get("Ratelimit-Limit"),K=N.headers.get("Ratelimit-Remaining"),W=N.headers.get("Ratelimit-Reset");if(U&&K&&W){const L=Number(U),ae=Math.max(0,Number(K)),te=Number(W);if(ae<L/2){const G=Math.ceil(te/(ae+1));ya.set(A,new Date(Date.now()+1e3*G))}else ya.delete(A)}})(i,S),!S.ok)throw new pa(S);if(S.headers.get("content-type")==="application/x-bison")return lm.fromBinary(yield S.blob());{const A=yield S.text();return ai.parse(A)}})}function Br(t){if(t!=null&&t.cancelled)throw new xe.AbortError("Operation was cancelled")}let or=!1;function Wf(t,e,n,r){return Z(this,void 0,void 0,function*(){yield t.$baseRevs.bulkPut(Object.keys(e).filter(i=>e[i].markedForSync).map(i=>({tableName:i,clientRev:(n[i]||0)+1,serverRev:r}))),yield t.$baseRevs.where("tableName").noneOf(Object.keys(e).filter(i=>e[i].markedForSync)).delete()})}function ga(t,e={}){for(const{table:n,muts:r}of t){const i=r.length>0?r[r.length-1].rev:null;e[n]=i||e[n]||0}return e}function dm(t,e,n){return Z(this,void 0,void 0,function*(){const r=yield t.bulkGet(e),i=[],s=[];e.forEach((c,l)=>{const f=r[l];if(f){for(const[d,g]of Object.entries(n[l]))if(d===t.schema.primKey.keyPath){if(Is(g,c)!==0)throw new Error("Cannot change primary key")}else xe.setByKeyPath(f,d,g);i.push(c),s.push(f)}}),yield t.schema.primKey.keyPath==null?t.bulkPut(s,i):t.bulkPut(s)})}function Hf(t,e){return Z(this,void 0,void 0,function*(){for(const{table:n,muts:r}of t){if(!e.dx._allTables[n])continue;const i=e.table(n),{primaryKey:s}=i.core.schema,c=l=>{switch(l[0]){case"[":if(l.endsWith("]"))try{return JSON.parse(l)}catch{}return l;case"#":return l.endsWith(":"+e.cloud.currentUserId)?l.substr(0,l.length-e.cloud.currentUserId.length-1):l;default:return l}};for(const l of r){const f=l.keys.map(c);switch(l.type){case"insert":s.outbound?yield i.bulkAdd(l.values,f):(f.forEach((d,g)=>{xe.setByKeyPath(l.values[g],s.keyPath,d)}),yield i.bulkAdd(l.values));break;case"upsert":s.outbound?yield i.bulkPut(l.values,f):(f.forEach((d,g)=>{xe.setByKeyPath(l.values[g],s.keyPath,d)}),yield i.bulkPut(l.values));break;case"modify":f.length===1?yield i.update(f[0],l.changeSpec):yield i.where(":id").anyOf(f).modify(l.changeSpec);break;case"update":yield dm(i,f,l.changeSpecs);break;case"delete":yield i.bulkDelete(f)}}}})}typeof self<"u"&&typeof navigator<"u"&&(or=navigator.onLine,self.addEventListener("online",()=>or=!0),self.addEventListener("offline",()=>or=!1));const wn="dexie-cloud-syncer";function zf(t,e){return t.where("i").between(e,1/0,!0).toArray()}function Gr(t,e,n){var r,i,s;if(!t.dx._allTables[e])return;const c=(s=(i=(r=t.table(e))===null||r===void 0?void 0:r.schema.yProps)===null||i===void 0?void 0:i.find(l=>l.prop===n))===null||s===void 0?void 0:s.updatesTable;return c&&t.dx._allTables[c]?t.table(c):void 0}function Yf(t,e){return Z(this,void 0,void 0,function*(){var n;const r={};let i,s=!1;for(const c of t)try{switch(c.type){case"u-s":{const l=Gr(e,c.table,c.prop);if(l){const f={k:c.k,u:c.u};c.r&&(f.r=c.r,i=c.r),r[l.name]=yield l.add(f)}break}case"u-ack":{const l=Gr(e,c.table,c.prop);l&&(yield e.transaction("rw",l,f=>Z(this,void 0,void 0,function*(){let d=yield f.table(l.name).get(wn);yield f.table(l.name).put(Object.assign(Object.assign({},d||{i:wn}),{unsentFrom:Math.max((d==null?void 0:d.unsentFrom)||1,c.i+1)}))})));break}case"u-reject":{const l=Gr(e,c.table,c.prop);if(!l)break;const f=(n=yield l.get(c.i))===null||n===void 0?void 0:n.k;if(f!=null){yield e.transaction("rw",l,g=>(g.idbtrans._rejecting_y_ypdate=!0,l.where("i").aboveOrEqual(c.i).filter(p=>Is(p.k,f)===0&&!(1&~(p.f||0))).delete()));const d=ft.getDocCache(e.dx).find(c.table,f,c.prop);d&&d.destroy()}break}case"in-sync":{const l=ft.getDocCache(e.dx).find(c.table,c.k,c.prop);l&&!l.isSynced&&l.emit("sync",[!0,l]);break}case"y-complete-sync-done":i=c.yServerRev;break;case"outdated-server-rev":s=!0}}catch{}return{receivedUntils:r,resyncNeeded:s,yServerRevision:i}})}function hm(t,e,n){return Z(this,arguments,void 0,function*(r,i,{yDownloadedRealms:s,realms:c}){if(s&&c&&c.every(g=>s[g]==="*"))return;const l=yield Ns(r),f={"Content-Type":"application/json",Accept:"application/octet-stream"};l&&(f.Authorization=`Bearer ${l.accessToken}`);const d=yield fetch(`${i}/y/download`,{body:ai.stringify({downloadedRealms:s||{}}),method:"POST",headers:f,credentials:"include"});if(!d.ok)throw new Error(`Failed to download Yjs documents from server. Status: ${d.status}`);yield(async function(g,...p){let v=g();for(let b=0;b<p.length;b++)v=p[b](v);for await(const b of v);})((function(g){return async function*(){if(!g.body)throw new Error("Response body is not readable");const p=g.body.getReader();try{for(;;){const{done:v,value:b}=await p.read();if(v)return;yield b}}finally{p.releaseLock()}}})(d),Vg,function(g){return Ug(this,arguments,function*(){var p,v,b,S;let A=null,N=null,U=null,K=[];function W(G){return Z(this,void 0,void 0,function*(){const ye=K[K.length-1];if(K.length>0){if(!A||!N||!U)throw new Error(`Protocol error from ${i}/y/download`);const ne=Gr(r,N,U);ne&&(yield ne.bulkAdd(K)),K=[]}A&&(N&&U&&ye||G)&&(yield r.$syncState.update("syncState",ne=>{const X=ne.yDownloadedRealms||{};X[A]=G?"*":{tbl:N,prop:U,key:ye.k},ne.yDownloadedRealms=X}))})}try{try{for(var L,ae=!0,te=Lg(g);!(p=(L=yield Kt(te.next())).done);ae=!0){S=L.value,ae=!1;const G=new wr(S);for(;ju(G);)switch(ur(G)){case 1:yield Kt(W(!0)),A=It(G);break;case 2:yield Kt(W(!1)),N=It(G),U=It(G);break;case 3:{const ye=bn(G),ne=st(G);K.push({k:ye,u:ne});break}}yield Kt(W(!1))}}catch(G){v={error:G}}finally{try{ae||p||!(b=te.return)||(yield Kt(b.call(te)))}finally{if(v)throw v.error}}yield Kt(W(!0))}catch(G){throw G instanceof xe.DexieError||(yield Kt(W(!1))),G}})})})}const Gf="currentSyncWorker";function Bs(t,e,n,r){return Jf(t,e,n,r).then(i=>(r!=null&&r.justCheckIfNeeded||t.syncStateChangedEvent.next({phase:"in-sync"}),i)).catch(i=>Z(this,void 0,void 0,function*(){return r!=null&&r.justCheckIfNeeded?Promise.reject(i):or&&(r!=null&&r.retryImmediatelyOnFetchError)&&(i==null?void 0:i.name)==="TypeError"&&/fetch/.test(i==null?void 0:i.message)?(t.syncStateChangedEvent.next({phase:"error",error:i}),yield new Promise(s=>setTimeout(s,500)),yield Bs(t,e,n,Object.assign(Object.assign({},r),{retryImmediatelyOnFetchError:!1}))):(yield t.$syncState.update("syncState",{timestamp:new Date,error:""+i}),t.syncStateChangedEvent.next({phase:or?"error":"offline",error:new Error(""+(i==null?void 0:i.message)||i)}),Promise.reject(i))}))}function Jf(t,e,n){return Z(this,arguments,void 0,function*(r,i,s,{isInitialSync:c,cancelToken:l,justCheckIfNeeded:f,purpose:d}={isInitialSync:!1}){var g;if(!(!((g=r.cloud.options)===null||g===void 0)&&g.databaseUrl))throw new Error("Internal error: sync must not be called when no databaseUrl is configured");const{databaseUrl:p}=i,v=yield r.getCurrentUser(),b=v.isLoggedIn?ls(r):[],S=b.map(le=>r.table($a(le.name))),A=yield r.getPersistedSyncState(),N=v.isLoggedIn,U=N?(function(le,Y){const ce=(Y==null?void 0:Y.syncedTables)||[];return ls(le).filter(ie=>!ce.includes(ie.name))})(r,A):[];Br(l);const K=U.length>0;if(K){if(f)return!0;yield r.transaction("rw",U,le=>Z(this,void 0,void 0,function*(){le.idbtrans.disableChangeTracking=!0,le.idbtrans.disableAccessControl=!0,yield(function(Y,ce,ie){return Z(this,void 0,void 0,function*(){const Ce=new Set(ie||[]);for(const he of Y)he.name==="members"?yield he.toCollection().modify(ue=>{Ce.has(ue.realmId)||ue.userId&&ue.userId!==ht.userId||(ue.userId=ce.userId)}):he.name==="roles"||(he.name==="realms"?yield he.toCollection().modify(ue=>{Ce.has(ue.realmId)||ue.owner!==void 0&&ue.owner!==ht.userId||(ue.owner=ce.userId)}):yield he.toCollection().modify(ue=>{ue.realmId&&Ce.has(ue.realmId)||(ue.owner&&ue.owner!==ht.userId||(ue.owner=ce.userId),ue.realmId&&ue.realmId!==ht.userId||(ue.realmId=ce.userId))}))})})(U,v,A==null?void 0:A.realms)})),Br(l)}const[W,L,ae,{yMessages:te,lastUpdateIds:G}]=yield r.transaction("r",r.tables,()=>Z(this,void 0,void 0,function*(){const le=yield r.getPersistedSyncState();let Y=yield r.$baseRevs.toArray();Y=Y.filter(Ce=>b.some(he=>he.name===Ce.tableName));let ce=yield fa(S,r);const ie=yield(function(Ce,he){return Z(this,void 0,void 0,function*(){const ue=[],_e={};for(const Fe of he)if(Fe.schema.yProps)for(const at of Fe.schema.yProps){const ze=Ce.table(at.updatesTable),Ge=yield ze.get(wn),qe=(Ge==null?void 0:Ge.unsentFrom)||1,ct=(Ge==null?void 0:Ge.receivedUntil)||0,J=Math.min(qe,ct+1),Ze=yield zf(ze,J);Ze.length>0&&(_e[ze.name]=Ze[Ze.length-1].i);const pe={};for(const ke of Ze){const Ae=!(1&~(ke.f||0));if(Ae&&ke.i<qe)continue;const Pe=JSON.stringify(ke.k)+"/"+Ae;let gt=pe[Pe];gt?(gt.u.push(ke.u),gt.i=Math.max(ke.i,gt.i)):(pe[Pe]=gt={i:ke.i,k:ke.k,isLocal:Ae,u:[]},gt.u.push(ke.u))}for(const{k:ke,isLocal:Ae,u:Pe,i:gt}of Object.values(pe)){const xn=Pe.length===1?Pe[0]:gs(Pe);if(Ae)ue.push({type:"u-c",table:Fe.name,prop:at.prop,k:ke,u:xn,i:gt});else{const Pt=cf(xn);ue.push({type:"sv",table:Fe.name,prop:at.prop,k:ke,sv:Pt})}}}return{yMessages:ue,lastUpdateIds:_e}})})(r,b);if(Br(l),K){const Ce=[...(A==null?void 0:A.realms)||[],...(A==null?void 0:A.inviteRealms)||[]],he=yield(function(ue,_e,Fe,at){return Z(this,void 0,void 0,function*(){const ze=`upload-${Uf(8)}`;if(_e.isLoggedIn&&ue.length>0){const Ge=new Set(at||[]);return(yield Promise.all(ue.map(qe=>Z(this,void 0,void 0,function*(){const{extractKey:ct}=qe.core.schema.primaryKey;if(!ct)return{table:qe.name,muts:[]};const J=Fe[qe.name],Ze=J!=null&&J.generatedGlobalId?qe.filter(ke=>{return ct(ke),!Ge.has(ke.realmId||"")&&(Ae=ct(ke),!(Pe=J==null?void 0:J.idPrefix)||typeof Ae=="string"&&Ae.startsWith(Pe));var Ae,Pe}):qe.filter(ke=>{const Ae=ct(ke);return!Ge.has(ke.realmId||"")&&Va(Ae)}),pe=yield Ze.toArray();if(pe.length>0){const ke={type:"upsert",values:pe,keys:pe.map(ct),userId:_e.userId,txid:ze};return{table:qe.name,muts:[ke]}}return{table:qe.name,muts:[]}})))).filter(qe=>qe.muts.length>0)}return[]})})(U,v,s,Ce);return Br(l),ce=ce.concat(he),[ce,le,Y,ie]}return[ce,le,Y,ie]})),ye=W.some(le=>le.muts.some(Y=>Y.keys.length>0))||te.some(le=>le.type==="u-c");if(f)return ye;if(d==="push"&&!ye)return!1;const ne=ga(W,L==null?void 0:L.latestRevisions),X=(L==null?void 0:L.clientIdentity)||Fg(16);Br(l);const se=yield fm(W,te,L,ae,r,p,s,X,v),{done:V,newSyncState:ge}=yield r.transaction("rw",r.tables,le=>Z(this,void 0,void 0,function*(){le.idbtrans.disableChangeTracking=!0,le.idbtrans.disableAccessControl=!0;for(const he of Object.keys(s))se.schema[he]&&(s[he]=se.schema[he]);yield r.$syncState.put(s,"schema");const Y=yield fa(S,r,{since:ne});for(const he of S){const ue=jf(he.name);if(Y.some(_e=>_e.table===ue&&_e.muts.length>0)){if(ne[ue]){const _e=ne[ue]||0;yield Promise.all([he.where("rev").belowOrEqual(_e).delete(),r.$baseRevs.where(":id").between([ue,-1/0],[ue,_e+1],!0,!0).reverse().offset(1).delete()])}}else yield Promise.all([he.clear(),r.$baseRevs.where({tableName:ue}).delete()])}ga(Y,ne),yield Wf(r,s,ne,se.serverRevision);const ce=yield r.getPersistedSyncState();yield(function(he,ue,_e){return Z(this,void 0,void 0,function*(){const Fe=new Set,at=new Set,ze=_e?_e.realms:[],Ge=_e?_e.inviteRealms:[],qe=new Set(ue.realms),ct=new Set(ue.realms.concat(ue.inviteRealms));for(const J of ze)qe.has(J)||(at.add(J),ct.has(J)||Fe.add(J));for(const J of Ge.concat(ze))ct.has(J)||Fe.add(J);if(Fe.size>0||at.size>0){const J=ls(he);for(const Ze of J){let pe=["realms","members","roles"].includes(Ze.name)?Fe:at;pe.size!==0&&(Ze.schema.indexes.some(ke=>ke.keyPath==="realmId"||Array.isArray(ke.keyPath)&&ke.keyPath[0]==="realmId")?yield Ze.where("realmId").anyOf([...pe]).delete():yield Ze.filter(ke=>!!(ke!=null&&ke.realmId)&&pe.has(ke.realmId)).delete())}}if(at.size>0&&(_e!=null&&_e.yDownloadedRealms))for(const J of at)delete _e.yDownloadedRealms[J]})})(r,se,ce);const ie=ce||{syncedTables:[],latestRevisions:{},realms:[],inviteRealms:[],clientIdentity:X};N&&(ie.syncedTables=b.map(he=>he.name).concat(U.map(he=>he.name))),ie.latestRevisions=ne,ie.remoteDbId=se.dbId,ie.initiallySynced=!0,ie.realms=se.realms,ie.inviteRealms=se.inviteRealms,ie.serverRevision=se.serverRevision,ie.yServerRevision=se.serverRevision,ie.timestamp=new Date,delete ie.error;const Ce=Xf(se.changes,Y);if(yield Hf(Ce,r),se.yMessages){const{receivedUntils:he,resyncNeeded:ue,yServerRevision:_e}=yield Yf(se.yMessages,r);_e&&(ie.yServerRevision=_e),yield(function(Fe,at,ze){return Z(this,void 0,void 0,function*(){var Ge,qe,ct,J,Ze;const pe={};for(const[Ae,Pe]of Object.entries(Fe))(Ge=pe[Ae])!==null&&Ge!==void 0||(pe[Ae]={}),pe[Ae].unsentFrom=Pe+1;for(const[Ae,Pe]of Object.entries(at))(qe=pe[Ae])!==null&&qe!==void 0||(pe[Ae]={}),pe[Ae].receivedUntil=Pe;const ke=Object.values(ze.dx._dbSchema).filter(Ae=>Ae.yProps).map(Ae=>Ae.yProps.map(Pe=>Pe.updatesTable)).flat();for(const Ae of ke){const Pe=pe[Ae],gt=(ct=Pe==null?void 0:Pe.unsentFrom)!==null&&ct!==void 0?ct:1,xn=(Ze=(J=Pe==null?void 0:Pe.receivedUntil)!==null&&J!==void 0?J:(yield ze.table(Ae).where("i").between(1,1/0).reverse().limit(1).primaryKeys())[0])!==null&&Ze!==void 0?Ze:0;yield ze.transaction("rw",Ae,()=>Z(this,void 0,void 0,function*(){const Pt=yield ze.table(Ae).get(wn);Pt?(Pt.unsentFrom=Math.max(gt,Pt.unsentFrom||1),Pt.receivedUntil=Math.max(xn,Pt.receivedUntil||0),yield ze.table(Ae).put(Pt)):yield ze.table(Ae).add({i:wn,unsentFrom:gt,receivedUntil:xn})}))}})})(G,he,r),ue&&(ie.yDownloadedRealms={})}return r.$syncState.put(ie,"syncState"),{done:Y.length===0,newSyncState:ie}}));if(!V)return yield Vf(r),yield Jf(r,i,s,{isInitialSync:c,cancelToken:l});const be=Object.values(s).some(le=>{var Y;return(Y=le.yProps)===null||Y===void 0?void 0:Y.length}),me=!!se.yMessages;if(be&&me)try{yield hm(r,p,ge)}catch{}return r.syncCompleteEvent.next(),!1})}function Xf(t,e){const n={};kl(n,t);const r={};return kl(r,e),(function(i,s){var c,l,f;for(const[d,g]of Object.entries(s))for(const[p,v]of Object.entries(g))switch(v.type){case"ups":{const b=(c=i[d])==null?void 0:c[p];if(b)switch(b.type){case"ups":case"upd":delete i[d][p]}}break;case"del":(l=i[d])==null||delete l[p];break;case"upd":{const b=(f=i[d])==null?void 0:f[p];if(b)switch(b.type){case"ups":for(const[S,A]of Object.entries(v.mod))Ss(b.val,S,A);break;case"del":break;case"upd":for(const S of Object.keys(v.mod))delete b.mod[S]}break}}})(n,r),(function(i,s){const c={};for(const[f,d]of Object.entries(i))for(const[g,p]of Object.entries(d)){const v=c[f]||(c[f]={});(v[p.type]||(v[p.type]=[])).push({key:g,...p})}const l=[];for(const[f,d]of Object.entries(c)){const g={table:f,muts:[]};for(const[p,v]of Object.entries(d))switch(p){case"ups":{const b={type:"upsert",keys:v.map(S=>S.key),values:v.map(S=>S.val),txid:s};g.muts.push(b);break}case"upd":{const b={type:"update",keys:v.map(S=>S.key),changeSpecs:v.map(S=>S.mod),txid:s};g.muts.push(b);break}case"del":{const b={type:"delete",keys:v.map(S=>S.key),txid:s};g.muts.push(b);break}}l.push(g)}return l})(n)}function pm(t){const e=[],n=new Rt(!0),r=new Rt(null);let i=!1,s=new Array(10).fill(0);return r.subscribe(()=>Z(this,void 0,void 0,function*(){if(!i&&e.length>0){i=!0,s.shift(),s.push(Date.now()),n.next(!1);try{yield(function(){return Z(this,void 0,void 0,function*(){for(var c,l,f,d,g,p;e.length>0;){const v=e.shift();try{yield Un(t.cloud.syncState.pipe(Et(({phase:S})=>S==="in-sync"||S==="error")));const b=t.cloud.persistedSyncState.value;if(!v)continue;switch(v.type){case"token-expired":const S=t.cloud.currentUser.value,A=yield Ks(t.cloud.options.databaseUrl,S);yield t.table("$logins").update(S.userId,{accessToken:A.accessToken,accessTokenExpiration:A.accessTokenExpiration,claims:A.claims,license:A.license,data:A.data});break;case"realm-added":!((c=b==null?void 0:b.realms)===null||c===void 0)&&c.includes(v.realm)||!((l=b==null?void 0:b.inviteRealms)===null||l===void 0)&&l.includes(v.realm)||(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-accepted":!((f=b==null?void 0:b.realms)===null||f===void 0)&&f.includes(v.realm)||(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-removed":(!((d=b==null?void 0:b.realms)===null||d===void 0)&&d.includes(v.realm)||!((g=b==null?void 0:b.inviteRealms)===null||g===void 0)&&g.includes(v.realm))&&(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realms-changed":yield t.cloud.sync({purpose:"pull",wait:!0});break;case"changes":if(((p=t.cloud.syncState.value)===null||p===void 0?void 0:p.phase)==="error"){Xt(t,"pull");break}yield t.transaction("rw",t.dx.tables,N=>Z(this,void 0,void 0,function*(){N.idbtrans.disableChangeTracking=!0,N.idbtrans.disableAccessControl=!0;const[U,K,W]=yield Promise.all([t.getSchema(),t.getPersistedSyncState(),t.getCurrentUser()]);if(!K||!U||!W)return;if(v.baseRev!==K.serverRevision)return void(typeof v.baseRev!="string"||typeof K.serverRevision!="bigint"&&typeof K.serverRevision!="object"||Xt(t,"pull"));if((yield xe.waitFor(ua(K)))!==v.realmSetHash)return void Xt(t,"pull");let L=[];if(W.isLoggedIn){const ae=ls(t).map(te=>t.table($a(te.name)));L=yield fa(ae,t)}if(v.changes.length>0){const ae=Xf(v.changes,L);yield Hf(ae,t)}K.latestRevisions=ga(L,K.latestRevisions),K.serverRevision=v.newRev,yield Wf(t,U,K.latestRevisions,v.newRev),yield t.$syncState.put(K,"syncState")}))}}catch{}}})})()}finally{s[s.length-1]-s[0]<1e4&&(yield new Promise(c=>setTimeout(c,1e3))),i=!1,n.next(!0)}}})),{enqueue:function(c){e.push(c),r.next(null)},readyToServe:n}}const Dl=new WeakMap,Gi={members:"@id, [userId+realmId], [email+realmId], realmId",roles:"[realmId+name]",realms:"@realmId",$jobs:"",$syncState:"",$baseRevs:"[tableName+clientRev]",$logins:"claims.sub, lastLogin"};let ym=0;function Nt(t){"vip"in t&&(t=t.vip);let e=Dl.get(t.cloud);if(!e){const n=new Bn;let r=new Yi(`syncstatechanged-${t.name}`),i=new Yi(`synccomplete-${t.name}`);n.id=++ym;let s=!1;e={get name(){return t.name},close:()=>t.close(),transaction:t.transaction.bind(t),table:t.table.bind(t),get tables(){return t.tables},cloud:t.cloud,get $jobs(){return t.table("$jobs")},get $syncState(){return t.table("$syncState")},get $baseRevs(){return t.table("$baseRevs")},get $logins(){return t.table("$logins")},get realms(){return t.realms},get members(){return t.members},get roles(){return t.roles},get initiallySynced(){return s},localSyncEvent:n,get syncStateChangedEvent(){return r},get syncCompleteEvent(){return i},dx:t},Object.assign(e,{getCurrentUser:()=>e.$logins.toArray().then(l=>l.find(f=>f.isLoggedIn)||ht),getPersistedSyncState:()=>e.$syncState.get("syncState"),getSchema:()=>e.$syncState.get("schema").then(l=>{if(l)for(const f of e.tables)f.schema.primKey&&f.schema.primKey.keyPath&&l[f.name]&&(l[f.name].primaryKey=gm(f.schema.primKey.keyPath));return l}),getOptions:()=>e.$syncState.get("options"),setInitiallySynced(l){s=l},reconfigure(){r=new Yi(`syncstatechanged-${t.name}`),i=new Yi(`synccomplete-${t.name}`)}}),e.messageConsumer=pm(e),e.messageProducer=new Bn,Dl.set(t.cloud,e)}return e}function gm(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}const Tl=new WeakMap;class Wa{constructor(e,n){Tl.set(this,e),Object.assign(this,n)}static load(e,n){return e.table("$logins").get(n).then(r=>new Wa(e,r||{userId:n,claims:{sub:n},lastLogin:new Date(0)}))}save(){return Z(this,void 0,void 0,function*(){Tl.get(this).table("$logins").put(this)})}}function Qf(t,e){return Un(_t(t).pipe(Et(e)))}function Zf(t){return Z(this,void 0,void 0,function*(){const e=yield ma(t);if(e){if(!(yield(function(n,r,i){return Z(this,void 0,void 0,function*(){const s=[{type:"warning",messageCode:"LOGOUT_CONFIRMATION",message:`{numUnsyncedChanges} unsynced changes will get lost!
                Logout anyway?`,messageParams:{currentUserId:r,numUnsyncedChanges:i.toString()}}];return yield mi(n,{type:"logout-confirmation",title:"Confirm Logout",alerts:s,fields:{},submitLabel:"Confirm logout",cancelLabel:"Cancel"}).then(()=>!0).catch(()=>!1)})})(t.cloud.userInteraction,t.cloud.currentUserId,e)))throw new Error("User cancelled logout due to unsynced changes");yield ma(t,{deleteUnsyncedData:!0})}})}function ma(t){return Z(this,arguments,void 0,function*(e,{deleteUnsyncedData:n=!1}={}){const[r,i]=yield e.dx.transaction("rw",e.dx.tables,s=>Z(this,void 0,void 0,function*(){const c=s.idbtrans;c.disableChangeTracking=!0,c.disableAccessControl=!0;const l=s.storeNames.filter(d=>d.endsWith("_mutations")),f=(yield Promise.all(l.map(d=>s.table(d).count()))).reduce((d,g)=>d+g,0);if(f>0&&!n)return[f,!1];e.$syncState.delete("syncState");for(const d of e.dx.tables)d.name!=="$jobs"&&d.name!=="$syncState"&&d.clear();return[f,!0]}));return i&&(yield Qf(e.cloud.currentUser,s=>s.userId===ht.userId),yield e.cloud.sync({purpose:"pull",wait:!0})),r})}const Rl={access_denied:"Access was denied by the authentication provider.",invalid_state:"The authentication response could not be verified. Please try again.",email_not_verified:"Your email address must be verified before you can log in.",expired_code:"The authentication code has expired. Please try again.",provider_error:"An error occurred with the authentication provider.",network_error:"A network error occurred during authentication. Please check your connection and try again."};class Gt extends Error{constructor(e,n,r){super(r||Rl[e]),this.name="OAuthError",this.code=e,this.provider=n}get userMessage(){return Rl[this.code]||this.message}}const Ji={providers:[],otpEnabled:!0};function mm(t){typeof sessionStorage<"u"&&sessionStorage.setItem("dexie-cloud-oauth-provider",t.provider);const e=(function(n){const r=new URL(`${n.databaseUrl}/oauth/login/${n.provider}`),i=n.redirectUri||(typeof window<"u"?window.location.href:"");return i&&r.searchParams.set("redirect_uri",i),r.toString()})(t);window.location.href=e}function vm(t){const{userInteraction:e}=t.cloud;return function(n){return Z(this,arguments,void 0,function*({public_key:r,hints:i}){var s,c;let l;const f=(s=t.cloud.options)===null||s===void 0?void 0:s.databaseUrl;if(!f)throw new Error("No database URL given.");if(i!=null&&i.oauthCode&&i.provider)return yield(function(p){return Z(this,void 0,void 0,function*(){const{databaseUrl:v,code:b,publicKey:S,scopes:A=["ACCESS_DB"]}=p,N={grant_type:"authorization_code",code:b,public_key:S,scopes:A};try{const U=yield fetch(`${v}/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(N),mode:"cors"});if(!U.ok){if(U.status===400||U.status===401)try{const L=yield U.json();if(L.type==="error")throw L.messageCode==="INVALID_OTP"?new Gt("expired_code",void 0,L.message):new Ln(L)}catch(L){if(L instanceof Gt||L instanceof Ln)throw L}const W=yield U.text().catch(()=>U.statusText);throw new Gt("provider_error",void 0,`Token exchange failed: ${U.status} ${W}`)}const K=yield U.json();if(K.type==="error")throw new Ln(K);if(K.type!=="tokens")throw new Gt("provider_error",void 0,`Unexpected response type: ${K.type}`);return K}catch(U){throw U instanceof Gt||U instanceof Ln?U:U instanceof TypeError?new Gt("network_error"):U}})})({databaseUrl:f,code:i.oauthCode,publicKey:r,scopes:["ACCESS_DB"]});if(i!=null&&i.provider)throw Pl(t,i.provider),new Error("OAuth redirect initiated");if((i==null?void 0:i.grant_type)==="demo")l={demo_user:yield xl(e,"Enter a demo user email",(i==null?void 0:i.email)||(i==null?void 0:i.userId)),grant_type:"demo",scopes:["ACCESS_DB"],public_key:r};else if(i!=null&&i.otpId&&i.otp)l={grant_type:"otp",otp_id:i.otpId,otp:i.otp,scopes:["ACCESS_DB"],public_key:r};else{const p=((c=t.cloud.options)===null||c===void 0?void 0:c.socialAuth)!==!1,v=yield(function(S){return Z(this,arguments,void 0,function*(A,N=!0){if(!N)return Ji;try{const U=yield fetch(`${A}/auth-providers`,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});return U.status===404?Ji:U.ok?yield U.json():Ji}catch{return Ji}})})(f,p);if(v.providers.length>0){const S=yield(function(A,N,U){return Z(this,arguments,void 0,function*(K,W,L,ae="Choose login method",te=[]){const G=[...yield Promise.all(W.map(Wg))];return L&&G.push({name:"otp",value:"email",displayName:"Continue with email",iconSvg:'<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M22 6L12 13 2 6"/></svg>',styleHint:"otp"}),new Promise((ye,ne)=>{const X={type:"generic",title:ae,alerts:te,options:G,fields:{},submitLabel:"",cancelLabel:"Cancel",onSubmit:se=>{K.next(void 0),ye("otp"in se?{type:"otp"}:"provider"in se?{type:"provider",provider:se.provider}:{type:"otp"})},onCancel:()=>{K.next(void 0),ne(new xe.AbortError("User cancelled"))}};K.next(X)})})})(e,v.providers,v.otpEnabled,"Sign in");if(S.type==="provider")throw Pl(t,S.provider),new Error("OAuth redirect initiated")}const b=yield xl(e,"Enter email address",i==null?void 0:i.email);l=/@demo.local$/.test(b)?{demo_user:b,grant_type:"demo",scopes:["ACCESS_DB"],public_key:r}:{email:b,grant_type:"otp",scopes:["ACCESS_DB"]}}const d=yield fetch(`${f}/token`,{body:JSON.stringify(l),method:"post",headers:{"Content-Type":"application/json",mode:"cors"}});if(d.status!==200){const p=yield d.text();throw yield da(e,"Token request failed",{type:"error",messageCode:"GENERIC_ERROR",message:p,messageParams:{}}).catch(()=>{}),new pa(d,p)}const g=yield d.json();if(g.type==="tokens"||g.type==="error")return g;if(l.grant_type==="otp"&&"email"in l){if(g.type!=="otp-sent")throw new Error(`Unexpected response from ${f}/token`);const p=yield Cl(e,l.email),v=Object.assign(Object.assign({},l),{otp:p||"",otp_id:g.otp_id,public_key:r});let b=yield fetch(`${f}/token`,{body:JSON.stringify(v),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});for(;b.status===401;){const S=yield b.text();v.otp=yield Cl(e,l.email,{type:"error",messageCode:"INVALID_OTP",message:S,messageParams:{}}),b=yield fetch(`${f}/token`,{body:JSON.stringify(v),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})}if(b.status!==200){const S=yield b.text();throw new pa(b,S)}return yield b.json()}throw new Error(`Unexpected response from ${f}/token`)})}}function Pl(t,e){var n,r;const i=(n=t.cloud.options)===null||n===void 0?void 0:n.databaseUrl;if(!i)throw new Error("No database URL given.");mm({databaseUrl:i,provider:e,redirectUri:((r=t.cloud.options)===null||r===void 0?void 0:r.oauthRedirectUri)||(typeof window<"u"?window.location.href:void 0)})}function Xi(t,...e){globalThis.console[t](...e)}function Qi(t,e){return Z(this,void 0,void 0,function*(){var n;const r=yield t.getCurrentUser(),i=r.userId;if(r.isLoggedIn&&(!e||!e.email&&!e.userId)){if((((n=r.license)===null||n===void 0?void 0:n.status)||"ok")==="ok"&&r.accessToken&&(!r.accessTokenExpiration||r.accessTokenExpiration.getTime()>Date.now()))return!1;if(r.refreshToken&&(!r.refreshTokenExpiration||r.refreshTokenExpiration.getTime()>Date.now()))return yield Ns(t),!1}const s=new Wa(t,{claims:{},lastLogin:new Date(0)});return yield Hg(t.cloud.options.databaseUrl,s,t.cloud.options.fetchTokens||vm(t),t.cloud.userInteraction,e),i!==ht.userId&&s.userId!==i&&(yield Zf(t)),yield(function(c,l){return Z(this,void 0,void 0,function*(){const f=c.table("$logins");yield c.transaction("rw",f,d=>Z(this,void 0,void 0,function*(){const g=yield f.toArray();yield Promise.all(g.filter(p=>p.userId!==l.userId&&p.isLoggedIn).map(p=>(p.isLoggedIn=!1,f.put(p)))),l.isLoggedIn=!0,l.lastLogin=new Date;try{yield l.save()}catch(p){try{p.name==="DataCloneError"&&(Xi("debug","Login context property names:",Object.keys(l)),Xi("debug","Login context property names:",Object.keys(l)),Xi("debug","Login context:",l),Xi("debug","Login context JSON:",JSON.stringify(l)))}catch{}throw p}})),yield Qf(c.cloud.currentUser,d=>d.userId===l.userId)})})(t,s),Xt(t,"pull"),s.userId!==i})}const bm=typeof InstallTrigger<"u",ed=typeof navigator<"u"&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\/|Edge\//.test(navigator.userAgent),wm=ed?[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]:NaN,td=ed&&wm<=605||bm,_m=typeof self<"u"&&"clients"in self&&!self.document,{toString:km}={};function jl(t){return km.call(t).slice(8,-1)}function Vo(t,e){var n;return e.type==="delete"?e.keys:((n=e.keys)===null||n===void 0?void 0:n.slice())||e.values.map(t.extractKey)}function Sm(t,e){return(1&e?t[0].toUpperCase():t[0].toLowerCase())+(2&e?t[1].toUpperCase():t[1].toLowerCase())+(4&e?t[2].toUpperCase():t[2].toLowerCase())}const xm=/b|c|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|x|y|z/i;function Cm(t){return t>="A"&&t<="Z"}let Yt=0;function nd(t,e){const n=new Uint8Array(18),r=new Uint8Array(n.buffer,0,6),i=Date.now();Yt>=i?++Yt:Yt=i,r[0]=Yt/1099511627776,r[1]=Yt/4294967296,r[2]=Yt/16777216,r[3]=Yt/65536,r[4]=Yt/256,r[5]=Yt;const s=new Uint8Array(n.buffer,6);return crypto.getRandomValues(s),t+Nf(new Uint8Array(n.buffer))+(e||"")}function Em(t){return{stack:"dbcore",name:"idGenerationMiddleware",level:1,create:e=>Object.assign(Object.assign({},e),{table:n=>{const r=e.table(n);return Object.assign(Object.assign({},r),{mutate:i=>{var s,c;const l=i.trans;if(l.mode==="versionchange"&&(l.disableChangeTracking=!0,l.disableAccessControl=!0),l.disableChangeTracking)return r.mutate(i);if(i.type==="add"||i.type==="put"){const f=(s=t.cloud.schema)===null||s===void 0?void 0:s[n];if(f!=null&&f.generatedGlobalId){if(!((c=t.cloud.options)===null||c===void 0)&&c.databaseUrl&&!t.initiallySynced){const d=Vo(r.schema.primaryKey,i);return r.getMany({keys:d,trans:i.trans,cache:"immutable"}).then(g=>{if(g.length<d.length)throw new Error("Unable to create new objects without an initial sync having been performed.");return r.mutate(i)})}return(function(d,g){let p=null;const v=Vo(r.schema.primaryKey,d);return v.forEach((b,S)=>{if(b===void 0){const A=d.values[S].realmId||t.cloud.currentUserId,N=A.substr(A.length-3);v[S]=nd(g,N),r.schema.primaryKey.outbound||(p||(p=d.values.slice()),p[S]=xe.deepClone(p[S]),xe.setByKeyPath(p[S],r.schema.primaryKey.keyPath,v[S]))}else if(typeof b!="string"||!b.startsWith(g)&&!b.startsWith("#"+g))throw new xe.ConstraintError(`The ID "${b}" is not valid for table "${n}". Primary '@' keys requires the key to be prefixed with "${g}" (or "#${g}).
If you want to generate IDs programmatically, remove '@' from the schema to get rid of this constraint. Dexie Cloud supports custom IDs as long as they are random and globally unique.`)}),r.mutate(Object.assign(Object.assign({},d),{keys:v,values:p||d.values}))})(i,f.idPrefix)}f!=null&&f.markedForSync&&Vo(r.schema.primaryKey,i).forEach((d,g)=>{if(!Va(d)){const p=Array.isArray(d)?d.map(jl).join(","):jl(d);throw new xe.ConstraintError(`Invalid primary key type ${p} for table ${n}. Tables marked for sync has primary keys of type string or Array of string (and optional numbers)`)}})}return r.mutate(i)}})}})}}let Om=0;function Fr(t,e){return function(n){const{readers:r,writers:i}=n.trans[e]||(n.trans[e]={writers:[],readers:[]}),s=i.length,c=(s>0?i[s-1].then(()=>t(n),()=>t(n)):t(n)).finally(()=>{r.splice(r.indexOf(c))});return r.push(c),c}}function Im(t,e){return function(n){const{readers:r,writers:i}=n.trans[e]||(n.trans[e]={writers:[],readers:[]});let s=(i.length>0?i[i.length-1].then(()=>t(n),()=>t(n)):r.length>0?(c=r,new Promise(l=>{c.length===0&&l([]);let f=c.length;const d=new Array(f);c.forEach((g,p)=>Promise.resolve(g).then(v=>d[p]={status:"fulfilled",value:v},v=>d[p]={status:"rejected",reason:v}).then(()=>--f||l(d)))})).then(()=>t(n)):t(n)).finally(()=>{i.shift()});var c;return i.push(s),s}}const er=new Rt(new Set);function ci(t){var e,n,r,i;return((e=t.cloud.options)===null||e===void 0?void 0:e.disableEagerSync)||((r=(n=t.cloud.currentUser.value)===null||n===void 0?void 0:n.license)===null||r===void 0?void 0:r.status)!=="ok"||!(!((i=t.cloud.options)===null||i===void 0)&&i.databaseUrl)}function Am({currentUserObservable:t,db:e}){return{stack:"dbcore",name:"MutationTrackingMiddleware",level:1,create:n=>{const r=new Set(n.schema.tables.map(c=>c.name)),i=n.schema.tables.filter(c=>!/^\$/.test(c.name)),s=new Map;for(const c of i){const l=`$${c.name}_mutations`;r.has(l)&&s.set(c.name,n.table(l))}return Object.assign(Object.assign({},n),{transaction:(c,l)=>{let f;if(l==="readwrite"){const d=c.filter(g=>{var p,v;return(v=(p=e.cloud.schema)===null||p===void 0?void 0:p[g])===null||v===void 0?void 0:v.markedForSync}).map(g=>$a(g));f=n.transaction([...c,...d],l)}else f=n.transaction(c,l);if(l==="readwrite"){f.txid=Uf(16),f.opCount=0,f.currentUser=t.value,er.value.add(f),er.next(er.value);const d=()=>{f.removeEventListener("complete",g),f.removeEventListener("error",d),f.removeEventListener("abort",d),er.value.delete(f),er.next(er.value)},g=()=>{f.mutationsAdded&&!ci(e)&&Xt(e,"push"),d()};f.addEventListener("complete",g),f.addEventListener("error",d),f.addEventListener("abort",d)}return f},table:c=>{const l=n.table(c);if(/^\$/.test(c))return c.endsWith("_mutations")?Object.assign(Object.assign({},l),{mutate:p=>(p.type!=="add"&&p.type!=="put"||(p.trans.mutationsAdded=!0),l.mutate(p))}):c==="$logins"?Object.assign(Object.assign({},l),{mutate:p=>l.mutate(p).then(v=>(p.trans.mutationsAdded=!0,v)).catch(v=>Promise.reject(v))}):l;const{schema:f}=l,d=s.get(c);return d?(function(p){const v="$lock"+ ++Om;return Object.assign(Object.assign({},p),{count:Fr(p.count,v),get:Fr(p.get,v),getMany:Fr(p.getMany,v),openCursor:Fr(p.openCursor,v),query:Fr(p.query,v),mutate:Im(p.mutate,v)})})(Object.assign(Object.assign({},l),{mutate:p=>{var v,b,S;const A=p.trans;return A.txid?A.disableChangeTracking?l.mutate(p):!((b=(v=e.cloud.schema)===null||v===void 0?void 0:v[c])===null||b===void 0)&&b.markedForSync&&(!((S=A.currentUser)===null||S===void 0)&&S.isLoggedIn)?p.type==="deleteRange"?l.query({query:{range:p.range,index:f.primaryKey},trans:p.trans,values:!1}).then(N=>g({type:"delete",keys:N.result,trans:p.trans,criteria:{index:null,range:p.range}})):g(p):l.mutate(p):l.mutate(p)}})):l;function g(p){var v,b;const S=p.trans,A=(b=(v=e.cloud.options)===null||v===void 0?void 0:v.unsyncedProperties)===null||b===void 0?void 0:b[c],{txid:N,currentUser:{userId:U}}=S,{type:K}=p,W=++S.opCount;function L(ae){if(!A)return ae;let te=ae;for(const G of Object.keys(ae))A.some(ye=>G===ye||G.startsWith(ye+"."))&&(te===ae&&(te=Object.assign({},ae)),delete te[G]);return te}return l.mutate(p).then(ae=>{var te;const{numFailures:G,failures:ye}=ae;let ne=K==="delete"?p.keys:ae.results,X="values"in p?p.values:[],se="changeSpec"in p?p.changeSpec:void 0,V="updates"in p?p.updates:void 0,ge=!(!V||!("upsert"in p))&&p.upsert;if(G&&(ne=ne.filter((Y,ce)=>!ye[ce]),X=X.filter((Y,ce)=>!ye[ce])),A){if(X=X.map(Y=>{const ce=Object.assign({},Y);for(const ie of A)delete ce[ie];return ce}),se&&(se=L(se),Object.keys(se).length===0))return ae;if(V){let Y=V.changeSpecs.map(L),ce={keys:[],changeSpecs:[]};const ie=new rh;let Ce=!1;if(!ge){for(let he=0,ue=Y.length;he<ue;++he)Object.keys(Y[he]).length>0?(ce.keys.push(V.keys[he]),ce.changeSpecs.push(Y[he]),ie.addKey(V.keys[he])):Ce=!0;if(V=ce,Ce){let he=[],ue=[];for(let _e=0,Fe=ne.length;_e<Fe;++_e)ie.hasKey(ne[_e])&&(he.push(ne[_e]),ue.push(X[_e]));ne=he,X=ue}}}}const be=Date.now();let me="criteria"in p&&p.criteria?Object.assign(Object.assign({},p.criteria),{index:p.criteria.index===f.primaryKey.keyPath?null:p.criteria.index}):void 0;if(A&&(me!=null&&me.index)){const Y=(te=f.indexes.find(ce=>ce.name===me.index))===null||te===void 0?void 0:te.keyPath;(Y?typeof Y=="string"?[Y]:Y:[]).some(ce=>A==null?void 0:A.includes(ce))&&(me=void 0)}const le=p.type==="delete"?{type:"delete",ts:be,opNo:W,keys:ne,criteria:me,txid:N,userId:U}:p.type==="add"?{type:"insert",ts:be,opNo:W,keys:ne,txid:N,userId:U,values:X}:ge&&V?{type:"upsert",ts:be,opNo:W,keys:ne,values:X,changeSpecs:V.changeSpecs.filter((Y,ce)=>!ye[ce]),txid:N,userId:U}:me&&se?{type:"modify",ts:be,opNo:W,keys:ne,criteria:me,changeSpec:se,txid:N,userId:U}:se?{type:"update",ts:be,opNo:W,keys:ne,changeSpecs:ne.map(()=>se),txid:N,userId:U}:V?{type:"update",ts:be,opNo:W,keys:V.keys,changeSpecs:V.changeSpecs,txid:N,userId:U}:{type:"upsert",ts:be,opNo:W,keys:ne,values:X,txid:N,userId:U};return"isAdditionalChunk"in p&&p.isAdditionalChunk&&(le.isAdditionalChunk=!0),ne.length>0||me?d.mutate({type:"add",trans:S,values:[le]}).then(()=>(S.mutationsAdded=!0,ae)):ae})}}})}}}function Dm(t,e){return function(n,r){var i;const s=Object.assign(Object.assign({},Gi),n);Object.keys(Gi).forEach(d=>{const g=s[d];if(g==null)throw new Error(`Cannot delete table ${d} as it is needed for access control of Dexie Cloud`);if(!n[d])return;const p=g.split(",").map(S=>S.trim()),v=Gi[d].split(",").map(S=>S.trim()),b=new Set(p.map(S=>S.replace(/([&*]|\+\+)/g,"")));if(p[0]!==v[0])throw new Error(`Cannot override primary key of table ${d}. Please declare it as {${d}: ${JSON.stringify(Gi[d])}`);for(let S=1;S<v.length;++S){const A=v[S];b.has(A.replace(/([&*]|\+\+)/g,""))||(s[d]+=`,${A}`)}});const c=e.cloud.schema||(e.cloud.schema={}),l=new Set;Object.keys(s).forEach(d=>{var g;const p=(g=s[d])===null||g===void 0?void 0:g.trim(),v=c[d]||(c[d]={});p!=null?(/^\@/.test(p)&&(s[d]=s[d].substr(1),v.generatedGlobalId=!0,v.idPrefix=(function(b,S){let A=b[0].toLocaleLowerCase();for(let N=1,U=b.length;N<U&&A.length<3;++N)(xm.test(b[N])||Cm(b[N]))&&(A+=b[N].toLowerCase());for(;S.has(A);){if(/\d/g.test(A)){if(A=A.substr(0,A.length-1)+(A[A.length-1]+1),!(A.length>3))continue;A=A.substr(0,3)}else if(A.length<3){A+="2";continue}let N=1,U=A;for(;S.has(U)&&N<8;)U=Sm(A,N),++N;if(N<8)A=U;else{let K=A.charCodeAt(2)+1&127;A=A.substr(0,2)+String.fromCharCode(K)}}return A})(d,l),l.add(v.idPrefix)),/^\$/.test(d)||(s[`$${d}_mutations`]="++rev",v.markedForSync=!0),v.deleted&&(v.deleted=!1)):(v.deleted=!0,v.markedForSync=!1,s[`$${d}_mutations`]=null)});const f=t.call(this,s,r);for(const[d,g]of Object.entries(r))if(!((i=g.yProps)===null||i===void 0)&&i.length){const p=c[d];p&&(p.yProps=g.yProps.map(v=>v.prop))}return f}}function rd(t,e,n){return typeof navigator<"u"&&navigator.locks?navigator.locks.request(t.name+"|"+e,n):n()}const Jr=new Rt(!0),va=new Rt(!0);Jr.pipe(ut(t=>t?Zt(!0):Zt(!1).pipe(Eu(2e4))),Ou()).subscribe(va);const id=typeof document<"u"?Bt(document,"visibilitychange"):Zt({}),Tm=id.pipe(Et(()=>document.visibilityState==="hidden")),Rm=id.pipe(Et(()=>document.visibilityState==="visible")),sd=typeof window<"u"?As(Rm,Bt(window,"mousedown"),Bt(window,"mousemove"),Bt(window,"keydown"),Bt(window,"wheel"),Bt(window,"touchmove")):Zt({});typeof document<"u"&&As(Zt(!0),Tm,sd).pipe(bt(()=>document.visibilityState==="visible"),Zo(t=>{Jr.value!==t&&Jr.next(t)}),ut(t=>t?Zt(0).pipe(Eu(16e4),Zo(()=>Jr.next(!1))):Zt(0))).subscribe(()=>{});class Pm extends Error{constructor(){super(...arguments),this.name="TokenExpiredError"}}const od=new WeakMap,Ul=new WeakMap;function ad(t){let e=Ul.get(t);return e||(e=new Bn,Ul.set(t,e)),e}class jm extends Xe{constructor(e,n,r,i,s,c,l,f){super(d=>new Lm(e,n,r,i,s,f,d,c,l))}}let Um=0;class Lm extends yr{constructor(e,n,r,i,s,c,l,f,d){super(()=>this.teardown()),this.id=++Um,this.subscriptions=new Set,this.reconnecting=!1,this.db=e,this.databaseUrl=e.cloud.options.databaseUrl,this.rev=n,this.yrev=r,this.realmSetHash=i,this.clientIdentity=s,this.user=c,this.subscriber=l,this.lastUserActivity=new Date,this.messageProducer=f,this.webSocketStatus=d,this.connect()}teardown(){this.disconnect()}disconnect(){if(this.webSocketStatus.next("disconnected"),this.pinger&&(clearInterval(this.pinger),this.pinger=null),this.ws)try{this.ws.close()}catch{}this.ws=null;for(const e of this.subscriptions)e.unsubscribe();this.subscriptions.clear()}reconnect(){if(!this.reconnecting){this.reconnecting=!0;try{this.disconnect()}catch{}this.connect().catch(()=>{}).then(()=>this.reconnecting=!1)}}connect(){return Z(this,void 0,void 0,function*(){if(this.lastServerActivity=new Date,this.pauseUntil&&this.pauseUntil>new Date)return;if(this.ws)throw new Error("Called connect() when a connection is already open");if(!this.databaseUrl)throw new Error("Cannot connect without a database URL");if(this.closed)return;const e=this.user.accessTokenExpiration;if(e&&e<new Date)return void this.subscriber.error(new Pm);this.webSocketStatus.next("connecting"),this.pinger=setInterval(()=>Z(this,void 0,void 0,function*(){if(this.closed)this.teardown();else if(this.ws)try{this.ws.send(JSON.stringify({type:"ping"})),setTimeout(()=>{this.pinger&&(this.closed?this.teardown():this.lastServerActivity<new Date(Date.now()-2e4)&&this.reconnect())},2e4)}catch{this.reconnect()}else this.reconnect()}),3e4);const n=new URL(this.databaseUrl);n.protocol=n.protocol==="http:"?"ws":"wss";const r=new URLSearchParams;if(this.subscriber.closed)return;r.set("v","2"),this.rev&&r.set("rev",this.rev),this.yrev&&r.set("yrev",this.yrev),r.set("realmsHash",this.realmSetHash),r.set("clientId",this.clientIdentity),r.set("dxcv",this.db.cloud.version),this.user.accessToken&&r.set("token",this.user.accessToken);const i=this.ws=new WebSocket(`${n}/changes?${r}`);i.binaryType="arraybuffer",i.onclose=s=>{this.pinger&&this.reconnect()},i.onmessage=s=>{if(this.pinger){this.lastServerActivity=new Date;try{const c=typeof s.data=="string"?ai.parse(s.data):(function(l){const f=new wr(l),d=It(f);if(d==="outdated-server-rev")return{type:d};if(d==="y-complete-sync-done")return{type:d,yServerRev:It(f)};const g=It(f),p=It(f);switch(d){case"u-ack":case"u-reject":return{type:d,table:g,prop:p,i:Number(nl(f))};default:{const v=bn(f);switch(d){case"in-sync":case"doc-close":return{type:d,table:g,prop:p,k:v};case"aware":return{type:d,table:g,prop:p,k:v,u:st(f)};case"doc-open":return{type:d,table:g,prop:p,k:v,serverRev:bn(f),sv:bn(f)};case"sv":return{type:d,table:g,prop:p,k:v,sv:st(f)};case"u-c":return{type:d,table:g,prop:p,k:v,u:st(f),i:Number(nl(f))};case"u-s":return{type:d,table:g,prop:p,k:v,u:st(f),r:f.pos<f.arr.length&&It(f)||void 0};default:throw new TypeError(`Unknown message type: ${d}`)}}}})(new Uint8Array(s.data));if(c.type==="error")throw new Error(`Error message from dexie-cloud: ${c.error}`);if(c.type==="aware"){const l=ft.getDocCache(this.db.dx).find(c.table,c.k,c.prop);if(l){const f=(d=>od.get(d))(l);f&&Pg(f,c.u,"server")}}else if(c.type!=="pong")if(c.type==="doc-open"){const l=ft.getDocCache(this.db.dx).find(c.table,c.k,c.prop);l&&ad(l).next()}else c.type==="u-ack"||c.type==="u-reject"||c.type==="u-s"||c.type==="in-sync"||c.type==="outdated-server-rev"||c.type==="y-complete-sync-done"?Yf([c],this.db).then(l=>Z(this,[l],void 0,function*({resyncNeeded:f,yServerRevision:d,receivedUntils:g}){if(d&&(yield this.db.$syncState.update("syncState",{yServerRevision:d})),c.type==="u-s"&&g){const p=Gr(this.db,c.table,c.prop);if(p){const v=g[p.name];v&&(yield p.update(wn,{receivedUntil:v}))}}f&&(yield this.db.cloud.sync({purpose:"pull",wait:!0}))})):this.subscriber.next(c)}catch(c){this.subscriber.error(c)}}};try{let s=!1;yield new Promise((c,l)=>{i.onopen=f=>{s=!0,c(null)},i.onerror=f=>{if(s)this.reconnect();else{const d=f.error||new Error("WebSocket Error");this.subscriber.error(d),this.webSocketStatus.next("error"),l(d)}}}),this.subscriptions.add(this.messageProducer.subscribe(c=>{var l,f;this.closed||(c.type==="ready"&&this.webSocketStatus.value!=="connected"&&this.webSocketStatus.next("connected"),c.type==="ready"?(this.rev=c.rev,(l=this.ws)===null||l===void 0||l.send(ai.stringify(c))):(f=this.ws)===null||f===void 0||f.send((function(d){const g=new vr;switch(Ot(g,d.type),"table"in d&&Ot(g,d.table),"prop"in d&&Ot(g,d.prop),d.type){case"u-ack":case"u-reject":Xc(g,BigInt(d.i));break;case"outdated-server-rev":break;case"y-complete-sync-done":Ot(g,d.yServerRev);break;default:switch(vn(g,d.k),d.type){case"aware":it(g,d.u);break;case"doc-open":vn(g,d.serverRev),vn(g,d.sv);break;case"doc-close":break;case"sv":it(g,d.sv);break;case"u-c":it(g,d.u),Xc(g,BigInt(d.i));break;case"u-s":it(g,d.u),Ot(g,d.r||"")}}return wt(g)})(c)))})),this.user.isLoggedIn&&!ci(this.db)&&this.subscriptions.add((function(c){const l=qa(c.tables.filter(f=>{var d,g;return((g=(d=c.cloud.schema)===null||d===void 0?void 0:d[f.name])===null||g===void 0?void 0:g.markedForSync)&&f.schema.yProps}).map(f=>f.schema.yProps.map(d=>({table:f.name,ydocProp:d.prop,updatesTable:d.updatesTable}))));return As(...l.map(({table:f,ydocProp:d,updatesTable:g})=>{const p=c.table(g);return _t(p.get(wn)).pipe(ut(v=>{let b=(v==null?void 0:v.unsentFrom)||1;return _t(gn(()=>Z(this,void 0,void 0,function*(){return(yield zf(p,b)).filter(S=>S.f&&1&S.f).map(S=>({type:"u-c",table:f,prop:d,k:S.k,u:S.u,i:S.i}))}))).pipe(Zo(S=>{S.length>0&&(b=S.at(-1).i+1)}))}))})).pipe(di(f=>f))})(this.db).subscribe(this.db.messageProducer))}catch{this.pauseUntil=new Date(Date.now()+6e4)}})}}class Mm extends Error{constructor(e){super(e==="expired"?"License expired":e==="deactivated"?"User deactivated":"Invalid license"),this.name="InvalidLicenseError",e&&(this.license=e)}}function Nm(t){return Z(this,void 0,void 0,function*(){var e;yield(e=3e3,new Promise(n=>setTimeout(n,e))),yield Un(sd)})}function Ll(t){return Z(this,void 0,void 0,function*(){var e;return!(!(!((e=t.cloud.options)===null||e===void 0)&&e.databaseUrl)||!t.cloud.schema)&&(yield Bs(t,t.cloud.options,t.cloud.schema,{justCheckIfNeeded:!0}))})}const Zi=new WeakMap;function Ha(t,e,n,r){const i=Zi.get(t);if(i){if(i.pull||(r==null?void 0:r.purpose)==="push")return i.promise;{let c=!1;const l=t.cloud.syncState.subscribe(f=>{f.phase==="pulling"&&(c=!0)});return i.promise.then(()=>{l.unsubscribe()}).catch(f=>(l.unsubscribe(),Promise.reject(f))).then(()=>{if(!c)return Ha(t,e,n,r)})}}const s=(function(){return Z(this,void 0,void 0,function*(){try{yield Vf(t),yield rd(t,Gf,()=>Bs(t,e,n,r)),Zi.delete(t)}catch(c){throw Zi.delete(t),c}})})();return Zi.set(t,{promise:s,pull:(r==null?void 0:r.purpose)!=="push"}),s}function Km(t,e,n){let r=null,i={cancelled:!1},s=0,c=0;function l(b=1){setTimeout(()=>{const S=f?"pull":"push";c=Date.now(),Ha(t,e,n,{cancelToken:i,retryImmediatelyOnFetchError:!0,purpose:S}).then(()=>{if(i.cancelled)v();else if(f||d)return f=!1,d=!1,l();g=!1,s=0,c=0}).catch(A=>{if(i.cancelled)v(),g=!1,s=0,c=0;else if(b<5){const N=1e3*[0,20,40,300,900][b];s=Date.now()+N,c=0,setTimeout(()=>l(b+1),N)}else g=!1,s=0,c=0})},0)}let f=!1,d=!1,g=!1;const p=b=>{i.cancelled||(b==="pull"&&(f=!0),b==="push"&&(d=!0),g?s||c>0&&Date.now():(g=!0,l()))},v=()=>{i.cancelled=!0,r&&r.unsubscribe()};return{start:()=>{r=t.localSyncEvent.subscribe(({purpose:b})=>{p(b||"pull")})},stop:v}}function Wo(t,e){if(t&&e&&e.unsyncedTables)for(const n of e.unsyncedTables)t[n]&&(t[n].markedForSync=!1)}var Fs,Me,cd,jn,Ml,ld,ud,fd,za,ba,wa,li={},dd=[],Bm=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,$s=Array.isArray;function Qt(t,e){for(var n in e)t[n]=e[n];return t}function Ya(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function Oe(t,e,n){var r,i,s,c={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:c[s]=e[s];if(arguments.length>2&&(c.children=arguments.length>3?Fs.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)c[s]===void 0&&(c[s]=t.defaultProps[s]);return us(t,c,r,i,null)}function us(t,e,n,r,i){var s={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++cd,__i:-1,__u:0};return i==null&&Me.vnode!=null&&Me.vnode(s),s}function Nn(t){return t.children}function Xr(t,e){this.props=t,this.context=e}function pr(t,e){if(e==null)return t.__?pr(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?pr(t):null}function hd(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return hd(t)}}function Nl(t){(!t.__d&&(t.__d=!0)&&jn.push(t)&&!xs.__r++||Ml!=Me.debounceRendering)&&((Ml=Me.debounceRendering)||ld)(xs)}function xs(){for(var t,e,n,r,i,s,c,l=1;jn.length;)jn.length>l&&jn.sort(ud),t=jn.shift(),l=jn.length,t.__d&&(n=void 0,r=void 0,i=(r=(e=t).__v).__e,s=[],c=[],e.__P&&((n=Qt({},r)).__v=r.__v+1,Me.vnode&&Me.vnode(n),Ga(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??pr(r),!!(32&r.__u),c),n.__v=r.__v,n.__.__k[n.__i]=n,gd(s,n,c),r.__e=r.__=null,n.__e!=i&&hd(n)));xs.__r=0}function pd(t,e,n,r,i,s,c,l,f,d,g){var p,v,b,S,A,N,U,K=r&&r.__k||dd,W=e.length;for(f=(function(L,ae,te,G,ye){var ne,X,se,V,ge,be=te.length,me=be,le=0;for(L.__k=new Array(ye),ne=0;ne<ye;ne++)(X=ae[ne])!=null&&typeof X!="boolean"&&typeof X!="function"?(typeof X=="string"||typeof X=="number"||typeof X=="bigint"||X.constructor==String?X=L.__k[ne]=us(null,X,null,null,null):$s(X)?X=L.__k[ne]=us(Nn,{children:X},null,null,null):X.constructor==null&&X.__b>0?X=L.__k[ne]=us(X.type,X.props,X.key,X.ref?X.ref:null,X.__v):L.__k[ne]=X,V=ne+le,X.__=L,X.__b=L.__b+1,(ge=X.__i=Fm(X,te,V,me))!=-1&&(me--,(se=te[ge])&&(se.__u|=2)),se==null||se.__v==null?(ge==-1&&(ye>be?le--:ye<be&&le++),typeof X.type!="function"&&(X.__u|=4)):ge!=V&&(ge==V-1?le--:ge==V+1?le++:(ge>V?le--:le++,X.__u|=4))):L.__k[ne]=null;if(me)for(ne=0;ne<be;ne++)(se=te[ne])!=null&&!(2&se.__u)&&(se.__e==G&&(G=pr(se)),vd(se,se));return G})(n,e,K,f,W),p=0;p<W;p++)(b=n.__k[p])!=null&&(v=b.__i==-1?li:K[b.__i]||li,b.__i=p,N=Ga(t,b,v,i,s,c,l,f,d,g),S=b.__e,b.ref&&v.ref!=b.ref&&(v.ref&&Ja(v.ref,null,b),g.push(b.ref,b.__c||S,b)),A==null&&S!=null&&(A=S),(U=!!(4&b.__u))||v.__k===b.__k?f=yd(b,f,t,U):typeof b.type=="function"&&N!==void 0?f=N:S&&(f=S.nextSibling),b.__u&=-7);return n.__e=A,f}function yd(t,e,n,r){var i,s;if(typeof t.type=="function"){for(i=t.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=t,e=yd(i[s],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=pr(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function Fm(t,e,n,r){var i,s,c,l=t.key,f=t.type,d=e[n],g=d!=null&&!(2&d.__u);if(d===null&&l==null||g&&l==d.key&&f==d.type)return n;if(r>(g?1:0)){for(i=n-1,s=n+1;i>=0||s<e.length;)if((d=e[c=i>=0?i--:s++])!=null&&!(2&d.__u)&&l==d.key&&f==d.type)return c}return-1}function Kl(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||Bm.test(e)?n:n+"px"}function es(t,e,n,r,i){var s,c;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||Kl(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||Kl(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(fd,"$1")),c=e.toLowerCase(),e=c in t||e=="onFocusOut"||e=="onFocusIn"?c.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?r?n.u=r.u:(n.u=za,t.addEventListener(e,s?wa:ba,s)):t.removeEventListener(e,s?wa:ba,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Bl(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=za++;else if(e.t<n.u)return;return n(Me.event?Me.event(e):e)}}}function Ga(t,e,n,r,i,s,c,l,f,d){var g,p,v,b,S,A,N,U,K,W,L,ae,te,G,ye,ne,X,se=e.type;if(e.constructor!=null)return null;128&n.__u&&(f=!!(32&n.__u),s=[l=e.__e=n.__e]),(g=Me.__b)&&g(e);e:if(typeof se=="function")try{if(U=e.props,K="prototype"in se&&se.prototype.render,W=(g=se.contextType)&&r[g.__c],L=g?W?W.props.value:g.__:r,n.__c?N=(p=e.__c=n.__c).__=p.__E:(K?e.__c=p=new se(U,L):(e.__c=p=new Xr(U,L),p.constructor=se,p.render=qm),W&&W.sub(p),p.state||(p.state={}),p.__n=r,v=p.__d=!0,p.__h=[],p._sb=[]),K&&p.__s==null&&(p.__s=p.state),K&&se.getDerivedStateFromProps!=null&&(p.__s==p.state&&(p.__s=Qt({},p.__s)),Qt(p.__s,se.getDerivedStateFromProps(U,p.__s))),b=p.props,S=p.state,p.__v=e,v)K&&se.getDerivedStateFromProps==null&&p.componentWillMount!=null&&p.componentWillMount(),K&&p.componentDidMount!=null&&p.__h.push(p.componentDidMount);else{if(K&&se.getDerivedStateFromProps==null&&U!==b&&p.componentWillReceiveProps!=null&&p.componentWillReceiveProps(U,L),e.__v==n.__v||!p.__e&&p.shouldComponentUpdate!=null&&p.shouldComponentUpdate(U,p.__s,L)===!1){for(e.__v!=n.__v&&(p.props=U,p.state=p.__s,p.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(V){V&&(V.__=e)}),ae=0;ae<p._sb.length;ae++)p.__h.push(p._sb[ae]);p._sb=[],p.__h.length&&c.push(p);break e}p.componentWillUpdate!=null&&p.componentWillUpdate(U,p.__s,L),K&&p.componentDidUpdate!=null&&p.__h.push(function(){p.componentDidUpdate(b,S,A)})}if(p.context=L,p.props=U,p.__P=t,p.__e=!1,te=Me.__r,G=0,K){for(p.state=p.__s,p.__d=!1,te&&te(e),g=p.render(p.props,p.state,p.context),ye=0;ye<p._sb.length;ye++)p.__h.push(p._sb[ye]);p._sb=[]}else do p.__d=!1,te&&te(e),g=p.render(p.props,p.state,p.context),p.state=p.__s;while(p.__d&&++G<25);p.state=p.__s,p.getChildContext!=null&&(r=Qt(Qt({},r),p.getChildContext())),K&&!v&&p.getSnapshotBeforeUpdate!=null&&(A=p.getSnapshotBeforeUpdate(b,S)),ne=g,g!=null&&g.type===Nn&&g.key==null&&(ne=md(g.props.children)),l=pd(t,$s(ne)?ne:[ne],e,n,r,i,s,c,l,f,d),p.base=e.__e,e.__u&=-161,p.__h.length&&c.push(p),N&&(p.__E=p.__=null)}catch(V){if(e.__v=null,f||s!=null)if(V.then){for(e.__u|=f?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;s[s.indexOf(l)]=null,e.__e=l}else{for(X=s.length;X--;)Ya(s[X]);_a(e)}else e.__e=n.__e,e.__k=n.__k,V.then||_a(e);Me.__e(V,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):l=e.__e=$m(n.__e,e,n,r,i,s,c,f,d);return(g=Me.diffed)&&g(e),128&e.__u?void 0:l}function _a(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(_a)}function gd(t,e,n){for(var r=0;r<n.length;r++)Ja(n[r],n[++r],n[++r]);Me.__c&&Me.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(s){s.call(i)})}catch(s){Me.__e(s,i.__v)}})}function md(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:$s(t)?t.map(md):Qt({},t)}function $m(t,e,n,r,i,s,c,l,f){var d,g,p,v,b,S,A,N=n.props||li,U=e.props,K=e.type;if(K=="svg"?i="http://www.w3.org/2000/svg":K=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(d=0;d<s.length;d++)if((b=s[d])&&"setAttribute"in b==!!K&&(K?b.localName==K:b.nodeType==3)){t=b,s[d]=null;break}}if(t==null){if(K==null)return document.createTextNode(U);t=document.createElementNS(i,K,U.is&&U),l&&(Me.__m&&Me.__m(e,s),l=!1),s=null}if(K==null)N===U||l&&t.data==U||(t.data=U);else{if(s=s&&Fs.call(t.childNodes),!l&&s!=null)for(N={},d=0;d<t.attributes.length;d++)N[(b=t.attributes[d]).name]=b.value;for(d in N)if(b=N[d],d!="children"){if(d=="dangerouslySetInnerHTML")p=b;else if(!(d in U)){if(d=="value"&&"defaultValue"in U||d=="checked"&&"defaultChecked"in U)continue;es(t,d,null,b,i)}}for(d in U)b=U[d],d=="children"?v=b:d=="dangerouslySetInnerHTML"?g=b:d=="value"?S=b:d=="checked"?A=b:l&&typeof b!="function"||N[d]===b||es(t,d,b,N[d],i);if(g)l||p&&(g.__html==p.__html||g.__html==t.innerHTML)||(t.innerHTML=g.__html),e.__k=[];else if(p&&(t.innerHTML=""),pd(e.type=="template"?t.content:t,$s(v)?v:[v],e,n,r,K=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,c,s?s[0]:n.__k&&pr(n,0),l,f),s!=null)for(d=s.length;d--;)Ya(s[d]);l||(d="value",K=="progress"&&S==null?t.removeAttribute("value"):S!=null&&(S!==t[d]||K=="progress"&&!S||K=="option"&&S!=N[d])&&es(t,d,S,N[d],i),d="checked",A!=null&&A!=t[d]&&es(t,d,A,N[d],i))}return t}function Ja(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(i){Me.__e(i,n)}}function vd(t,e,n){var r,i;if(Me.unmount&&Me.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||Ja(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){Me.__e(s,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&vd(r[i],e,n||typeof t.type!="function");n||Ya(t.__e),t.__c=t.__=t.__e=void 0}function qm(t,e,n){return this.constructor(t,n)}function Fl(t,e,n){var r,i,s;e==document&&(e=document.documentElement),Me.__&&Me.__(t,e),r=e.__k,i=[],s=[],Ga(e,t=e.__k=Oe(Nn,null,[t]),r||li,li,e.namespaceURI,r?null:e.firstChild?Fs.call(e.childNodes):null,i,r?r.__e:e.firstChild,!1,s),gd(i,t,s)}Fs=dd.slice,Me={__e:function(t,e,n,r){for(var i,s,c;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(t)),c=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,r||{}),c=i.__d),c)return i.__E=i}catch(l){t=l}throw t}},cd=0,Xr.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=Qt({},this.state),typeof t=="function"&&(t=t(Qt({},n),this.props)),t&&Qt(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),Nl(this))},Xr.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Nl(this))},Xr.prototype.render=Nn,jn=[],ld=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ud=function(t,e){return t.__v.__b-e.__v.__b},xs.__r=0,fd=/(PointerCapture)$|Capture$/i,za=0,ba=Bl(!1),wa=Bl(!0);const Ke={Alert:{error:{color:"red",fontWeight:"bold"},warning:{color:"#f80",fontWeight:"bold"},info:{color:"black"}},Darken:{position:"fixed",top:0,left:0,opacity:.5,backgroundColor:"#000",width:"100vw",height:"100vh",zIndex:150,webkitBackdropFilter:"blur(2px)",backdropFilter:"blur(2px)"},DialogOuter:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:150,alignItems:"center",display:"flex",justifyContent:"center",padding:"16px",boxSizing:"border-box"},DialogInner:{position:"relative",color:"#222",backgroundColor:"#fff",padding:"24px",marginBottom:"2em",maxWidth:"400px",width:"100%",maxHeight:"90%",overflowY:"auto",border:"3px solid #3d3d5d",borderRadius:"8px",boxShadow:"0 0 80px 10px #666",fontFamily:"sans-serif",boxSizing:"border-box"},Input:{height:"35px",width:"100%",maxWidth:"100%",borderColor:"#ccf4",outline:"none",fontSize:"16px",padding:"8px",boxSizing:"border-box",backgroundColor:"#f9f9f9",borderRadius:"4px",border:"1px solid #ccc",marginTop:"6px",fontFamily:"inherit"},Button:{padding:"10px 20px",margin:"0 4px",border:"1px solid #d1d5db",borderRadius:"6px",backgroundColor:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#374151",transition:"all 0.2s ease"},PrimaryButton:{padding:"10px 20px",margin:"0 4px",border:"1px solid #3b82f6",borderRadius:"6px",backgroundColor:"#3b82f6",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s ease"},ButtonsDiv:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"24px",paddingTop:"20px"},Label:{display:"block",marginBottom:"12px",fontSize:"14px",fontWeight:"500",color:"#333"},WindowHeader:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600",color:"#333",borderBottom:"1px solid #eee",paddingBottom:"10px"},ProviderButton:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"12px 16px",marginBottom:"10px",border:"1px solid #d1d5db",borderRadius:"6px",backgroundColor:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#374151",transition:"all 0.2s ease",gap:"12px"},ProviderButtonIcon:{width:"20px",height:"20px",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center"},ProviderButtonText:{flex:1,textAlign:"left"},ProviderGoogle:{backgroundColor:"#ffffff",border:"1px solid #dadce0",color:"#3c4043"},ProviderGitHub:{backgroundColor:"#24292e",border:"1px solid #24292e",color:"#ffffff"},ProviderMicrosoft:{backgroundColor:"#ffffff",border:"1px solid #8c8c8c",color:"#5e5e5e"},ProviderApple:{backgroundColor:"#000000",border:"1px solid #000000",color:"#ffffff"},ProviderCustom:{backgroundColor:"#4f46e5",border:"1px solid #4f46e5",color:"#ffffff"},Divider:{display:"flex",alignItems:"center",margin:"20px 0",color:"#6b7280",fontSize:"13px"},DividerLine:{flex:1,height:"1px",backgroundColor:"#e5e7eb"},DividerText:{padding:"0 12px",color:"#9ca3af"},OtpButton:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",padding:"12px 16px",border:"1px solid #d1d5db",borderRadius:"6px",backgroundColor:"#f9fafb",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#374151",transition:"all 0.2s ease",gap:"12px"}};function Vm({children:t,className:e}){return Oe("div",{className:`dexie-dialog ${e||""}`},Oe("div",{style:Ke.Darken}),Oe("div",{style:Ke.DialogOuter},Oe("div",{style:Ke.DialogInner},t)))}var ui,He,Ho,$l,Cs=0,bd=[],Ye=Me,ql=Ye.__b,Vl=Ye.__r,Wl=Ye.diffed,Hl=Ye.__c,zl=Ye.unmount,Yl=Ye.__;function Xa(t,e){Ye.__h&&Ye.__h(He,t,Cs||e),Cs=0;var n=He.__H||(He.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function Wm(t){return Cs=1,(function(e,n){var r=Xa(ui++,2);if(r.t=e,!r.__c&&(r.__=[Jl(void 0,n),function(l){var f=r.__N?r.__N[0]:r.__[0],d=r.t(f,l);f!==d&&(r.__N=[d,r.__[1]],r.__c.setState({}))}],r.__c=He,!He.__f)){var i=function(l,f,d){if(!r.__c.__H)return!0;var g=r.__c.__H.__.filter(function(v){return!!v.__c});if(g.every(function(v){return!v.__N}))return!s||s.call(this,l,f,d);var p=r.__c.props!==l;return g.forEach(function(v){if(v.__N){var b=v.__[0];v.__=v.__N,v.__N=void 0,b!==v.__[0]&&(p=!0)}}),s&&s.call(this,l,f,d)||p};He.__f=!0;var s=He.shouldComponentUpdate,c=He.componentWillUpdate;He.componentWillUpdate=function(l,f,d){if(this.__e){var g=s;s=void 0,i(l,f,d),s=g}c&&c.call(this,l,f,d)},He.shouldComponentUpdate=i}return r.__N||r.__})(Jl,t)}function Hm(t){return Cs=5,(function(e,n){var r=Xa(ui++,7);return wd(r.__H,n)&&(r.__=e(),r.__H=n,r.__h=e),r.__})(function(){return{current:t}},[])}function zm(){for(var t;t=bd.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(fs),t.__H.__h.forEach(ka),t.__H.__h=[]}catch(e){t.__H.__h=[],Ye.__e(e,t.__v)}}Ye.__b=function(t){He=null,ql&&ql(t)},Ye.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Yl&&Yl(t,e)},Ye.__r=function(t){Vl&&Vl(t),ui=0;var e=(He=t.__c).__H;e&&(Ho===He?(e.__h=[],He.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(fs),e.__h.forEach(ka),e.__h=[],ui=0)),Ho=He},Ye.diffed=function(t){Wl&&Wl(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(bd.push(e)!==1&&$l===Ye.requestAnimationFrame||(($l=Ye.requestAnimationFrame)||Ym)(zm)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Ho=He=null},Ye.__c=function(t,e){e.some(function(n){try{n.__h.forEach(fs),n.__h=n.__h.filter(function(r){return!r.__||ka(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],Ye.__e(r,n.__v)}}),Hl&&Hl(t,e)},Ye.unmount=function(t){zl&&zl(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{fs(r)}catch(i){e=i}}),n.__H=void 0,e&&Ye.__e(e,n.__v))};var Gl=typeof requestAnimationFrame=="function";function Ym(t){var e,n=function(){clearTimeout(r),Gl&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);Gl&&(e=requestAnimationFrame(n))}function fs(t){var e=He,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),He=e}function ka(t){var e=He;t.__c=t.__(),He=e}function wd(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Jl(t,e){return typeof e=="function"?e(t):e}function Xl({option:t,onClick:e}){const{displayName:n,iconUrl:r,iconSvg:i,styleHint:s,value:c}=t,l=(function(g){const p=Object.assign({},Ke.ProviderButton);if(!g)return p;switch(g){case"google":return Object.assign(Object.assign({},p),Ke.ProviderGoogle);case"github":return Object.assign(Object.assign({},p),Ke.ProviderGitHub);case"microsoft":return Object.assign(Object.assign({},p),Ke.ProviderMicrosoft);case"apple":return Object.assign(Object.assign({},p),Ke.ProviderApple);case"otp":return Object.assign({},Ke.OtpButton);case"custom-oauth2":return Object.assign(Object.assign({},p),Ke.ProviderCustom);default:return p}})(s),f=l.color||"#000000",d=i?i.replace(/fill="currentColor"/gi,`fill="${f}"`).replace(/fill='currentColor'/gi,`fill='${f}'`).replace(/stroke="currentColor"/gi,`stroke="${f}"`).replace(/stroke='currentColor'/gi,`stroke='${f}'`):null;return Oe("button",{type:"button",style:l,onClick:e,class:"dxc-option-btn"+(s?` dxc-option-${s}`:""),"aria-label":n},d?Oe("span",{style:Ke.ProviderButtonIcon,"aria-hidden":"true",dangerouslySetInnerHTML:{__html:d}}):r?Oe("img",{src:r,alt:"",style:Ke.ProviderButtonIcon,"aria-hidden":"true"}):null,Oe("span",{style:Ke.ProviderButtonText},n))}function Ql(){return Oe("div",{style:Ke.Divider},Oe("div",{style:Ke.DividerLine}),Oe("span",{style:Ke.DividerText},"or"),Oe("div",{style:Ke.DividerLine}))}function Gm({title:t,alerts:e,fields:n,options:r,submitLabel:i,cancelLabel:s,onCancel:c,onSubmit:l}){const[f,d]=Wm({}),g=Hm(null);(function(U,K){var W=Xa(ui++,4);!Ye.__s&&wd(W.__H,K)&&(W.__=U,W.u=K,He.__h.push(W))})(()=>{var U;return(U=g.current)===null||U===void 0?void 0:U.focus()},[]);const p=Object.entries(n||{}),v=p.length>0,b=r&&r.length>0,S=new Map;if(r)for(const U of r){const K=S.get(U.name)||[];K.push(U),S.set(U.name,K)}const A=S.size>1,N=U=>{l({[U.name]:U.value})};return Oe(Vm,{className:"dxc-login-dlg"},Oe(Nn,null,Oe("h3",{style:Ke.WindowHeader},t),e.map((U,K)=>Oe("p",{key:K,style:Ke.Alert[U.type]},(function({message:W,messageCode:L,messageParams:ae}){return W.replace(/\{\w+\}/gi,te=>ae[te.substring(1,te.length-1)])})(U))),b&&Oe("div",{class:"dxc-options"},A?Array.from(S.entries()).map(([U,K],W)=>Oe(Nn,{key:U},W>0&&Oe(Ql,null),K.map(L=>Oe(Xl,{key:`${L.name}-${L.value}`,option:L,onClick:()=>N(L)})))):r.map(U=>Oe(Xl,{key:`${U.name}-${U.value}`,option:U,onClick:()=>N(U)}))),b&&v&&Oe(Ql,null),v&&Oe("form",{onSubmit:U=>{U.preventDefault(),l(f)}},p.map(([U,{type:K,label:W,placeholder:L}],ae)=>Oe("label",{style:Ke.Label,key:ae},W?`${W}: `:"",Oe("input",{ref:ae===0?g:void 0,type:K,name:U,autoComplete:"on",style:Ke.Input,autoFocus:!0,placeholder:L,value:f[U]||"",onInput:te=>{var G;const ye=(function(X,se){switch(X){case"email":return se.toLowerCase();case"otp":return se.toUpperCase();default:return se}})(K,(G=te.target)===null||G===void 0?void 0:G.value);let ne=Object.assign(Object.assign({},f),{[U]:ye});d(ne),K==="otp"&&(ye==null?void 0:ye.trim().length)===8&&l(ne)}}))))),Oe("div",{style:Ke.ButtonsDiv},Oe(Nn,null,v&&i&&Oe("button",{type:"submit",style:Ke.PrimaryButton,onClick:()=>l(f)},i),s&&Oe("button",{style:Ke.Button,onClick:c},s))))}class Zl extends Xr{constructor(e){super(e),this.observer=n=>this.setState({userInteraction:n}),this.state={userInteraction:void 0}}componentDidMount(){this.subscription=_t(this.props.db.cloud.userInteraction).subscribe(this.observer)}componentWillUnmount(){this.subscription&&(this.subscription.unsubscribe(),delete this.subscription)}render(e,{userInteraction:n}){return n?Oe(Gm,Object.assign({},n)):null}}function vi(t){const e=new WeakMap;return n=>{let r=e.get(n);return r||(r=t(n),e.set(n,r)),r}}const Es=vi(t=>new Rt(ht));function qs(t,e){let n=e,r=_t(t).pipe(bt(s=>n=s),ap({resetOnRefCountZero:()=>Cu(1e3)}));const i=new Xe(s=>{let c=!1;const l=r.subscribe({next(f){c=!0,s.next(f)},error(f){s.error(f)},complete(){s.complete()}});return c||l.closed||s.next(n),l});return i.getValue=()=>n,i}const _d=vi(t=>qs(gn(()=>t.roles.where({realmId:"rlm-public"}).toArray().then(e=>{const n={};for(const r of e.slice().sort((i,s)=>(i.sortOrder||0)-(s.sortOrder||0)))n[r.name]=r;return n})),{})),kd=vi(t=>qs(Es(t._novip).pipe(ut(e=>gn(()=>t.transaction("r","realms","members",()=>Promise.all([t.members.where({userId:e.userId}).toArray(),t.realms.toArray(),e.userId]).then(([n,r,i])=>({selfMembers:n,realms:r,userId:i})))))),{selfMembers:[],realms:[],get userId(){return t.cloud.currentUserId}}));function Jm(...t){return t.length===0?{}:t.reduce((n,r)=>{const i=Object.assign({},n);for(const[s,c]of Object.entries(r))if(s in i&&i[s]){if(i[s]==="*")continue;if(c==="*")i[s]="*";else if(Array.isArray(c)&&Array.isArray(i[s])){const l=i,f=l[s];l[s]=[...new Set([...f,...c])]}else if(typeof c=="object"&&c&&typeof i[s]=="object"){const l=i[s];for(const[f,d]of Object.entries(c))l[f]!=="*"&&(d==="*"?l[f]="*":Array.isArray(l[f])&&Array.isArray(d)&&(l[f]=[...new Set([...l[f],...d])]))}}else i[s]=r[s];return i})}const Sd=vi(t=>(function(e,n){let r;const i=e.pipe(bt(s=>r=n(s)));return i.getValue=()=>r!==void 0?r:r=n(e.getValue()),i})(qs(Zr([kd(t._novip),_d(t._novip)]).pipe(bt(([{selfMembers:e,realms:n,userId:r},i])=>({selfMembers:e,realms:n,userId:r,globalRoles:i}))),{selfMembers:[],realms:[],userId:ht.userId,globalRoles:{}}),({selfMembers:e,realms:n,userId:r,globalRoles:i})=>n.map(c=>{const l=e.filter(g=>g.realmId===c.realmId),f=l.map(g=>g.permissions).filter(g=>g),d=qa(l.map(g=>g.roles).filter(g=>g)).map(g=>i[g]).filter(g=>g).map(g=>g.permissions);return Object.assign(Object.assign({},c),{permissions:c.owner===r?{manage:"*"}:Jm(...f,...d)})}).reduce((c,l)=>Object.assign(Object.assign({},c),{[l.realmId]:l}),{[r]:{realmId:r,owner:r,name:r,permissions:{manage:"*"}}})));class eu{constructor(e,n,r){this.permissions=e||{},this.tableName=n,this.isOwner=r}add(...e){var n;return this.permissions.manage==="*"||!!(!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))||this.permissions.add==="*"||!!e.every(r=>{var i;return(i=this.permissions.add)===null||i===void 0?void 0:i.includes(r)})}update(...e){var n,r;if(this.isOwner||this.permissions.manage==="*"||!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))return!0;if(this.permissions.update==="*")return e.every(s=>s!=="owner");const i=(r=this.permissions.update)===null||r===void 0?void 0:r[this.tableName];return i==="*"?e.every(s=>s!=="owner"):e.every(s=>i==null?void 0:i.some(c=>c===s||c==="*"&&s!=="owner"))}delete(){var e;return!(!this.isOwner&&this.permissions.manage!=="*")||!!(!((e=this.permissions.manage)===null||e===void 0)&&e.includes(this.tableName))}}const Xm=vi(t=>{const e=Es(t._novip).pipe(ut(i=>gn(()=>t.members.where({email:i.email||""}).toArray()))),n=Sd(t._novip),r=kd(t._novip);return qs(Zr([e,r,n]).pipe(bt(([i,s,c])=>{const l=(g,p)=>Object.assign(Object.assign({},g),{[p.id]:Object.assign(Object.assign({},p),{realm:c[p.realmId]})}),f=i.reduce(l,{}),d=s.selfMembers.reduce(l,f);return Object.values(d).filter(g=>!g.accepted).map(g=>Object.assign(Object.assign({},g),{accept(){return Z(this,void 0,void 0,function*(){yield t.members.update(g.id,{accepted:new Date})})},reject(){return Z(this,void 0,void 0,function*(){yield t.members.update(g.id,{rejected:new Date})})}}))})),[])});function Qm(t){return e=>{var n;const r=e.doc;if(!r)throw new Error("Internal error: DexieYProvider.createYHandler called without a doc. This is unexpected.");const{parentTable:i}=r.meta||{};if(!(!((n=t.cloud.schema)===null||n===void 0)&&n[i].markedForSync))return;let s;Object.defineProperty(e,"awareness",{get:()=>s||(s=(function(c,l,f){const{parentTable:d,parentId:g,parentProp:p,updatesTable:v}=l.meta,b=new Tg(l),S=ad(l);return b.on("update",({added:A,updated:N,removed:U},K)=>{const W=A.concat(N).concat(U),L=c.cloud.currentUser.value;if(K!=="server"&&L.isLoggedIn&&!ci(c)){const ae=Rg(b,W);c.messageProducer.next({type:"aware",table:d,prop:p,k:l.meta.parentId,u:ae}),f.destroyed&&c.messageProducer.next({type:"doc-close",table:d,prop:p,k:l.meta.parentId})}}),b.on("destroy",()=>{Rf(b,[l.clientID],"provider destroyed")}),Z(this,void 0,void 0,function*(){if(f.destroyed)return;let A=!1,N=1;const U=Zr([c.cloud.webSocketStatus,S.pipe(Iu(null))]).subscribe(([W])=>{if(f.destroyed)return;A=W==="connected";const L=c.cloud.currentUser.value;W==="connected"&&L.isLoggedIn&&!ci(c)&&(++N,K().catch(ae=>{}))});function K(){return Z(this,void 0,void 0,function*(){const W=N,L=c.table(v),ae=c.$syncState,[te,G]=yield c.transaction("r",ae,L,()=>Z(this,void 0,void 0,function*(){const X=yield L.get(wn),se=yield ae.get("syncState");return[(X==null?void 0:X.receivedUntil)||0,(se==null?void 0:se.yServerRevision)||(se==null?void 0:se.serverRevision)]}));if(f.destroyed||N!==W||!A)return;const ye={type:"doc-open",table:d,prop:p,k:g,serverRev:G},ne=yield L.where("i").between(te,1/0,!1).filter(X=>Is(X.k,g)===0&&!(1&(X.f||0))).toArray();if(!f.destroyed&&N===W&&A){if(ne.length>0){const X=gs(ne.map(V=>V.u)),se=cf(X);ye.sv=se}c.messageProducer.next(ye)}})}f.addCleanupHandler(U)}),b})(t,r,e),od.set(r,s),s)})}}function Zm(t){const e=typeof window<"u"?window.location.href:"";if(!e)return null;const n=new URL(e).searchParams.get("dxc-auth");if(!n)return null;let r;try{const f=(function(d){const g=(d+"=".repeat((4-d.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/");return atob(g)})(n);r=JSON.parse(f)}catch{return null}const{code:i,provider:s,state:c,error:l}=r;if(l)throw l.toLowerCase().includes("access_denied")||l.toLowerCase().includes("access denied")?new Gt("access_denied",s,l):l.toLowerCase().includes("email")&&l.toLowerCase().includes("verif")?new Gt("email_not_verified",s,l):new Gt("provider_error",s,l);return i&&s&&c?{code:i,provider:s,state:c}:null}function tu(){var t;if(typeof window>"u"||!(!((t=window.history)===null||t===void 0)&&t.replaceState))return;const e=new URL(window.location.href);if(!e.searchParams.has("dxc-auth"))return;e.searchParams.delete("dxc-auth");const n=e.pathname+(e.searchParams.toString()?`?${e.searchParams.toString()}`:"")+e.hash;window.history.replaceState(null,"",n)}const ev={nameSuffix:!0};function Sa(t){const e=t.name,n=Es(t),r=[];let i=!1,s=null,c=null;t.on("ready",p=>Z(this,void 0,void 0,function*(){try{yield(function(v){return Z(this,void 0,void 0,function*(){var b,S,A,N,U,K,W;l=!1;const L=Nt(v);typeof window<"u"&&typeof document<"u"&&(!((b=L.cloud.options)===null||b===void 0)&&b.customLoginGui||r.push((function(V){let ge=!1;const be=document.createElement("div");return document.body?(document.body.appendChild(be),Fl(Oe(Zl,{db:V.vip}),be)):addEventListener("DOMContentLoaded",()=>{ge||(document.body.appendChild(be),Fl(Oe(Zl,{db:V.vip}),be))}),{unsubscribe(){try{be.remove()}catch{}ge=!0},get closed(){return ge}}})(v))),L.cloud.isServiceWorkerDB||r.push((function(V){let ge=V.cloud.webSocketStatus.value;const be=V.cloud.webSocketStatus.pipe(ut(me=>{const le=ge;ge=me;const Y=Zt(me);switch(me){case"disconnected":return Jr.value?Y.pipe(Hc(500)):Y;case"connecting":return le==="not-started"||le==="error"?Y:Y.pipe(Hc(4e3));default:return Y}}));return Zr([be,V.syncStateChangedEvent.pipe(Iu({phase:"initial"})),Es(V.dx._novip),va]).pipe(bt(([me,le,Y,ce])=>{var ie;if(!((ie=Y.license)===null||ie===void 0)&&ie.status&&Y.license.status!=="ok")return{phase:"offline",status:"offline",license:Y.license.status};let{phase:Ce,error:he,progress:ue}=le,_e=me;return Ce==="error"&&(_e="error"),me==="not-started"&&(Ce!=="pushing"&&Ce!=="pulling"||(_e="connecting")),V.cloud.syncState.value.phase!=="error"||le.phase!=="pushing"&&le.phase!=="pulling"||(_e="connecting"),ce||(_e="disconnected"),{phase:Ce,error:he,progress:ue,status:or?_e:"offline",license:"ok"}}))})(L).subscribe(v.cloud.syncState)),r.push(L.syncCompleteEvent.subscribe(d)),L.tables.every(V=>V.core)||(function(){throw new xe.SchemaError("Version increment needed to allow dexie-cloud change tracking")})();const ae="serviceWorker"in navigator?yield navigator.serviceWorker.getRegistrations():[],[te,G]=yield L.transaction("rw",L.$syncState,()=>Z(this,void 0,void 0,function*(){var V,ge;const{options:be,schema:me}=L.cloud,[le,Y,ce]=yield Promise.all([L.getOptions(),L.getSchema(),L.getPersistedSyncState()]);if(i){if(!le||JSON.stringify(le)!==JSON.stringify(be)){if(!be)throw new Error("Internal error");const ie=Object.assign({},be);delete ie.fetchTokens,delete ie.awarenessProtocol,yield L.$syncState.put(ie,"options")}}else L.cloud.options=le||null;if(!((V=L.cloud.options)===null||V===void 0)&&V.tryUseServiceWorker&&"serviceWorker"in navigator&&ae.length>0&&!td?L.cloud.usingServiceWorker=!0:(!((ge=L.cloud.options)===null||ge===void 0)&&ge.tryUseServiceWorker&&L.cloud.isServiceWorkerDB,L.cloud.usingServiceWorker=!1),Wo(me,L.cloud.options),Wo(Y,L.cloud.options),me){if(!Y||JSON.stringify(Y)!==JSON.stringify(me)){const ie=Y||{};for(const[Ce,he]of Object.entries(me)){const ue=ie[Ce];ue?(ue.markedForSync=he.markedForSync,he.deleted=ue.deleted,ue.generatedGlobalId=he.generatedGlobalId):ie[Ce]=Object.assign({},he)}yield L.$syncState.put(ie,"schema"),Object.assign(me,ie)}}else L.cloud.schema=Y||null;return[ce==null?void 0:ce.initiallySynced,ce==null?void 0:ce.realms]}));if(te&&L.setInitiallySynced(!0),(function(V){var ge,be;for(const me of V.tables)if(!((be=(ge=V.cloud.schema)===null||ge===void 0?void 0:ge[me.name])===null||be===void 0)&&be.markedForSync){if(me.schema.primKey.auto)throw new xe.SchemaError(`Table ${me.name} is both autoIncremented and synced. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(me.name)}]}) to blacklist it from sync`);if(!me.schema.primKey.keyPath)throw new xe.SchemaError(`Table ${me.name} cannot be both synced and outbound. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(me.name)}]}) to blacklist it from sync`)}})(L),f(),!L.cloud.isServiceWorkerDB){r.push(gn(()=>L.getCurrentUser()).subscribe(n)),r.push(gn(()=>L.getPersistedSyncState()).subscribe(L.cloud.persistedSyncState)),yield Un(Zr([n.pipe(zc(1),tr(1)),L.cloud.persistedSyncState.pipe(zc(1),tr(1))]));const V=Qm(L);ft.on.new.subscribe(V),L.dx.once("close",()=>{ft.on.new.unsubscribe(V)})}let ye=!1;const ne=yield L.getCurrentUser();if(s&&!L.cloud.isServiceWorkerDB){const{code:V,provider:ge}=s;s=null;try{ye=yield Qi(L,{oauthCode:V,provider:ge})}catch{}}const X=(S=L.cloud.options)===null||S===void 0?void 0:S.requireAuth;X&&(L.cloud.isServiceWorkerDB?yield Un(n.pipe(Et(V=>!!V.isLoggedIn),tr(1))):typeof X=="object"?(!ne.isLoggedIn||X.userId&&ne.userId!==X.userId||X.email&&ne.email!==X.email)&&(ye=yield Qi(L,X)):ne.isLoggedIn||(ye=yield Qi(L))),!ne.isLoggedIn||G&&G.includes(ne.userId)||(ye=!0),c&&c.stop(),c=null,f();const se=((A=L.cloud.options)===null||A===void 0?void 0:A.databaseUrl)&&(!te||ye);se&&(yield(function(V,ge,be){return Z(this,void 0,void 0,function*(){yield rd(V,Gf,()=>Bs(V,ge,be,{isInitialSync:!0}))})})(L,L.cloud.options,L.cloud.schema),L.setInitiallySynced(!0)),f(),L.cloud.usingServiceWorker&&(!((N=L.cloud.options)===null||N===void 0)&&N.databaseUrl)?(se||Pf(L,"push").catch(()=>{}),(function(V){return Z(this,void 0,void 0,function*(){var ge;try{const{periodicSync:be}=yield navigator.serviceWorker.ready;if(be)try{yield be.register(`dexie-cloud:${V.name}`,(ge=V.cloud.options)===null||ge===void 0?void 0:ge.periodicSync)}catch{}}catch{}})})(L).catch(()=>{})):!((U=L.cloud.options)===null||U===void 0)&&U.databaseUrl&&L.cloud.schema&&!L.cloud.isServiceWorkerDB&&(c=Km(L,L.cloud.options,L.cloud.schema),c.start(),se||Xt(L,"push")),f(),L.cloud.isServiceWorkerDB||r.push(Bt(self,"online").subscribe(()=>{L.syncStateChangedEvent.next({phase:"not-in-sync"}),ci(L)||Xt(L,"push")}),Bt(self,"offline").subscribe(()=>{L.syncStateChangedEvent.next({phase:"offline"})})),!(!((K=L.cloud.options)===null||K===void 0)&&K.databaseUrl)||!((W=L.cloud.options)===null||W===void 0)&&W.disableWebSocket||_m||r.push((function(V){var ge;if(!(!((ge=V.cloud.options)===null||ge===void 0)&&ge.databaseUrl))throw new Error("No database URL to connect WebSocket to");const be=V.messageConsumer.readyToServe.pipe(Et(le=>le),ut(()=>V.getPersistedSyncState()),Et(le=>le&&le.serverRevision),ut(le=>Z(this,void 0,void 0,function*(){return{type:"ready",rev:le.serverRevision,realmSetHash:yield ua(le)}}))),me=As(be,V.messageProducer);return(function le(){return V.cloud.persistedSyncState.pipe(Et(Y=>Y==null?void 0:Y.serverRevision),tr(1),ut(Y=>V.cloud.currentUser.pipe(bt(ce=>[ce,Y]))),ut(([Y,ce])=>va.pipe(bt(ie=>[ie?Y:null,ce]))),ut(([Y,ce])=>Y!=null&&Y.isLoggedIn&&!(ce!=null&&ce.realms.includes(Y.userId))?V.cloud.persistedSyncState.pipe(Et(ie=>(ie==null?void 0:ie.realms.includes(Y.userId))||!1),tr(1),bt(ie=>[Y,ie])):new Rt([Y,ce])),ut(Y=>Z(this,[Y],void 0,function*([ce,ie]){return[ce,yield ua(ie)]})),Ou(([Y,ce],[ie,Ce])=>Y===ie&&ce===Ce),ut(([Y,ce])=>{var ie;return!((ie=V.cloud.persistedSyncState)===null||ie===void 0)&&ie.value?Y?new jm(V,V.cloud.persistedSyncState.value.serverRevision,V.cloud.persistedSyncState.value.yServerRevision,ce,V.cloud.persistedSyncState.value.clientIdentity,me,V.cloud.webSocketStatus,Y):_t([]):le()}),Qo(Y=>(Y==null?void 0:Y.name)==="TokenExpiredError"?Zt(!0).pipe(ut(()=>Z(this,void 0,void 0,function*(){const ce=yield V.getCurrentUser(),ie=yield Ks(V.cloud.options.databaseUrl,ce);yield V.table("$logins").update(ce.userId,{accessToken:ie.accessToken,accessTokenExpiration:ie.accessTokenExpiration,claims:ie.claims,license:ie.license,data:ie.data})})),ut(()=>le())):$c(()=>Y)),Qo(Y=>(V.cloud.webSocketStatus.next("error"),Y instanceof Mm?$c(()=>Y):_t(Nm()).pipe(ut(()=>le())))))})().subscribe({next:le=>{le&&V.messageConsumer.enqueue(le)},error:le=>{},complete:()=>{}})})(L))})})(p)}catch{}}),!0);let l=!1;function f(){if(l)throw new xe.DatabaseClosedError}t.once("close",()=>{r.forEach(p=>p.unsubscribe()),r.splice(0,r.length),l=!0,c&&c.stop(),c=null,n.next(ht)});const d=new Bn;var g;t.cloud={version:"4.3.2",options:Object.assign({},ev),schema:null,get currentUserId(){return n.value.userId||ht.userId},currentUser:n,syncState:new Rt({phase:"initial",status:"not-started"}),events:{syncComplete:d},persistedSyncState:new Rt(void 0),userInteraction:new Rt(void 0),webSocketStatus:new Rt("not-started"),login(p){return Z(this,void 0,void 0,function*(){const v=Nt(t);yield v.cloud.sync(),yield Qi(v,p)})},invites:Xm(t),roles:_d(t),configure(p){if(p=t.cloud.options=Object.assign(Object.assign({},t.cloud.options),p),i=!0,p.databaseUrl&&p.nameSuffix&&(t.name=`${e}-${(function(v){const b=new URL(v);return b.pathname==="/"?b.hostname.split(".")[0]:b.pathname.split("/")[1]})(p.databaseUrl)}`,Nt(t).reconfigure()),Wo(t.cloud.schema,t.cloud.options),typeof window<"u"&&window.location)try{const v=Zm();v&&(tu(),s={code:v.code,provider:v.provider})}catch{tu()}},logout(){return Z(this,arguments,void 0,function*({force:p}={}){p?yield ma(Nt(t),{deleteUnsyncedData:!0}):yield Zf(Nt(t))})},sync(){return Z(this,arguments,void 0,function*({wait:p,purpose:v}={wait:!0,purpose:"push"}){var b;p===void 0&&(p=!0);const S=Nt(t);if((((b=S.cloud.currentUser.value.license)===null||b===void 0?void 0:b.status)||"ok")!=="ok"&&(yield Ns(S)),v==="pull"){const A=S.cloud.persistedSyncState.value;if(Xt(S,v),p){const N=yield Un(S.cloud.persistedSyncState.pipe(Et(U=>(U==null?void 0:U.timestamp)!=null&&(!A||U.timestamp>A.timestamp))));if(N!=null&&N.error)throw new Error("Sync error: "+N.error)}}else if(yield Ll(S)){const A=S.cloud.persistedSyncState.value;Xt(S,v),p&&(yield Un(_t(gn(()=>Z(this,void 0,void 0,function*(){const N=yield Ll(S),U=yield S.getPersistedSyncState();if((U==null?void 0:U.timestamp)!==(A==null?void 0:A.timestamp)&&(U!=null&&U.error))throw new Error("Sync error: "+U.error);return N}))).pipe(Et(N=>!N))))}})},permissions:(p,v)=>(function(b,S,A){if(!S)throw new TypeError("Cannot check permissions of undefined or null. A Dexie Cloud object with realmId and owner expected.");const{owner:N,realmId:U}=S;if(!A){if(typeof S.table!="function")throw new TypeError("Missing 'table' argument to permissions and table could not be extracted from entity");A=S.table()}const K=Sd(b),W=ae=>{const te=ae[U||b.cloud.currentUserId];return te?new eu(te.permissions,A,U===void 0||U===b.cloud.currentUserId||N===b.cloud.currentUserId):new eu({},A,!N||N===b.cloud.currentUserId)},L=K.pipe(bt(W));return L.getValue=()=>W(K.getValue()),L})(t._novip,p,v)},t.Version.prototype._parseStoresSpec=xe.override(t.Version.prototype._parseStoresSpec,p=>Dm(p,t)),t.Table.prototype.newId=function({colocateWith:p}={}){const v=p&&p.substr(p.length-3);return nd(t.cloud.schema[this.name].idPrefix||"",v)},t.Table.prototype.idPrefix=function(){var p,v;return((v=(p=this.db.cloud.schema)===null||p===void 0?void 0:p[this.name])===null||v===void 0?void 0:v.idPrefix)||""},t.use(Am({currentUserObservable:t.cloud.currentUser,db:Nt(t)})),t.use((g=Nt(t),{stack:"dbcore",name:"implicitPropSetterMiddleware",level:1,create:p=>Object.assign(Object.assign({},p),{table:v=>{const b=p.table(v);return Object.assign(Object.assign({},b),{mutate:S=>{var A,N,U,K,W,L;const ae=S.trans;if(ae.disableChangeTracking)return b.mutate(S);const te=(N=(A=ae.currentUser)===null||A===void 0?void 0:A.userId)!==null&&N!==void 0?N:ht.userId;if(!((K=(U=g.cloud.schema)===null||U===void 0?void 0:U[v])===null||K===void 0)&&K.markedForSync&&(S.type==="add"||S.type==="put")){if(v==="members")for(const G of S.values)typeof G.email=="string"&&(G.email=G.email.trim().toLowerCase());for(const G of S.values){G.owner||(G.owner=te),G.realmId||(G.realmId=te);const ye=(L=(W=b.schema.primaryKey).extractKey)===null||L===void 0?void 0:L.call(W,G);typeof ye=="string"&&ye[0]==="#"&&S.type==="put"&&(delete S.criteria,delete S.changeSpec,S.upsert||delete S.updates,G.$ts=Date.now())}}return b.mutate(S)}})}})})),t.use(Em(Nt(t)))}Sa.version="4.3.2",xe.Cloud=Sa;const $r=new Map;function nu(t){return t.startsWith("dexie-cloud:")&&t.split(":")[1]}const ts=new Map;function zo(t,e){let n=ts.get(t+"/"+e);return n||(n=(function r(i,s){return Z(this,void 0,void 0,function*(){var c;let l=$r.get(i);if(!l){const d=new xe(i,{addons:[Sa]});if(l=Nt(d),l.cloud.isServiceWorkerDB=!0,d.on("versionchange",f),yield l.dx.open(),$r.get(i))return l.close(),yield r(i,s);$r.set(i,l)}if(!((c=l.cloud.options)===null||c===void 0)&&c.databaseUrl&&l.cloud.schema)try{yield Ha(l,l.cloud.options,l.cloud.schema,{retryImmediatelyOnFetchError:!0,purpose:s})}catch(d){if(f(),d.name!==xe.errnames.NoSuchDatabase)throw d}function f(){return l.dx.on.versionchange.unsubscribe(f),$r.get(l.name)===l&&$r.delete(l.name),l.dx.close(),!1}})})(t,e).then(()=>{ts.delete(t+"/"+e)}).catch(r=>(ts.delete(t+"/"+e),Promise.reject(r))),ts.set(t+"/"+e,n)),n}td||(self.addEventListener("sync",t=>{const e=nu(t.tag);e&&t.waitUntil(zo(e,"push"))}),self.addEventListener("periodicsync",t=>{const e=nu(t.tag);e&&t.waitUntil(zo(e,"pull"))}),self.addEventListener("message",t=>{if(t.data.type==="dexie-cloud-sync"){const{dbName:e}=t.data,n=(r=1)=>zo(e,t.data.purpose||"pull").catch(i=>Z(void 0,void 0,void 0,function*(){if(r===3)throw i;var s;yield(s=6e4,new Promise(c=>setTimeout(c,s))),n(r+1)}));"waitUntil"in t?t.waitUntil(n().catch(r=>{})):n().catch(r=>{})}}));try{self["workbox:core:7.3.0"]&&_()}catch{}const tv=(t,...e)=>{let n=t;return e.length>0&&(n+=` :: ${JSON.stringify(e)}`),n},nv=tv;class yt extends Error{constructor(e,n){const r=nv(e,n);super(r),this.name=e,this.details=n}}const Jt={googleAnalytics:"googleAnalytics",precache:"precache-v2",prefix:"workbox",runtime:"runtime",suffix:typeof registration<"u"?registration.scope:""},Yo=t=>[Jt.prefix,t,Jt.suffix].filter(e=>e&&e.length>0).join("-"),rv=t=>{for(const e of Object.keys(Jt))t(e)},Vs={updateDetails:t=>{rv(e=>{typeof t[e]=="string"&&(Jt[e]=t[e])})},getGoogleAnalyticsName:t=>t||Yo(Jt.googleAnalytics),getPrecacheName:t=>t||Yo(Jt.precache),getPrefix:()=>Jt.prefix,getRuntimeName:t=>t||Yo(Jt.runtime),getSuffix:()=>Jt.suffix};function ru(t,e){const n=e();return t.waitUntil(n),n}try{self["workbox:precaching:7.3.0"]&&_()}catch{}const iv="__WB_REVISION__";function sv(t){if(!t)throw new yt("add-to-cache-list-unexpected-type",{entry:t});if(typeof t=="string"){const s=new URL(t,location.href);return{cacheKey:s.href,url:s.href}}const{revision:e,url:n}=t;if(!n)throw new yt("add-to-cache-list-unexpected-type",{entry:t});if(!e){const s=new URL(n,location.href);return{cacheKey:s.href,url:s.href}}const r=new URL(n,location.href),i=new URL(n,location.href);return r.searchParams.set(iv,e),{cacheKey:r.href,url:i.href}}class ov{constructor(){this.updatedURLs=[],this.notUpdatedURLs=[],this.handlerWillStart=async({request:e,state:n})=>{n&&(n.originalRequest=e)},this.cachedResponseWillBeUsed=async({event:e,state:n,cachedResponse:r})=>{if(e.type==="install"&&n&&n.originalRequest&&n.originalRequest instanceof Request){const i=n.originalRequest.url;r?this.notUpdatedURLs.push(i):this.updatedURLs.push(i)}return r}}}class av{constructor({precacheController:e}){this.cacheKeyWillBeUsed=async({request:n,params:r})=>{const i=(r==null?void 0:r.cacheKey)||this._precacheController.getCacheKeyForURL(n.url);return i?new Request(i,{headers:n.headers}):n},this._precacheController=e}}let qr;function cv(){if(qr===void 0){const t=new Response("");if("body"in t)try{new Response(t.body),qr=!0}catch{qr=!1}qr=!1}return qr}async function lv(t,e){let n=null;if(t.url&&(n=new URL(t.url).origin),n!==self.location.origin)throw new yt("cross-origin-copy-response",{origin:n});const r=t.clone(),s={headers:new Headers(r.headers),status:r.status,statusText:r.statusText},c=cv()?r.body:await r.blob();return new Response(c,s)}const uv=t=>new URL(String(t),location.href).href.replace(new RegExp(`^${location.origin}`),"");function iu(t,e){const n=new URL(t);for(const r of e)n.searchParams.delete(r);return n.href}async function fv(t,e,n,r){const i=iu(e.url,n);if(e.url===i)return t.match(e,r);const s=Object.assign(Object.assign({},r),{ignoreSearch:!0}),c=await t.keys(e,s);for(const l of c){const f=iu(l.url,n);if(i===f)return t.match(l,r)}}class dv{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}const hv=new Set;async function pv(){for(const t of hv)await t()}function yv(t){return new Promise(e=>setTimeout(e,t))}try{self["workbox:strategies:7.3.0"]&&_()}catch{}function ns(t){return typeof t=="string"?new Request(t):t}class gv{constructor(e,n){this._cacheKeys={},Object.assign(this,n),this.event=n.event,this._strategy=e,this._handlerDeferred=new dv,this._extendLifetimePromises=[],this._plugins=[...e.plugins],this._pluginStateMap=new Map;for(const r of this._plugins)this._pluginStateMap.set(r,{});this.event.waitUntil(this._handlerDeferred.promise)}async fetch(e){const{event:n}=this;let r=ns(e);if(r.mode==="navigate"&&n instanceof FetchEvent&&n.preloadResponse){const c=await n.preloadResponse;if(c)return c}const i=this.hasCallback("fetchDidFail")?r.clone():null;try{for(const c of this.iterateCallbacks("requestWillFetch"))r=await c({request:r.clone(),event:n})}catch(c){if(c instanceof Error)throw new yt("plugin-error-request-will-fetch",{thrownErrorMessage:c.message})}const s=r.clone();try{let c;c=await fetch(r,r.mode==="navigate"?void 0:this._strategy.fetchOptions);for(const l of this.iterateCallbacks("fetchDidSucceed"))c=await l({event:n,request:s,response:c});return c}catch(c){throw i&&await this.runCallbacks("fetchDidFail",{error:c,event:n,originalRequest:i.clone(),request:s.clone()}),c}}async fetchAndCachePut(e){const n=await this.fetch(e),r=n.clone();return this.waitUntil(this.cachePut(e,r)),n}async cacheMatch(e){const n=ns(e);let r;const{cacheName:i,matchOptions:s}=this._strategy,c=await this.getCacheKey(n,"read"),l=Object.assign(Object.assign({},s),{cacheName:i});r=await caches.match(c,l);for(const f of this.iterateCallbacks("cachedResponseWillBeUsed"))r=await f({cacheName:i,matchOptions:s,cachedResponse:r,request:c,event:this.event})||void 0;return r}async cachePut(e,n){const r=ns(e);await yv(0);const i=await this.getCacheKey(r,"write");if(!n)throw new yt("cache-put-with-no-response",{url:uv(i.url)});const s=await this._ensureResponseSafeToCache(n);if(!s)return!1;const{cacheName:c,matchOptions:l}=this._strategy,f=await self.caches.open(c),d=this.hasCallback("cacheDidUpdate"),g=d?await fv(f,i.clone(),["__WB_REVISION__"],l):null;try{await f.put(i,d?s.clone():s)}catch(p){if(p instanceof Error)throw p.name==="QuotaExceededError"&&await pv(),p}for(const p of this.iterateCallbacks("cacheDidUpdate"))await p({cacheName:c,oldResponse:g,newResponse:s.clone(),request:i,event:this.event});return!0}async getCacheKey(e,n){const r=`${e.url} | ${n}`;if(!this._cacheKeys[r]){let i=e;for(const s of this.iterateCallbacks("cacheKeyWillBeUsed"))i=ns(await s({mode:n,request:i,event:this.event,params:this.params}));this._cacheKeys[r]=i}return this._cacheKeys[r]}hasCallback(e){for(const n of this._strategy.plugins)if(e in n)return!0;return!1}async runCallbacks(e,n){for(const r of this.iterateCallbacks(e))await r(n)}*iterateCallbacks(e){for(const n of this._strategy.plugins)if(typeof n[e]=="function"){const r=this._pluginStateMap.get(n);yield s=>{const c=Object.assign(Object.assign({},s),{state:r});return n[e](c)}}}waitUntil(e){return this._extendLifetimePromises.push(e),e}async doneWaiting(){for(;this._extendLifetimePromises.length;){const e=this._extendLifetimePromises.splice(0),r=(await Promise.allSettled(e)).find(i=>i.status==="rejected");if(r)throw r.reason}}destroy(){this._handlerDeferred.resolve(null)}async _ensureResponseSafeToCache(e){let n=e,r=!1;for(const i of this.iterateCallbacks("cacheWillUpdate"))if(n=await i({request:this.request,response:n,event:this.event})||void 0,r=!0,!n)break;return r||n&&n.status!==200&&(n=void 0),n}}class mv{constructor(e={}){this.cacheName=Vs.getRuntimeName(e.cacheName),this.plugins=e.plugins||[],this.fetchOptions=e.fetchOptions,this.matchOptions=e.matchOptions}handle(e){const[n]=this.handleAll(e);return n}handleAll(e){e instanceof FetchEvent&&(e={event:e,request:e.request});const n=e.event,r=typeof e.request=="string"?new Request(e.request):e.request,i="params"in e?e.params:void 0,s=new gv(this,{event:n,request:r,params:i}),c=this._getResponse(s,r,n),l=this._awaitComplete(c,s,r,n);return[c,l]}async _getResponse(e,n,r){await e.runCallbacks("handlerWillStart",{event:r,request:n});let i;try{if(i=await this._handle(n,e),!i||i.type==="error")throw new yt("no-response",{url:n.url})}catch(s){if(s instanceof Error){for(const c of e.iterateCallbacks("handlerDidError"))if(i=await c({error:s,event:r,request:n}),i)break}if(!i)throw s}for(const s of e.iterateCallbacks("handlerWillRespond"))i=await s({event:r,request:n,response:i});return i}async _awaitComplete(e,n,r,i){let s,c;try{s=await e}catch{}try{await n.runCallbacks("handlerDidRespond",{event:i,request:r,response:s}),await n.doneWaiting()}catch(l){l instanceof Error&&(c=l)}if(await n.runCallbacks("handlerDidComplete",{event:i,request:r,response:s,error:c}),n.destroy(),c)throw c}}class yn extends mv{constructor(e={}){e.cacheName=Vs.getPrecacheName(e.cacheName),super(e),this._fallbackToNetwork=e.fallbackToNetwork!==!1,this.plugins.push(yn.copyRedirectedCacheableResponsesPlugin)}async _handle(e,n){const r=await n.cacheMatch(e);return r||(n.event&&n.event.type==="install"?await this._handleInstall(e,n):await this._handleFetch(e,n))}async _handleFetch(e,n){let r;const i=n.params||{};if(this._fallbackToNetwork){const s=i.integrity,c=e.integrity,l=!c||c===s;r=await n.fetch(new Request(e,{integrity:e.mode!=="no-cors"?c||s:void 0})),s&&l&&e.mode!=="no-cors"&&(this._useDefaultCacheabilityPluginIfNeeded(),await n.cachePut(e,r.clone()))}else throw new yt("missing-precache-entry",{cacheName:this.cacheName,url:e.url});return r}async _handleInstall(e,n){this._useDefaultCacheabilityPluginIfNeeded();const r=await n.fetch(e);if(!await n.cachePut(e,r.clone()))throw new yt("bad-precaching-response",{url:e.url,status:r.status});return r}_useDefaultCacheabilityPluginIfNeeded(){let e=null,n=0;for(const[r,i]of this.plugins.entries())i!==yn.copyRedirectedCacheableResponsesPlugin&&(i===yn.defaultPrecacheCacheabilityPlugin&&(e=r),i.cacheWillUpdate&&n++);n===0?this.plugins.push(yn.defaultPrecacheCacheabilityPlugin):n>1&&e!==null&&this.plugins.splice(e,1)}}yn.defaultPrecacheCacheabilityPlugin={async cacheWillUpdate({response:t}){return!t||t.status>=400?null:t}};yn.copyRedirectedCacheableResponsesPlugin={async cacheWillUpdate({response:t}){return t.redirected?await lv(t):t}};class vv{constructor({cacheName:e,plugins:n=[],fallbackToNetwork:r=!0}={}){this._urlsToCacheKeys=new Map,this._urlsToCacheModes=new Map,this._cacheKeysToIntegrities=new Map,this._strategy=new yn({cacheName:Vs.getPrecacheName(e),plugins:[...n,new av({precacheController:this})],fallbackToNetwork:r}),this.install=this.install.bind(this),this.activate=this.activate.bind(this)}get strategy(){return this._strategy}precache(e){this.addToCacheList(e),this._installAndActiveListenersAdded||(self.addEventListener("install",this.install),self.addEventListener("activate",this.activate),this._installAndActiveListenersAdded=!0)}addToCacheList(e){const n=[];for(const r of e){typeof r=="string"?n.push(r):r&&r.revision===void 0&&n.push(r.url);const{cacheKey:i,url:s}=sv(r),c=typeof r!="string"&&r.revision?"reload":"default";if(this._urlsToCacheKeys.has(s)&&this._urlsToCacheKeys.get(s)!==i)throw new yt("add-to-cache-list-conflicting-entries",{firstEntry:this._urlsToCacheKeys.get(s),secondEntry:i});if(typeof r!="string"&&r.integrity){if(this._cacheKeysToIntegrities.has(i)&&this._cacheKeysToIntegrities.get(i)!==r.integrity)throw new yt("add-to-cache-list-conflicting-integrities",{url:s});this._cacheKeysToIntegrities.set(i,r.integrity)}if(this._urlsToCacheKeys.set(s,i),this._urlsToCacheModes.set(s,c),n.length>0){const l=`Workbox is precaching URLs without revision info: ${n.join(", ")}
This is generally NOT safe. Learn more at https://bit.ly/wb-precache`;console.warn(l)}}}install(e){return ru(e,async()=>{const n=new ov;this.strategy.plugins.push(n);for(const[s,c]of this._urlsToCacheKeys){const l=this._cacheKeysToIntegrities.get(c),f=this._urlsToCacheModes.get(s),d=new Request(s,{integrity:l,cache:f,credentials:"same-origin"});await Promise.all(this.strategy.handleAll({params:{cacheKey:c},request:d,event:e}))}const{updatedURLs:r,notUpdatedURLs:i}=n;return{updatedURLs:r,notUpdatedURLs:i}})}activate(e){return ru(e,async()=>{const n=await self.caches.open(this.strategy.cacheName),r=await n.keys(),i=new Set(this._urlsToCacheKeys.values()),s=[];for(const c of r)i.has(c.url)||(await n.delete(c),s.push(c.url));return{deletedURLs:s}})}getURLsToCacheKeys(){return this._urlsToCacheKeys}getCachedURLs(){return[...this._urlsToCacheKeys.keys()]}getCacheKeyForURL(e){const n=new URL(e,location.href);return this._urlsToCacheKeys.get(n.href)}getIntegrityForCacheKey(e){return this._cacheKeysToIntegrities.get(e)}async matchPrecache(e){const n=e instanceof Request?e.url:e,r=this.getCacheKeyForURL(n);if(r)return(await self.caches.open(this.strategy.cacheName)).match(r)}createHandlerBoundToURL(e){const n=this.getCacheKeyForURL(e);if(!n)throw new yt("non-precached-url",{url:e});return r=>(r.request=new Request(e),r.params=Object.assign({cacheKey:n},r.params),this.strategy.handle(r))}}let Go;const xd=()=>(Go||(Go=new vv),Go);try{self["workbox:routing:7.3.0"]&&_()}catch{}const Cd="GET",Os=t=>t&&typeof t=="object"?t:{handle:t};class Qr{constructor(e,n,r=Cd){this.handler=Os(n),this.match=e,this.method=r}setCatchHandler(e){this.catchHandler=Os(e)}}class bv extends Qr{constructor(e,n,r){const i=({url:s})=>{const c=e.exec(s.href);if(c&&!(s.origin!==location.origin&&c.index!==0))return c.slice(1)};super(i,n,r)}}class wv{constructor(){this._routes=new Map,this._defaultHandlerMap=new Map}get routes(){return this._routes}addFetchListener(){self.addEventListener("fetch",(e=>{const{request:n}=e,r=this.handleRequest({request:n,event:e});r&&e.respondWith(r)}))}addCacheListener(){self.addEventListener("message",(e=>{if(e.data&&e.data.type==="CACHE_URLS"){const{payload:n}=e.data,r=Promise.all(n.urlsToCache.map(i=>{typeof i=="string"&&(i=[i]);const s=new Request(...i);return this.handleRequest({request:s,event:e})}));e.waitUntil(r),e.ports&&e.ports[0]&&r.then(()=>e.ports[0].postMessage(!0))}}))}handleRequest({request:e,event:n}){const r=new URL(e.url,location.href);if(!r.protocol.startsWith("http"))return;const i=r.origin===location.origin,{params:s,route:c}=this.findMatchingRoute({event:n,request:e,sameOrigin:i,url:r});let l=c&&c.handler;const f=e.method;if(!l&&this._defaultHandlerMap.has(f)&&(l=this._defaultHandlerMap.get(f)),!l)return;let d;try{d=l.handle({url:r,request:e,event:n,params:s})}catch(p){d=Promise.reject(p)}const g=c&&c.catchHandler;return d instanceof Promise&&(this._catchHandler||g)&&(d=d.catch(async p=>{if(g)try{return await g.handle({url:r,request:e,event:n,params:s})}catch(v){v instanceof Error&&(p=v)}if(this._catchHandler)return this._catchHandler.handle({url:r,request:e,event:n});throw p})),d}findMatchingRoute({url:e,sameOrigin:n,request:r,event:i}){const s=this._routes.get(r.method)||[];for(const c of s){let l;const f=c.match({url:e,sameOrigin:n,request:r,event:i});if(f)return l=f,(Array.isArray(l)&&l.length===0||f.constructor===Object&&Object.keys(f).length===0||typeof f=="boolean")&&(l=void 0),{route:c,params:l}}return{}}setDefaultHandler(e,n=Cd){this._defaultHandlerMap.set(n,Os(e))}setCatchHandler(e){this._catchHandler=Os(e)}registerRoute(e){this._routes.has(e.method)||this._routes.set(e.method,[]),this._routes.get(e.method).push(e)}unregisterRoute(e){if(!this._routes.has(e.method))throw new yt("unregister-route-but-not-found-with-method",{method:e.method});const n=this._routes.get(e.method).indexOf(e);if(n>-1)this._routes.get(e.method).splice(n,1);else throw new yt("unregister-route-route-not-registered")}}let Vr;const _v=()=>(Vr||(Vr=new wv,Vr.addFetchListener(),Vr.addCacheListener()),Vr);function kv(t,e,n){let r;if(typeof t=="string"){const s=new URL(t,location.href),c=({url:l})=>l.href===s.href;r=new Qr(c,e,n)}else if(t instanceof RegExp)r=new bv(t,e,n);else if(typeof t=="function")r=new Qr(t,e,n);else if(t instanceof Qr)r=t;else throw new yt("unsupported-route-type",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});return _v().registerRoute(r),r}function Sv(t,e=[]){for(const n of[...t.searchParams.keys()])e.some(r=>r.test(n))&&t.searchParams.delete(n);return t}function*xv(t,{ignoreURLParametersMatching:e=[/^utm_/,/^fbclid$/],directoryIndex:n="index.html",cleanURLs:r=!0,urlManipulation:i}={}){const s=new URL(t,location.href);s.hash="",yield s.href;const c=Sv(s,e);if(yield c.href,n&&c.pathname.endsWith("/")){const l=new URL(c.href);l.pathname+=n,yield l.href}if(r){const l=new URL(c.href);l.pathname+=".html",yield l.href}if(i){const l=i({url:s});for(const f of l)yield f.href}}class Cv extends Qr{constructor(e,n){const r=({request:i})=>{const s=e.getURLsToCacheKeys();for(const c of xv(i.url,n)){const l=s.get(c);if(l){const f=e.getIntegrityForCacheKey(l);return{cacheKey:l,integrity:f}}}};super(r,e.strategy)}}function Ev(t){const e=xd(),n=new Cv(e,t);kv(n)}const Ov="-precache-",Iv=async(t,e=Ov)=>{const r=(await self.caches.keys()).filter(i=>i.includes(e)&&i.includes(self.registration.scope)&&i!==t);return await Promise.all(r.map(i=>self.caches.delete(i))),r};function Av(){self.addEventListener("activate",(t=>{const e=Vs.getPrecacheName();t.waitUntil(Iv(e).then(n=>{}))}))}function Dv(t){xd().precache(t)}function Tv(t,e){Dv(t),Ev(e)}console.log("ð Service Worker starting (built at 2026-01-22T15:51:11.396Z)");Tv([{"revision":"554ee676dbca3d956bd84187aee1f19b","url":"index.html"},{"revision":null,"url":"assets/index-D9C3dXeG.js"},{"revision":null,"url":"assets/index-Czf3zI1d.css"},{"revision":"0ea25c17ba9443457d913d6be03fea55","url":"dexie-icon-192x192.png"},{"revision":"f1749b24004626d4cb2f90aee4e442d2","url":"dexie-icon-512x512.png"},{"revision":"fc723c843a0b8a137167d3d63dda4e28","url":"dexie-icon-64x64.gif"},{"revision":"863c49ac89a611a8eef92f08ca81eb5f","url":"manifest.webmanifest"}]);Av();self.addEventListener("install",t=>{self.skipWaiting()});
//# sourceMappingURL=sw.js.map
