var Cc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Kd(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Wl={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(Cc,function(){var n=function(s,a){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,p){u.__proto__=p}||function(u,p){for(var y in p)Object.prototype.hasOwnProperty.call(p,y)&&(u[y]=p[y])})(s,a)},r=function(){return(r=Object.assign||function(s){for(var a,u=1,p=arguments.length;u<p;u++)for(var y in a=arguments[u])Object.prototype.hasOwnProperty.call(a,y)&&(s[y]=a[y]);return s}).apply(this,arguments)};function i(s,a,u){for(var p,y=0,v=a.length;y<v;y++)!p&&y in a||((p=p||Array.prototype.slice.call(a,0,y))[y]=a[y]);return s.concat(p||Array.prototype.slice.call(a))}var o=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Cc,c=Object.keys,l=Array.isArray;function f(s,a){return typeof a!="object"||c(a).forEach(function(u){s[u]=a[u]}),s}typeof Promise>"u"||o.Promise||(o.Promise=Promise);var h=Object.getPrototypeOf,d={}.hasOwnProperty;function g(s,a){return d.call(s,a)}function m(s,a){typeof a=="function"&&(a=a(h(s))),(typeof Reflect>"u"?c:Reflect.ownKeys)(a).forEach(function(u){k(s,u,a[u])})}var b=Object.defineProperty;function k(s,a,u,p){b(s,a,f(u&&g(u,"get")&&typeof u.get=="function"?{get:u.get,set:u.set,configurable:!0}:{value:u,configurable:!0,writable:!0},p))}function C(s){return{from:function(a){return s.prototype=Object.create(a.prototype),k(s.prototype,"constructor",s),{extend:m.bind(null,s.prototype)}}}}var j=Object.getOwnPropertyDescriptor,F=[].slice;function K(s,a,u){return F.call(s,a,u)}function N(s,a){return a(s)}function G(s){if(!s)throw new Error("Assertion Failed")}function re(s){o.setImmediate?setImmediate(s):setTimeout(s,0)}function Q(s,a){if(typeof a=="string"&&g(s,a))return s[a];if(!a)return s;if(typeof a!="string"){for(var u=[],p=0,y=a.length;p<y;++p){var v=Q(s,a[p]);u.push(v)}return u}var w=a.indexOf(".");if(w!==-1){var S=s[a.substr(0,w)];return S==null?void 0:Q(S,a.substr(w+1))}}function oe(s,a,u){if(s&&a!==void 0&&!("isFrozen"in Object&&Object.isFrozen(s)))if(typeof a!="string"&&"length"in a){G(typeof u!="string"&&"length"in u);for(var p=0,y=a.length;p<y;++p)oe(s,a[p],u[p])}else{var v,w,S=a.indexOf(".");S!==-1?(v=a.substr(0,S),(w=a.substr(S+1))===""?u===void 0?l(s)&&!isNaN(parseInt(v))?s.splice(v,1):delete s[v]:s[v]=u:oe(S=!(S=s[v])||!g(s,v)?s[v]={}:S,w,u)):u===void 0?l(s)&&!isNaN(parseInt(a))?s.splice(a,1):delete s[a]:s[a]=u}}function Te(s){var a,u={};for(a in s)g(s,a)&&(u[a]=s[a]);return u}var fe=[].concat;function De(s){return fe.apply([],s)}var xn="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(De([8,16,32,64].map(function(s){return["Int","Uint","Float"].map(function(a){return a+s+"Array"})}))).filter(function(s){return o[s]}),H=new Set(xn.map(function(s){return o[s]})),ue=null;function we(s){return ue=new WeakMap,s=function a(u){if(!u||typeof u!="object")return u;var p=ue.get(u);if(p)return p;if(l(u)){p=[],ue.set(u,p);for(var y=0,v=u.length;y<v;++y)p.push(a(u[y]))}else if(H.has(u.constructor))p=u;else{var w,S=h(u);for(w in p=S===Object.prototype?{}:Object.create(S),ue.set(u,p),u)g(u,w)&&(p[w]=a(u[w]))}return p}(s),ue=null,s}var _e={}.toString;function ge(s){return _e.call(s).slice(8,-1)}var Z=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ie=typeof Z=="symbol"?function(s){var a;return s!=null&&(a=s[Z])&&a.apply(s)}:function(){return null};function X(s,a){return a=s.indexOf(a),0<=a&&s.splice(a,1),0<=a}var de={};function Ae(s){var a,u,p,y;if(arguments.length===1){if(l(s))return s.slice();if(this===de&&typeof s=="string")return[s];if(y=ie(s)){for(u=[];!(p=y.next()).done;)u.push(p.value);return u}if(s==null)return[s];if(typeof(a=s.length)!="number")return[s];for(u=new Array(a);a--;)u[a]=s[a];return u}for(a=arguments.length,u=new Array(a);a--;)u[a]=arguments[a];return u}var ce=typeof Symbol<"u"?function(s){return s[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},kr=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Et=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(kr),ae={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Se(s,a){this.name=s,this.message=a}function Ge(s,a){return s+". Errors: "+Object.keys(a).map(function(u){return a[u].toString()}).filter(function(u,p,y){return y.indexOf(u)===p}).join(`
`)}function Je(s,a,u,p){this.failures=a,this.failedKeys=p,this.successCount=u,this.message=Ge(s,a)}function Ke(s,a){this.name="BulkError",this.failures=Object.keys(a).map(function(u){return a[u]}),this.failuresByPos=a,this.message=Ge(s,this.failures)}C(Se).from(Error).extend({toString:function(){return this.name+": "+this.message}}),C(Je).from(Se),C(Ke).from(Se);var st=Et.reduce(function(s,a){return s[a]=a+"Error",s},{}),qe=Se,ee=Et.reduce(function(s,a){var u=a+"Error";function p(y,v){this.name=u,y?typeof y=="string"?(this.message="".concat(y).concat(v?`
 `+v:""),this.inner=v||null):typeof y=="object"&&(this.message="".concat(y.name," ").concat(y.message),this.inner=y):(this.message=ae[a]||u,this.inner=null)}return C(p).from(qe),s[a]=p,s},{});ee.Syntax=SyntaxError,ee.Type=TypeError,ee.Range=RangeError;var Ne=kr.reduce(function(s,a){return s[a+"Error"]=ee[a],s},{}),$e=Et.reduce(function(s,a){return["Syntax","Type","Range"].indexOf(a)===-1&&(s[a+"Error"]=ee[a]),s},{});function le(){}function ke(s){return s}function Ie(s,a){return s==null||s===ke?a:function(u){return a(s(u))}}function Pe(s,a){return function(){s.apply(this,arguments),a.apply(this,arguments)}}function gt(s,a){return s===le?a:function(){var u=s.apply(this,arguments);u!==void 0&&(arguments[0]=u);var p=this.onsuccess,y=this.onerror;this.onsuccess=null,this.onerror=null;var v=a.apply(this,arguments);return p&&(this.onsuccess=this.onsuccess?Pe(p,this.onsuccess):p),y&&(this.onerror=this.onerror?Pe(y,this.onerror):y),v!==void 0?v:u}}function Sn(s,a){return s===le?a:function(){s.apply(this,arguments);var u=this.onsuccess,p=this.onerror;this.onsuccess=this.onerror=null,a.apply(this,arguments),u&&(this.onsuccess=this.onsuccess?Pe(u,this.onsuccess):u),p&&(this.onerror=this.onerror?Pe(p,this.onerror):p)}}function Rt(s,a){return s===le?a:function(u){var p=s.apply(this,arguments);f(u,p);var y=this.onsuccess,v=this.onerror;return this.onsuccess=null,this.onerror=null,u=a.apply(this,arguments),y&&(this.onsuccess=this.onsuccess?Pe(y,this.onsuccess):y),v&&(this.onerror=this.onerror?Pe(v,this.onerror):v),p===void 0?u===void 0?void 0:u:f(p,u)}}function hd(s,a){return s===le?a:function(){return a.apply(this,arguments)!==!1&&s.apply(this,arguments)}}function Fs(s,a){return s===le?a:function(){var u=s.apply(this,arguments);if(u&&typeof u.then=="function"){for(var p=this,y=arguments.length,v=new Array(y);y--;)v[y]=arguments[y];return u.then(function(){return a.apply(p,v)})}return a.apply(this,arguments)}}$e.ModifyError=Je,$e.DexieError=Se,$e.BulkError=Ke;var Pt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Wa(s){Pt=s}var _r={},Ha=100,xn=typeof Promise>"u"?[]:function(){var s=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[s,h(s),s];var a=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[a,h(a),s]}(),kr=xn[0],Et=xn[1],xn=xn[2],Et=Et&&Et.then,En=kr&&kr.constructor,$s=!!xn,Sr=function(s,a){xr.push([s,a]),yi&&(queueMicrotask(yd),yi=!1)},qs=!0,yi=!0,Cn=[],gi=[],Vs=ke,sn={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:le,pgp:!1,env:{},finalize:le},se=sn,xr=[],In=0,mi=[];function J(s){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var a=this._PSD=se;if(typeof s!="function"){if(s!==_r)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Hs(this,this._value))}this._state=null,this._value=null,++a.ref,function u(p,y){try{y(function(v){if(p._state===null){if(v===p)throw new TypeError("A promise cannot be resolved with itself.");var w=p._lib&&$n();v&&typeof v.then=="function"?u(p,function(S,E){v instanceof J?v._then(S,E):v.then(S,E)}):(p._state=!0,p._value=v,Ya(p)),w&&qn()}},Hs.bind(null,p))}catch(v){Hs(p,v)}}(this,s)}var Ws={get:function(){var s=se,a=_i;function u(p,y){var v=this,w=!s.global&&(s!==se||a!==_i),S=w&&!an(),E=new J(function(I,T){zs(v,new za(Ja(p,s,w,S),Ja(y,s,w,S),I,T,s))});return this._consoleTask&&(E._consoleTask=this._consoleTask),E}return u.prototype=_r,u},set:function(s){k(this,"then",s&&s.prototype===_r?Ws:{get:function(){return s},set:Ws.set})}};function za(s,a,u,p,y){this.onFulfilled=typeof s=="function"?s:null,this.onRejected=typeof a=="function"?a:null,this.resolve=u,this.reject=p,this.psd=y}function Hs(s,a){var u,p;gi.push(a),s._state===null&&(u=s._lib&&$n(),a=Vs(a),s._state=!1,s._value=a,p=s,Cn.some(function(y){return y._value===p._value})||Cn.push(p),Ya(s),u&&qn())}function Ya(s){var a=s._listeners;s._listeners=[];for(var u=0,p=a.length;u<p;++u)zs(s,a[u]);var y=s._PSD;--y.ref||y.finalize(),In===0&&(++In,Sr(function(){--In==0&&Ys()},[]))}function zs(s,a){if(s._state!==null){var u=s._state?a.onFulfilled:a.onRejected;if(u===null)return(s._state?a.resolve:a.reject)(s._value);++a.psd.ref,++In,Sr(pd,[u,s,a])}else s._listeners.push(a)}function pd(s,a,u){try{var p,y=a._value;!a._state&&gi.length&&(gi=[]),p=Pt&&a._consoleTask?a._consoleTask.run(function(){return s(y)}):s(y),a._state||gi.indexOf(y)!==-1||function(v){for(var w=Cn.length;w;)if(Cn[--w]._value===v._value)return Cn.splice(w,1)}(a),u.resolve(p)}catch(v){u.reject(v)}finally{--In==0&&Ys(),--u.psd.ref||u.psd.finalize()}}function yd(){On(sn,function(){$n()&&qn()})}function $n(){var s=qs;return yi=qs=!1,s}function qn(){var s,a,u;do for(;0<xr.length;)for(s=xr,xr=[],u=s.length,a=0;a<u;++a){var p=s[a];p[0].apply(null,p[1])}while(0<xr.length);yi=qs=!0}function Ys(){var s=Cn;Cn=[],s.forEach(function(p){p._PSD.onunhandled.call(null,p._value,p)});for(var a=mi.slice(0),u=a.length;u;)a[--u]()}function vi(s){return new J(_r,!1,s)}function Me(s,a){var u=se;return function(){var p=$n(),y=se;try{return cn(u,!0),s.apply(this,arguments)}catch(v){a&&a(v)}finally{cn(y,!1),p&&qn()}}}m(J.prototype,{then:Ws,_then:function(s,a){zs(this,new za(null,null,s,a,se))},catch:function(s){if(arguments.length===1)return this.then(null,s);var a=s,u=arguments[1];return typeof a=="function"?this.then(null,function(p){return(p instanceof a?u:vi)(p)}):this.then(null,function(p){return(p&&p.name===a?u:vi)(p)})},finally:function(s){return this.then(function(a){return J.resolve(s()).then(function(){return a})},function(a){return J.resolve(s()).then(function(){return vi(a)})})},timeout:function(s,a){var u=this;return s<1/0?new J(function(p,y){var v=setTimeout(function(){return y(new ee.Timeout(a))},s);u.then(p,y).finally(clearTimeout.bind(null,v))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&k(J.prototype,Symbol.toStringTag,"Dexie.Promise"),sn.env=Ga(),m(J,{all:function(){var s=Ae.apply(null,arguments).map(ki);return new J(function(a,u){s.length===0&&a([]);var p=s.length;s.forEach(function(y,v){return J.resolve(y).then(function(w){s[v]=w,--p||a(s)},u)})})},resolve:function(s){return s instanceof J?s:s&&typeof s.then=="function"?new J(function(a,u){s.then(a,u)}):new J(_r,!0,s)},reject:vi,race:function(){var s=Ae.apply(null,arguments).map(ki);return new J(function(a,u){s.map(function(p){return J.resolve(p).then(a,u)})})},PSD:{get:function(){return se},set:function(s){return se=s}},totalEchoes:{get:function(){return _i}},newPSD:on,usePSD:On,scheduler:{get:function(){return Sr},set:function(s){Sr=s}},rejectionMapper:{get:function(){return Vs},set:function(s){Vs=s}},follow:function(s,a){return new J(function(u,p){return on(function(y,v){var w=se;w.unhandleds=[],w.onunhandled=v,w.finalize=Pe(function(){var S,E=this;S=function(){E.unhandleds.length===0?y():v(E.unhandleds[0])},mi.push(function I(){S(),mi.splice(mi.indexOf(I),1)}),++In,Sr(function(){--In==0&&Ys()},[])},w.finalize),s()},a,u,p)})}}),En&&(En.allSettled&&k(J,"allSettled",function(){var s=Ae.apply(null,arguments).map(ki);return new J(function(a){s.length===0&&a([]);var u=s.length,p=new Array(u);s.forEach(function(y,v){return J.resolve(y).then(function(w){return p[v]={status:"fulfilled",value:w}},function(w){return p[v]={status:"rejected",reason:w}}).then(function(){return--u||a(p)})})})}),En.any&&typeof AggregateError<"u"&&k(J,"any",function(){var s=Ae.apply(null,arguments).map(ki);return new J(function(a,u){s.length===0&&u(new AggregateError([]));var p=s.length,y=new Array(p);s.forEach(function(v,w){return J.resolve(v).then(function(S){return a(S)},function(S){y[w]=S,--p||u(new AggregateError(y))})})})}),En.withResolvers&&(J.withResolvers=En.withResolvers));var Xe={awaits:0,echoes:0,id:0},gd=0,bi=[],wi=0,_i=0,md=0;function on(s,a,u,p){var y=se,v=Object.create(y);return v.parent=y,v.ref=0,v.global=!1,v.id=++md,sn.env,v.env=$s?{Promise:J,PromiseProp:{value:J,configurable:!0,writable:!0},all:J.all,race:J.race,allSettled:J.allSettled,any:J.any,resolve:J.resolve,reject:J.reject}:{},a&&f(v,a),++y.ref,v.finalize=function(){--this.parent.ref||this.parent.finalize()},p=On(v,s,u,p),v.ref===0&&v.finalize(),p}function Vn(){return Xe.id||(Xe.id=++gd),++Xe.awaits,Xe.echoes+=Ha,Xe.id}function an(){return!!Xe.awaits&&(--Xe.awaits==0&&(Xe.id=0),Xe.echoes=Xe.awaits*Ha,!0)}function ki(s){return Xe.echoes&&s&&s.constructor===En?(Vn(),s.then(function(a){return an(),a},function(a){return an(),Be(a)})):s}function vd(){var s=bi[bi.length-1];bi.pop(),cn(s,!1)}function cn(s,a){var u,p=se;(a?!Xe.echoes||wi++&&s===se:!wi||--wi&&s===se)||queueMicrotask(a?(function(y){++_i,Xe.echoes&&--Xe.echoes!=0||(Xe.echoes=Xe.awaits=Xe.id=0),bi.push(se),cn(y,!0)}).bind(null,s):vd),s!==se&&(se=s,p===sn&&(sn.env=Ga()),$s&&(u=sn.env.Promise,a=s.env,(p.global||s.global)&&(Object.defineProperty(o,"Promise",a.PromiseProp),u.all=a.all,u.race=a.race,u.resolve=a.resolve,u.reject=a.reject,a.allSettled&&(u.allSettled=a.allSettled),a.any&&(u.any=a.any))))}function Ga(){var s=o.Promise;return $s?{Promise:s,PromiseProp:Object.getOwnPropertyDescriptor(o,"Promise"),all:s.all,race:s.race,allSettled:s.allSettled,any:s.any,resolve:s.resolve,reject:s.reject}:{}}function On(s,a,u,p,y){var v=se;try{return cn(s,!0),a(u,p,y)}finally{cn(v,!1)}}function Ja(s,a,u,p){return typeof s!="function"?s:function(){var y=se;u&&Vn(),cn(a,!0);try{return s.apply(this,arguments)}finally{cn(y,!1),p&&queueMicrotask(an)}}}function Gs(s){Promise===En&&Xe.echoes===0?wi===0?s():enqueueNativeMicroTask(s):setTimeout(s,0)}(""+Et).indexOf("[native code]")===-1&&(Vn=an=le);var Be=J.reject,An="￿",Wt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Xa="String expected.",Wn=[],Si="__dbnames",Js="readonly",Xs="readwrite";function Dn(s,a){return s?a?function(){return s.apply(this,arguments)&&a.apply(this,arguments)}:s:a}var Qa={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function xi(s){return typeof s!="string"||/\./.test(s)?function(a){return a}:function(a){return a[s]===void 0&&s in a&&delete(a=we(a))[s],a}}function Za(){throw ee.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function xe(s,a){try{var u=ec(s),p=ec(a);if(u!==p)return u==="Array"?1:p==="Array"?-1:u==="binary"?1:p==="binary"?-1:u==="string"?1:p==="string"?-1:u==="Date"?1:p!=="Date"?NaN:-1;switch(u){case"number":case"Date":case"string":return a<s?1:s<a?-1:0;case"binary":return function(y,v){for(var w=y.length,S=v.length,E=w<S?w:S,I=0;I<E;++I)if(y[I]!==v[I])return y[I]<v[I]?-1:1;return w===S?0:w<S?-1:1}(tc(s),tc(a));case"Array":return function(y,v){for(var w=y.length,S=v.length,E=w<S?w:S,I=0;I<E;++I){var T=xe(y[I],v[I]);if(T!==0)return T}return w===S?0:w<S?-1:1}(s,a)}}catch{}return NaN}function ec(s){var a=typeof s;return a!="object"?a:ArrayBuffer.isView(s)?"binary":(s=ge(s),s==="ArrayBuffer"?"binary":s)}function tc(s){return s instanceof Uint8Array?s:ArrayBuffer.isView(s)?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s)}function Ei(s,a,u){var p=s.schema.yProps;return p?(a&&0<u.numFailures&&(a=a.filter(function(y,v){return!u.failures[v]})),Promise.all(p.map(function(y){return y=y.updatesTable,a?s.db.table(y).where("k").anyOf(a).delete():s.db.table(y).clear()})).then(function(){return u})):u}var Er=(nc.prototype.execute=function(s){var a=this["@@propmod"];if(a.add!==void 0){var u=a.add;if(l(u))return i(i([],l(s)?s:[],!0),u).sort();if(typeof u=="number")return(Number(s)||0)+u;if(typeof u=="bigint")try{return BigInt(s)+u}catch{return BigInt(0)+u}throw new TypeError("Invalid term ".concat(u))}if(a.remove!==void 0){var p=a.remove;if(l(p))return l(s)?s.filter(function(y){return!p.includes(y)}).sort():[];if(typeof p=="number")return Number(s)-p;if(typeof p=="bigint")try{return BigInt(s)-p}catch{return BigInt(0)-p}throw new TypeError("Invalid subtrahend ".concat(p))}return u=(u=a.replacePrefix)===null||u===void 0?void 0:u[0],u&&typeof s=="string"&&s.startsWith(u)?a.replacePrefix[1]+s.substring(u.length):s},nc);function nc(s){this["@@propmod"]=s}function rc(s,a){for(var u=c(a),p=u.length,y=!1,v=0;v<p;++v){var w=u[v],S=a[w],E=Q(s,w);S instanceof Er?(oe(s,w,S.execute(E)),y=!0):E!==S&&(oe(s,w,S),y=!0)}return y}var ic=(Le.prototype._trans=function(s,a,u){var p=this._tx||se.trans,y=this.name,v=Pt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(s==="readonly"?"read":"write"," ").concat(this.name));function w(I,T,x){if(!x.schema[y])throw new ee.NotFound("Table "+y+" not part of transaction");return a(x.idbtrans,x)}var S=$n();try{var E=p&&p.db._novip===this.db._novip?p===se.trans?p._promise(s,w,u):on(function(){return p._promise(s,w,u)},{trans:p,transless:se.transless||se}):function I(T,x,P,O){if(T.idbdb&&(T._state.openComplete||se.letThrough||T._vip)){var A=T._createTransaction(x,P,T._dbSchema);try{A.create(),T._state.PR1398_maxLoop=3}catch(D){return D.name===st.InvalidState&&T.isOpen()&&0<--T._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),T.close({disableAutoOpen:!1}),T.open().then(function(){return I(T,x,P,O)})):Be(D)}return A._promise(x,function(D,R){return on(function(){return se.trans=A,O(D,R,A)})}).then(function(D){if(x==="readwrite")try{A.idbtrans.commit()}catch{}return x==="readonly"?D:A._completion.then(function(){return D})})}if(T._state.openComplete)return Be(new ee.DatabaseClosed(T._state.dbOpenError));if(!T._state.isBeingOpened){if(!T._state.autoOpen)return Be(new ee.DatabaseClosed);T.open().catch(le)}return T._state.dbReadyPromise.then(function(){return I(T,x,P,O)})}(this.db,s,[this.name],w);return v&&(E._consoleTask=v,E=E.catch(function(I){return console.trace(I),Be(I)})),E}finally{S&&qn()}},Le.prototype.get=function(s,a){var u=this;return s&&s.constructor===Object?this.where(s).first(a):s==null?Be(new ee.Type("Invalid argument to Table.get()")):this._trans("readonly",function(p){return u.core.get({trans:p,key:s}).then(function(y){return u.hook.reading.fire(y)})}).then(a)},Le.prototype.where=function(s){if(typeof s=="string")return new this.db.WhereClause(this,s);if(l(s))return new this.db.WhereClause(this,"[".concat(s.join("+"),"]"));var a=c(s);if(a.length===1)return this.where(a[0]).equals(s[a[0]]);var u=this.schema.indexes.concat(this.schema.primKey).filter(function(S){if(S.compound&&a.every(function(I){return 0<=S.keyPath.indexOf(I)})){for(var E=0;E<a.length;++E)if(a.indexOf(S.keyPath[E])===-1)return!1;return!0}return!1}).sort(function(S,E){return S.keyPath.length-E.keyPath.length})[0];if(u&&this.db._maxKey!==An){var v=u.keyPath.slice(0,a.length);return this.where(v).equals(v.map(function(E){return s[E]}))}!u&&Pt&&console.warn("The query ".concat(JSON.stringify(s)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(a.join("+"),"]"));var p=this.schema.idxByName;function y(S,E){return xe(S,E)===0}var w=a.reduce(function(x,E){var I=x[0],T=x[1],x=p[E],P=s[E];return[I||x,I||!x?Dn(T,x&&x.multi?function(O){return O=Q(O,E),l(O)&&O.some(function(A){return y(P,A)})}:function(O){return y(P,Q(O,E))}):T]},[null,null]),v=w[0],w=w[1];return v?this.where(v.name).equals(s[v.keyPath]).filter(w):u?this.filter(w):this.where(a).equals("")},Le.prototype.filter=function(s){return this.toCollection().and(s)},Le.prototype.count=function(s){return this.toCollection().count(s)},Le.prototype.offset=function(s){return this.toCollection().offset(s)},Le.prototype.limit=function(s){return this.toCollection().limit(s)},Le.prototype.each=function(s){return this.toCollection().each(s)},Le.prototype.toArray=function(s){return this.toCollection().toArray(s)},Le.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},Le.prototype.orderBy=function(s){return new this.db.Collection(new this.db.WhereClause(this,l(s)?"[".concat(s.join("+"),"]"):s))},Le.prototype.reverse=function(){return this.toCollection().reverse()},Le.prototype.mapToClass=function(s){var a,u=this.db,p=this.name;function y(){return a!==null&&a.apply(this,arguments)||this}(this.schema.mappedClass=s).prototype instanceof Za&&(function(E,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function T(){this.constructor=E}n(E,I),E.prototype=I===null?Object.create(I):(T.prototype=I.prototype,new T)}(y,a=s),Object.defineProperty(y.prototype,"db",{get:function(){return u},enumerable:!1,configurable:!0}),y.prototype.table=function(){return p},s=y);for(var v=new Set,w=s.prototype;w;w=h(w))Object.getOwnPropertyNames(w).forEach(function(E){return v.add(E)});function S(E){if(!E)return E;var I,T=Object.create(s.prototype);for(I in E)if(!v.has(I))try{T[I]=E[I]}catch{}return T}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=S,this.hook("reading",S),s},Le.prototype.defineClass=function(){return this.mapToClass(function(s){f(this,s)})},Le.prototype.add=function(s,a){var u=this,p=this.schema.primKey,y=p.auto,v=p.keyPath,w=s;return v&&y&&(w=xi(v)(s)),this._trans("readwrite",function(S){return u.core.mutate({trans:S,type:"add",keys:a!=null?[a]:null,values:[w]})}).then(function(S){return S.numFailures?J.reject(S.failures[0]):S.lastResult}).then(function(S){if(v)try{oe(s,v,S)}catch{}return S})},Le.prototype.upsert=function(s,a){var u=this,p=this.schema.primKey.keyPath;return this._trans("readwrite",function(y){return u.core.get({trans:y,key:s}).then(function(v){var w=v??{};return rc(w,a),p&&oe(w,p,s),u.core.mutate({trans:y,type:"put",values:[w],keys:[s],upsert:!0,updates:{keys:[s],changeSpecs:[a]}}).then(function(S){return S.numFailures?J.reject(S.failures[0]):!!v})})})},Le.prototype.update=function(s,a){return typeof s!="object"||l(s)?this.where(":id").equals(s).modify(a):(s=Q(s,this.schema.primKey.keyPath),s===void 0?Be(new ee.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(s).modify(a))},Le.prototype.put=function(s,a){var u=this,p=this.schema.primKey,y=p.auto,v=p.keyPath,w=s;return v&&y&&(w=xi(v)(s)),this._trans("readwrite",function(S){return u.core.mutate({trans:S,type:"put",values:[w],keys:a!=null?[a]:null})}).then(function(S){return S.numFailures?J.reject(S.failures[0]):S.lastResult}).then(function(S){if(v)try{oe(s,v,S)}catch{}return S})},Le.prototype.delete=function(s){var a=this;return this._trans("readwrite",function(u){return a.core.mutate({trans:u,type:"delete",keys:[s]}).then(function(p){return Ei(a,[s],p)}).then(function(p){return p.numFailures?J.reject(p.failures[0]):void 0})})},Le.prototype.clear=function(){var s=this;return this._trans("readwrite",function(a){return s.core.mutate({trans:a,type:"deleteRange",range:Qa}).then(function(u){return Ei(s,null,u)})}).then(function(a){return a.numFailures?J.reject(a.failures[0]):void 0})},Le.prototype.bulkGet=function(s){var a=this;return this._trans("readonly",function(u){return a.core.getMany({keys:s,trans:u}).then(function(p){return p.map(function(y){return a.hook.reading.fire(y)})})})},Le.prototype.bulkAdd=function(s,a,u){var p=this,y=Array.isArray(a)?a:void 0,v=(u=u||(y?void 0:a))?u.allKeys:void 0;return this._trans("readwrite",function(w){var I=p.schema.primKey,S=I.auto,I=I.keyPath;if(I&&y)throw new ee.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(y&&y.length!==s.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var E=s.length,I=I&&S?s.map(xi(I)):s;return p.core.mutate({trans:w,type:"add",keys:y,values:I,wantResults:v}).then(function(A){var x=A.numFailures,P=A.results,O=A.lastResult,A=A.failures;if(x===0)return v?P:O;throw new Ke("".concat(p.name,".bulkAdd(): ").concat(x," of ").concat(E," operations failed"),A)})})},Le.prototype.bulkPut=function(s,a,u){var p=this,y=Array.isArray(a)?a:void 0,v=(u=u||(y?void 0:a))?u.allKeys:void 0;return this._trans("readwrite",function(w){var I=p.schema.primKey,S=I.auto,I=I.keyPath;if(I&&y)throw new ee.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(y&&y.length!==s.length)throw new ee.InvalidArgument("Arguments objects and keys must have the same length");var E=s.length,I=I&&S?s.map(xi(I)):s;return p.core.mutate({trans:w,type:"put",keys:y,values:I,wantResults:v}).then(function(A){var x=A.numFailures,P=A.results,O=A.lastResult,A=A.failures;if(x===0)return v?P:O;throw new Ke("".concat(p.name,".bulkPut(): ").concat(x," of ").concat(E," operations failed"),A)})})},Le.prototype.bulkUpdate=function(s){var a=this,u=this.core,p=s.map(function(w){return w.key}),y=s.map(function(w){return w.changes}),v=[];return this._trans("readwrite",function(w){return u.getMany({trans:w,keys:p,cache:"clone"}).then(function(S){var E=[],I=[];s.forEach(function(x,P){var O=x.key,A=x.changes,D=S[P];if(D){for(var R=0,U=Object.keys(A);R<U.length;R++){var L=U[R],M=A[L];if(L===a.schema.primKey.keyPath){if(xe(M,O)!==0)throw new ee.Constraint("Cannot update primary key in bulkUpdate()")}else oe(D,L,M)}v.push(P),E.push(O),I.push(D)}});var T=E.length;return u.mutate({trans:w,type:"put",keys:E,values:I,updates:{keys:p,changeSpecs:y}}).then(function(x){var P=x.numFailures,O=x.failures;if(P===0)return T;for(var A=0,D=Object.keys(O);A<D.length;A++){var R,U=D[A],L=v[Number(U)];L!=null&&(R=O[U],delete O[U],O[L]=R)}throw new Ke("".concat(a.name,".bulkUpdate(): ").concat(P," of ").concat(T," operations failed"),O)})})})},Le.prototype.bulkDelete=function(s){var a=this,u=s.length;return this._trans("readwrite",function(p){return a.core.mutate({trans:p,type:"delete",keys:s}).then(function(y){return Ei(a,s,y)})}).then(function(w){var y=w.numFailures,v=w.lastResult,w=w.failures;if(y===0)return v;throw new Ke("".concat(a.name,".bulkDelete(): ").concat(y," of ").concat(u," operations failed"),w)})},Le);function Le(){}function Cr(s){function a(w,S){if(S){for(var E=arguments.length,I=new Array(E-1);--E;)I[E-1]=arguments[E];return u[w].subscribe.apply(null,I),s}if(typeof w=="string")return u[w]}var u={};a.addEventType=v;for(var p=1,y=arguments.length;p<y;++p)v(arguments[p]);return a;function v(w,S,E){if(typeof w!="object"){var I;S=S||hd;var T={subscribers:[],fire:E=E||le,subscribe:function(x){T.subscribers.indexOf(x)===-1&&(T.subscribers.push(x),T.fire=S(T.fire,x))},unsubscribe:function(x){T.subscribers=T.subscribers.filter(function(P){return P!==x}),T.fire=T.subscribers.reduce(S,E)}};return u[w]=a[w]=T}c(I=w).forEach(function(x){var P=I[x];if(l(P))v(x,I[x][0],I[x][1]);else{if(P!=="asap")throw new ee.InvalidArgument("Invalid event config");var O=v(x,ke,function(){for(var A=arguments.length,D=new Array(A);A--;)D[A]=arguments[A];O.subscribers.forEach(function(R){re(function(){R.apply(null,D)})})})}})}}function Ir(s,a){return C(a).from({prototype:s}),a}function Hn(s,a){return!(s.filter||s.algorithm||s.or)&&(a?s.justLimit:!s.replayFilter)}function Qs(s,a){s.filter=Dn(s.filter,a)}function Zs(s,a,u){var p=s.replayFilter;s.replayFilter=p?function(){return Dn(p(),a())}:a,s.justLimit=u&&!p}function Ci(s,a){if(s.isPrimKey)return a.primaryKey;var u=a.getIndexByKeyPath(s.index);if(!u)throw new ee.Schema("KeyPath "+s.index+" on object store "+a.name+" is not indexed");return u}function sc(s,a,u){var p=Ci(s,a.schema);return a.openCursor({trans:u,values:!s.keysOnly,reverse:s.dir==="prev",unique:!!s.unique,query:{index:p,range:s.range}})}function Ii(s,a,u,p){var y=s.replayFilter?Dn(s.filter,s.replayFilter()):s.filter;if(s.or){var v={},w=function(S,E,I){var T,x;y&&!y(E,I,function(P){return E.stop(P)},function(P){return E.fail(P)})||((x=""+(T=E.primaryKey))=="[object ArrayBuffer]"&&(x=""+new Uint8Array(T)),g(v,x)||(v[x]=!0,a(S,E,I)))};return Promise.all([s.or._iterate(w,u),oc(sc(s,p,u),s.algorithm,w,!s.keysOnly&&s.valueMapper)])}return oc(sc(s,p,u),Dn(s.algorithm,y),a,!s.keysOnly&&s.valueMapper)}function oc(s,a,u,p){var y=Me(p?function(v,w,S){return u(p(v),w,S)}:u);return s.then(function(v){if(v)return v.start(function(){var w=function(){return v.continue()};a&&!a(v,function(S){return w=S},function(S){v.stop(S),w=le},function(S){v.fail(S),w=le})||y(v.value,v,function(S){return w=S}),w()})})}var bd=(Oe.prototype._read=function(s,a){var u=this._ctx;return u.error?u.table._trans(null,Be.bind(null,u.error)):u.table._trans("readonly",s).then(a)},Oe.prototype._write=function(s){var a=this._ctx;return a.error?a.table._trans(null,Be.bind(null,a.error)):a.table._trans("readwrite",s,"locked")},Oe.prototype._addAlgorithm=function(s){var a=this._ctx;a.algorithm=Dn(a.algorithm,s)},Oe.prototype._iterate=function(s,a){return Ii(this._ctx,s,a,this._ctx.table.core)},Oe.prototype.clone=function(s){var a=Object.create(this.constructor.prototype),u=Object.create(this._ctx);return s&&f(u,s),a._ctx=u,a},Oe.prototype.raw=function(){return this._ctx.valueMapper=null,this},Oe.prototype.each=function(s){var a=this._ctx;return this._read(function(u){return Ii(a,s,u,a.table.core)})},Oe.prototype.count=function(s){var a=this;return this._read(function(u){var p=a._ctx,y=p.table.core;if(Hn(p,!0))return y.count({trans:u,query:{index:Ci(p,y.schema),range:p.range}}).then(function(w){return Math.min(w,p.limit)});var v=0;return Ii(p,function(){return++v,!1},u,y).then(function(){return v})}).then(s)},Oe.prototype.sortBy=function(s,a){var u=s.split(".").reverse(),p=u[0],y=u.length-1;function v(E,I){return I?v(E[u[I]],I-1):E[p]}var w=this._ctx.dir==="next"?1:-1;function S(E,I){return xe(v(E,y),v(I,y))*w}return this.toArray(function(E){return E.sort(S)}).then(a)},Oe.prototype.toArray=function(s){var a=this;return this._read(function(u){var p=a._ctx;if(p.dir==="next"&&Hn(p,!0)&&0<p.limit){var y=p.valueMapper,v=Ci(p,p.table.core.schema);return p.table.core.query({trans:u,limit:p.limit,values:!0,query:{index:v,range:p.range}}).then(function(S){return S=S.result,y?S.map(y):S})}var w=[];return Ii(p,function(S){return w.push(S)},u,p.table.core).then(function(){return w})},s)},Oe.prototype.offset=function(s){var a=this._ctx;return s<=0||(a.offset+=s,Hn(a)?Zs(a,function(){var u=s;return function(p,y){return u===0||(u===1?--u:y(function(){p.advance(u),u=0}),!1)}}):Zs(a,function(){var u=s;return function(){return--u<0}})),this},Oe.prototype.limit=function(s){return this._ctx.limit=Math.min(this._ctx.limit,s),Zs(this._ctx,function(){var a=s;return function(u,p,y){return--a<=0&&p(y),0<=a}},!0),this},Oe.prototype.until=function(s,a){return Qs(this._ctx,function(u,p,y){return!s(u.value)||(p(y),a)}),this},Oe.prototype.first=function(s){return this.limit(1).toArray(function(a){return a[0]}).then(s)},Oe.prototype.last=function(s){return this.reverse().first(s)},Oe.prototype.filter=function(s){var a;return Qs(this._ctx,function(u){return s(u.value)}),(a=this._ctx).isMatch=Dn(a.isMatch,s),this},Oe.prototype.and=function(s){return this.filter(s)},Oe.prototype.or=function(s){return new this.db.WhereClause(this._ctx.table,s,this)},Oe.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Oe.prototype.desc=function(){return this.reverse()},Oe.prototype.eachKey=function(s){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(u,p){s(p.key,p)})},Oe.prototype.eachUniqueKey=function(s){return this._ctx.unique="unique",this.eachKey(s)},Oe.prototype.eachPrimaryKey=function(s){var a=this._ctx;return a.keysOnly=!a.isMatch,this.each(function(u,p){s(p.primaryKey,p)})},Oe.prototype.keys=function(s){var a=this._ctx;a.keysOnly=!a.isMatch;var u=[];return this.each(function(p,y){u.push(y.key)}).then(function(){return u}).then(s)},Oe.prototype.primaryKeys=function(s){var a=this._ctx;if(a.dir==="next"&&Hn(a,!0)&&0<a.limit)return this._read(function(p){var y=Ci(a,a.table.core.schema);return a.table.core.query({trans:p,values:!1,limit:a.limit,query:{index:y,range:a.range}})}).then(function(p){return p.result}).then(s);a.keysOnly=!a.isMatch;var u=[];return this.each(function(p,y){u.push(y.primaryKey)}).then(function(){return u}).then(s)},Oe.prototype.uniqueKeys=function(s){return this._ctx.unique="unique",this.keys(s)},Oe.prototype.firstKey=function(s){return this.limit(1).keys(function(a){return a[0]}).then(s)},Oe.prototype.lastKey=function(s){return this.reverse().firstKey(s)},Oe.prototype.distinct=function(){var s=this._ctx,s=s.index&&s.table.schema.idxByName[s.index];if(!s||!s.multi)return this;var a={};return Qs(this._ctx,function(y){var p=y.primaryKey.toString(),y=g(a,p);return a[p]=!0,!y}),this},Oe.prototype.modify=function(s){var a=this,u=this._ctx;return this._write(function(p){var y=typeof s=="function"?s:function(D){return rc(D,s)},v=u.table.core,I=v.schema.primaryKey,w=I.outbound,S=I.extractKey,E=200,I=a.db._options.modifyChunkSize;I&&(E=typeof I=="object"?I[v.name]||I["*"]||200:I);function T(D,L){var U=L.failures,L=L.numFailures;P+=D-L;for(var M=0,B=c(U);M<B.length;M++){var q=B[M];x.push(U[q])}}var x=[],P=0,O=[],A=s===ac;return a.clone().primaryKeys().then(function(D){function R(L){var M=Math.min(E,D.length-L),B=D.slice(L,L+M);return(A?Promise.resolve([]):v.getMany({trans:p,keys:B,cache:"immutable"})).then(function(q){var z=[],$=[],V=w?[]:null,Y=A?B:[];if(!A)for(var W=0;W<M;++W){var ne=q[W],pe={value:we(ne),primKey:D[L+W]};y.call(pe,pe.value,pe)!==!1&&(pe.value==null?Y.push(D[L+W]):w||xe(S(ne),S(pe.value))===0?($.push(pe.value),w&&V.push(D[L+W])):(Y.push(D[L+W]),z.push(pe.value)))}return Promise.resolve(0<z.length&&v.mutate({trans:p,type:"add",values:z}).then(function(me){for(var be in me.failures)Y.splice(parseInt(be),1);T(z.length,me)})).then(function(){return(0<$.length||U&&typeof s=="object")&&v.mutate({trans:p,type:"put",keys:V,values:$,criteria:U,changeSpec:typeof s!="function"&&s,isAdditionalChunk:0<L}).then(function(me){return T($.length,me)})}).then(function(){return(0<Y.length||U&&A)&&v.mutate({trans:p,type:"delete",keys:Y,criteria:U,isAdditionalChunk:0<L}).then(function(me){return Ei(u.table,Y,me)}).then(function(me){return T(Y.length,me)})}).then(function(){return D.length>L+M&&R(L+E)})})}var U=Hn(u)&&u.limit===1/0&&(typeof s!="function"||A)&&{index:u.index,range:u.range};return R(0).then(function(){if(0<x.length)throw new Je("Error modifying one or more objects",x,P,O);return D.length})})})},Oe.prototype.delete=function(){var s=this._ctx,a=s.range;return!Hn(s)||s.table.schema.yProps||!s.isPrimKey&&a.type!==3?this.modify(ac):this._write(function(u){var p=s.table.core.schema.primaryKey,y=a;return s.table.core.count({trans:u,query:{index:p,range:y}}).then(function(v){return s.table.core.mutate({trans:u,type:"deleteRange",range:y}).then(function(E){var S=E.failures,E=E.numFailures;if(E)throw new Je("Could not delete some values",Object.keys(S).map(function(I){return S[I]}),v-E);return v-E})})})},Oe);function Oe(){}var ac=function(s,a){return a.value=null};function wd(s,a){return s<a?-1:s===a?0:1}function _d(s,a){return a<s?-1:s===a?0:1}function mt(s,a,u){return s=s instanceof lc?new s.Collection(s):s,s._ctx.error=new(u||TypeError)(a),s}function zn(s){return new s.Collection(s,function(){return cc("")}).limit(0)}function Oi(s,a,u,p){var y,v,w,S,E,I,T,x=u.length;if(!u.every(function(A){return typeof A=="string"}))return mt(s,Xa);function P(A){y=A==="next"?function(R){return R.toUpperCase()}:function(R){return R.toLowerCase()},v=A==="next"?function(R){return R.toLowerCase()}:function(R){return R.toUpperCase()},w=A==="next"?wd:_d;var D=u.map(function(R){return{lower:v(R),upper:y(R)}}).sort(function(R,U){return w(R.lower,U.lower)});S=D.map(function(R){return R.upper}),E=D.map(function(R){return R.lower}),T=(I=A)==="next"?"":p}P("next"),s=new s.Collection(s,function(){return ln(S[0],E[x-1]+p)}),s._ondirectionchange=function(A){P(A)};var O=0;return s._addAlgorithm(function(A,D,R){var U=A.key;if(typeof U!="string")return!1;var L=v(U);if(a(L,E,O))return!0;for(var M=null,B=O;B<x;++B){var q=function(z,$,V,Y,W,ne){for(var pe=Math.min(z.length,Y.length),me=-1,be=0;be<pe;++be){var vt=$[be];if(vt!==Y[be])return W(z[be],V[be])<0?z.substr(0,be)+V[be]+V.substr(be+1):W(z[be],Y[be])<0?z.substr(0,be)+Y[be]+V.substr(be+1):0<=me?z.substr(0,me)+$[me]+V.substr(me+1):null;W(z[be],vt)<0&&(me=be)}return pe<Y.length&&ne==="next"?z+V.substr(z.length):pe<z.length&&ne==="prev"?z.substr(0,V.length):me<0?null:z.substr(0,me)+Y[me]+V.substr(me+1)}(U,L,S[B],E[B],w,I);q===null&&M===null?O=B+1:(M===null||0<w(M,q))&&(M=q)}return D(M!==null?function(){A.continue(M+T)}:R),!1}),s}function ln(s,a,u,p){return{type:2,lower:s,upper:a,lowerOpen:u,upperOpen:p}}function cc(s){return{type:1,lower:s,upper:s}}var lc=(Object.defineProperty(Qe.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Qe.prototype.between=function(s,a,u,p){u=u!==!1,p=p===!0;try{return 0<this._cmp(s,a)||this._cmp(s,a)===0&&(u||p)&&(!u||!p)?zn(this):new this.Collection(this,function(){return ln(s,a,!u,!p)})}catch{return mt(this,Wt)}},Qe.prototype.equals=function(s){return s==null?mt(this,Wt):new this.Collection(this,function(){return cc(s)})},Qe.prototype.above=function(s){return s==null?mt(this,Wt):new this.Collection(this,function(){return ln(s,void 0,!0)})},Qe.prototype.aboveOrEqual=function(s){return s==null?mt(this,Wt):new this.Collection(this,function(){return ln(s,void 0,!1)})},Qe.prototype.below=function(s){return s==null?mt(this,Wt):new this.Collection(this,function(){return ln(void 0,s,!1,!0)})},Qe.prototype.belowOrEqual=function(s){return s==null?mt(this,Wt):new this.Collection(this,function(){return ln(void 0,s)})},Qe.prototype.startsWith=function(s){return typeof s!="string"?mt(this,Xa):this.between(s,s+An,!0,!0)},Qe.prototype.startsWithIgnoreCase=function(s){return s===""?this.startsWith(s):Oi(this,function(a,u){return a.indexOf(u[0])===0},[s],An)},Qe.prototype.equalsIgnoreCase=function(s){return Oi(this,function(a,u){return a===u[0]},[s],"")},Qe.prototype.anyOfIgnoreCase=function(){var s=Ae.apply(de,arguments);return s.length===0?zn(this):Oi(this,function(a,u){return u.indexOf(a)!==-1},s,"")},Qe.prototype.startsWithAnyOfIgnoreCase=function(){var s=Ae.apply(de,arguments);return s.length===0?zn(this):Oi(this,function(a,u){return u.some(function(p){return a.indexOf(p)===0})},s,An)},Qe.prototype.anyOf=function(){var s=this,a=Ae.apply(de,arguments),u=this._cmp;try{a.sort(u)}catch{return mt(this,Wt)}if(a.length===0)return zn(this);var p=new this.Collection(this,function(){return ln(a[0],a[a.length-1])});p._ondirectionchange=function(v){u=v==="next"?s._ascending:s._descending,a.sort(u)};var y=0;return p._addAlgorithm(function(v,w,S){for(var E=v.key;0<u(E,a[y]);)if(++y===a.length)return w(S),!1;return u(E,a[y])===0||(w(function(){v.continue(a[y])}),!1)}),p},Qe.prototype.notEqual=function(s){return this.inAnyRange([[-1/0,s],[s,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Qe.prototype.noneOf=function(){var s=Ae.apply(de,arguments);if(s.length===0)return new this.Collection(this);try{s.sort(this._ascending)}catch{return mt(this,Wt)}var a=s.reduce(function(u,p){return u?u.concat([[u[u.length-1][1],p]]):[[-1/0,p]]},null);return a.push([s[s.length-1],this.db._maxKey]),this.inAnyRange(a,{includeLowers:!1,includeUppers:!1})},Qe.prototype.inAnyRange=function(U,a){var u=this,p=this._cmp,y=this._ascending,v=this._descending,w=this._min,S=this._max;if(U.length===0)return zn(this);if(!U.every(function(L){return L[0]!==void 0&&L[1]!==void 0&&y(L[0],L[1])<=0}))return mt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",ee.InvalidArgument);var E=!a||a.includeLowers!==!1,I=a&&a.includeUppers===!0,T,x=y;function P(L,M){return x(L[0],M[0])}try{(T=U.reduce(function(L,M){for(var B=0,q=L.length;B<q;++B){var z=L[B];if(p(M[0],z[1])<0&&0<p(M[1],z[0])){z[0]=w(z[0],M[0]),z[1]=S(z[1],M[1]);break}}return B===q&&L.push(M),L},[])).sort(P)}catch{return mt(this,Wt)}var O=0,A=I?function(L){return 0<y(L,T[O][1])}:function(L){return 0<=y(L,T[O][1])},D=E?function(L){return 0<v(L,T[O][0])}:function(L){return 0<=v(L,T[O][0])},R=A,U=new this.Collection(this,function(){return ln(T[0][0],T[T.length-1][1],!E,!I)});return U._ondirectionchange=function(L){x=L==="next"?(R=A,y):(R=D,v),T.sort(P)},U._addAlgorithm(function(L,M,B){for(var q,z=L.key;R(z);)if(++O===T.length)return M(B),!1;return!A(q=z)&&!D(q)||(u._cmp(z,T[O][1])===0||u._cmp(z,T[O][0])===0||M(function(){x===y?L.continue(T[O][0]):L.continue(T[O][1])}),!1)}),U},Qe.prototype.startsWithAnyOf=function(){var s=Ae.apply(de,arguments);return s.every(function(a){return typeof a=="string"})?s.length===0?zn(this):this.inAnyRange(s.map(function(a){return[a,a+An]})):mt(this,"startsWithAnyOf() only works with strings")},Qe);function Qe(){}function Ut(s){return Me(function(a){return Or(a),s(a.target.error),!1})}function Or(s){s.stopPropagation&&s.stopPropagation(),s.preventDefault&&s.preventDefault()}var Ar="storagemutated",eo="x-storagemutated-1",un=Cr(null,Ar),kd=(jt.prototype._lock=function(){return G(!se.global),++this._reculock,this._reculock!==1||se.global||(se.lockOwnerFor=this),this},jt.prototype._unlock=function(){if(G(!se.global),--this._reculock==0)for(se.global||(se.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var s=this._blockedFuncs.shift();try{On(s[1],s[0])}catch{}}return this},jt.prototype._locked=function(){return this._reculock&&se.lockOwnerFor!==this},jt.prototype.create=function(s){var a=this;if(!this.mode)return this;var u=this.db.idbdb,p=this.db._state.dbOpenError;if(G(!this.idbtrans),!s&&!u)switch(p&&p.name){case"DatabaseClosedError":throw new ee.DatabaseClosed(p);case"MissingAPIError":throw new ee.MissingAPI(p.message,p);default:throw new ee.OpenFailed(p)}if(!this.active)throw new ee.TransactionInactive;return G(this._completion._state===null),(s=this.idbtrans=s||(this.db.core||u).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Me(function(y){Or(y),a._reject(s.error)}),s.onabort=Me(function(y){Or(y),a.active&&a._reject(new ee.Abort(s.error)),a.active=!1,a.on("abort").fire(y)}),s.oncomplete=Me(function(){a.active=!1,a._resolve(),"mutatedParts"in s&&un.storagemutated.fire(s.mutatedParts)}),this},jt.prototype._promise=function(s,a,u){var p=this;if(s==="readwrite"&&this.mode!=="readwrite")return Be(new ee.ReadOnly("Transaction is readonly"));if(!this.active)return Be(new ee.TransactionInactive);if(this._locked())return new J(function(v,w){p._blockedFuncs.push([function(){p._promise(s,a,u).then(v,w)},se])});if(u)return on(function(){var v=new J(function(w,S){p._lock();var E=a(w,S,p);E&&E.then&&E.then(w,S)});return v.finally(function(){return p._unlock()}),v._lib=!0,v});var y=new J(function(v,w){var S=a(v,w,p);S&&S.then&&S.then(v,w)});return y._lib=!0,y},jt.prototype._root=function(){return this.parent?this.parent._root():this},jt.prototype.waitFor=function(s){var a,u=this._root(),p=J.resolve(s);u._waitingFor?u._waitingFor=u._waitingFor.then(function(){return p}):(u._waitingFor=p,u._waitingQueue=[],a=u.idbtrans.objectStore(u.storeNames[0]),function v(){for(++u._spinCount;u._waitingQueue.length;)u._waitingQueue.shift()();u._waitingFor&&(a.get(-1/0).onsuccess=v)}());var y=u._waitingFor;return new J(function(v,w){p.then(function(S){return u._waitingQueue.push(Me(v.bind(null,S)))},function(S){return u._waitingQueue.push(Me(w.bind(null,S)))}).finally(function(){u._waitingFor===y&&(u._waitingFor=null)})})},jt.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new ee.Abort))},jt.prototype.table=function(s){var a=this._memoizedTables||(this._memoizedTables={});if(g(a,s))return a[s];var u=this.schema[s];if(!u)throw new ee.NotFound("Table "+s+" not part of transaction");return u=new this.db.Table(s,u,this),u.core=this.db.core.table(s),a[s]=u},jt);function jt(){}function to(s,a,u,p,y,v,w,S){return{name:s,keyPath:a,unique:u,multi:p,auto:y,compound:v,src:(u&&!w?"&":"")+(p?"*":"")+(y?"++":"")+uc(a),type:S}}function uc(s){return typeof s=="string"?s:s?"["+[].join.call(s,"+")+"]":""}function no(s,a,u){return{name:s,primKey:a,indexes:u,mappedClass:null,idxByName:(p=function(y){return[y.name,y]},u.reduce(function(y,v,w){return w=p(v,w),w&&(y[w[0]]=w[1]),y},{}))};var p}var Dr=function(s){try{return s.only([[]]),Dr=function(){return[[]]},[[]]}catch{return Dr=function(){return An},An}};function ro(s){return s==null?function(){}:typeof s=="string"?(a=s).split(".").length===1?function(u){return u[a]}:function(u){return Q(u,a)}:function(u){return Q(u,s)};var a}function fc(s){return[].slice.call(s)}var Sd=0;function Tr(s){return s==null?":id":typeof s=="string"?s:"[".concat(s.join("+"),"]")}function xd(s,a,E){function p(R){if(R.type===3)return null;if(R.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var O=R.lower,A=R.upper,D=R.lowerOpen,R=R.upperOpen;return O===void 0?A===void 0?null:a.upperBound(A,!!R):A===void 0?a.lowerBound(O,!!D):a.bound(O,A,!!D,!!R)}function y(P){var O,A=P.name;return{name:A,schema:P,mutate:function(D){var R=D.trans,U=D.type,L=D.keys,M=D.values,B=D.range;return new Promise(function(q,z){q=Me(q);var $=R.objectStore(A),V=$.keyPath==null,Y=U==="put"||U==="add";if(!Y&&U!=="delete"&&U!=="deleteRange")throw new Error("Invalid operation type: "+U);var W,ne=(L||M||{length:1}).length;if(L&&M&&L.length!==M.length)throw new Error("Given keys array must have same length as given values array.");if(ne===0)return q({numFailures:0,failures:{},results:[],lastResult:void 0});function pe(dt){++vt,Or(dt)}var me=[],be=[],vt=0;if(U==="deleteRange"){if(B.type===4)return q({numFailures:vt,failures:be,results:[],lastResult:void 0});B.type===3?me.push(W=$.clear()):me.push(W=$.delete(p(B)))}else{var V=Y?V?[M,L]:[M,null]:[L,null],he=V[0],at=V[1];if(Y)for(var ct=0;ct<ne;++ct)me.push(W=at&&at[ct]!==void 0?$[U](he[ct],at[ct]):$[U](he[ct])),W.onerror=pe;else for(ct=0;ct<ne;++ct)me.push(W=$[U](he[ct])),W.onerror=pe}function Bi(dt){dt=dt.target.result,me.forEach(function(Pn,ko){return Pn.error!=null&&(be[ko]=Pn.error)}),q({numFailures:vt,failures:be,results:U==="delete"?L:me.map(function(Pn){return Pn.result}),lastResult:dt})}W.onerror=function(dt){pe(dt),Bi(dt)},W.onsuccess=Bi})},getMany:function(D){var R=D.trans,U=D.keys;return new Promise(function(L,M){L=Me(L);for(var B,q=R.objectStore(A),z=U.length,$=new Array(z),V=0,Y=0,W=function(me){me=me.target,$[me._pos]=me.result,++Y===V&&L($)},ne=Ut(M),pe=0;pe<z;++pe)U[pe]!=null&&((B=q.get(U[pe]))._pos=pe,B.onsuccess=W,B.onerror=ne,++V);V===0&&L($)})},get:function(D){var R=D.trans,U=D.key;return new Promise(function(L,M){L=Me(L);var B=R.objectStore(A).get(U);B.onsuccess=function(q){return L(q.target.result)},B.onerror=Ut(M)})},query:(O=I,function(D){return new Promise(function(R,U){R=Me(R);var L,M,B,V=D.trans,q=D.values,z=D.limit,W=D.query,$=z===1/0?void 0:z,Y=W.index,W=W.range,V=V.objectStore(A),Y=Y.isPrimaryKey?V:V.index(Y.name),W=p(W);if(z===0)return R({result:[]});O?(($=q?Y.getAll(W,$):Y.getAllKeys(W,$)).onsuccess=function(ne){return R({result:ne.target.result})},$.onerror=Ut(U)):(L=0,M=!q&&"openKeyCursor"in Y?Y.openKeyCursor(W):Y.openCursor(W),B=[],M.onsuccess=function(ne){var pe=M.result;return pe?(B.push(q?pe.value:pe.primaryKey),++L===z?R({result:B}):void pe.continue()):R({result:B})},M.onerror=Ut(U))})}),openCursor:function(D){var R=D.trans,U=D.values,L=D.query,M=D.reverse,B=D.unique;return new Promise(function(q,z){q=Me(q);var Y=L.index,$=L.range,V=R.objectStore(A),V=Y.isPrimaryKey?V:V.index(Y.name),Y=M?B?"prevunique":"prev":B?"nextunique":"next",W=!U&&"openKeyCursor"in V?V.openKeyCursor(p($),Y):V.openCursor(p($),Y);W.onerror=Ut(z),W.onsuccess=Me(function(ne){var pe,me,be,vt,he=W.result;he?(he.___id=++Sd,he.done=!1,pe=he.continue.bind(he),me=(me=he.continuePrimaryKey)&&me.bind(he),be=he.advance.bind(he),vt=function(){throw new Error("Cursor not stopped")},he.trans=R,he.stop=he.continue=he.continuePrimaryKey=he.advance=function(){throw new Error("Cursor not started")},he.fail=Me(z),he.next=function(){var at=this,ct=1;return this.start(function(){return ct--?at.continue():at.stop()}).then(function(){return at})},he.start=function(at){function ct(){if(W.result)try{at()}catch(dt){he.fail(dt)}else he.done=!0,he.start=function(){throw new Error("Cursor behind last entry")},he.stop()}var Bi=new Promise(function(dt,Pn){dt=Me(dt),W.onerror=Ut(Pn),he.fail=Pn,he.stop=function(ko){he.stop=he.continue=he.continuePrimaryKey=he.advance=vt,dt(ko)}});return W.onsuccess=Me(function(dt){W.onsuccess=ct,ct()}),he.continue=pe,he.continuePrimaryKey=me,he.advance=be,ct(),Bi},q(he)):q(null)},z)})},count:function(D){var R=D.query,U=D.trans,L=R.index,M=R.range;return new Promise(function(B,q){var z=U.objectStore(A),$=L.isPrimaryKey?z:z.index(L.name),z=p(M),$=z?$.count(z):$.count();$.onsuccess=Me(function(V){return B(V.target.result)}),$.onerror=Ut(q)})}}}var v,w,S,T=(w=E,S=fc((v=s).objectStoreNames),{schema:{name:v.name,tables:S.map(function(P){return w.objectStore(P)}).map(function(P){var O=P.keyPath,R=P.autoIncrement,A=l(O),D={},R={name:P.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:O==null,compound:A,keyPath:O,autoIncrement:R,unique:!0,extractKey:ro(O)},indexes:fc(P.indexNames).map(function(U){return P.index(U)}).map(function(B){var L=B.name,M=B.unique,q=B.multiEntry,B=B.keyPath,q={name:L,compound:l(B),keyPath:B,unique:M,multiEntry:q,extractKey:ro(B)};return D[Tr(B)]=q}),getIndexByKeyPath:function(U){return D[Tr(U)]}};return D[":id"]=R.primaryKey,O!=null&&(D[Tr(O)]=R.primaryKey),R})},hasGetAll:0<S.length&&"getAll"in w.objectStore(S[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),E=T.schema,I=T.hasGetAll,T=E.tables.map(y),x={};return T.forEach(function(P){return x[P.name]=P}),{stack:"dbcore",transaction:s.transaction.bind(s),table:function(P){if(!x[P])throw new Error("Table '".concat(P,"' not found"));return x[P]},MIN_KEY:-1/0,MAX_KEY:Dr(a),schema:E}}function Ed(s,a,u,p){var y=u.IDBKeyRange;return u.indexedDB,{dbcore:(p=xd(a,y,p),s.dbcore.reduce(function(v,w){return w=w.create,r(r({},v),w(v))},p))}}function Ai(s,p){var u=p.db,p=Ed(s._middlewares,u,s._deps,p);s.core=p.dbcore,s.tables.forEach(function(y){var v=y.name;s.core.schema.tables.some(function(w){return w.name===v})&&(y.core=s.core.table(v),s[v]instanceof s.Table&&(s[v].core=y.core))})}function Di(s,a,u,p){u.forEach(function(y){var v=p[y];a.forEach(function(w){var S=function E(I,T){return j(I,T)||(I=h(I))&&E(I,T)}(w,y);(!S||"value"in S&&S.value===void 0)&&(w===s.Transaction.prototype||w instanceof s.Transaction?k(w,y,{get:function(){return this.table(y)},set:function(E){b(this,y,{value:E,writable:!0,configurable:!0,enumerable:!0})}}):w[y]=new s.Table(y,v))})})}function io(s,a){a.forEach(function(u){for(var p in u)u[p]instanceof s.Table&&delete u[p]})}function Cd(s,a){return s._cfg.version-a._cfg.version}function Id(s,a,u,p){var y=s._dbSchema;u.objectStoreNames.contains("$meta")&&!y.$meta&&(y.$meta=no("$meta",hc("")[0],[]),s._storeNames.push("$meta"));var v=s._createTransaction("readwrite",s._storeNames,y);v.create(u),v._completion.catch(p);var w=v._reject.bind(v),S=se.transless||se;on(function(){return se.trans=v,se.transless=S,a!==0?(Ai(s,u),I=a,((E=v).storeNames.includes("$meta")?E.table("$meta").get("version").then(function(T){return T??I}):J.resolve(I)).then(function(T){return P=T,O=v,A=u,D=[],T=(x=s)._versions,R=x._dbSchema=Ri(0,x.idbdb,A),(T=T.filter(function(U){return U._cfg.version>=P})).length!==0?(T.forEach(function(U){D.push(function(){var L=R,M=U._cfg.dbschema;Pi(x,L,A),Pi(x,M,A),R=x._dbSchema=M;var B=so(L,M);B.add.forEach(function(Y){oo(A,Y[0],Y[1].primKey,Y[1].indexes)}),B.change.forEach(function(Y){if(Y.recreate)throw new ee.Upgrade("Not yet support for changing primary key");var W=A.objectStore(Y.name);Y.add.forEach(function(ne){return Ti(W,ne)}),Y.change.forEach(function(ne){W.deleteIndex(ne.name),Ti(W,ne)}),Y.del.forEach(function(ne){return W.deleteIndex(ne)})});var q=U._cfg.contentUpgrade;if(q&&U._cfg.version>P){Ai(x,A),O._memoizedTables={};var z=Te(M);B.del.forEach(function(Y){z[Y]=L[Y]}),io(x,[x.Transaction.prototype]),Di(x,[x.Transaction.prototype],c(z),z),O.schema=z;var $,V=ce(q);return V&&Vn(),B=J.follow(function(){var Y;($=q(O))&&V&&(Y=an.bind(null,null),$.then(Y,Y))}),$&&typeof $.then=="function"?J.resolve($):B.then(function(){return $})}}),D.push(function(L){var M,B,q=U._cfg.dbschema;M=q,B=L,[].slice.call(B.db.objectStoreNames).forEach(function(z){return M[z]==null&&B.db.deleteObjectStore(z)}),io(x,[x.Transaction.prototype]),Di(x,[x.Transaction.prototype],x._storeNames,x._dbSchema),O.schema=x._dbSchema}),D.push(function(L){x.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(x.idbdb.version/10)===U._cfg.version?(x.idbdb.deleteObjectStore("$meta"),delete x._dbSchema.$meta,x._storeNames=x._storeNames.filter(function(M){return M!=="$meta"})):L.objectStore("$meta").put(U._cfg.version,"version"))})}),function U(){return D.length?J.resolve(D.shift()(O.idbtrans)).then(U):J.resolve()}().then(function(){dc(R,A)})):J.resolve();var x,P,O,A,D,R}).catch(w)):(c(y).forEach(function(T){oo(u,T,y[T].primKey,y[T].indexes)}),Ai(s,u),void J.follow(function(){return s.on.populate.fire(v)}).catch(w));var E,I})}function Od(s,a){dc(s._dbSchema,a),a.db.version%10!=0||a.objectStoreNames.contains("$meta")||a.db.createObjectStore("$meta").add(Math.ceil(a.db.version/10-1),"version");var u=Ri(0,s.idbdb,a);Pi(s,s._dbSchema,a);for(var p=0,y=so(u,s._dbSchema).change;p<y.length;p++){var v=function(w){if(w.change.length||w.recreate)return console.warn("Unable to patch indexes of table ".concat(w.name," because it has changes on the type of index or primary key.")),{value:void 0};var S=a.objectStore(w.name);w.add.forEach(function(E){Pt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(w.name,".").concat(E.src)),Ti(S,E)})}(y[p]);if(typeof v=="object")return v.value}}function so(s,a){var u,p={del:[],add:[],change:[]};for(u in s)a[u]||p.del.push(u);for(u in a){var y=s[u],v=a[u];if(y){var w={name:u,def:v,recreate:!1,del:[],add:[],change:[]};if(""+(y.primKey.keyPath||"")!=""+(v.primKey.keyPath||"")||y.primKey.auto!==v.primKey.auto)w.recreate=!0,p.change.push(w);else{var S=y.idxByName,E=v.idxByName,I=void 0;for(I in S)E[I]||w.del.push(I);for(I in E){var T=S[I],x=E[I];T?T.src!==x.src&&w.change.push(x):w.add.push(x)}(0<w.del.length||0<w.add.length||0<w.change.length)&&p.change.push(w)}}else p.add.push([u,v])}return p}function oo(s,a,u,p){var y=s.db.createObjectStore(a,u.keyPath?{keyPath:u.keyPath,autoIncrement:u.auto}:{autoIncrement:u.auto});return p.forEach(function(v){return Ti(y,v)}),y}function dc(s,a){c(s).forEach(function(u){a.db.objectStoreNames.contains(u)||(Pt&&console.debug("Dexie: Creating missing table",u),oo(a,u,s[u].primKey,s[u].indexes))})}function Ti(s,a){s.createIndex(a.name,a.keyPath,{unique:a.unique,multiEntry:a.multi})}function Ri(s,a,u){var p={};return K(a.objectStoreNames,0).forEach(function(y){for(var v=u.objectStore(y),w=to(uc(I=v.keyPath),I||"",!0,!1,!!v.autoIncrement,I&&typeof I!="string",!0),S=[],E=0;E<v.indexNames.length;++E){var T=v.index(v.indexNames[E]),I=T.keyPath,T=to(T.name,I,!!T.unique,!!T.multiEntry,!1,I&&typeof I!="string",!1);S.push(T)}p[y]=no(y,w,S)}),p}function Pi(s,a,u){for(var p=u.db.objectStoreNames,y=0;y<p.length;++y){var v=p[y],w=u.objectStore(v);s._hasGetAll="getAll"in w;for(var S=0;S<w.indexNames.length;++S){var E=w.indexNames[S],I=w.index(E).keyPath,T=typeof I=="string"?I:"["+K(I).join("+")+"]";!a[v]||(I=a[v].idxByName[T])&&(I.name=E,delete a[v].idxByName[T],a[v].idxByName[E]=I)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&o.WorkerGlobalScope&&o instanceof o.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(s._hasGetAll=!1)}function hc(s){return s.split(",").map(function(a,u){var v=a.split(":"),p=(y=v[1])===null||y===void 0?void 0:y.trim(),y=(a=v[0].trim()).replace(/([&*]|\+\+)/g,""),v=/^\[/.test(y)?y.match(/^\[(.*)\]$/)[1].split("+"):y;return to(y,v||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),l(v),u===0,p)})}var Ad=(Yn.prototype._createTableSchema=no,Yn.prototype._parseIndexSyntax=hc,Yn.prototype._parseStoresSpec=function(s,a){var u=this;c(s).forEach(function(p){if(s[p]!==null){var y=u._parseIndexSyntax(s[p]),v=y.shift();if(!v)throw new ee.Schema("Invalid schema for table "+p+": "+s[p]);if(v.unique=!0,v.multi)throw new ee.Schema("Primary key cannot be multiEntry*");y.forEach(function(w){if(w.auto)throw new ee.Schema("Only primary key can be marked as autoIncrement (++)");if(!w.keyPath)throw new ee.Schema("Index must have a name and cannot be an empty string")}),y=u._createTableSchema(p,v,y),a[p]=y}})},Yn.prototype.stores=function(u){var a=this.db;this._cfg.storesSource=this._cfg.storesSource?f(this._cfg.storesSource,u):u;var u=a._versions,p={},y={};return u.forEach(function(v){f(p,v._cfg.storesSource),y=v._cfg.dbschema={},v._parseStoresSpec(p,y)}),a._dbSchema=y,io(a,[a._allTables,a,a.Transaction.prototype]),Di(a,[a._allTables,a,a.Transaction.prototype,this._cfg.tables],c(y),y),a._storeNames=c(y),this},Yn.prototype.upgrade=function(s){return this._cfg.contentUpgrade=Fs(this._cfg.contentUpgrade||le,s),this},Yn);function Yn(){}function ao(s,a){var u=s._dbNamesDB;return u||(u=s._dbNamesDB=new Ht(Si,{addons:[],indexedDB:s,IDBKeyRange:a})).version(1).stores({dbnames:"name"}),u.table("dbnames")}function co(s){return s&&typeof s.databases=="function"}function lo(s){return on(function(){return se.letThrough=!0,s()})}function uo(s){return!("from"in s)}var ot=function(s,a){if(!this){var u=new ot;return s&&"d"in s&&f(u,s),u}f(this,arguments.length?{d:1,from:s,to:1<arguments.length?a:s}:{d:0})};function Rr(s,a,u){var p=xe(a,u);if(!isNaN(p)){if(0<p)throw RangeError();if(uo(s))return f(s,{from:a,to:u,d:1});var y=s.l,p=s.r;if(xe(u,s.from)<0)return y?Rr(y,a,u):s.l={from:a,to:u,d:1,l:null,r:null},yc(s);if(0<xe(a,s.to))return p?Rr(p,a,u):s.r={from:a,to:u,d:1,l:null,r:null},yc(s);xe(a,s.from)<0&&(s.from=a,s.l=null,s.d=p?p.d+1:1),0<xe(u,s.to)&&(s.to=u,s.r=null,s.d=s.l?s.l.d+1:1),u=!s.r,y&&!s.l&&Pr(s,y),p&&u&&Pr(s,p)}}function Pr(s,a){uo(a)||function u(p,E){var v=E.from,w=E.to,S=E.l,E=E.r;Rr(p,v,w),S&&u(p,S),E&&u(p,E)}(s,a)}function pc(s,a){var u=Ui(a),p=u.next();if(p.done)return!1;for(var y=p.value,v=Ui(s),w=v.next(y.from),S=w.value;!p.done&&!w.done;){if(xe(S.from,y.to)<=0&&0<=xe(S.to,y.from))return!0;xe(y.from,S.from)<0?y=(p=u.next(S.from)).value:S=(w=v.next(y.from)).value}return!1}function Ui(s){var a=uo(s)?null:{s:0,n:s};return{next:function(u){for(var p=0<arguments.length;a;)switch(a.s){case 0:if(a.s=1,p)for(;a.n.l&&xe(u,a.n.from)<0;)a={up:a,n:a.n.l,s:1};else for(;a.n.l;)a={up:a,n:a.n.l,s:1};case 1:if(a.s=2,!p||xe(u,a.n.to)<=0)return{value:a.n,done:!1};case 2:if(a.n.r){a.s=3,a={up:a,n:a.n.r,s:0};continue}case 3:a=a.up}return{done:!0}}}}function yc(s){var a,u,p=(((a=s.r)===null||a===void 0?void 0:a.d)||0)-(((u=s.l)===null||u===void 0?void 0:u.d)||0),y=1<p?"r":p<-1?"l":"";y&&(a=y=="r"?"l":"r",u=r({},s),p=s[y],s.from=p.from,s.to=p.to,s[y]=p[y],u[y]=p[a],(s[a]=u).d=gc(u)),s.d=gc(s)}function gc(u){var a=u.r,u=u.l;return(a?u?Math.max(a.d,u.d):a.d:u?u.d:0)+1}function ji(s,a){return c(a).forEach(function(u){s[u]?Pr(s[u],a[u]):s[u]=function p(y){var v,w,S={};for(v in y)g(y,v)&&(w=y[v],S[v]=!w||typeof w!="object"||H.has(w.constructor)?w:p(w));return S}(a[u])}),s}function fo(s,a){return s.all||a.all||Object.keys(s).some(function(u){return a[u]&&pc(a[u],s[u])})}m(ot.prototype,((Et={add:function(s){return Pr(this,s),this},addKey:function(s){return Rr(this,s,s),this},addKeys:function(s){var a=this;return s.forEach(function(u){return Rr(a,u,u)}),this},hasKey:function(s){var a=Ui(this).next(s).value;return a&&xe(a.from,s)<=0&&0<=xe(a.to,s)}})[Z]=function(){return Ui(this)},Et));var Tn={},ho={},po=!1;function Li(s){ji(ho,s),po||(po=!0,setTimeout(function(){po=!1,yo(ho,!(ho={}))},0))}function yo(s,a){a===void 0&&(a=!1);var u=new Set;if(s.all)for(var p=0,y=Object.values(Tn);p<y.length;p++)mc(w=y[p],s,u,a);else for(var v in s){var w,S=/^idb\:\/\/(.*)\/(.*)\//.exec(v);S&&(v=S[1],S=S[2],(w=Tn["idb://".concat(v,"/").concat(S)])&&mc(w,s,u,a))}u.forEach(function(E){return E()})}function mc(s,a,u,p){for(var y=[],v=0,w=Object.entries(s.queries.query);v<w.length;v++){for(var S=w[v],E=S[0],I=[],T=0,x=S[1];T<x.length;T++){var P=x[T];fo(a,P.obsSet)?P.subscribers.forEach(function(R){return u.add(R)}):p&&I.push(P)}p&&y.push([E,I])}if(p)for(var O=0,A=y;O<A.length;O++){var D=A[O],E=D[0],I=D[1];s.queries.query[E]=I}}function Dd(s){var a=s._state,u=s._deps.indexedDB;if(a.isBeingOpened||s.idbdb)return a.dbReadyPromise.then(function(){return a.dbOpenError?Be(a.dbOpenError):s});a.isBeingOpened=!0,a.dbOpenError=null,a.openComplete=!1;var p=a.openCanceller,y=Math.round(10*s.verno),v=!1;function w(){if(a.openCanceller!==p)throw new ee.DatabaseClosed("db.open() was cancelled")}function S(){return new J(function(P,O){if(w(),!u)throw new ee.MissingAPI;var A=s.name,D=a.autoSchema||!y?u.open(A):u.open(A,y);if(!D)throw new ee.MissingAPI;D.onerror=Ut(O),D.onblocked=Me(s._fireOnBlocked),D.onupgradeneeded=Me(function(R){var U;T=D.transaction,a.autoSchema&&!s._options.allowEmptyDB?(D.onerror=Or,T.abort(),D.result.close(),(U=u.deleteDatabase(A)).onsuccess=U.onerror=Me(function(){O(new ee.NoSuchDatabase("Database ".concat(A," doesnt exist")))})):(T.onerror=Ut(O),R=R.oldVersion>Math.pow(2,62)?0:R.oldVersion,x=R<1,s.idbdb=D.result,v&&Od(s,T),Id(s,R/10,T,O))},O),D.onsuccess=Me(function(){T=null;var R,U,L,M,B,q=s.idbdb=D.result,z=K(q.objectStoreNames);if(0<z.length)try{var $=q.transaction((M=z).length===1?M[0]:M,"readonly");if(a.autoSchema)U=q,L=$,(R=s).verno=U.version/10,L=R._dbSchema=Ri(0,U,L),R._storeNames=K(U.objectStoreNames,0),Di(R,[R._allTables],c(L),L);else if(Pi(s,s._dbSchema,$),((B=so(Ri(0,(B=s).idbdb,$),B._dbSchema)).add.length||B.change.some(function(V){return V.add.length||V.change.length}))&&!v)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),q.close(),y=q.version+1,v=!0,P(S());Ai(s,$)}catch{}Wn.push(s),q.onversionchange=Me(function(V){a.vcFired=!0,s.on("versionchange").fire(V)}),q.onclose=Me(function(){s.close({disableAutoOpen:!1})}),x&&(B=s._deps,$=A,q=B.indexedDB,B=B.IDBKeyRange,co(q)||$===Si||ao(q,B).put({name:$}).catch(le)),P()},O)}).catch(function(P){switch(P==null?void 0:P.name){case"UnknownError":if(0<a.PR1398_maxLoop)return a.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),S();break;case"VersionError":if(0<y)return y=0,S()}return J.reject(P)})}var E,I=a.dbReadyResolve,T=null,x=!1;return J.race([p,(typeof navigator>"u"?J.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(P){function O(){return indexedDB.databases().finally(P)}E=setInterval(O,100),O()}).finally(function(){return clearInterval(E)}):Promise.resolve()).then(S)]).then(function(){return w(),a.onReadyBeingFired=[],J.resolve(lo(function(){return s.on.ready.fire(s.vip)})).then(function P(){if(0<a.onReadyBeingFired.length){var O=a.onReadyBeingFired.reduce(Fs,le);return a.onReadyBeingFired=[],J.resolve(lo(function(){return O(s.vip)})).then(P)}})}).finally(function(){a.openCanceller===p&&(a.onReadyBeingFired=null,a.isBeingOpened=!1)}).catch(function(P){a.dbOpenError=P;try{T&&T.abort()}catch{}return p===a.openCanceller&&s._close(),Be(P)}).finally(function(){a.openComplete=!0,I()}).then(function(){var P;return x&&(P={},s.tables.forEach(function(O){O.schema.indexes.forEach(function(A){A.name&&(P["idb://".concat(s.name,"/").concat(O.name,"/").concat(A.name)]=new ot(-1/0,[[[]]]))}),P["idb://".concat(s.name,"/").concat(O.name,"/")]=P["idb://".concat(s.name,"/").concat(O.name,"/:dels")]=new ot(-1/0,[[[]]])}),un(Ar).fire(P),yo(P,!0)),s})}function go(s){function a(v){return s.next(v)}var u=y(a),p=y(function(v){return s.throw(v)});function y(v){return function(E){var S=v(E),E=S.value;return S.done?E:E&&typeof E.then=="function"?E.then(u,p):l(E)?Promise.all(E).then(u,p):u(E)}}return y(a)()}function Ni(s,a,u){for(var p=l(s)?s.slice():[s],y=0;y<u;++y)p.push(a);return p}var Td={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(s){return r(r({},s),{table:function(a){var u=s.table(a),p=u.schema,y={},v=[];function w(x,P,O){var A=Tr(x),D=y[A]=y[A]||[],R=x==null?0:typeof x=="string"?1:x.length,U=0<P,U=r(r({},O),{name:U?"".concat(A,"(virtual-from:").concat(O.name,")"):O.name,lowLevelIndex:O,isVirtual:U,keyTail:P,keyLength:R,extractKey:ro(x),unique:!U&&O.unique});return D.push(U),U.isPrimaryKey||v.push(U),1<R&&w(R===2?x[0]:x.slice(0,R-1),P+1,O),D.sort(function(L,M){return L.keyTail-M.keyTail}),U}a=w(p.primaryKey.keyPath,0,p.primaryKey),y[":id"]=[a];for(var S=0,E=p.indexes;S<E.length;S++){var I=E[S];w(I.keyPath,0,I)}function T(x){var P,O=x.query.index;return O.isVirtual?r(r({},x),{query:{index:O.lowLevelIndex,range:(P=x.query.range,O=O.keyTail,{type:P.type===1?2:P.type,lower:Ni(P.lower,P.lowerOpen?s.MAX_KEY:s.MIN_KEY,O),lowerOpen:!0,upper:Ni(P.upper,P.upperOpen?s.MIN_KEY:s.MAX_KEY,O),upperOpen:!0})}}):x}return r(r({},u),{schema:r(r({},p),{primaryKey:a,indexes:v,getIndexByKeyPath:function(x){return(x=y[Tr(x)])&&x[0]}}),count:function(x){return u.count(T(x))},query:function(x){return u.query(T(x))},openCursor:function(x){var P=x.query.index,O=P.keyTail,A=P.isVirtual,D=P.keyLength;return A?u.openCursor(T(x)).then(function(U){return U&&R(U)}):u.openCursor(x);function R(U){return Object.create(U,{continue:{value:function(L){L!=null?U.continue(Ni(L,x.reverse?s.MAX_KEY:s.MIN_KEY,O)):x.unique?U.continue(U.key.slice(0,D).concat(x.reverse?s.MIN_KEY:s.MAX_KEY,O)):U.continue()}},continuePrimaryKey:{value:function(L,M){U.continuePrimaryKey(Ni(L,s.MAX_KEY,O),M)}},primaryKey:{get:function(){return U.primaryKey}},key:{get:function(){var L=U.key;return D===1?L[0]:L.slice(0,D)}},value:{get:function(){return U.value}}})}}})}})}};function mo(s,a,u,p){return u=u||{},p=p||"",c(s).forEach(function(y){var v,w,S;g(a,y)?(v=s[y],w=a[y],typeof v=="object"&&typeof w=="object"&&v&&w?(S=ge(v))!==ge(w)?u[p+y]=a[y]:S==="Object"?mo(v,w,u,p+y+"."):v!==w&&(u[p+y]=a[y]):v!==w&&(u[p+y]=a[y])):u[p+y]=void 0}),c(a).forEach(function(y){g(s,y)||(u[p+y]=a[y])}),u}function vo(s,a){return a.type==="delete"?a.keys:a.keys||a.values.map(s.extractKey)}var Rd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(s){return r(r({},s),{table:function(a){var u=s.table(a),p=u.schema.primaryKey;return r(r({},u),{mutate:function(y){var v=se.trans,w=v.table(a).hook,S=w.deleting,E=w.creating,I=w.updating;switch(y.type){case"add":if(E.fire===le)break;return v._promise("readwrite",function(){return T(y)},!0);case"put":if(E.fire===le&&I.fire===le)break;return v._promise("readwrite",function(){return T(y)},!0);case"delete":if(S.fire===le)break;return v._promise("readwrite",function(){return T(y)},!0);case"deleteRange":if(S.fire===le)break;return v._promise("readwrite",function(){return function x(P,O,A){return u.query({trans:P,values:!1,query:{index:p,range:O},limit:A}).then(function(D){var R=D.result;return T({type:"delete",keys:R,trans:P}).then(function(U){return 0<U.numFailures?Promise.reject(U.failures[0]):R.length<A?{failures:[],numFailures:0,lastResult:void 0}:x(P,r(r({},O),{lower:R[R.length-1],lowerOpen:!0}),A)})})}(y.trans,y.range,1e4)},!0)}return u.mutate(y);function T(x){var P,O,A,D=se.trans,R=x.keys||vo(p,x);if(!R)throw new Error("Keys missing");return(x=x.type==="add"||x.type==="put"?r(r({},x),{keys:R}):r({},x)).type!=="delete"&&(x.values=i([],x.values)),x.keys&&(x.keys=i([],x.keys)),P=u,A=R,((O=x).type==="add"?Promise.resolve([]):P.getMany({trans:O.trans,keys:A,cache:"immutable"})).then(function(U){var L=R.map(function(M,B){var q,z,$,V=U[B],Y={onerror:null,onsuccess:null};return x.type==="delete"?S.fire.call(Y,M,V,D):x.type==="add"||V===void 0?(q=E.fire.call(Y,M,x.values[B],D),M==null&&q!=null&&(x.keys[B]=M=q,p.outbound||oe(x.values[B],p.keyPath,M))):(q=mo(V,x.values[B]),(z=I.fire.call(Y,q,M,V,D))&&($=x.values[B],Object.keys(z).forEach(function(W){g($,W)?$[W]=z[W]:oe($,W,z[W])}))),Y});return u.mutate(x).then(function(M){for(var B=M.failures,q=M.results,z=M.numFailures,M=M.lastResult,$=0;$<R.length;++$){var V=(q||R)[$],Y=L[$];V==null?Y.onerror&&Y.onerror(B[$]):Y.onsuccess&&Y.onsuccess(x.type==="put"&&U[$]?x.values[$]:V)}return{failures:B,results:q,numFailures:z,lastResult:M}}).catch(function(M){return L.forEach(function(B){return B.onerror&&B.onerror(M)}),Promise.reject(M)})})}}})}})}};function vc(s,a,u){try{if(!a||a.keys.length<s.length)return null;for(var p=[],y=0,v=0;y<a.keys.length&&v<s.length;++y)xe(a.keys[y],s[v])===0&&(p.push(u?we(a.values[y]):a.values[y]),++v);return p.length===s.length?p:null}catch{return null}}var Pd={stack:"dbcore",level:-1,create:function(s){return{table:function(a){var u=s.table(a);return r(r({},u),{getMany:function(p){if(!p.cache)return u.getMany(p);var y=vc(p.keys,p.trans._cache,p.cache==="clone");return y?J.resolve(y):u.getMany(p).then(function(v){return p.trans._cache={keys:p.keys,values:p.cache==="clone"?we(v):v},v})},mutate:function(p){return p.type!=="add"&&(p.trans._cache=null),u.mutate(p)}})}}}};function bc(s,a){return s.trans.mode==="readonly"&&!!s.subscr&&!s.trans.explicit&&s.trans.db._options.cache!=="disabled"&&!a.schema.primaryKey.outbound}function wc(s,a){switch(s){case"query":return a.values&&!a.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Ud={stack:"dbcore",level:0,name:"Observability",create:function(s){var a=s.schema.name,u=new ot(s.MIN_KEY,s.MAX_KEY);return r(r({},s),{transaction:function(p,y,v){if(se.subscr&&y!=="readonly")throw new ee.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(se.querier));return s.transaction(p,y,v)},table:function(p){var y=s.table(p),v=y.schema,w=v.primaryKey,x=v.indexes,S=w.extractKey,E=w.outbound,I=w.autoIncrement&&x.filter(function(O){return O.compound&&O.keyPath.includes(w.keyPath)}),T=r(r({},y),{mutate:function(O){function A(W){return W="idb://".concat(a,"/").concat(p,"/").concat(W),M[W]||(M[W]=new ot)}var D,R,U,L=O.trans,M=O.mutatedParts||(O.mutatedParts={}),B=A(""),q=A(":dels"),z=O.type,Y=O.type==="deleteRange"?[O.range]:O.type==="delete"?[O.keys]:O.values.length<50?[vo(w,O).filter(function(W){return W}),O.values]:[],$=Y[0],V=Y[1],Y=O.trans._cache;return l($)?(B.addKeys($),(Y=z==="delete"||$.length===V.length?vc($,Y):null)||q.addKeys($),(Y||V)&&(D=A,R=Y,U=V,v.indexes.forEach(function(W){var ne=D(W.name||"");function pe(be){return be!=null?W.extractKey(be):null}function me(be){return W.multiEntry&&l(be)?be.forEach(function(vt){return ne.addKey(vt)}):ne.addKey(be)}(R||U).forEach(function(be,at){var he=R&&pe(R[at]),at=U&&pe(U[at]);xe(he,at)!==0&&(he!=null&&me(he),at!=null&&me(at))})}))):$?(V={from:(V=$.lower)!==null&&V!==void 0?V:s.MIN_KEY,to:(V=$.upper)!==null&&V!==void 0?V:s.MAX_KEY},q.add(V),B.add(V)):(B.add(u),q.add(u),v.indexes.forEach(function(W){return A(W.name).add(u)})),y.mutate(O).then(function(W){return!$||O.type!=="add"&&O.type!=="put"||(B.addKeys(W.results),I&&I.forEach(function(ne){for(var pe=O.values.map(function(he){return ne.extractKey(he)}),me=ne.keyPath.findIndex(function(he){return he===w.keyPath}),be=0,vt=W.results.length;be<vt;++be)pe[be][me]=W.results[be];A(ne.name).addKeys(pe)})),L.mutatedParts=ji(L.mutatedParts||{},M),W})}}),x=function(A){var D=A.query,A=D.index,D=D.range;return[A,new ot((A=D.lower)!==null&&A!==void 0?A:s.MIN_KEY,(D=D.upper)!==null&&D!==void 0?D:s.MAX_KEY)]},P={get:function(O){return[w,new ot(O.key)]},getMany:function(O){return[w,new ot().addKeys(O.keys)]},count:x,query:x,openCursor:x};return c(P).forEach(function(O){T[O]=function(A){var D=se.subscr,R=!!D,U=bc(se,y)&&wc(O,A)?A.obsSet={}:D;if(R){var L=function(V){return V="idb://".concat(a,"/").concat(p,"/").concat(V),U[V]||(U[V]=new ot)},M=L(""),B=L(":dels"),D=P[O](A),R=D[0],D=D[1];if((O==="query"&&R.isPrimaryKey&&!A.values?B:L(R.name||"")).add(D),!R.isPrimaryKey){if(O!=="count"){var q=O==="query"&&E&&A.values&&y.query(r(r({},A),{values:!1}));return y[O].apply(this,arguments).then(function(V){if(O==="query"){if(E&&A.values)return q.then(function(pe){return pe=pe.result,M.addKeys(pe),V});var Y=A.values?V.result.map(S):V.result;(A.values?M:B).addKeys(Y)}else if(O==="openCursor"){var W=V,ne=A.values;return W&&Object.create(W,{key:{get:function(){return B.addKey(W.primaryKey),W.key}},primaryKey:{get:function(){var pe=W.primaryKey;return B.addKey(pe),pe}},value:{get:function(){return ne&&M.addKey(W.primaryKey),W.value}}})}return V})}B.add(u)}}return y[O].apply(this,arguments)}}),T}})}};function _c(s,a,u){if(u.numFailures===0)return a;if(a.type==="deleteRange")return null;var p=a.keys?a.keys.length:"values"in a&&a.values?a.values.length:1;return u.numFailures===p?null:(a=r({},a),l(a.keys)&&(a.keys=a.keys.filter(function(y,v){return!(v in u.failures)})),"values"in a&&l(a.values)&&(a.values=a.values.filter(function(y,v){return!(v in u.failures)})),a)}function bo(s,a){return u=s,((p=a).lower===void 0||(p.lowerOpen?0<xe(u,p.lower):0<=xe(u,p.lower)))&&(s=s,(a=a).upper===void 0||(a.upperOpen?xe(s,a.upper)<0:xe(s,a.upper)<=0));var u,p}function kc(s,a,P,p,y,v){if(!P||P.length===0)return s;var w=a.query.index,S=w.multiEntry,E=a.query.range,I=p.schema.primaryKey.extractKey,T=w.extractKey,x=(w.lowLevelIndex||w).extractKey,P=P.reduce(function(O,A){var D=O,R=[];if(A.type==="add"||A.type==="put")for(var U=new ot,L=A.values.length-1;0<=L;--L){var M,B=A.values[L],q=I(B);U.hasKey(q)||(M=T(B),(S&&l(M)?M.some(function(W){return bo(W,E)}):bo(M,E))&&(U.addKey(q),R.push(B)))}switch(A.type){case"add":var z=new ot().addKeys(a.values?O.map(function(ne){return I(ne)}):O),D=O.concat(a.values?R.filter(function(ne){return ne=I(ne),!z.hasKey(ne)&&(z.addKey(ne),!0)}):R.map(function(ne){return I(ne)}).filter(function(ne){return!z.hasKey(ne)&&(z.addKey(ne),!0)}));break;case"put":var $=new ot().addKeys(A.values.map(function(ne){return I(ne)}));D=O.filter(function(ne){return!$.hasKey(a.values?I(ne):ne)}).concat(a.values?R:R.map(function(ne){return I(ne)}));break;case"delete":var V=new ot().addKeys(A.keys);D=O.filter(function(ne){return!V.hasKey(a.values?I(ne):ne)});break;case"deleteRange":var Y=A.range;D=O.filter(function(ne){return!bo(I(ne),Y)})}return D},s);return P===s?s:(P.sort(function(O,A){return xe(x(O),x(A))||xe(I(O),I(A))}),a.limit&&a.limit<1/0&&(P.length>a.limit?P.length=a.limit:s.length===a.limit&&P.length<a.limit&&(y.dirty=!0)),v?Object.freeze(P):P)}function Sc(s,a){return xe(s.lower,a.lower)===0&&xe(s.upper,a.upper)===0&&!!s.lowerOpen==!!a.lowerOpen&&!!s.upperOpen==!!a.upperOpen}function jd(s,a){return function(u,p,y,v){if(u===void 0)return p!==void 0?-1:0;if(p===void 0)return 1;if((p=xe(u,p))===0){if(y&&v)return 0;if(y)return 1;if(v)return-1}return p}(s.lower,a.lower,s.lowerOpen,a.lowerOpen)<=0&&0<=function(u,p,y,v){if(u===void 0)return p!==void 0?1:0;if(p===void 0)return-1;if((p=xe(u,p))===0){if(y&&v)return 0;if(y)return-1;if(v)return 1}return p}(s.upper,a.upper,s.upperOpen,a.upperOpen)}function Ld(s,a,u,p){s.subscribers.add(u),p.addEventListener("abort",function(){var y,v;s.subscribers.delete(u),s.subscribers.size===0&&(y=s,v=a,setTimeout(function(){y.subscribers.size===0&&X(v,y)},3e3))})}var Nd={stack:"dbcore",level:0,name:"Cache",create:function(s){var a=s.schema.name;return r(r({},s),{transaction:function(u,p,y){var v,w,S=s.transaction(u,p,y);return p==="readwrite"&&(w=(v=new AbortController).signal,y=function(E){return function(){if(v.abort(),p==="readwrite"){for(var I=new Set,T=0,x=u;T<x.length;T++){var P=x[T],O=Tn["idb://".concat(a,"/").concat(P)];if(O){var A=s.table(P),D=O.optimisticOps.filter(function(ne){return ne.trans===S});if(S._explicit&&E&&S.mutatedParts)for(var R=0,U=Object.values(O.queries.query);R<U.length;R++)for(var L=0,M=(z=U[R]).slice();L<M.length;L++)fo(($=M[L]).obsSet,S.mutatedParts)&&(X(z,$),$.subscribers.forEach(function(ne){return I.add(ne)}));else if(0<D.length){O.optimisticOps=O.optimisticOps.filter(function(ne){return ne.trans!==S});for(var B=0,q=Object.values(O.queries.query);B<q.length;B++)for(var z,$,V,Y=0,W=(z=q[B]).slice();Y<W.length;Y++)($=W[Y]).res!=null&&S.mutatedParts&&(E&&!$.dirty?(V=Object.isFrozen($.res),V=kc($.res,$.req,D,A,$,V),$.dirty?(X(z,$),$.subscribers.forEach(function(ne){return I.add(ne)})):V!==$.res&&($.res=V,$.promise=J.resolve({result:V}))):($.dirty&&X(z,$),$.subscribers.forEach(function(ne){return I.add(ne)})))}}}I.forEach(function(ne){return ne()})}}},S.addEventListener("abort",y(!1),{signal:w}),S.addEventListener("error",y(!1),{signal:w}),S.addEventListener("complete",y(!0),{signal:w})),S},table:function(u){var p=s.table(u),y=p.schema.primaryKey;return r(r({},p),{mutate:function(v){var w=se.trans;if(y.outbound||w.db._options.cache==="disabled"||w.explicit||w.idbtrans.mode!=="readwrite")return p.mutate(v);var S=Tn["idb://".concat(a,"/").concat(u)];return S?(w=p.mutate(v),v.type!=="add"&&v.type!=="put"||!(50<=v.values.length||vo(y,v).some(function(E){return E==null}))?(S.optimisticOps.push(v),v.mutatedParts&&Li(v.mutatedParts),w.then(function(E){0<E.numFailures&&(X(S.optimisticOps,v),(E=_c(0,v,E))&&S.optimisticOps.push(E),v.mutatedParts&&Li(v.mutatedParts))}),w.catch(function(){X(S.optimisticOps,v),v.mutatedParts&&Li(v.mutatedParts)})):w.then(function(E){var I=_c(0,r(r({},v),{values:v.values.map(function(T,x){var P;return E.failures[x]?T:(T=(P=y.keyPath)!==null&&P!==void 0&&P.includes(".")?we(T):r({},T),oe(T,y.keyPath,E.results[x]),T)})}),E);S.optimisticOps.push(I),queueMicrotask(function(){return v.mutatedParts&&Li(v.mutatedParts)})}),w):p.mutate(v)},query:function(v){if(!bc(se,p)||!wc("query",v))return p.query(v);var w=((I=se.trans)===null||I===void 0?void 0:I.db._options.cache)==="immutable",x=se,S=x.requery,E=x.signal,I=function(A,D,R,U){var L=Tn["idb://".concat(A,"/").concat(D)];if(!L)return[];if(!(D=L.queries[R]))return[null,!1,L,null];var M=D[(U.query?U.query.index.name:null)||""];if(!M)return[null,!1,L,null];switch(R){case"query":var B=M.find(function(q){return q.req.limit===U.limit&&q.req.values===U.values&&Sc(q.req.query.range,U.query.range)});return B?[B,!0,L,M]:[M.find(function(q){return("limit"in q.req?q.req.limit:1/0)>=U.limit&&(!U.values||q.req.values)&&jd(q.req.query.range,U.query.range)}),!1,L,M];case"count":return B=M.find(function(q){return Sc(q.req.query.range,U.query.range)}),[B,!!B,L,M]}}(a,u,"query",v),T=I[0],x=I[1],P=I[2],O=I[3];return T&&x?T.obsSet=v.obsSet:(x=p.query(v).then(function(A){var D=A.result;if(T&&(T.res=D),w){for(var R=0,U=D.length;R<U;++R)Object.freeze(D[R]);Object.freeze(D)}else A.result=we(D);return A}).catch(function(A){return O&&T&&X(O,T),Promise.reject(A)}),T={obsSet:v.obsSet,promise:x,subscribers:new Set,type:"query",req:v,dirty:!1},O?O.push(T):(O=[T],(P=P||(Tn["idb://".concat(a,"/").concat(u)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[v.query.index.name||""]=O)),Ld(T,O,S,E),T.promise.then(function(A){return{result:kc(A.result,v,P==null?void 0:P.optimisticOps,p,T,w)}})}})}})}};function Mi(s,a){return new Proxy(s,{get:function(u,p,y){return p==="db"?a:Reflect.get(u,p,y)}})}var Ht=(Fe.prototype.version=function(s){if(isNaN(s)||s<.1)throw new ee.Type("Given version is not a positive number");if(s=Math.round(10*s)/10,this.idbdb||this._state.isBeingOpened)throw new ee.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,s);var a=this._versions,u=a.filter(function(p){return p._cfg.version===s})[0];return u||(u=new this.Version(s),a.push(u),a.sort(Cd),u.stores({}),this._state.autoSchema=!1,u)},Fe.prototype._whenReady=function(s){var a=this;return this.idbdb&&(this._state.openComplete||se.letThrough||this._vip)?s():new J(function(u,p){if(a._state.openComplete)return p(new ee.DatabaseClosed(a._state.dbOpenError));if(!a._state.isBeingOpened){if(!a._state.autoOpen)return void p(new ee.DatabaseClosed);a.open().catch(le)}a._state.dbReadyPromise.then(u,p)}).then(s)},Fe.prototype.use=function(s){var a=s.stack,u=s.create,p=s.level,y=s.name;return y&&this.unuse({stack:a,name:y}),s=this._middlewares[a]||(this._middlewares[a]=[]),s.push({stack:a,create:u,level:p??10,name:y}),s.sort(function(v,w){return v.level-w.level}),this},Fe.prototype.unuse=function(s){var a=s.stack,u=s.name,p=s.create;return a&&this._middlewares[a]&&(this._middlewares[a]=this._middlewares[a].filter(function(y){return p?y.create!==p:!!u&&y.name!==u})),this},Fe.prototype.open=function(){var s=this;return On(sn,function(){return Dd(s)})},Fe.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var s=this._state,a=Wn.indexOf(this);if(0<=a&&Wn.splice(a,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}s.isBeingOpened||(s.dbReadyPromise=new J(function(u){s.dbReadyResolve=u}),s.openCanceller=new J(function(u,p){s.cancelOpen=p}))},Fe.prototype.close=function(u){var a=(u===void 0?{disableAutoOpen:!0}:u).disableAutoOpen,u=this._state;a?(u.isBeingOpened&&u.cancelOpen(new ee.DatabaseClosed),this._close(),u.autoOpen=!1,u.dbOpenError=new ee.DatabaseClosed):(this._close(),u.autoOpen=this._options.autoOpen||u.isBeingOpened,u.openComplete=!1,u.dbOpenError=null)},Fe.prototype.delete=function(s){var a=this;s===void 0&&(s={disableAutoOpen:!0});var u=0<arguments.length&&typeof arguments[0]!="object",p=this._state;return new J(function(y,v){function w(){a.close(s);var S=a._deps.indexedDB.deleteDatabase(a.name);S.onsuccess=Me(function(){var E,I,T;E=a._deps,I=a.name,T=E.indexedDB,E=E.IDBKeyRange,co(T)||I===Si||ao(T,E).delete(I).catch(le),y()}),S.onerror=Ut(v),S.onblocked=a._fireOnBlocked}if(u)throw new ee.InvalidArgument("Invalid closeOptions argument to db.delete()");p.isBeingOpened?p.dbReadyPromise.then(w):w()})},Fe.prototype.backendDB=function(){return this.idbdb},Fe.prototype.isOpen=function(){return this.idbdb!==null},Fe.prototype.hasBeenClosed=function(){var s=this._state.dbOpenError;return s&&s.name==="DatabaseClosed"},Fe.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Fe.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Fe.prototype,"tables",{get:function(){var s=this;return c(this._allTables).map(function(a){return s._allTables[a]})},enumerable:!1,configurable:!0}),Fe.prototype.transaction=function(){var s=(function(a,u,p){var y=arguments.length;if(y<2)throw new ee.InvalidArgument("Too few arguments");for(var v=new Array(y-1);--y;)v[y-1]=arguments[y];return p=v.pop(),[a,De(v),p]}).apply(this,arguments);return this._transaction.apply(this,s)},Fe.prototype._transaction=function(s,a,u){var p=this,y=se.trans;y&&y.db===this&&s.indexOf("!")===-1||(y=null);var v,w,S=s.indexOf("?")!==-1;s=s.replace("!","").replace("?","");try{if(w=a.map(function(I){if(I=I instanceof p.Table?I.name:I,typeof I!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return I}),s=="r"||s===Js)v=Js;else{if(s!="rw"&&s!=Xs)throw new ee.InvalidArgument("Invalid transaction mode: "+s);v=Xs}if(y){if(y.mode===Js&&v===Xs){if(!S)throw new ee.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");y=null}y&&w.forEach(function(I){if(y&&y.storeNames.indexOf(I)===-1){if(!S)throw new ee.SubTransaction("Table "+I+" not included in parent transaction.");y=null}}),S&&y&&!y.active&&(y=null)}}catch(I){return y?y._promise(null,function(T,x){x(I)}):Be(I)}var E=(function I(T,x,P,O,A){return J.resolve().then(function(){var D=se.transless||se,R=T._createTransaction(x,P,T._dbSchema,O);if(R.explicit=!0,D={trans:R,transless:D},O)R.idbtrans=O.idbtrans;else try{R.create(),R.idbtrans._explicit=!0,T._state.PR1398_maxLoop=3}catch(M){return M.name===st.InvalidState&&T.isOpen()&&0<--T._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),T.close({disableAutoOpen:!1}),T.open().then(function(){return I(T,x,P,null,A)})):Be(M)}var U,L=ce(A);return L&&Vn(),D=J.follow(function(){var M;(U=A.call(R,R))&&(L?(M=an.bind(null,null),U.then(M,M)):typeof U.next=="function"&&typeof U.throw=="function"&&(U=go(U)))},D),(U&&typeof U.then=="function"?J.resolve(U).then(function(M){return R.active?M:Be(new ee.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):D.then(function(){return U})).then(function(M){return O&&R._resolve(),R._completion.then(function(){return M})}).catch(function(M){return R._reject(M),Be(M)})})}).bind(null,this,v,w,y,u);return y?y._promise(v,E,"lock"):se.trans?On(se.transless,function(){return p._whenReady(E)}):this._whenReady(E)},Fe.prototype.table=function(s){if(!g(this._allTables,s))throw new ee.InvalidTable("Table ".concat(s," does not exist"));return this._allTables[s]},Fe);function Fe(s,a){var u=this;this._middlewares={},this.verno=0;var p=Fe.dependencies;this._options=a=r({addons:Fe.addons,autoOpen:!0,indexedDB:p.indexedDB,IDBKeyRange:p.IDBKeyRange,cache:"cloned"},a),this._deps={indexedDB:a.indexedDB,IDBKeyRange:a.IDBKeyRange},p=a.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var y,v,w,S,E,I={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:le,dbReadyPromise:null,cancelOpen:le,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:a.autoOpen};I.dbReadyPromise=new J(function(x){I.dbReadyResolve=x}),I.openCanceller=new J(function(x,P){I.cancelOpen=P}),this._state=I,this.name=s,this.on=Cr(this,"populate","blocked","versionchange","close",{ready:[Fs,le]}),this.once=function(x,P){var O=function(){for(var A=[],D=0;D<arguments.length;D++)A[D]=arguments[D];u.on(x).unsubscribe(O),P.apply(u,A)};return u.on(x,O)},this.on.ready.subscribe=N(this.on.ready.subscribe,function(x){return function(P,O){Fe.vip(function(){var A,D=u._state;D.openComplete?(D.dbOpenError||J.resolve().then(P),O&&x(P)):D.onReadyBeingFired?(D.onReadyBeingFired.push(P),O&&x(P)):(x(P),A=u,O||x(function R(){A.on.ready.unsubscribe(P),A.on.ready.unsubscribe(R)}))})}}),this.Collection=(y=this,Ir(bd.prototype,function(U,R){this.db=y;var O=Qa,A=null;if(R)try{O=R()}catch(L){A=L}var D=U._ctx,R=D.table,U=R.hook.reading.fire;this._ctx={table:R,index:D.index,isPrimKey:!D.index||R.schema.primKey.keyPath&&D.index===R.schema.primKey.name,range:O,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:A,or:D.or,valueMapper:U!==ke?U:null}})),this.Table=(v=this,Ir(ic.prototype,function(x,P,O){this.db=v,this._tx=O,this.name=x,this.schema=P,this.hook=v._allTables[x]?v._allTables[x].hook:Cr(null,{creating:[gt,le],reading:[Ie,ke],updating:[Rt,le],deleting:[Sn,le]})})),this.Transaction=(w=this,Ir(kd.prototype,function(x,P,O,A,D){var R=this;x!=="readonly"&&P.forEach(function(U){U=(U=O[U])===null||U===void 0?void 0:U.yProps,U&&(P=P.concat(U.map(function(L){return L.updatesTable})))}),this.db=w,this.mode=x,this.storeNames=P,this.schema=O,this.chromeTransactionDurability=A,this.idbtrans=null,this.on=Cr(this,"complete","error","abort"),this.parent=D||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new J(function(U,L){R._resolve=U,R._reject=L}),this._completion.then(function(){R.active=!1,R.on.complete.fire()},function(U){var L=R.active;return R.active=!1,R.on.error.fire(U),R.parent?R.parent._reject(U):L&&R.idbtrans&&R.idbtrans.abort(),Be(U)})})),this.Version=(S=this,Ir(Ad.prototype,function(x){this.db=S,this._cfg={version:x,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(E=this,Ir(lc.prototype,function(x,P,O){if(this.db=E,this._ctx={table:x,index:P===":id"?null:P,or:O},this._cmp=this._ascending=xe,this._descending=function(A,D){return xe(D,A)},this._max=function(A,D){return 0<xe(A,D)?A:D},this._min=function(A,D){return xe(A,D)<0?A:D},this._IDBKeyRange=E._deps.IDBKeyRange,!this._IDBKeyRange)throw new ee.MissingAPI})),this.on("versionchange",function(x){0<x.newVersion?console.warn("Another connection wants to upgrade database '".concat(u.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(u.name,"'. Closing db now to resume the delete request.")),u.close({disableAutoOpen:!1})}),this.on("blocked",function(x){!x.newVersion||x.newVersion<x.oldVersion?console.warn("Dexie.delete('".concat(u.name,"') was blocked")):console.warn("Upgrade '".concat(u.name,"' blocked by other connection holding version ").concat(x.oldVersion/10))}),this._maxKey=Dr(a.IDBKeyRange),this._createTransaction=function(x,P,O,A){return new u.Transaction(x,P,O,u._options.chromeTransactionDurability,A)},this._fireOnBlocked=function(x){u.on("blocked").fire(x),Wn.filter(function(P){return P.name===u.name&&P!==u&&!P._state.vcFired}).map(function(P){return P.on("versionchange").fire(x)})},this.use(Pd),this.use(Nd),this.use(Ud),this.use(Td),this.use(Rd);var T=new Proxy(this,{get:function(x,P,O){if(P==="_vip")return!0;if(P==="table")return function(D){return Mi(u.table(D),T)};var A=Reflect.get(x,P,O);return A instanceof ic?Mi(A,T):P==="tables"?A.map(function(D){return Mi(D,T)}):P==="_createTransaction"?function(){return Mi(A.apply(this,arguments),T)}:A}});this.vip=T,p.forEach(function(x){return x(u)})}var Ki,Et=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Md=(wo.prototype.subscribe=function(s,a,u){return this._subscribe(s&&typeof s!="function"?s:{next:s,error:a,complete:u})},wo.prototype[Et]=function(){return this},wo);function wo(s){this._subscribe=s}try{Ki={indexedDB:o.indexedDB||o.mozIndexedDB||o.webkitIndexedDB||o.msIndexedDB,IDBKeyRange:o.IDBKeyRange||o.webkitIDBKeyRange}}catch{Ki={indexedDB:null,IDBKeyRange:null}}function xc(s){var a,u=!1,p=new Md(function(y){var v=ce(s),w,S=!1,E={},I={},T={get closed(){return S},unsubscribe:function(){S||(S=!0,w&&w.abort(),x&&un.storagemutated.unsubscribe(O))}};y.start&&y.start(T);var x=!1,P=function(){return Gs(A)},O=function(D){ji(E,D),fo(I,E)&&P()},A=function(){var D,R,U;!S&&Ki.indexedDB&&(E={},D={},w&&w.abort(),w=new AbortController,U=function(L){var M=$n();try{v&&Vn();var B=on(s,L);return B=v?B.finally(an):B}finally{M&&qn()}}(R={subscr:D,signal:w.signal,requery:P,querier:s,trans:null}),Promise.resolve(U).then(function(L){u=!0,a=L,S||R.signal.aborted||(E={},function(M){for(var B in M)if(g(M,B))return;return 1}(I=D)||x||(un(Ar,O),x=!0),Gs(function(){return!S&&y.next&&y.next(L)}))},function(L){u=!1,["DatabaseClosedError","AbortError"].includes(L==null?void 0:L.name)||S||Gs(function(){S||y.error&&y.error(L)})}))};return setTimeout(P,0),T});return p.hasValue=function(){return u},p.getValue=function(){return a},p}var Rn=Ht;function _o(s){var a=fn;try{fn=!0,un.storagemutated.fire(s),yo(s,!0)}finally{fn=a}}m(Rn,r(r({},$e),{delete:function(s){return new Rn(s,{addons:[]}).delete()},exists:function(s){return new Rn(s,{addons:[]}).open().then(function(a){return a.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(s){try{return a=Rn.dependencies,u=a.indexedDB,a=a.IDBKeyRange,(co(u)?Promise.resolve(u.databases()).then(function(p){return p.map(function(y){return y.name}).filter(function(y){return y!==Si})}):ao(u,a).toCollection().primaryKeys()).then(s)}catch{return Be(new ee.MissingAPI)}var a,u},defineClass:function(){return function(s){f(this,s)}},ignoreTransaction:function(s){return se.trans?On(se.transless,s):s()},vip:lo,async:function(s){return function(){try{var a=go(s.apply(this,arguments));return a&&typeof a.then=="function"?a:J.resolve(a)}catch(u){return Be(u)}}},spawn:function(s,a,u){try{var p=go(s.apply(u,a||[]));return p&&typeof p.then=="function"?p:J.resolve(p)}catch(y){return Be(y)}},currentTransaction:{get:function(){return se.trans||null}},waitFor:function(s,a){return a=J.resolve(typeof s=="function"?Rn.ignoreTransaction(s):s).timeout(a||6e4),se.trans?se.trans.waitFor(a):a},Promise:J,debug:{get:function(){return Pt},set:function(s){Wa(s)}},derive:C,extend:f,props:m,override:N,Events:Cr,on:un,liveQuery:xc,extendObservabilitySet:ji,getByKeyPath:Q,setByKeyPath:oe,delByKeyPath:function(s,a){typeof a=="string"?oe(s,a,void 0):"length"in a&&[].map.call(a,function(u){oe(s,u,void 0)})},shallowClone:Te,deepClone:we,getObjectDiff:mo,cmp:xe,asap:re,minKey:-1/0,addons:[],connections:Wn,errnames:st,dependencies:Ki,cache:Tn,semVer:"4.2.1",version:"4.2.1".split(".").map(function(s){return parseInt(s)}).reduce(function(s,a,u){return s+a/Math.pow(10,2*u)})})),Rn.maxKey=Dr(Rn.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(un(Ar,function(s){fn||(s=new CustomEvent(eo,{detail:s}),fn=!0,dispatchEvent(s),fn=!1)}),addEventListener(eo,function(s){s=s.detail,fn||_o(s)}));var Gn,fn=!1,Ec=function(){};return typeof BroadcastChannel<"u"&&((Ec=function(){(Gn=new BroadcastChannel(eo)).onmessage=function(s){return s.data&&_o(s.data)}})(),typeof Gn.unref=="function"&&Gn.unref(),un(Ar,function(s){fn||Gn.postMessage(s)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(s){if(!Ht.disableBfCache&&s.persisted){Pt&&console.debug("Dexie: handling persisted pagehide"),Gn!=null&&Gn.close();for(var a=0,u=Wn;a<u.length;a++)u[a].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(s){!Ht.disableBfCache&&s.persisted&&(Pt&&console.debug("Dexie: handling persisted pageshow"),Ec(),_o({all:new ot(-1/0,[[]])}))})),J.rejectionMapper=function(s,a){return!s||s instanceof Se||s instanceof TypeError||s instanceof SyntaxError||!s.name||!Ne[s.name]?s:(a=new Ne[s.name](a||s.message,s),"stack"in s&&k(a,"stack",{get:function(){return this.inner.stack}}),a)},Wa(Pt),r(Ht,Object.freeze({__proto__:null,Dexie:Ht,liveQuery:xc,Entity:Za,cmp:xe,PropModification:Er,replacePrefix:function(s,a){return new Er({replacePrefix:[s,a]})},add:function(s){return new Er({add:s})},remove:function(s){return new Er({remove:s})},default:Ht,RangeSet:ot,mergeRanges:Pr,rangesOverlap:pc}),{default:Ht}),Ht})})(Wl);var Bd=Wl.exports;const Ho=Kd(Bd),Ic=Symbol.for("Dexie"),Ee=globalThis[Ic]||(globalThis[Ic]=Ho);if(Ho.semVer!==Ee.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${Ho.semVer} and ${Ee.semVer}`);const{liveQuery:yn,mergeRanges:dv,rangesOverlap:hv,RangeSet:Fd,cmp:xs,Entity:pv,PropModification:Oc,replacePrefix:yv,add:gv,remove:mv,DexieYProvider:vv}=Ee;var zo=function(t,e){return zo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},zo(t,e)};function en(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");zo(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function $d(t,e,n,r){function i(o){return o instanceof n?o:new n(function(c){c(o)})}return new(n||(n=Promise))(function(o,c){function l(d){try{h(r.next(d))}catch(g){c(g)}}function f(d){try{h(r.throw(d))}catch(g){c(g)}}function h(d){d.done?o(d.value):i(d.value).then(l,f)}h((r=r.apply(t,[])).next())})}function Hl(t,e){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(h){return function(d){return f([h,d])}}function f(h){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(o=h[0]&2?i.return:h[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,h[1])).done)return o;switch(i=0,o&&(h=[h[0]&2,o.value]),h[0]){case 0:case 1:o=h;break;case 4:return n.label++,{value:h[1],done:!1};case 5:n.label++,i=h[1],h=[0];continue;case 7:h=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(h[0]===6||h[0]===2)){n=0;continue}if(h[0]===3&&(!o||h[1]>o[0]&&h[1]<o[3])){n.label=h[1];break}if(h[0]===6&&n.label<o[1]){n.label=o[1],o=h;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(h);break}o[2]&&n.ops.pop(),n.trys.pop();continue}h=e.call(t,n)}catch(d){h=[6,d],i=0}finally{r=o=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}}function rr(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ln(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,o=[],c;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(l){c={error:l}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(c)throw c.error}}return o}function ir(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}function Zn(t){return this instanceof Zn?(this.v=t,this):new Zn(t)}function qd(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,o=[];return i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i;function c(m){r[m]&&(i[m]=function(b){return new Promise(function(k,C){o.push([m,b,k,C])>1||l(m,b)})})}function l(m,b){try{f(r[m](b))}catch(k){g(o[0][3],k)}}function f(m){m.value instanceof Zn?Promise.resolve(m.value.v).then(h,d):g(o[0][2],m)}function h(m){l("next",m)}function d(m){l("throw",m)}function g(m,b){m(b),o.shift(),o.length&&l(o[0][0],o[0][1])}}function Vd(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof rr=="function"?rr(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=t[o]&&function(c){return new Promise(function(l,f){c=t[o](c),i(l,f,c.done,c.value)})}}function i(o,c,l,f){Promise.resolve(f).then(function(h){o({value:h,done:l})},c)}}function Re(t){return typeof t=="function"}function wa(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var So=wa(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function as(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var dr=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,o;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var l=rr(c),f=l.next();!f.done;f=l.next()){var h=f.value;h.remove(this)}}catch(C){e={error:C}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}else c.remove(this);var d=this.initialTeardown;if(Re(d))try{d()}catch(C){o=C instanceof So?C.errors:[C]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var m=rr(g),b=m.next();!b.done;b=m.next()){var k=b.value;try{Ac(k)}catch(C){o=o??[],C instanceof So?o=ir(ir([],Ln(o)),Ln(C.errors)):o.push(C)}}}catch(C){r={error:C}}finally{try{b&&!b.done&&(i=m.return)&&i.call(m)}finally{if(r)throw r.error}}}if(o)throw new So(o)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)Ac(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&as(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&as(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),zl=dr.EMPTY;function Yl(t){return t instanceof dr||t&&"closed"in t&&Re(t.remove)&&Re(t.add)&&Re(t.unsubscribe)}function Ac(t){Re(t)?t():t.unsubscribe()}var Wd={Promise:void 0},Hd={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,ir([t,e],Ln(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Gl(t){Hd.setTimeout(function(){throw t})}function Dc(){}function Qi(t){t()}var _a=function(t){en(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,Yl(n)&&n.add(r)):r.destination=Gd,r}return e.create=function(n,r,i){return new sr(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(dr),zd=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Fi(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Fi(r)}else Fi(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Fi(n)}},t}(),sr=function(t){en(e,t);function e(n,r,i){var o=t.call(this)||this,c;return Re(n)||!n?c={next:n??void 0,error:r??void 0,complete:i??void 0}:c=n,o.destination=new zd(c),o}return e}(_a);function Fi(t){Gl(t)}function Yd(t){throw t}var Gd={closed:!0,next:Dc,error:Yd,complete:Dc},ka=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function hr(t){return t}function Jd(t){return t.length===0?hr:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var ze=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,o=Qd(e)?e:new sr(e,n,r);return Qi(function(){var c=i,l=c.operator,f=c.source;o.add(l?l.call(o,f):f?i._subscribe(o):i._trySubscribe(o))}),o},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=Tc(n),new n(function(i,o){var c=new sr({next:function(l){try{e(l)}catch(f){o(f),c.unsubscribe()}},error:o,complete:i});r.subscribe(c)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[ka]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Jd(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=Tc(e),new e(function(r,i){var o;n.subscribe(function(c){return o=c},function(c){return i(c)},function(){return r(o)})})},t.create=function(e){return new t(e)},t}();function Tc(t){var e;return(e=t??Wd.Promise)!==null&&e!==void 0?e:Promise}function Xd(t){return t&&Re(t.next)&&Re(t.error)&&Re(t.complete)}function Qd(t){return t&&t instanceof _a||Xd(t)&&Yl(t)}function Zd(t){return Re(t==null?void 0:t.lift)}function xt(t){return function(e){if(Zd(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function St(t,e,n,r,i){return new eh(t,e,n,r,i)}var eh=function(t){en(e,t);function e(n,r,i,o,c,l){var f=t.call(this,n)||this;return f.onFinalize=c,f.shouldUnsubscribe=l,f._next=r?function(h){try{r(h)}catch(d){n.error(d)}}:t.prototype._next,f._error=o?function(h){try{o(h)}catch(d){n.error(d)}finally{this.unsubscribe()}}:t.prototype._error,f._complete=i?function(){try{i()}catch(h){n.error(h)}finally{this.unsubscribe()}}:t.prototype._complete,f}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(_a),th=wa(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Nn=function(t){en(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new Rc(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new th},e.prototype.next=function(n){var r=this;Qi(function(){var i,o;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var c=rr(r.currentObservers),l=c.next();!l.done;l=c.next()){var f=l.value;f.next(n)}}catch(h){i={error:h}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;Qi(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;Qi(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,o=i.hasError,c=i.isStopped,l=i.observers;return o||c?zl:(this.currentObservers=null,l.push(n),new dr(function(){r.currentObservers=null,as(l,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,o=r.thrownError,c=r.isStopped;i?n.error(o):c&&n.complete()},e.prototype.asObservable=function(){var n=new ze;return n.source=this,n},e.create=function(n,r){return new Rc(n,r)},e}(ze),Rc=function(t){en(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:zl},e}(Nn),Tt=function(t){en(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,o=n._value;if(r)throw i;return this._throwIfClosed(),o},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(Nn),nh={now:function(){return Date.now()}},rh=function(t){en(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e}(dr),Pc={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,ir([t,e],Ln(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},ih=function(t){en(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){if(r===void 0&&(r=0),this.closed)return this;this.state=n;var i=this.id,o=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(o,i,r)),this.pending=!0,this.delay=r,this.id=this.id||this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),Pc.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;Pc.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,o;try{this.work(n)}catch(c){i=!0,o=c||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),o},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,o=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,as(o,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(rh),Uc=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=nh.now,t}(),sh=function(t){en(e,t);function e(n,r){r===void 0&&(r=Uc.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i._scheduled=void 0,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e}(Uc),Sa=new sh(ih),oh=Sa,Jl=new ze(function(t){return t.complete()});function Xl(t){return t&&Re(t.schedule)}function xa(t){return t[t.length-1]}function ah(t){return Re(xa(t))?t.pop():void 0}function ai(t){return Xl(xa(t))?t.pop():void 0}function ch(t,e){return typeof xa(t)=="number"?t.pop():e}var Ea=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function Ql(t){return Re(t==null?void 0:t.then)}function Zl(t){return Re(t[ka])}function eu(t){return Symbol.asyncIterator&&Re(t==null?void 0:t[Symbol.asyncIterator])}function tu(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function lh(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var nu=lh();function ru(t){return Re(t==null?void 0:t[nu])}function iu(t){return qd(this,arguments,function(){var n,r,i,o;return Hl(this,function(c){switch(c.label){case 0:n=t.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,Zn(n.read())];case 3:return r=c.sent(),i=r.value,o=r.done,o?[4,Zn(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,Zn(i)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function su(t){return Re(t==null?void 0:t.getReader)}function Vt(t){if(t instanceof ze)return t;if(t!=null){if(Zl(t))return uh(t);if(Ea(t))return fh(t);if(Ql(t))return dh(t);if(eu(t))return ou(t);if(ru(t))return hh(t);if(su(t))return ph(t)}throw tu(t)}function uh(t){return new ze(function(e){var n=t[ka]();if(Re(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function fh(t){return new ze(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function dh(t){return new ze(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Gl)})}function hh(t){return new ze(function(e){var n,r;try{for(var i=rr(t),o=i.next();!o.done;o=i.next()){var c=o.value;if(e.next(c),e.closed)return}}catch(l){n={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function ou(t){return new ze(function(e){yh(t,e).catch(function(n){return e.error(n)})})}function ph(t){return ou(iu(t))}function yh(t,e){var n,r,i,o;return $d(this,void 0,void 0,function(){var c,l;return Hl(this,function(f){switch(f.label){case 0:f.trys.push([0,5,6,11]),n=Vd(t),f.label=1;case 1:return[4,n.next()];case 2:if(r=f.sent(),!!r.done)return[3,4];if(c=r.value,e.next(c),e.closed)return[2];f.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=f.sent(),i={error:l},[3,11];case 6:return f.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:f.sent(),f.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function gn(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var o=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(o),!i)return o}function au(t,e){return e===void 0&&(e=0),xt(function(n,r){n.subscribe(St(r,function(i){return gn(r,t,function(){return r.next(i)},e)},function(){return gn(r,t,function(){return r.complete()},e)},function(i){return gn(r,t,function(){return r.error(i)},e)}))})}function cu(t,e){return e===void 0&&(e=0),xt(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function gh(t,e){return Vt(t).pipe(cu(e),au(e))}function mh(t,e){return Vt(t).pipe(cu(e),au(e))}function vh(t,e){return new ze(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function bh(t,e){return new ze(function(n){var r;return gn(n,e,function(){r=t[nu](),gn(n,e,function(){var i,o,c;try{i=r.next(),o=i.value,c=i.done}catch(l){n.error(l);return}c?n.complete():n.next(o)},0,!0)}),function(){return Re(r==null?void 0:r.return)&&r.return()}})}function lu(t,e){if(!t)throw new Error("Iterable cannot be null");return new ze(function(n){gn(n,e,function(){var r=t[Symbol.asyncIterator]();gn(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function wh(t,e){return lu(iu(t),e)}function _h(t,e){if(t!=null){if(Zl(t))return gh(t,e);if(Ea(t))return vh(t,e);if(Ql(t))return mh(t,e);if(eu(t))return lu(t,e);if(ru(t))return bh(t,e);if(su(t))return wh(t,e)}throw tu(t)}function _t(t,e){return e?_h(t,e):Vt(t)}function Xt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ai(t);return _t(t,n)}function jc(t,e){var n=Re(t)?t:function(){return t},r=function(i){return i.error(n())};return new ze(r)}var kh=wa(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function Un(t,e){return new Promise(function(n,r){var i=new sr({next:function(o){n(o),i.unsubscribe()},error:r,complete:function(){r(new kh)}});t.subscribe(i)})}function Sh(t){return t instanceof Date&&!isNaN(t)}function bt(t,e){return xt(function(n,r){var i=0;n.subscribe(St(r,function(o){r.next(t.call(e,o,i++))}))})}var xh=Array.isArray;function Eh(t,e){return xh(e)?t.apply(void 0,ir([],Ln(e))):t(e)}function uu(t){return bt(function(e){return Eh(t,e)})}var Ch=Array.isArray,Ih=Object.getPrototypeOf,Oh=Object.prototype,Ah=Object.keys;function Dh(t){if(t.length===1){var e=t[0];if(Ch(e))return{args:e,keys:null};if(Th(e)){var n=Ah(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function Th(t){return t&&typeof t=="object"&&Ih(t)===Oh}function Rh(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function Xr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ai(t),r=ah(t),i=Dh(t),o=i.args,c=i.keys;if(o.length===0)return _t([],n);var l=new ze(Ph(o,n,c?function(f){return Rh(c,f)}:hr));return r?l.pipe(uu(r)):l}function Ph(t,e,n){return n===void 0&&(n=hr),function(r){Lc(e,function(){for(var i=t.length,o=new Array(i),c=i,l=i,f=function(d){Lc(e,function(){var g=_t(t[d],e),m=!1;g.subscribe(St(r,function(b){o[d]=b,m||(m=!0,l--),l||r.next(n(o.slice()))},function(){--c||r.complete()}))},r)},h=0;h<i;h++)f(h)},r)}}function Lc(t,e,n){t?gn(n,t,e):e()}function Uh(t,e,n,r,i,o,c,l){var f=[],h=0,d=0,g=!1,m=function(){g&&!f.length&&!h&&e.complete()},b=function(C){return h<r?k(C):f.push(C)},k=function(C){h++;var j=!1;Vt(n(C,d++)).subscribe(St(e,function(F){e.next(F)},function(){j=!0},void 0,function(){if(j)try{h--;for(var F=function(){var K=f.shift();c||k(K)};f.length&&h<r;)F();m()}catch(K){e.error(K)}}))};return t.subscribe(St(e,b,function(){g=!0,m()})),function(){}}function ci(t,e,n){return n===void 0&&(n=1/0),Re(e)?ci(function(r,i){return bt(function(o,c){return e(r,o,i,c)})(Vt(t(r,i)))},n):(typeof e=="number"&&(n=e),xt(function(r,i){return Uh(r,i,t,n)}))}function fu(t){return t===void 0&&(t=1/0),ci(hr,t)}function jh(){return fu(1)}function Nc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return jh()(_t(t,ai(t)))}var Lh=["addListener","removeListener"],Nh=["addEventListener","removeEventListener"],Mh=["on","off"];function Kt(t,e,n,r){if(Re(n)&&(r=n,n=void 0),r)return Kt(t,e,n).pipe(uu(r));var i=Ln(Fh(t)?Nh.map(function(l){return function(f){return t[l](e,f,n)}}):Kh(t)?Lh.map(Mc(t,e)):Bh(t)?Mh.map(Mc(t,e)):[],2),o=i[0],c=i[1];if(!o&&Ea(t))return ci(function(l){return Kt(l,e,n)})(Vt(t));if(!o)throw new TypeError("Invalid event target");return new ze(function(l){var f=function(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];return l.next(1<h.length?h:h[0])};return o(f),function(){return c(f)}})}function Mc(t,e){return function(n){return function(r){return t[n](e,r)}}}function Kh(t){return Re(t.addListener)&&Re(t.removeListener)}function Bh(t){return Re(t.on)&&Re(t.off)}function Fh(t){return Re(t.addEventListener)&&Re(t.removeEventListener)}function du(t,e,n){t===void 0&&(t=0),n===void 0&&(n=oh);var r=-1;return e!=null&&(Xl(e)?n=e:r=e),new ze(function(i){var o=Sh(t)?+t-n.now():t;o<0&&(o=0);var c=0;return n.schedule(function(){i.closed||(i.next(c++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function Es(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ai(t),r=ch(t,1/0),i=t;return i.length?i.length===1?Vt(i[0]):fu(r)(_t(i,n)):Jl}function Ct(t,e){return xt(function(n,r){var i=0;n.subscribe(St(r,function(o){return t.call(e,o,i++)&&r.next(o)}))})}function Yo(t){return xt(function(e,n){var r=null,i=!1,o;r=e.subscribe(St(n,void 0,void 0,function(c){o=Vt(t(c,Yo(t)(e))),r?(r.unsubscribe(),r=null,o.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(n))})}function Kc(t,e){return e===void 0&&(e=Sa),xt(function(n,r){var i=null,o=null,c=null,l=function(){if(i){i.unsubscribe(),i=null;var h=o;o=null,r.next(h)}};function f(){var h=c+t,d=e.now();if(d<h){i=this.schedule(void 0,h-d),r.add(i);return}l()}n.subscribe(St(r,function(h){o=h,c=e.now(),i||(i=e.schedule(f,t),r.add(i))},function(){l(),r.complete()},void 0,function(){o=i=null}))})}function Xn(t){return t<=0?function(){return Jl}:xt(function(e,n){var r=0;e.subscribe(St(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function $h(t){return bt(function(){return t})}function qh(t,e){return ci(function(n,r){return t(n,r).pipe(Xn(1),$h(n))})}function hu(t,e){e===void 0&&(e=Sa);var n=du(t,e);return qh(function(){return n})}function pu(t,e){return e===void 0&&(e=hr),t=t??Vh,xt(function(n,r){var i,o=!0;n.subscribe(St(r,function(c){var l=e(c);(o||!t(i,l))&&(o=!1,i=l,r.next(c))}))})}function Vh(t,e){return t===e}function Wh(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new Nn}:e,r=t.resetOnError,i=r===void 0?!0:r,o=t.resetOnComplete,c=o===void 0?!0:o,l=t.resetOnRefCountZero,f=l===void 0?!0:l;return function(h){var d,g,m,b=0,k=!1,C=!1,j=function(){g==null||g.unsubscribe(),g=void 0},F=function(){j(),d=m=void 0,k=C=!1},K=function(){var N=d;F(),N==null||N.unsubscribe()};return xt(function(N,G){b++,!C&&!k&&j();var re=m=m??n();G.add(function(){b--,b===0&&!C&&!k&&(g=xo(K,f))}),re.subscribe(G),!d&&b>0&&(d=new sr({next:function(Q){return re.next(Q)},error:function(Q){C=!0,j(),g=xo(F,i,Q),re.error(Q)},complete:function(){k=!0,j(),g=xo(F,c),re.complete()}}),Vt(N).subscribe(d))})(h)}}function xo(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(e===!0){t();return}if(e!==!1){var i=new sr({next:function(){i.unsubscribe(),t()}});return e.apply(void 0,ir([],Ln(n))).subscribe(i)}}function Bc(t){return Ct(function(e,n){return t<=n})}function yu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ai(t);return xt(function(r,i){(n?Nc(t,r,n):Nc(t,r)).subscribe(i)})}function lt(t,e){return xt(function(n,r){var i=null,o=0,c=!1,l=function(){return c&&!i&&r.complete()};n.subscribe(St(r,function(f){i==null||i.unsubscribe();var h=0,d=o++;Vt(t(f,d)).subscribe(i=St(r,function(g){return r.next(e?e(f,g,d,h++):g)},function(){i=null,l()}))},function(){c=!0,l()}))})}function Go(t,e,n){var r=Re(t)||e||n?{next:t,error:e,complete:n}:t;return r?xt(function(i,o){var c;(c=r.subscribe)===null||c===void 0||c.call(r);var l=!0;i.subscribe(St(o,function(f){var h;(h=r.next)===null||h===void 0||h.call(r,f),o.next(f)},function(){var f;l=!1,(f=r.complete)===null||f===void 0||f.call(r),o.complete()},function(f){var h;l=!1,(h=r.error)===null||h===void 0||h.call(r,f),o.error(f)},function(){var f,h;l&&((f=r.unsubscribe)===null||f===void 0||f.call(r)),(h=r.finalize)===null||h===void 0||h.call(r)}))}):hr}const Zt=Math.floor,Zi=Math.abs,gu=(t,e)=>t<e?t:e,pr=(t,e)=>t>e?t:e,mu=t=>t!==0?t<0:1/t<0,Fc=1,$c=2,Eo=4,Co=8,Qr=32,Qt=64,kt=128,Cs=31,Jo=63,jn=127,Hh=2147483647,vu=Number.MAX_SAFE_INTEGER,zh=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&Zt(t)===t),Mn=()=>new Set,Io=t=>t[t.length-1],Yh=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},wn=Array.from,Gh=Array.isArray,Jh=t=>t.toLowerCase(),Xh=/^\s*/g,Qh=t=>t.replace(Xh,""),Zh=/([A-Z])/g,qc=(t,e)=>Qh(t.replace(Zh,n=>`${e}${Jh(n)}`)),ep=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},Zr=typeof TextEncoder<"u"?new TextEncoder:null,tp=t=>Zr.encode(t),np=Zr?tp:ep;let $r=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});$r&&$r.decode(new Uint8Array).length===1&&($r=null);class yr{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const gr=()=>new yr,rp=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},wt=t=>{const e=new Uint8Array(rp(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(new Uint8Array(t.cbuf.buffer,0,t.cpos),n),e},ip=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(new Uint8Array(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(pr(n,e)*2),t.cpos=0)},Ze=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},Xo=Ze,ye=(t,e)=>{for(;e>jn;)Ze(t,kt|jn&e),e=Zt(e/128);Ze(t,jn&e)},Ca=(t,e)=>{const n=mu(e);for(n&&(e=-e),Ze(t,(e>Jo?kt:0)|(n?Qt:0)|Jo&e),e=Zt(e/64);e>0;)Ze(t,(e>jn?kt:0)|jn&e),e=Zt(e/128)},Qo=new Uint8Array(3e4),sp=Qo.length/3,op=(t,e)=>{if(e.length<sp){const n=Zr.encodeInto(e,Qo).written||0;ye(t,n);for(let r=0;r<n;r++)Ze(t,Qo[r])}else tt(t,np(e))},ap=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;ye(t,r);for(let i=0;i<r;i++)Ze(t,n.codePointAt(i))},It=Zr&&Zr.encodeInto?op:ap,cp=(t,e)=>li(t,wt(e)),li=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=gu(n-r,e.length),o=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,o>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(pr(n*2,o)),t.cbuf.set(e.subarray(i)),t.cpos=o)},tt=(t,e)=>{ye(t,e.byteLength),li(t,e)},Is=(t,e)=>{ip(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},lp=(t,e)=>Is(t,4).setFloat32(0,e,!1),up=(t,e)=>Is(t,8).setFloat64(0,e,!1),fp=(t,e)=>Is(t,8).setBigInt64(0,e,!1),Vc=(t,e)=>Is(t,8).setBigUint64(0,e,!1),Wc=new DataView(new ArrayBuffer(4)),dp=t=>(Wc.setFloat32(0,t),Wc.getFloat32(0)===t),mn=(t,e)=>{switch(typeof e){case"string":Ze(t,119),It(t,e);break;case"number":zh(e)&&Zi(e)<=Hh?(Ze(t,125),Ca(t,e)):dp(e)?(Ze(t,124),lp(t,e)):(Ze(t,123),up(t,e));break;case"bigint":Ze(t,122),fp(t,e);break;case"object":if(e===null)Ze(t,126);else if(Gh(e)){Ze(t,117),ye(t,e.length);for(let n=0;n<e.length;n++)mn(t,e[n])}else if(e instanceof Uint8Array)Ze(t,116),tt(t,e);else{Ze(t,118);const n=Object.keys(e);ye(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];It(t,i),mn(t,e[i])}}break;case"boolean":Ze(t,e?120:121);break;default:Ze(t,127)}};class Hc extends yr{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ye(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const zc=t=>{t.count>0&&(Ca(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ye(t.encoder,t.count-2))};class es{constructor(){this.encoder=new yr,this.s=0,this.count=0}write(e){this.s===e?this.count++:(zc(this),this.count=1,this.s=e)}toUint8Array(){return zc(this),wt(this.encoder)}}const Yc=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);Ca(t.encoder,e),t.count>1&&ye(t.encoder,t.count-2)}};class Oo{constructor(){this.encoder=new yr,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(Yc(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return Yc(this),wt(this.encoder)}}class hp{constructor(){this.sarr=[],this.s="",this.lensE=new es}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new yr;return this.sarr.push(this.s),this.s="",It(e,this.sarr.join("")),li(e,this.lensE.toUint8Array()),wt(e)}}const _n=t=>new Error(t),Bt=()=>{throw _n("Method unimplemented")},Ft=()=>{throw _n("Unexpected case")},bu=_n("Unexpected end of array"),wu=_n("Integer out of Range");class mr{constructor(e){this.arr=e,this.pos=0}}const ui=t=>new mr(t),_u=t=>t.pos!==t.arr.length,pp=(t,e)=>{const n=new Uint8Array(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},nt=t=>pp(t,Ue(t)),or=t=>t.arr[t.pos++],Ue=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const i=t.arr[t.pos++];if(e=e+(i&jn)*n,n*=128,i<kt)return e;if(e>vu)throw wu}throw bu},Ia=t=>{let e=t.arr[t.pos++],n=e&Jo,r=64;const i=(e&Qt)>0?-1:1;if(!(e&kt))return i*n;const o=t.arr.length;for(;t.pos<o;){if(e=t.arr[t.pos++],n=n+(e&jn)*r,r*=128,e<kt)return i*n;if(n>vu)throw wu}throw bu},yp=t=>{let e=Ue(t);if(e===0)return"";{let n=String.fromCodePoint(or(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(or(t));else for(;e>0;){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},gp=t=>$r.decode(nt(t)),Ot=$r?gp:yp,Os=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},mp=t=>Os(t,4).getFloat32(0,!1),vp=t=>Os(t,8).getFloat64(0,!1),bp=t=>Os(t,8).getBigInt64(0,!1),Gc=t=>Os(t,8).getBigUint64(0,!1),wp=[t=>{},t=>null,Ia,mp,vp,bp,t=>!1,t=>!0,Ot,t=>{const e=Ue(t),n={};for(let r=0;r<e;r++){const i=Ot(t);n[i]=vn(t)}return n},t=>{const e=Ue(t),n=[];for(let r=0;r<e;r++)n.push(vn(t));return n},nt],vn=t=>wp[127-or(t)](t);class Jc extends mr{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),_u(this)?this.count=Ue(this)+1:this.count=-1),this.count--,this.s}}class ts extends mr{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Ia(this);const e=mu(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ue(this)+2)}return this.count--,this.s}}class Ao extends mr{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Ia(this),n=e&1;this.diff=Zt(e/2),this.count=1,n&&(this.count=Ue(this)+2)}return this.s+=this.diff,this.count--,this.s}}class _p{constructor(e){this.decoder=new ts(e),this.str=Ot(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const pt=()=>new Map,Zo=t=>{const e=pt();return t.forEach((n,r)=>{e.set(r,n)}),e},tn=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},kp=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},Sp=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1};class xp{constructor(){this._observers=pt()}on(e,n){return tn(this._observers,e,Mn).add(n),n}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return wn((this._observers.get(e)||pt()).values()).forEach(r=>r(...n))}destroy(){this._observers=pt()}}class Ep{constructor(){this._observers=pt()}on(e,n){tn(this._observers,e,Mn).add(n)}once(e,n){const r=(...i)=>{this.off(e,r),n(...i)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return wn((this._observers.get(e)||pt()).values()).forEach(r=>r(...n))}destroy(){this._observers=pt()}}const Cp=crypto.getRandomValues.bind(crypto),ku=()=>Cp(new Uint32Array(1))[0],Ip="10000000-1000-4000-8000"+-1e11,Op=()=>Ip.replace(/[018]/g,t=>(t^ku()&15>>t/4).toString(16)),cs=Date.now,Xc=t=>new Promise(t);Promise.all.bind(Promise);const Qc=t=>t===void 0?null:t;class Ap{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let Su=new Ap,Dp=!0;try{typeof localStorage<"u"&&localStorage&&(Su=localStorage,Dp=!1)}catch{}const Tp=Su,Rp=Object.assign,xu=Object.keys,Pp=(t,e)=>{for(const n in t)e(t[n],n)},Zc=t=>xu(t).length,el=t=>xu(t).length,Up=t=>{for(const e in t)return!1;return!0},jp=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},Eu=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Lp=(t,e)=>t===e||el(t)===el(e)&&jp(t,(n,r)=>(n!==void 0||Eu(e,r))&&e[r]===n),Np=Object.freeze,Cu=t=>{for(const e in t){const n=t[e];(typeof n=="object"||typeof n=="function")&&Cu(t[e])}return Np(t)},Oa=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Oa(t,e,n+1)}},Mp=(t,e)=>t===e,qr=(t,e)=>{if(t==null||e==null)return Mp(t,e);if(t.constructor!==e.constructor)return!1;if(t===e)return!0;switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:{if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break}case Set:{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break}case Map:{if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!qr(t.get(n),e.get(n)))return!1;break}case Object:if(Zc(t)!==Zc(e))return!1;for(const n in t)if(!Eu(t,n)||!qr(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!qr(t[n],e[n]))return!1;break;default:return!1}return!0},Kp=(t,e)=>e.includes(t);var Iu={};const ei=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]";let Lt;const Bp=()=>{if(Lt===void 0)if(ei){Lt=pt();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Lt.set(e,""),e=r):e!==null&&(Lt.set(e,r),e=null)}e!==null&&Lt.set(e,"")}else typeof location=="object"?(Lt=pt(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Lt.set(`--${qc(e,"-")}`,n),Lt.set(`-${qc(e,"-")}`,n)}})):Lt=pt();return Lt},ea=t=>Bp().has(t),ls=t=>Qc(ei?Iu[t.toUpperCase().replaceAll("-","_")]:Tp.getItem(t)),Ou=t=>ea("--"+t)||ls(t)!==null;Ou("production");const Fp=ei&&Kp(Iu.FORCE_COLOR,["true","1","2"]),$p=Fp||!ea("--no-colors")&&!Ou("no-color")&&(!ei||process.stdout.isTTY)&&(!ei||ea("--color")||ls("COLORTERM")!==null||(ls("TERM")||"").includes("color"));class qp{constructor(e,n){this.left=e,this.right=n}}const zt=(t,e)=>new qp(t,e);typeof DOMParser<"u"&&new DOMParser;const Vp=t=>kp(t,(e,n)=>`${n}:${e};`).join(""),nn=Symbol,Au=nn(),Du=nn(),Wp=nn(),Hp=nn(),zp=nn(),Tu=nn(),Yp=nn(),Aa=nn(),Gp=nn(),Jp=t=>{var i;t.length===1&&((i=t[0])==null?void 0:i.constructor)===Function&&(t=t[0]());const e=[],n=[];let r=0;for(;r<t.length;r++){const o=t[r];if(o===void 0)break;if(o.constructor===String||o.constructor===Number)e.push(o);else if(o.constructor===Object)break}for(r>0&&n.push(e.join(""));r<t.length;r++){const o=t[r];o instanceof Symbol||n.push(o)}return n},Xp={[Au]:zt("font-weight","bold"),[Du]:zt("font-weight","normal"),[Wp]:zt("color","blue"),[zp]:zt("color","green"),[Hp]:zt("color","grey"),[Tu]:zt("color","red"),[Yp]:zt("color","purple"),[Aa]:zt("color","orange"),[Gp]:zt("color","black")},Qp=t=>{var c;t.length===1&&((c=t[0])==null?void 0:c.constructor)===Function&&(t=t[0]());const e=[],n=[],r=pt();let i=[],o=0;for(;o<t.length;o++){const l=t[o],f=Xp[l];if(f!==void 0)r.set(f.left,f.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){const h=Vp(r);o>0||h.length>0?(e.push("%c"+l),n.push(h)):e.push(l)}else break}}for(o>0&&(i=n,i.unshift(e.join("")));o<t.length;o++){const l=t[o];l instanceof Symbol||i.push(l)}return i},Ru=$p?Qp:Jp,Zp=(...t)=>{console.log(...Ru(t)),Pu.forEach(e=>e.print(t))},ey=(...t)=>{console.warn(...Ru(t)),t.unshift(Aa),Pu.forEach(e=>e.print(t))},Pu=Mn(),Uu=t=>({[Symbol.iterator](){return this},next:t}),ty=(t,e)=>Uu(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),Do=(t,e)=>Uu(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class ju{constructor(e,n){this.clock=e,this.len=n}}class As{constructor(){this.clients=new Map}}const Lu=(t,e,n)=>e.clients.forEach((r,i)=>{const o=t.doc.store.clients.get(i);if(o!=null){const c=o[o.length-1],l=c.id.clock+c.length;for(let f=0,h=r[f];f<r.length&&h.clock<l;h=r[++f])Wu(t,o,h.clock,h.len,n)}}),ny=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const i=Zt((n+r)/2),o=t[i],c=o.clock;if(c<=e){if(e<c+o.len)return i;n=i+1}else r=i-1}return null},Nu=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&ny(n,e.clock)!==null},Da=t=>{t.clients.forEach(e=>{e.sort((i,o)=>i.clock-o.clock);let n,r;for(n=1,r=1;n<e.length;n++){const i=e[r-1],o=e[n];i.clock+i.len>=o.clock?i.len=pr(i.len,o.clock+o.len-i.clock):(r<n&&(e[r]=o),r++)}e.length=r})},ry=t=>{const e=new As;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,i)=>{if(!e.clients.has(i)){const o=r.slice();for(let c=n+1;c<t.length;c++)Yh(o,t[c].clients.get(i)||[]);e.clients.set(i,o)}});return Da(e),e},us=(t,e,n,r)=>{tn(t.clients,e,()=>[]).push(new ju(n,r))},Ta=(t,e)=>{ye(t.restEncoder,e.clients.size),wn(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),ye(t.restEncoder,n);const i=r.length;ye(t.restEncoder,i);for(let o=0;o<i;o++){const c=r[o];t.writeDsClock(c.clock),t.writeDsLen(c.len)}})},iy=t=>{const e=new As,n=Ue(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const i=Ue(t.restDecoder),o=Ue(t.restDecoder);if(o>0){const c=tn(e.clients,i,()=>[]);for(let l=0;l<o;l++)c.push(new ju(t.readDsClock(),t.readDsLen()))}}return e},tl=(t,e,n)=>{const r=new As,i=Ue(t.restDecoder);for(let o=0;o<i;o++){t.resetDsCurVal();const c=Ue(t.restDecoder),l=Ue(t.restDecoder),f=n.clients.get(c)||[],h=et(n,c);for(let d=0;d<l;d++){const g=t.readDsClock(),m=g+t.readDsLen();if(g<h){h<m&&us(r,c,h,m-h);let b=$t(f,g),k=f[b];for(!k.deleted&&k.id.clock<g&&(f.splice(b+1,0,ms(e,k,g-k.id.clock)),b++);b<f.length&&(k=f[b++],k.id.clock<m);)k.deleted||(m<k.id.clock+k.length&&f.splice(b,0,ms(e,k,m-k.id.clock)),k.delete(e))}else us(r,c,g,m-g)}}if(r.clients.size>0){const o=new Ds;return ye(o.restEncoder,0),Ta(o,r),o.toUint8Array()}return null},Mu=ku;class vr extends xp{constructor({guid:e=Op(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:o=null,autoLoad:c=!1,shouldLoad:l=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Mu(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new qu,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=c,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Xc(h=>{this.on("load",()=>{this.isLoaded=!0,h(this)})});const f=()=>Xc(h=>{const d=g=>{(g===void 0||g===!0)&&(this.off("sync",d),h())};this.on("sync",d)});this.on("sync",h=>{h===!1&&this.isSynced&&(this.whenSynced=f()),this.isSynced=h===void 0||h===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=f()}load(){const e=this._item;e!==null&&!this.shouldLoad&&je(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(wn(this.subdocs).map(e=>e.guid))}transact(e,n=null){return je(this,e,n)}get(e,n=it){const r=tn(this.share,e,()=>{const o=new n;return o._integrate(this,null),o}),i=r.constructor;if(n!==it&&i!==n)if(i===it){const o=new n;o._map=r._map,r._map.forEach(c=>{for(;c!==null;c=c.left)c.parent=o}),o._start=r._start;for(let c=o._start;c!==null;c=c.right)c.parent=o;return o._length=r._length,this.share.set(e,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,tr)}getText(e=""){return this.get(e,cr)}getMap(e=""){return this.get(e,ar)}getXmlElement(e=""){return this.get(e,lr)}getXmlFragment(e=""){return this.get(e,Kn)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){this.isDestroyed=!0,wn(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new vr({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,je(e.parent.doc,r=>{const i=n.doc;e.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class sy{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ue(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ue(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class ti extends sy{constructor(e){super(e),this.keys=[],Ue(e),this.keyClockDecoder=new Ao(nt(e)),this.clientDecoder=new ts(nt(e)),this.leftClockDecoder=new Ao(nt(e)),this.rightClockDecoder=new Ao(nt(e)),this.infoDecoder=new Jc(nt(e),or),this.stringDecoder=new _p(nt(e)),this.parentInfoDecoder=new Jc(nt(e),or),this.typeRefDecoder=new ts(nt(e)),this.lenDecoder=new ts(nt(e))}readLeftID(){return new er(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new er(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return vn(this.restDecoder)}readBuf(){return nt(this.restDecoder)}readJSON(){return vn(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class oy{constructor(){this.restEncoder=gr()}toUint8Array(){return wt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ye(this.restEncoder,e)}writeDsLen(e){ye(this.restEncoder,e)}}class ay extends oy{writeLeftID(e){ye(this.restEncoder,e.client),ye(this.restEncoder,e.clock)}writeRightID(e){ye(this.restEncoder,e.client),ye(this.restEncoder,e.clock)}writeClient(e){ye(this.restEncoder,e)}writeInfo(e){Xo(this.restEncoder,e)}writeString(e){It(this.restEncoder,e)}writeParentInfo(e){ye(this.restEncoder,e?1:0)}writeTypeRef(e){ye(this.restEncoder,e)}writeLen(e){ye(this.restEncoder,e)}writeAny(e){mn(this.restEncoder,e)}writeBuf(e){tt(this.restEncoder,e)}writeJSON(e){It(this.restEncoder,JSON.stringify(e))}writeKey(e){It(this.restEncoder,e)}}class Ku{constructor(){this.restEncoder=gr(),this.dsCurrVal=0}toUint8Array(){return wt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,ye(this.restEncoder,n)}writeDsLen(e){e===0&&Ft(),ye(this.restEncoder,e-1),this.dsCurrVal+=e}}class Ds extends Ku{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Oo,this.clientEncoder=new es,this.leftClockEncoder=new Oo,this.rightClockEncoder=new Oo,this.infoEncoder=new Hc(Xo),this.stringEncoder=new hp,this.parentInfoEncoder=new Hc(Xo),this.typeRefEncoder=new es,this.lenEncoder=new es}toUint8Array(){const e=gr();return ye(e,0),tt(e,this.keyClockEncoder.toUint8Array()),tt(e,this.clientEncoder.toUint8Array()),tt(e,this.leftClockEncoder.toUint8Array()),tt(e,this.rightClockEncoder.toUint8Array()),tt(e,wt(this.infoEncoder)),tt(e,this.stringEncoder.toUint8Array()),tt(e,wt(this.parentInfoEncoder)),tt(e,this.typeRefEncoder.toUint8Array()),tt(e,this.lenEncoder.toUint8Array()),li(e,wt(this.restEncoder)),wt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){mn(this.restEncoder,e)}writeBuf(e){tt(this.restEncoder,e)}writeJSON(e){mn(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const cy=(t,e,n,r)=>{r=pr(r,e[0].id.clock);const i=$t(e,r);ye(t.restEncoder,e.length-i),t.writeClient(n),ye(t.restEncoder,r);const o=e[i];o.write(t,r-o.id.clock);for(let c=i+1;c<e.length;c++)e[c].write(t,0)},Bu=(t,e,n)=>{const r=new Map;n.forEach((i,o)=>{et(e,o)>i&&r.set(o,i)}),Ra(e).forEach((i,o)=>{n.has(o)||r.set(o,0)}),ye(t.restEncoder,r.size),wn(r.entries()).sort((i,o)=>o[0]-i[0]).forEach(([i,o])=>{cy(t,e.clients.get(i),i,o)})},ly=(t,e)=>{const n=pt(),r=Ue(t.restDecoder);for(let i=0;i<r;i++){const o=Ue(t.restDecoder),c=new Array(o),l=t.readClient();let f=Ue(t.restDecoder);n.set(l,{i:0,refs:c});for(let h=0;h<o;h++){const d=t.readInfo();switch(Cs&d){case 0:{const g=t.readLen();c[h]=new At(Ce(l,f),g),f+=g;break}case 10:{const g=Ue(t.restDecoder);c[h]=new Dt(Ce(l,f),g),f+=g;break}default:{const g=(d&(Qt|kt))===0,m=new He(Ce(l,f),null,(d&kt)===kt?t.readLeftID():null,null,(d&Qt)===Qt?t.readRightID():null,g?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,g&&(d&Qr)===Qr?t.readString():null,hf(t,d));c[h]=m,f+=m.length}}}}return n},uy=(t,e,n)=>{const r=[];let i=wn(n.keys()).sort((b,k)=>b-k);if(i.length===0)return null;const o=()=>{if(i.length===0)return null;let b=n.get(i[i.length-1]);for(;b.refs.length===b.i;)if(i.pop(),i.length>0)b=n.get(i[i.length-1]);else return null;return b};let c=o();if(c===null)return null;const l=new qu,f=new Map,h=(b,k)=>{const C=f.get(b);(C==null||C>k)&&f.set(b,k)};let d=c.refs[c.i++];const g=new Map,m=()=>{for(const b of r){const k=b.id.client,C=n.get(k);C?(C.i--,l.clients.set(k,C.refs.slice(C.i)),n.delete(k),C.i=0,C.refs=[]):l.clients.set(k,[b]),i=i.filter(j=>j!==k)}r.length=0};for(;;){if(d.constructor!==Dt){const k=tn(g,d.id.client,()=>et(e,d.id.client))-d.id.clock;if(k<0)r.push(d),h(d.id.client,d.id.clock-1),m();else{const C=d.getMissing(t,e);if(C!==null){r.push(d);const j=n.get(C)||{refs:[],i:0};if(j.refs.length===j.i)h(C,et(e,C)),m();else{d=j.refs[j.i++];continue}}else(k===0||k<d.length)&&(d.integrate(t,k),g.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(c!==null&&c.i<c.refs.length)d=c.refs[c.i++];else{if(c=o(),c===null)break;d=c.refs[c.i++]}}if(l.clients.size>0){const b=new Ds;return Bu(b,l,new Map),ye(b.restEncoder,0),{missing:f,update:b.toUint8Array()}}return null},fy=(t,e)=>Bu(t,e.doc.store,e.beforeState),dy=(t,e,n,r=new ti(t))=>je(e,i=>{i.local=!1;let o=!1;const c=i.doc,l=c.store,f=ly(r,c),h=uy(i,l,f),d=l.pendingStructs;if(d){for(const[m,b]of d.missing)if(b<et(l,m)){o=!0;break}if(h){for(const[m,b]of h.missing){const k=d.missing.get(m);(k==null||k>b)&&d.missing.set(m,b)}d.update=fs([d.update,h.update])}}else l.pendingStructs=h;const g=tl(r,i,l);if(l.pendingDs){const m=new ti(ui(l.pendingDs));Ue(m.restDecoder);const b=tl(m,i,l);g&&b?l.pendingDs=fs([g,b]):l.pendingDs=g||b}else l.pendingDs=g;if(o){const m=l.pendingStructs.update;l.pendingStructs=null,Fu(i.doc,m)}},n,!1),Fu=(t,e,n,r=ti)=>{const i=ui(e);dy(i,t,n,new r(i))};class hy{constructor(){this.l=[]}}const nl=()=>new hy,rl=(t,e)=>t.l.push(e),il=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(i=>e!==i),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},$u=(t,e,n)=>Oa(t.l,[e,n]);class er{constructor(e,n){this.client=e,this.clock=n}}const $i=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,Ce=(t,e)=>new er(t,e),py=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw Ft()},Qn=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!Nu(e.ds,t.id),ta=(t,e)=>{const n=tn(t.meta,ta,Mn),r=t.doc.store;n.has(e)||(e.sv.forEach((i,o)=>{i<et(r,o)&&kn(t,Ce(o,i))}),Lu(t,e.ds,i=>{}),n.add(e))};class qu{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Ra=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const i=n[n.length-1];e.set(r,i.id.clock+i.length)}),e},et=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},Vu=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw Ft()}n.push(e)},$t=(t,e)=>{let n=0,r=t.length-1,i=t[r],o=i.id.clock;if(o===e)return r;let c=Zt(e/(o+i.length-1)*r);for(;n<=r;){if(i=t[c],o=i.id.clock,o<=e){if(e<o+i.length)return c;n=c+1}else r=c-1;c=Zt((n+r)/2)}throw Ft()},yy=(t,e)=>{const n=t.clients.get(e.client);return n[$t(n,e.clock)]},To=yy,na=(t,e,n)=>{const r=$t(e,n),i=e[r];return i.id.clock<n&&i instanceof He?(e.splice(r+1,0,ms(t,i,n-i.id.clock)),r+1):r},kn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[na(t,n,e.clock)]},sl=(t,e,n)=>{const r=e.clients.get(n.client),i=$t(r,n.clock),o=r[i];return n.clock!==o.id.clock+o.length-1&&o.constructor!==At&&r.splice(i+1,0,ms(t,o,n.clock-o.id.clock+1)),o},gy=(t,e,n)=>{const r=t.clients.get(e.id.client);r[$t(r,e.id.clock)]=n},Wu=(t,e,n,r,i)=>{if(r===0)return;const o=n+r;let c=na(t,e,n),l;do l=e[c++],o<l.id.clock+l.length&&na(t,e,o),i(l);while(c<e.length&&e[c].id.clock<o)};class my{constructor(e,n,r){this.doc=e,this.deleteSet=new As,this.beforeState=Ra(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const ol=(t,e)=>e.deleteSet.clients.size===0&&!Sp(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(Da(e.deleteSet),fy(t,e),Ta(t,e.deleteSet),!0),al=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&tn(t.changed,e,Mn).add(n)},ns=(t,e)=>{let n=t[e],r=t[e-1],i=e;for(;i>0;n=r,r=t[--i-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof He&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const o=e-i;return o&&t.splice(e+1-o,o),o},vy=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const o=e.clients.get(r);for(let c=i.length-1;c>=0;c--){const l=i[c],f=l.clock+l.len;for(let h=$t(o,l.clock),d=o[h];h<o.length&&d.id.clock<f;d=o[++h]){const g=o[h];if(l.clock+l.len<=g.id.clock)break;g instanceof He&&g.deleted&&!g.keep&&n(g)&&g.gc(e,!1)}}}},by=(t,e)=>{t.clients.forEach((n,r)=>{const i=e.clients.get(r);for(let o=n.length-1;o>=0;o--){const c=n[o],l=gu(i.length-1,1+$t(i,c.clock+c.len-1));for(let f=l,h=i[f];f>0&&h.id.clock>=c.clock;h=i[f])f-=1+ns(i,f)}})},Hu=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,o=n.deleteSet,c=n._mergeStructs;try{Da(o),n.afterState=Ra(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const l=[];n.changed.forEach((f,h)=>l.push(()=>{(h._item===null||!h._item.deleted)&&h._callObserver(n,f)})),l.push(()=>{n.changedParentTypes.forEach((f,h)=>{h._dEH.l.length>0&&(h._item===null||!h._item.deleted)&&(f=f.filter(d=>d.target._item===null||!d.target._item.deleted),f.forEach(d=>{d.currentTarget=h,d._path=null}),f.sort((d,g)=>d.path.length-g.path.length),$u(h._dEH,f,n))})}),l.push(()=>r.emit("afterTransaction",[n,r])),Oa(l,[]),n._needFormattingCleanup&&Ny(n)}finally{r.gc&&vy(o,i,r.gcFilter),by(o,i),n.afterState.forEach((d,g)=>{const m=n.beforeState.get(g)||0;if(m!==d){const b=i.clients.get(g),k=pr($t(b,m),1);for(let C=b.length-1;C>=k;)C-=1+ns(b,C)}});for(let d=c.length-1;d>=0;d--){const{client:g,clock:m}=c[d].id,b=i.clients.get(g),k=$t(b,m);k+1<b.length&&ns(b,k+1)>1||k>0&&ns(b,k)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Zp(Aa,Au,"[yjs] ",Du,Tu,"Changed the client-id because another client seems to be using it."),r.clientID=Mu()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const d=new ay;ol(d,n)&&r.emit("update",[d.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const d=new Ds;ol(d,n)&&r.emit("updateV2",[d.toUint8Array(),n.origin,r,n])}const{subdocsAdded:l,subdocsLoaded:f,subdocsRemoved:h}=n;(l.size>0||h.size>0||f.size>0)&&(l.forEach(d=>{d.clientID=r.clientID,d.collectionid==null&&(d.collectionid=r.collectionid),r.subdocs.add(d)}),h.forEach(d=>r.subdocs.delete(d)),r.emit("subdocs",[{loaded:f,added:l,removed:h},r,n]),h.forEach(d=>d.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):Hu(t,e+1)}}},je=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let o=!1,c=null;t._transaction===null&&(o=!0,t._transaction=new my(t,n,r),i.push(t._transaction),i.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{c=e(t._transaction)}finally{if(o){const l=t._transaction===i[0];t._transaction=null,l&&Hu(i,0)}}return c};function*wy(t){const e=Ue(t.restDecoder);for(let n=0;n<e;n++){const r=Ue(t.restDecoder),i=t.readClient();let o=Ue(t.restDecoder);for(let c=0;c<r;c++){const l=t.readInfo();if(l===10){const f=Ue(t.restDecoder);yield new Dt(Ce(i,o),f),o+=f}else if(Cs&l){const f=(l&(Qt|kt))===0,h=new He(Ce(i,o),null,(l&kt)===kt?t.readLeftID():null,null,(l&Qt)===Qt?t.readRightID():null,f?t.readParentInfo()?t.readString():t.readLeftID():null,f&&(l&Qr)===Qr?t.readString():null,hf(t,l));yield h,o+=h.length}else{const f=t.readLen();yield new At(Ce(i,o),f),o+=f}}}}class zu{constructor(e,n){this.gen=wy(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===Dt);return this.curr}}class _y{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const Yu=(t,e=Ku,n=ti)=>{const r=new e,i=new zu(new n(ui(t)),!1);let o=i.curr;if(o!==null){let c=0,l=o.id.client,f=o.id.clock!==0,h=f?0:o.id.clock+o.length;for(;o!==null;o=i.next())l!==o.id.client&&(h!==0&&(c++,ye(r.restEncoder,l),ye(r.restEncoder,h)),l=o.id.client,h=0,f=o.id.clock!==0),o.constructor===Dt&&(f=!0),f||(h=o.id.clock+o.length);h!==0&&(c++,ye(r.restEncoder,l),ye(r.restEncoder,h));const d=gr();return ye(d,c),cp(d,r.restEncoder),r.restEncoder=d,r.toUint8Array()}else return ye(r.restEncoder,0),r.toUint8Array()},ky=(t,e)=>{if(t.constructor===At){const{client:n,clock:r}=t.id;return new At(Ce(n,r+e),t.length-e)}else if(t.constructor===Dt){const{client:n,clock:r}=t.id;return new Dt(Ce(n,r+e),t.length-e)}else{const n=t,{client:r,clock:i}=n.id;return new He(Ce(r,i+e),null,Ce(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},fs=(t,e=ti,n=Ds)=>{if(t.length===1)return t[0];const r=t.map(d=>new e(ui(d)));let i=r.map(d=>new zu(d,!0)),o=null;const c=new n,l=new _y(c);for(;i=i.filter(m=>m.curr!==null),i.sort((m,b)=>{if(m.curr.id.client===b.curr.id.client){const k=m.curr.id.clock-b.curr.id.clock;return k===0?m.curr.constructor===b.curr.constructor?0:m.curr.constructor===Dt?1:-1:k}else return b.curr.id.client-m.curr.id.client}),i.length!==0;){const d=i[0],g=d.curr.id.client;if(o!==null){let m=d.curr,b=!1;for(;m!==null&&m.id.clock+m.length<=o.struct.id.clock+o.struct.length&&m.id.client>=o.struct.id.client;)m=d.next(),b=!0;if(m===null||m.id.client!==g||b&&m.id.clock>o.struct.id.clock+o.struct.length)continue;if(g!==o.struct.id.client)Ur(l,o.struct,o.offset),o={struct:m,offset:0},d.next();else if(o.struct.id.clock+o.struct.length<m.id.clock)if(o.struct.constructor===Dt)o.struct.length=m.id.clock+m.length-o.struct.id.clock;else{Ur(l,o.struct,o.offset);const k=m.id.clock-o.struct.id.clock-o.struct.length;o={struct:new Dt(Ce(g,o.struct.id.clock+o.struct.length),k),offset:0}}else{const k=o.struct.id.clock+o.struct.length-m.id.clock;k>0&&(o.struct.constructor===Dt?o.struct.length-=k:m=ky(m,k)),o.struct.mergeWith(m)||(Ur(l,o.struct,o.offset),o={struct:m,offset:0},d.next())}}else o={struct:d.curr,offset:0},d.next();for(let m=d.curr;m!==null&&m.id.client===g&&m.id.clock===o.struct.id.clock+o.struct.length&&m.constructor!==Dt;m=d.next())Ur(l,o.struct,o.offset),o={struct:m,offset:0}}o!==null&&(Ur(l,o.struct,o.offset),o=null),Sy(l);const f=r.map(d=>iy(d)),h=ry(f);return Ta(c,h),c.toUint8Array()},Gu=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:wt(t.encoder.restEncoder)}),t.encoder.restEncoder=gr(),t.written=0)},Ur=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&Gu(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ye(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Sy=t=>{Gu(t);const e=t.encoder.restEncoder;ye(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];ye(e,r.written),li(e,r.restEncoder)}},cl="You must not compute changes after the event-handler fired.";class Ts{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=xy(this.currentTarget,this.target))}deletes(e){return Nu(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw _n(cl);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const o=n._map.get(i);let c,l;if(this.adds(o)){let f=o.left;for(;f!==null&&this.adds(f);)f=f.left;if(this.deletes(o))if(f!==null&&this.deletes(f))c="delete",l=Io(f.content.getContent());else return;else f!==null&&this.deletes(f)?(c="update",l=Io(f.content.getContent())):(c="add",l=void 0)}else if(this.deletes(o))c="delete",l=Io(o.content.getContent());else return;e.set(i,{action:c,oldValue:l})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw _n(cl);const n=this.target,r=Mn(),i=Mn(),o=[];if(e={added:r,deleted:i,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let l=null;const f=()=>{l&&o.push(l)};for(let h=n._start;h!==null;h=h.right)h.deleted?this.deletes(h)&&!this.adds(h)&&((l===null||l.delete===void 0)&&(f(),l={delete:0}),l.delete+=h.length,i.add(h)):this.adds(h)?((l===null||l.insert===void 0)&&(f(),l={insert:[]}),l.insert=l.insert.concat(h.content.getContent()),r.add(h)):((l===null||l.retain===void 0)&&(f(),l={retain:0}),l.retain+=h.length);l!==null&&l.retain===void 0&&f()}this._changes=e}return e}}const xy=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,i=e._item.parent._start;for(;i!==e._item&&i!==null;)!i.deleted&&i.countable&&(r+=i.length),i=i.right;n.unshift(r)}e=e._item.parent}return n},ft=()=>{ey("Invalid access: Add Yjs type to a document before reading data.")},Ju=80;let Pa=0;class Ey{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Pa++}}const Cy=t=>{t.timestamp=Pa++},Xu=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Pa++},Iy=(t,e,n)=>{if(t.length>=Ju){const r=t.reduce((i,o)=>i.timestamp<o.timestamp?i:o);return Xu(r,e,n),r}else{const r=new Ey(e,n);return t.push(r),r}},Rs=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((o,c)=>Zi(e-o.index)<Zi(e-c.index)?o:c);let r=t._start,i=0;for(n!==null&&(r=n.p,i=n.index,Cy(n));r.right!==null&&i<e;){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>e;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&Zi(n.index-i)<r.parent.length/Ju?(Xu(n,r,i),n):Iy(t._searchMarker,r,i)},ni=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let o=i.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(i.index-=o.length);if(o===null||o.marker===!0){t.splice(r,1);continue}i.p=o,o.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=pr(e,i.index+n))}},Ps=(t,e,n)=>{const r=t,i=e.changedParentTypes;for(;tn(i,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;$u(r._eH,n,e)};class it{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=nl(),this._dEH=nl(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw Bt()}clone(){throw Bt()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){rl(this._eH,e)}observeDeep(e){rl(this._dEH,e)}unobserve(e){il(this._eH,e)}unobserveDeep(e){il(this._dEH,e)}toJSON(){}}const Qu=(t,e,n)=>{t.doc??ft(),e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let o=t._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){const c=o.content.getContent();if(c.length<=e)e-=c.length;else{for(let l=e;l<c.length&&r>0;l++)i.push(c[l]),r--;e=0}}o=o.right}return i},Zu=t=>{t.doc??ft();const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)e.push(r[i])}n=n.right}return e},ri=(t,e)=>{let n=0,r=t._start;for(t.doc??ft();r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let o=0;o<i.length;o++)e(i[o],n++,t)}r=r.right}},ef=(t,e)=>{const n=[];return ri(t,(r,i)=>{n.push(e(r,i,t))}),n},Oy=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},tf=(t,e)=>{t.doc??ft();const n=Rs(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},ds=(t,e,n,r)=>{let i=n;const o=t.doc,c=o.clientID,l=o.store,f=n===null?e._start:n.right;let h=[];const d=()=>{h.length>0&&(i=new He(Ce(c,et(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new Bn(h)),i.integrate(t,0),h=[])};r.forEach(g=>{if(g===null)h.push(g);else switch(g.constructor){case Number:case Object:case Boolean:case Array:case String:h.push(g);break;default:switch(d(),g.constructor){case Uint8Array:case ArrayBuffer:i=new He(Ce(c,et(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new fi(new Uint8Array(g))),i.integrate(t,0);break;case vr:i=new He(Ce(c,et(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new di(g)),i.integrate(t,0);break;default:if(g instanceof it)i=new He(Ce(c,et(l,c)),i,i&&i.lastId,f,f&&f.id,e,null,new rn(g)),i.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},nf=()=>_n("Length exceeded!"),rf=(t,e,n,r)=>{if(n>e._length)throw nf();if(n===0)return e._searchMarker&&ni(e._searchMarker,n,r.length),ds(t,e,null,r);const i=n,o=Rs(e,n);let c=e._start;for(o!==null&&(c=o.p,n-=o.index,n===0&&(c=c.prev,n+=c&&c.countable&&!c.deleted?c.length:0));c!==null;c=c.right)if(!c.deleted&&c.countable){if(n<=c.length){n<c.length&&kn(t,Ce(c.id.client,c.id.clock+n));break}n-=c.length}return e._searchMarker&&ni(e._searchMarker,i,r.length),ds(t,e,c,r)},Ay=(t,e,n)=>{let i=(e._searchMarker||[]).reduce((o,c)=>c.index>o.index?c:o,{index:0,p:e._start}).p;if(i)for(;i.right;)i=i.right;return ds(t,e,i,n)},sf=(t,e,n,r)=>{if(r===0)return;const i=n,o=r,c=Rs(e,n);let l=e._start;for(c!==null&&(l=c.p,n-=c.index);l!==null&&n>0;l=l.right)!l.deleted&&l.countable&&(n<l.length&&kn(t,Ce(l.id.client,l.id.clock+n)),n-=l.length);for(;r>0&&l!==null;)l.deleted||(r<l.length&&kn(t,Ce(l.id.client,l.id.clock+r)),l.delete(t),r-=l.length),l=l.right;if(r>0)throw nf();e._searchMarker&&ni(e._searchMarker,i,-o+r)},hs=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Ua=(t,e,n,r)=>{const i=e._map.get(n)||null,o=t.doc,c=o.clientID;let l;if(r==null)l=new Bn([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:l=new Bn([r]);break;case Uint8Array:l=new fi(r);break;case vr:l=new di(r);break;default:if(r instanceof it)l=new rn(r);else throw new Error("Unexpected content type")}new He(Ce(c,et(o.store,c)),i,i&&i.lastId,null,null,e,n,l).integrate(t,0)},ja=(t,e)=>{t.doc??ft();const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},of=t=>{const e={};return t.doc??ft(),t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},af=(t,e)=>{t.doc??ft();const n=t._map.get(e);return n!==void 0&&!n.deleted},Dy=(t,e)=>{const n={};return t._map.forEach((r,i)=>{let o=r;for(;o!==null&&(!e.sv.has(o.id.client)||o.id.clock>=(e.sv.get(o.id.client)||0));)o=o.left;o!==null&&Qn(o,e)&&(n[i]=o.content.getContent()[o.length-1])}),n},qi=t=>(t.doc??ft(),ty(t._map.entries(),e=>!e[1].deleted));class Ty extends Ts{}class tr extends it{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new tr;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new tr}clone(){const e=new tr;return e.insert(0,this.toArray().map(n=>n instanceof it?n.clone():n)),e}get length(){return this.doc??ft(),this._length}_callObserver(e,n){super._callObserver(e,n),Ps(this,e,new Ty(this,e))}insert(e,n){this.doc!==null?je(this.doc,r=>{rf(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?je(this.doc,n=>{Ay(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?je(this.doc,r=>{sf(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return tf(this,e)}toArray(){return Zu(this)}slice(e=0,n=this.length){return Qu(this,e,n)}toJSON(){return this.map(e=>e instanceof it?e.toJSON():e)}map(e){return ef(this,e)}forEach(e){ri(this,e)}[Symbol.iterator](){return Oy(this)}_write(e){e.writeTypeRef(ng)}}const Ry=t=>new tr;class Py extends Ts{constructor(e,n,r){super(e,n),this.keysChanged=r}}class ar extends it{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new ar}clone(){const e=new ar;return this.forEach((n,r)=>{e.set(r,n instanceof it?n.clone():n)}),e}_callObserver(e,n){Ps(this,e,new Py(this,e,n))}toJSON(){this.doc??ft();const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];e[r]=i instanceof it?i.toJSON():i}}),e}get size(){return[...qi(this)].length}keys(){return Do(qi(this),e=>e[0])}values(){return Do(qi(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Do(qi(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??ft(),this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?je(this.doc,n=>{hs(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?je(this.doc,r=>{Ua(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return ja(this,e)}has(e){return af(this,e)}clear(){this.doc!==null?je(this.doc,e=>{this.forEach(function(n,r,i){hs(e,i,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(rg)}}const Uy=t=>new ar,dn=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Lp(t,e);class ra{constructor(e,n,r,i){this.left=e,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Ft(),this.right.content.constructor){case Ye:this.right.deleted||br(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const ll=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case Ye:e.right.deleted||br(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&kn(t,Ce(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Vi=(t,e,n,r)=>{const i=new Map,o=r?Rs(e,n):null;if(o){const c=new ra(o.p.left,o.p,o.index,i);return ll(t,c,n-o.index)}else{const c=new ra(null,e._start,0,i);return ll(t,c,n)}},cf=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Ye&&dn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,o=i.clientID;r.forEach((c,l)=>{const f=n.left,h=n.right,d=new He(Ce(o,et(i.store,o)),f,f&&f.lastId,h,h&&h.id,e,null,new Ye(l,c));d.integrate(t,0),n.right=d,n.forward()})},br=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},lf=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===Ye&&dn(e[t.right.content.key]??null,t.right.content.value)))break;t.forward()}},uf=(t,e,n,r)=>{const i=t.doc,o=i.clientID,c=new Map;for(const l in r){const f=r[l],h=n.currentAttributes.get(l)??null;if(!dn(h,f)){c.set(l,h);const{left:d,right:g}=n;n.right=new He(Ce(o,et(i.store,o)),d,d&&d.lastId,g,g&&g.id,e,null,new Ye(l,f)),n.right.integrate(t,0),n.forward()}}return c},Ro=(t,e,n,r,i)=>{n.currentAttributes.forEach((m,b)=>{i[b]===void 0&&(i[b]=null)});const o=t.doc,c=o.clientID;lf(n,i);const l=uf(t,e,n,i),f=r.constructor===String?new qt(r):r instanceof it?new rn(r):new Fn(r);let{left:h,right:d,index:g}=n;e._searchMarker&&ni(e._searchMarker,n.index,f.getLength()),d=new He(Ce(c,et(o.store,c)),h,h&&h.lastId,d,d&&d.id,e,null,f),d.integrate(t,0),n.right=d,n.index=g,n.forward(),cf(t,e,n,l)},ul=(t,e,n,r,i)=>{const o=t.doc,c=o.clientID;lf(n,i);const l=uf(t,e,n,i);e:for(;n.right!==null&&(r>0||l.size>0&&(n.right.deleted||n.right.content.constructor===Ye));){if(!n.right.deleted)switch(n.right.content.constructor){case Ye:{const{key:f,value:h}=n.right.content,d=i[f];if(d!==void 0){if(dn(d,h))l.delete(f);else{if(r===0)break e;l.set(f,h)}n.right.delete(t)}else n.currentAttributes.set(f,h);break}default:r<n.right.length&&kn(t,Ce(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let f="";for(;r>0;r--)f+=`
`;n.right=new He(Ce(c,et(o.store,c)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new qt(f)),n.right.integrate(t,0),n.forward()}cf(t,e,n,l)},ff=(t,e,n,r,i)=>{let o=e;const c=pt();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===Ye){const h=o.content;c.set(h.key,h)}o=o.right}let l=0,f=!1;for(;e!==o;){if(n===e&&(f=!0),!e.deleted){const h=e.content;switch(h.constructor){case Ye:{const{key:d,value:g}=h,m=r.get(d)??null;(c.get(d)!==h||m===g)&&(e.delete(t),l++,!f&&(i.get(d)??null)===g&&m!==g&&(m===null?i.delete(d):i.set(d,m))),!f&&!e.deleted&&br(i,h);break}}}e=e.right}return l},jy=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===Ye){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},Ly=t=>{let e=0;return je(t.doc,n=>{let r=t._start,i=t._start,o=pt();const c=Zo(o);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case Ye:br(c,i.content);break;default:e+=ff(n,r,i,o,c),o=Zo(c),r=i;break}i=i.right}}),e},Ny=t=>{const e=new Set,n=t.doc;for(const[r,i]of t.afterState.entries()){const o=t.beforeState.get(r)||0;i!==o&&Wu(t,n.store.clients.get(r),o,i,c=>{!c.deleted&&c.content.constructor===Ye&&c.constructor!==At&&e.add(c.parent)})}je(n,r=>{Lu(t,t.deleteSet,i=>{if(i instanceof At||!i.parent._hasFormatting||e.has(i.parent))return;const o=i.parent;i.content.constructor===Ye?e.add(o):jy(r,i)});for(const i of e)Ly(i)})},fl=(t,e,n)=>{const r=n,i=Zo(e.currentAttributes),o=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case rn:case Fn:case qt:n<e.right.length&&kn(t,Ce(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}o&&ff(t,o,e.right,i,e.currentAttributes);const c=(e.left||e.right).parent;return c._searchMarker&&ni(c._searchMarker,e.index,-r+n),e};class My extends Ts{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];je(e,r=>{const i=new Map,o=new Map;let c=this.target._start,l=null;const f={};let h="",d=0,g=0;const m=()=>{if(l!==null){let b=null;switch(l){case"delete":g>0&&(b={delete:g}),g=0;break;case"insert":(typeof h=="object"||h.length>0)&&(b={insert:h},i.size>0&&(b.attributes={},i.forEach((k,C)=>{k!==null&&(b.attributes[C]=k)}))),h="";break;case"retain":d>0&&(b={retain:d},Up(f)||(b.attributes=Rp({},f))),d=0;break}b&&n.push(b),l=null}};for(;c!==null;){switch(c.content.constructor){case rn:case Fn:this.adds(c)?this.deletes(c)||(m(),l="insert",h=c.content.getContent()[0],m()):this.deletes(c)?(l!=="delete"&&(m(),l="delete"),g+=1):c.deleted||(l!=="retain"&&(m(),l="retain"),d+=1);break;case qt:this.adds(c)?this.deletes(c)||(l!=="insert"&&(m(),l="insert"),h+=c.content.str):this.deletes(c)?(l!=="delete"&&(m(),l="delete"),g+=c.length):c.deleted||(l!=="retain"&&(m(),l="retain"),d+=c.length);break;case Ye:{const{key:b,value:k}=c.content;if(this.adds(c)){if(!this.deletes(c)){const C=i.get(b)??null;dn(C,k)?k!==null&&c.delete(r):(l==="retain"&&m(),dn(k,o.get(b)??null)?delete f[b]:f[b]=k)}}else if(this.deletes(c)){o.set(b,k);const C=i.get(b)??null;dn(C,k)||(l==="retain"&&m(),f[b]=C)}else if(!c.deleted){o.set(b,k);const C=f[b];C!==void 0&&(dn(C,k)?C!==null&&c.delete(r):(l==="retain"&&m(),k===null?delete f[b]:f[b]=k))}c.deleted||(l==="insert"&&m(),br(i,c.content));break}}c=c.right}for(m();n.length>0;){const b=n[n.length-1];if(b.retain!==void 0&&b.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class cr extends it{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??ft(),this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new cr}clone(){const e=new cr;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new My(this,e,n);Ps(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??ft();let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===qt&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?je(this.doc,r=>{const i=new ra(null,this._start,0,new Map);for(let o=0;o<e.length;o++){const c=e[o];if(c.insert!==void 0){const l=!n&&typeof c.insert=="string"&&o===e.length-1&&i.right===null&&c.insert.slice(-1)===`
`?c.insert.slice(0,-1):c.insert;(typeof l!="string"||l.length>0)&&Ro(r,this,i,l,c.attributes||{})}else c.retain!==void 0?ul(r,this,i,c.retain,c.attributes||{}):c.delete!==void 0&&fl(r,i,c.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){this.doc??ft();const i=[],o=new Map,c=this.doc;let l="",f=this._start;function h(){if(l.length>0){const g={};let m=!1;o.forEach((k,C)=>{m=!0,g[C]=k});const b={insert:l};m&&(b.attributes=g),i.push(b),l=""}}const d=()=>{for(;f!==null;){if(Qn(f,e)||n!==void 0&&Qn(f,n))switch(f.content.constructor){case qt:{const g=o.get("ychange");e!==void 0&&!Qn(f,e)?(g===void 0||g.user!==f.id.client||g.type!=="removed")&&(h(),o.set("ychange",r?r("removed",f.id):{type:"removed"})):n!==void 0&&!Qn(f,n)?(g===void 0||g.user!==f.id.client||g.type!=="added")&&(h(),o.set("ychange",r?r("added",f.id):{type:"added"})):g!==void 0&&(h(),o.delete("ychange")),l+=f.content.str;break}case rn:case Fn:{h();const g={insert:f.content.getContent()[0]};if(o.size>0){const m={};g.attributes=m,o.forEach((b,k)=>{m[k]=b})}i.push(g);break}case Ye:Qn(f,e)&&(h(),br(o,f.content));break}f=f.right}h()};return e||n?je(c,g=>{e&&ta(g,e),n&&ta(g,n),d()},"cleanup"):d(),i}insert(e,n,r){if(n.length<=0)return;const i=this.doc;i!==null?je(i,o=>{const c=Vi(o,this,e,!r);r||(r={},c.currentAttributes.forEach((l,f)=>{r[f]=l})),Ro(o,this,c,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r){const i=this.doc;i!==null?je(i,o=>{const c=Vi(o,this,e,!r);Ro(o,this,c,n,r||{})}):this._pending.push(()=>this.insertEmbed(e,n,r||{}))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?je(r,i=>{fl(i,Vi(i,this,e,!0),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const i=this.doc;i!==null?je(i,o=>{const c=Vi(o,this,e,!1);c.right!==null&&ul(o,this,c,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?je(this.doc,n=>{hs(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?je(this.doc,r=>{Ua(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return ja(this,e)}getAttributes(){return of(this)}_write(e){e.writeTypeRef(ig)}}const Ky=t=>new cr;class Po{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??ft()}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===lr||n.constructor===Kn)&&n._start!==null)e=n._start;else for(;e!==null;){const r=e.next;if(r!==null){e=r;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Kn extends it{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Kn}clone(){const e=new Kn;return e.insert(0,this.toArray().map(n=>n instanceof it?n.clone():n)),e}get length(){return this.doc??ft(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Po(this,e)}querySelector(e){e=e.toUpperCase();const r=new Po(this,i=>i.nodeName&&i.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),wn(new Po(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Ps(this,e,new $y(this,n,e))}toString(){return ef(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const i=e.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),ri(this,o=>{i.insertBefore(o.toDOM(e,n,r),null)}),i}insert(e,n){this.doc!==null?je(this.doc,r=>{rf(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)je(this.doc,r=>{const i=e&&e instanceof it?e._item:e;ds(r,this,i,n)});else{const r=this._prelimContent,i=e===null?0:r.findIndex(o=>o===e)+1;if(i===0&&e!==null)throw _n("Reference item not found");r.splice(i,0,...n)}}delete(e,n=1){this.doc!==null?je(this.doc,r=>{sf(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return Zu(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return tf(this,e)}slice(e=0,n=this.length){return Qu(this,e,n)}forEach(e){ri(this,e)}_write(e){e.writeTypeRef(og)}}const By=t=>new Kn;class lr extends Kn{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new lr(this.nodeName)}clone(){const e=new lr(this.nodeName),n=this.getAttributes();return Pp(n,(r,i)=>{typeof r=="string"&&e.setAttribute(i,r)}),e.insert(0,this.toArray().map(r=>r instanceof it?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const l in e)r.push(l);r.sort();const i=r.length;for(let l=0;l<i;l++){const f=r[l];n.push(f+'="'+e[f]+'"')}const o=this.nodeName.toLocaleLowerCase(),c=n.length>0?" "+n.join(" "):"";return`<${o}${c}>${super.toString()}</${o}>`}removeAttribute(e){this.doc!==null?je(this.doc,n=>{hs(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?je(this.doc,r=>{Ua(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return ja(this,e)}hasAttribute(e){return af(this,e)}getAttributes(e){return e?Dy(this,e):of(this)}toDOM(e=document,n={},r){const i=e.createElement(this.nodeName),o=this.getAttributes();for(const c in o){const l=o[c];typeof l=="string"&&i.setAttribute(c,l)}return ri(this,c=>{i.appendChild(c.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(e){e.writeTypeRef(sg),e.writeKey(this.nodeName)}}const Fy=t=>new lr(t.readKey());class $y extends Ts{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class ps extends ar{constructor(e){super(),this.hookName=e}_copy(){return new ps(this.hookName)}clone(){const e=new ps(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const i=n[this.hookName];let o;return i!==void 0?o=i.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(e){e.writeTypeRef(ag),e.writeKey(this.hookName)}}const qy=t=>new ps(t.readKey());class ys extends cr{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new ys}clone(){const e=new ys;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const i=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(e=>{const n=[];for(const i in e.attributes){const o=[];for(const c in e.attributes[i])o.push({key:c,value:e.attributes[i][c]});o.sort((c,l)=>c.key<l.key?-1:1),n.push({nodeName:i,attrs:o})}n.sort((i,o)=>i.nodeName<o.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const o=n[i];r+=`<${o.nodeName}`;for(let c=0;c<o.attrs.length;c++){const l=o.attrs[c];r+=` ${l.key}="${l.value}"`}r+=">"}r+=e.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(cg)}}const Vy=t=>new ys;class La{constructor(e,n){this.id=e,this.length=n}get deleted(){throw Bt()}mergeWith(e){return!1}write(e,n,r){throw Bt()}integrate(e,n){throw Bt()}}const Wy=0;class At extends La{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),Vu(e.doc.store,this)}write(e,n){e.writeInfo(Wy),e.writeLen(this.length-n)}getMissing(e,n){return null}}class fi{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new fi(this.content)}splice(e){throw Bt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const Hy=t=>new fi(t.readBuf());class ii{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ii(this.len)}splice(e){const n=new ii(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){us(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const zy=t=>new ii(t.readLen()),df=(t,e)=>new vr({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class di{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new di(df(this.doc.guid,this.opts))}splice(e){throw Bt()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const Yy=t=>new di(df(t.readString(),t.readAny()));class Fn{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Fn(this.embed)}splice(e){throw Bt()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const Gy=t=>new Fn(t.readJSON());class Ye{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Ye(this.key,this.value)}splice(e){throw Bt()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Jy=t=>new Ye(t.readKey(),t.readJSON());class gs{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new gs(this.arr)}splice(e){const n=new gs(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const o=this.arr[i];e.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const Xy=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const i=t.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new gs(n)},Qy=ls("node_env")==="development";class Bn{constructor(e){this.arr=e,Qy&&Cu(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Bn(this.arr)}splice(e){const n=new Bn(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let i=n;i<r;i++){const o=this.arr[i];e.writeAny(o)}}getRef(){return 8}}const Zy=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Bn(n)};class qt{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new qt(this.str)}splice(e){const n=new qt(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const eg=t=>new qt(t.readString()),tg=[Ry,Uy,Ky,Fy,By,qy,Vy],ng=0,rg=1,ig=2,sg=3,og=4,ag=5,cg=6;class rn{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new rn(this.type._copy())}splice(e){throw Bt()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const lg=t=>new rn(tg[t.readTypeRef()](t)),ms=(t,e,n)=>{const{client:r,clock:i}=e.id,o=new He(Ce(r,i+n),e,Ce(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&o.markDeleted(),e.keep&&(o.keep=!0),e.redone!==null&&(o.redone=Ce(e.redone.client,e.redone.clock+n)),e.right=o,o.right!==null&&(o.right.left=o),t._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),e.length=n,o};class He extends La{constructor(e,n,r,i,o,c,l,f){super(e,f.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=o,this.parent=c,this.parentSub=l,this.redone=null,this.content=f,this.info=this.content.isCountable()?$c:0}set marker(e){(this.info&Co)>0!==e&&(this.info^=Co)}get marker(){return(this.info&Co)>0}get keep(){return(this.info&Fc)>0}set keep(e){this.keep!==e&&(this.info^=Fc)}get countable(){return(this.info&$c)>0}get deleted(){return(this.info&Eo)>0}set deleted(e){this.deleted!==e&&(this.info^=Eo)}markDeleted(){this.info|=Eo}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=et(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=et(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===er&&this.id.client!==this.parent.client&&this.parent.clock>=et(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=sl(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=kn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===At||this.right&&this.right.constructor===At)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===He?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===He&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===er){const r=To(n,this.parent);r.constructor===At?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=sl(e,e.doc.store,Ce(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const o=new Set,c=new Set;for(;i!==null&&i!==this.right;){if(c.add(i),o.add(i),$i(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,o.clear();else if($i(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&c.has(To(e.doc.store,i.origin)))o.has(To(e.doc.store,i.origin))||(r=i,o.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Vu(e.doc.store,this),this.content.integrate(e,this),al(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new At(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ce(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&$i(e.origin,this.lastId)&&this.right===e&&$i(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),us(e.deleteSet,this.id.client,this.id.clock,this.length),al(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw Ft();this.content.gc(e),n?gy(e,this,new At(this.id,this.length)):this.content=new ii(this.length)}write(e,n){const r=n>0?Ce(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,o=this.parentSub,c=this.content.getRef()&Cs|(r===null?0:kt)|(i===null?0:Qt)|(o===null?0:Qr);if(e.writeInfo(c),r!==null&&e.writeLeftID(r),i!==null&&e.writeRightID(i),r===null&&i===null){const l=this.parent;if(l._item!==void 0){const f=l._item;if(f===null){const h=py(l);e.writeParentInfo(!0),e.writeString(h)}else e.writeParentInfo(!1),e.writeLeftID(f.id)}else l.constructor===String?(e.writeParentInfo(!0),e.writeString(l)):l.constructor===er?(e.writeParentInfo(!1),e.writeLeftID(l)):Ft();o!==null&&e.writeString(o)}this.content.write(e,n)}}const hf=(t,e)=>ug[e&Cs](t),ug=[()=>{Ft()},zy,Xy,Hy,eg,Gy,Jy,lg,Zy,Yy,()=>{Ft()}],fg=10;class Dt extends La{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){Ft()}write(e,n){e.writeInfo(fg),ye(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const pf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},yf="__ $YJS$ __";pf[yf]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");pf[yf]=!0;const Uo=new FinalizationRegistry(({cache:t,key:e})=>{delete t[e]});function gf(t){var e,n;return(e=(n=t._novip)._docCache)!==null&&e!==void 0?e:n._docCache={cache:{},get size(){return Object.keys(this.cache).length},find(r,i,o){const c=jo(r,i,o),l=this.cache[c];return l?l.deref():void 0},add(r){var i;const{parentTable:o,parentId:c,parentProp:l}=r.meta;if(!o||!l||c==null)throw new Error("Missing Dexie-related metadata in Y.Doc");const f=jo(o,c,l),h=(i=this.cache[f])===null||i===void 0?void 0:i.deref();h&&Uo.unregister(h),this.cache[f]=new WeakRef(r),Uo.register(r,{cache:this.cache,key:f},r)},delete(r){Uo.unregister(r);const i=jo(r.meta.parentTable,r.meta.parentId,r.meta.parentProp),o=this.cache[i];(o==null?void 0:o.deref())===r&&delete this.cache[i]}}}const Vr=new WeakSet;function ia(t){if(Vr.has(t))throw new Error(`Y.Doc ${t.meta.parentId} has been destroyed`)}function jo(t,e,n){return`${t}[${e}].${n}`}function dg(t,e,n,r,i,o){let c=e.find(n,o,r);return c||(c=new vr({meta:{db:t,updatesTable:i,parentProp:r,parentTable:n,parentId:o}}),e.add(c),c.on("destroy",()=>{Vr.add(c),e.delete(c)}),c)}const{getByKeyPath:bv}=Ee;let mf=null;function dl(t){mf=t}function hg(t,e,n,r,i,o){let c=0,l=!0;const f=yn(()=>{ia(e);const g=n.table(i);return Promise.all([(c>0?g.where("i").between(c,1/0,!1).toArray().then(m=>m.filter(b=>xs(b.k,o)===0)):g.where({k:o}).toArray()).then(m=>m),n.table(r).where(":id").equals(o).toArray()])}).subscribe(([g,m])=>{if(g.length>0&&(c=g[g.length-1].i),m.length===0){e.destroy();return}ia(e),g.length>0&&je(e,()=>{g.forEach(b=>{try{dl(b),Fu(e,b.u)}finally{dl(null)}})},t,!1),l&&(l=!1,e.emit("load",[e]))},g=>{t.on("error").fire(g)}),h=(g,m)=>{m!==t&&n.table(i).add({k:o,u:g,f:1}).then(b=>{b===c-1&&++c}).catch(b=>{t.on("error").fire(b)})},d=()=>{f.unsubscribe(),e.off("updateV2",h),e.off("destroy",d)};return e.on("updateV2",h),e.on("destroy",d),d}function vf(){}function pg(t,e){return t===vf?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}function yg(t,e){return t===vf?e:function(){t.apply(this,arguments),e.apply(this,arguments)}}const jr=new WeakMap;function hl(){return Ee.Events(null,"load","sync","error")}class ut{static getOrCreateDocument(e,n,r,i){var o,c;const l=gf(e),f=(c=(o=e.table(n).schema.yProps)===null||o===void 0?void 0:o.find(h=>h.prop===r))===null||c===void 0?void 0:c.updatesTable;if(!f)throw new Error(`Updates table for ${n}.${r} not found`);return dg(e,l,n,r,f,i)}static load(e,n){var r;let i=jr.get(e);return i?(++i.refCount,(n==null?void 0:n.gracePeriod)!=null&&i.graceTimeout<n.gracePeriod&&(i.graceTimeout=n.gracePeriod),i.graceTimer&&(clearTimeout(i.graceTimer),i.graceTimer=null)):(i=new ut(e),i.graceTimeout=(r=n==null?void 0:n.gracePeriod)!==null&&r!==void 0?r:-1,jr.set(e,i)),i}static release(e){if(!e||Vr.has(e))return;const n=jr.get(e);n?--n.refCount<=0&&(n.graceTimeout<0?n._release():n.graceTimer||(n.graceTimer=setTimeout(()=>{n.graceTimer=null,n.refCount===0&&n._release()},n.graceTimeout))):e.destroy()}_release(){this.doc&&Promise.resolve(ut.on("beforeunload").fire(this)).finally(()=>{var e;this.refCount===0&&((e=this.doc)===null||e===void 0||e.destroy())})}static for(e){return jr.get(e)}static get currentUpdateRow(){return mf}get whenLoaded(){return this._whenLoaded||(this._whenLoaded=new Promise((e,n)=>{if(!this.doc){n(new Error("No Y.Doc associated with this provider"));return}this.doc.isLoaded?e():this._error?n(this._error):Vr.has(this.doc)?n(new Ee.AbortError("Document was destroyed before loaded")):(this.on("load",e),this.on("error",n),this.doc.on("destroy",()=>n(new Ee.AbortError("Document was destroyed before loaded"))))})),this._whenLoaded}get whenSynced(){return this._whenSynced||(this._whenSynced=new Promise((e,n)=>{if(!this.doc){n(new Error("No Y.Doc associated with this provider"));return}this.doc.isSynced?e():this._error?n(this._error):Vr.has(this.doc)?n(new Ee.AbortError("Document was destroyed before synced")):(this.on("sync",e),this.on("error",n),this.doc.on("destroy",()=>n(new Ee.AbortError("Document was destroyed before synced"))))})),this._whenSynced}constructor(e){this.refCount=1,this.cleanupHandlers=[],this.graceTimeout=-1,this.doc=null,this.destroyed=!1,this.on=hl(),this.doc=e,this.off=(c,l)=>{var f;return(f=this.on[c])===null||f===void 0?void 0:f.unsubscribe(l)},"dispose"in Symbol&&(this[Symbol.dispose]=()=>ut.release(e)),e.on("load",()=>this.on("load").fire()),e.on("sync",c=>c!==!1&&this.on("sync").fire()),e.on("destroy",this.destroy.bind(this)),this.on("error",c=>{this._error=c});const{db:n,parentTable:r,parentId:i,updatesTable:o}=e.meta||{};if(!n||!r||!o)throw new Error("Missing Dexie-related metadata in Y.Doc. Documents need to be obtained through Y.Doc properties from dexie queries.");if(!n.table(r)||!n.table(o))throw new Error(`Table ${r} or ${o} not found in db`);ia(e),this.stopObserving=hg(this,e,n,r,o,i),ut.on("new").fire(this)}destroy(){var e,n,r;console.debug(`Y.Doc ${(n=(e=this.doc)===null||e===void 0?void 0:e.meta)===null||n===void 0?void 0:n.parentId} was destroyed`),jr.delete(this.doc),this.doc=null,this.destroyed=!0,this.refCount=0,(r=this.stopObserving)===null||r===void 0||r.call(this),this.on=hl(),this.cleanupHandlers.forEach(i=>i())}addCleanupHandler(e){this.cleanupHandlers.push(typeof e=="function"?e:()=>e.unsubscribe())}}ut.on=Ee.Events(null,{new:[yg],beforeunload:[pg]});ut.getDocCache=gf;Ee.DexieYProvider?ut=Ee.DexieYProvider||ut:Ee.DexieYProvider=ut;const Lo=3e4;class gg extends Ep{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=cs();this.getLocalState()!==null&&Lo/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,o)=>{o!==this.clientID&&Lo<=n-i.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&bf(this,r,"timeout")},Zt(Lo/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const n=this.clientID,r=this.meta.get(n),i=r===void 0?0:r.clock+1,o=this.states.get(n);e===null?this.states.delete(n):this.states.set(n,e),this.meta.set(n,{clock:i,lastUpdated:cs()});const c=[],l=[],f=[],h=[];e===null?h.push(n):o==null?e!=null&&c.push(n):(l.push(n),qr(o,e)||f.push(n)),(c.length>0||f.length>0||h.length>0)&&this.emit("change",[{added:c,updated:f,removed:h},"local"]),this.emit("update",[{added:c,updated:l,removed:h},"local"])}setLocalStateField(e,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:n})}getStates(){return this.states}}const bf=(t,e,n)=>{const r=[];for(let i=0;i<e.length;i++){const o=e[i];if(t.states.has(o)){if(t.states.delete(o),o===t.clientID){const c=t.meta.get(o);t.meta.set(o,{clock:c.clock+1,lastUpdated:cs()})}r.push(o)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},mg=(t,e,n=t.states)=>{const r=e.length,i=gr();ye(i,r);for(let o=0;o<r;o++){const c=e[o],l=n.get(c)||null,f=t.meta.get(c).clock;ye(i,c),ye(i,f),It(i,JSON.stringify(l))}return wt(i)},vg=(t,e,n)=>{const r=ui(e),i=cs(),o=[],c=[],l=[],f=[],h=Ue(r);for(let d=0;d<h;d++){const g=Ue(r);let m=Ue(r);const b=JSON.parse(Ot(r)),k=t.meta.get(g),C=t.states.get(g),j=k===void 0?0:k.clock;(j<m||j===m&&b===null&&t.states.has(g))&&(b===null?g===t.clientID&&t.getLocalState()!=null?m++:t.states.delete(g):t.states.set(g,b),t.meta.set(g,{clock:m,lastUpdated:i}),k===void 0&&b!==null?o.push(g):k!==void 0&&b===null?f.push(g):b!==null&&(qr(b,C)||l.push(g),c.push(g)))}(o.length>0||l.length>0||f.length>0)&&t.emit("change",[{added:o,updated:l,removed:f},n]),(o.length>0||c.length>0||f.length>0)&&t.emit("update",[{added:o,updated:c,removed:f},n])};function te(t,e,n,r){return new(n||(n=Promise))(function(i,o){function c(h){try{f(r.next(h))}catch(d){o(d)}}function l(h){try{f(r.throw(h))}catch(d){o(d)}}function f(h){var d;h.done?i(h.value):(d=h.value,d instanceof n?d:new n(function(g){g(d)})).then(c,l)}f((r=r.apply(t,e||[])).next())})}function bg(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function rt(t){return this instanceof rt?(this.v=t,this):new rt(t)}function sa(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},c("next"),c("throw"),c("return"),r[Symbol.asyncIterator]=function(){return this},r;function c(g){i[g]&&(r[g]=function(m){return new Promise(function(b,k){o.push([g,m,b,k])>1||l(g,m)})})}function l(g,m){try{(function(b){b.value instanceof rt?Promise.resolve(b.value.v).then(f,h):d(o[0][2],b)})(i[g](m))}catch(b){d(o[0][3],b)}}function f(g){l("next",g)}function h(g){l("throw",g)}function d(g,m){g(m),o.shift(),o.length&&l(o[0][0],o[0][1])}}function oa(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=bg(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(o){return new Promise(function(c,l){(function(f,h,d,g){Promise.resolve(g).then(function(m){f({value:m,done:d})},h)})(c,l,(o=t[i](o)).done,o.value)})}}}const ht={userId:"unauthorized",name:"Unauthorized",claims:{sub:"unauthorized"},lastLogin:new Date(0)};try{Object.freeze(ht),Object.freeze(ht.claims)}catch{}const aa={},Wr=typeof self<"u"&&self.document&&typeof navigator<"u"&&navigator.serviceWorker;Wr&&Wr.ready.then(t=>aa.registration=t),typeof self<"u"&&"clients"in self&&!self.document&&addEventListener("message",t=>{var e,n;!((n=(e=t.data)===null||e===void 0?void 0:e.type)===null||n===void 0)&&n.startsWith("sw-broadcast-")&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>{var i;return r.id!==((i=t.source)===null||i===void 0?void 0:i.id)&&r.postMessage(t.data)})});class No{constructor(e){this.name=e}subscribe(e){if(!Wr)return()=>{};const n=r=>{var i;((i=r.data)===null||i===void 0?void 0:i.type)===`sw-broadcast-${this.name}`&&e(r.data.message)};return Wr.addEventListener("message",n),()=>Wr.removeEventListener("message",n)}postMessage(e){var n;typeof self.clients=="object"?[...self.clients.matchAll({includeUncontrolled:!0})].forEach(r=>r.postMessage({type:`sw-broadcast-${this.name}`,message:e})):aa.registration&&((n=aa.registration.active)===null||n===void 0||n.postMessage({type:`sw-broadcast-${this.name}`,message:e}))}}const Lr=globalThis["lbc-events"]||(globalThis["lbc-events"]=new Map);class Wi extends ze{constructor(e){const n=typeof BroadcastChannel>"u"?new No(e):new BroadcastChannel(e);super(r=>{function i(l){r.next(l.detail)}function o(l){r.next(l.data)}let c;(function(l,f){Lr.has(l)?Lr.get(l).push(f):Lr.set(l,[f])})(`lbc-${e}`,i);try{n instanceof No?c=n.subscribe(l=>r.next(l)):n.addEventListener("message",o)}catch{}return()=>{(function(l,f){const h=Lr.get(l);if(h){const d=h.indexOf(f);d!==-1&&h.splice(d,1)}})(`lbc-${e}`,i),n instanceof No?c():n.removeEventListener("message",o)}}),this.name=e,this.bc=n}next(e){this.bc.postMessage(e),function(n){const r=Lr.get(n.type);r&&r.forEach(i=>{try{i(n)}catch{}})}(new CustomEvent(`lbc-${this.name}`,{detail:e}))}}function wf(t,e){return te(this,void 0,void 0,function*(){try{const n=yield navigator.serviceWorker.ready;if(e==="push"&&n.sync&&(yield n.sync.register(`dexie-cloud:${t.name}`)),!n.active)throw new Error("Failed to trigger sync - there's no active service worker");return void n.active.postMessage({type:"dexie-cloud-sync",dbName:t.name,purpose:e})}catch{}})}function Jt(t,e){t.cloud.usingServiceWorker?wf(t,e):t.localSyncEvent.next({purpose:e})}const wg="fromBase64"in Uint8Array,_g="toBase64"in Uint8Array.prototype,Na=typeof Buffer<"u"?t=>Buffer.from(t,"base64"):wg?t=>Uint8Array.fromBase64(t):t=>{const e=atob(t),n=e.length,r=new Uint8Array(n);for(var i=0;i<n;i++)r[i]=e.charCodeAt(i);return r},wr=typeof Buffer<"u"?t=>ArrayBuffer.isView(t)?Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"):Buffer.from(t).toString("base64"):_g?t=>(ArrayBuffer.isView(t)?t:new Uint8Array(t)).toBase64():t=>{const e=ArrayBuffer.isView(t)?t:new Uint8Array(t),n=[];for(let r=0,i=e.length;r<i;r+=4096){const o=e.subarray(r,r+4096);n.push(String.fromCharCode.apply(null,o))}return btoa(n.join(""))};function ca(t){return te(this,arguments,void 0,function*({realms:e,inviteRealms:n}){const r=JSON.stringify([...e.map(c=>({realmId:c,accepted:!0})),...n.map(c=>({realmId:c,accepted:!1}))].sort((c,l)=>c.realmId<l.realmId?-1:c.realmId>l.realmId?1:0)),i=new TextEncoder().encode(r),o=yield crypto.subtle.digest("SHA-1",i);return wr(o)})}function rs(t){return Object.entries(t.cloud.schema||{}).filter(([,{markedForSync:e}])=>e).map(([e])=>t.tables.filter(({name:n})=>n===e)[0]).filter(e=>e)}function Ma(t){return`$${t}_mutations`}function _f(t){var e;const n=(e=/^\$(.*)_mutations$/.exec(t))===null||e===void 0?void 0:e[1];if(!n)throw new Error(`Given mutationTable ${t} is not correct`);return n}const kg=[].concat;function Ka(t){return kg.apply([],t)}function la(t,e){return te(this,arguments,void 0,function*(n,r,{since:i={},limit:o=1/0}={}){const c=yield Promise.all(n.map(g=>te(this,void 0,void 0,function*(){const m=_f(g.name),b=i[m];let k=b?g.where("rev").above(b):g;o<1/0&&(k=k.limit(o));let C=yield k.toArray();return C=function(j){return j=j.map(F=>{if(F.type==="modify"&&F.criteria.index===null){const K=Object.assign(Object.assign({},F),{criteria:void 0,changeSpec:void 0,type:"update",keys:F.keys,changeSpecs:[F.changeSpec]});return delete K.criteria,delete K.changeSpec,K}return F}),j}(C),C=function(j){const F=new Map;for(const K of j)if(K.type==="update"){if(K.keys.length!==1||K.changeSpecs.length!==1)continue;const N=""+K.keys[0],G=K.changeSpecs[0];if(Object.values(G).some(Q=>typeof Q=="object"&&Q&&"@@propmod"in Q))continue;let re=F.get(N);re?re.push({txid:K.txid,updateSpec:G}):F.set(N,[{txid:K.txid,updateSpec:G}])}return j=j.filter(K=>{if(K.type!=="update"||K.keys.length!==1||K.changeSpecs.length!==1)return!0;const N=new Set(Object.keys(K.changeSpecs[0])),G=""+K.keys[0],re=F.get(G);for(let Q=re.length-1;Q>=0;--Q){const{txid:oe,updateSpec:Te}=re[Q];if(oe===K.txid)break;for(const fe of Object.keys(Te))N.delete(fe)}return N.size!==0}),j}(C),C.map(j=>({table:m,mut:j}))}))),l=Ka(c).sort((g,m)=>g.mut.txid===m.mut.txid?g.mut.opNo-m.mut.opNo:g.mut.ts-m.mut.ts),f=[];let h=null,d=null;for(const{table:g,mut:m}of l)h&&h.table===g&&d===m.txid?h.muts.push(m):(h={table:g,muts:[m]},d=m.txid,f.push(h));return f})}function kf(t){const e=new Uint8Array(t);if(typeof crypto<"u")crypto.getRandomValues(e);else for(let n=0;n<t;n++)e[n]=Math.floor(256*Math.random());if(typeof Buffer<"u"&&Buffer.from)return Buffer.from(e).toString("base64");if(typeof btoa<"u")return btoa(String.fromCharCode.apply(null,e));throw new Error("No btoa or Buffer available")}const Sg={}.hasOwnProperty;function vs(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){(function(h){if(!h)throw new Error("Assertion Failed")})(typeof n!="string"&&"length"in n);for(var r=0,i=e.length;r<i;++r)vs(t,e[r],n[r])}else{var o=e.indexOf(".");if(o!==-1){var c=e.substr(0,o),l=e.substr(o+1);if(l==="")n===void 0?Array.isArray(t)?isNaN(parseInt(c))||t.splice(parseInt(c),1):delete t[c]:t[c]=n;else{var f=t[c];f&&function(h,d){return Sg.call(h,d)}(t,c)||(f=t[c]={}),vs(f,l,n)}}else n===void 0?Array.isArray(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}const Sf=typeof self<"u"&&typeof crypto<"u"?(t,e=crypto.getRandomValues.bind(crypto))=>{const n=new Uint8Array(t);return e(n),self.btoa(String.fromCharCode.apply(null,n))}:typeof Buffer<"u"?(t,e=xg)=>{const n=Buffer.alloc(t);return e(n),n.toString("base64")}:()=>{throw new Error("No implementation of randomString was found")};function xg(t){for(let e=0;e<t.length;++e)t[e]=Math.floor(256*Math.random())}function Ba(t){return typeof t=="string"||!!(Array.isArray(t)&&t.some(e=>Ba(e))&&t.every(xf))}function xf(t){return typeof t=="string"||typeof t=="number"||Array.isArray(t)&&t.every(xf)}function Eg(t,e,n){const r=t[e]||(t[e]={}),i=n.keys.map(o=>typeof o=="string"?o:JSON.stringify(o));switch(n.type){case"insert":case"upsert":i.forEach((o,c)=>{r[o]={type:"ups",val:n.values[c]}});break;case"update":case"modify":i.forEach((o,c)=>{const l=n.type==="update"?n.changeSpecs[c]:n.changeSpec,f=r[o];if(f)switch(f.type){case"ups":for(const[h,d]of Object.entries(l))vs(f.val,h,d);break;case"del":break;case"upd":Object.assign(f.mod,l)}else r[o]={type:"upd",mod:l}});break;case"delete":i.forEach(o=>{r[o]={type:"del"}})}return t}function pl(t,e){for(const{table:n,muts:r}of e)for(const i of r)Eg(t,n,i)}function Cg(t){return sa(this,arguments,function*(){var e,n,r,i;let o=0,c=new Uint8Array(4),l=0,f=[],h=0;try{for(var d,g=!0,m=oa(t);!(e=(d=yield rt(m.next())).done);g=!0){i=d.value,g=!1;const b=i,k=new DataView(b.buffer,b.byteOffset,b.byteLength);let C=0;for(;C<b.byteLength;)switch(o){case 0:if(C+4>b.byteLength){for(const j of b.slice(C)){if(l===4)break;c[l++]=j,++C}if(l<4)break}else if(l>0&&l<4)for(const j of b.slice(C,C+4-l))c[l++]=j,++C;case 1:h=l===4?new DataView(c.buffer,0,4).getUint32(0,!1):k.getUint32(C,!1),l?l=0:C+=4;case 2:if(C>=b.byteLength){o=2;break}if(C+h>b.byteLength)f.push(b.slice(C)),h-=b.byteLength-C,o=2,C=b.byteLength;else{if(f.length>0){const j=new Uint8Array(f.reduce((K,N)=>K+N.byteLength,h));let F=0;for(const K of f)j.set(K,F),F+=K.byteLength;j.set(b.slice(C,C+h),F),f=[],yield yield rt(j)}else yield yield rt(b.slice(C,C+h));C+=h,o=0}}}}catch(b){n={error:b}}finally{try{g||e||!(r=m.return)||(yield rt(r.call(m)))}finally{if(n)throw n.error}}})}class ua extends Error{constructor({title:e,message:n,messageCode:r,messageParams:i}){super(n),this.name="TokenErrorResponseError",this.title=e,this.messageCode=r,this.messageParams=i}}function hi(t,e){return new Promise((n,r)=>{const i=Object.assign(Object.assign({submitLabel:"Submit",cancelLabel:"Cancel"},e),{onSubmit:o=>{t.next(void 0),n(o)},onCancel:()=>{t.next(void 0),r(new Ee.AbortError("User cancelled"))}});t.next(i)})}function fa(t,e,...n){return hi(t,{type:"message-alert",title:e,alerts:n,fields:{},submitLabel:"OK",cancelLabel:null})}function yl(t,e,n){return te(this,void 0,void 0,function*(){let r=n||"";for(;!r||!/^[\w-+.]+@([\w-]+\.)+[\w-]{2,10}(\sas\s[\w-+.]+@([\w-]+\.)+[\w-]{2,10})?$/.test(r);)r=(yield hi(t,{type:"email",title:e,alerts:r?[{type:"error",messageCode:"INVALID_EMAIL",message:"Please enter a valid email address",messageParams:{}}]:[],fields:{email:{type:"email",placeholder:"you@somedomain.com"}}})).email;return r})}function gl(t,e,n){return te(this,void 0,void 0,function*(){const r=[{type:"info",messageCode:"OTP_SENT",message:"A One-Time password has been sent to {email}",messageParams:{email:e}}];n&&r.push(n);const{otp:i}=yield hi(t,{type:"otp",title:"Enter OTP",alerts:r,fields:{otp:{type:"otp",label:"OTP",placeholder:"Paste OTP here"}}});return i})}function Us(t){return te(this,void 0,void 0,function*(){var e,n,r;const i=yield t.getCurrentUser(),{accessToken:o,accessTokenExpiration:c,refreshToken:l,refreshTokenExpiration:f,claims:h}=i;if(!o)return null;if(((e=c==null?void 0:c.getTime())!==null&&e!==void 0?e:1/0)>Date.now()&&(((n=i.license)===null||n===void 0?void 0:n.status)||"ok")==="ok")return i;if(!l)throw new Error("Refresh token missing");if(((r=f==null?void 0:f.getTime())!==null&&r!==void 0?r:1/0)<=Date.now())throw new Error("Refresh token has expired");const d=yield js(t.cloud.options.databaseUrl,i);return yield t.table("$logins").update(h.sub,{accessToken:d.accessToken,accessTokenExpiration:d.accessTokenExpiration,claims:d.claims,license:d.license,data:d.data}),d})}function Ig(t,e,n,r,i){return te(this,void 0,void 0,function*(){return e.accessToken&&e.accessTokenExpiration.getTime()>Date.now()?e:e.refreshToken&&(!e.refreshTokenExpiration||e.refreshTokenExpiration.getTime()>Date.now())?yield js(t,e):yield function(o,c,l,f){return te(this,void 0,void 0,function*(){if(!crypto.subtle)throw typeof location<"u"&&location.protocol==="http:"?new Error("Dexie Cloud Addon needs to use WebCrypto, but your browser has disabled it due to being served from an insecure location. Please serve it from https or http://localhost:<port> (See https://stackoverflow.com/questions/46670556/how-to-enable-crypto-subtle-for-unsecure-origins-in-chrome/46671627#46671627)"):new Error("This browser does not support WebCrypto.");const{privateKey:h,publicKey:d}=yield crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!1,["sign","verify"]);if(!h||!d)throw new Error("Could not generate RSA keypair");o.nonExportablePrivateKey=h;const g=function(m){const b=wr(m);return function(k){let C=`-----BEGIN PUBLIC KEY-----
`;for(;k.length>0;)C+=k.substring(0,64)+`
`,k=k.substring(64);return C+="-----END PUBLIC KEY-----",C}(b)}(yield crypto.subtle.exportKey("spki",d));o.publicKey=d;try{const m=yield c({public_key:g,hints:f});if(m.type==="error")throw new ua(m);if(m.type!=="tokens")throw new Error(`Unexpected response type from token endpoint: ${m.type}`);return o.accessToken=m.accessToken,o.accessTokenExpiration=new Date(m.accessTokenExpiration),o.refreshToken=m.refreshToken,m.refreshTokenExpiration&&(o.refreshTokenExpiration=new Date(m.refreshTokenExpiration)),o.userId=m.claims.sub,o.email=m.claims.email,o.name=m.claims.name,o.claims=m.claims,o.license={type:m.userType,status:m.claims.license||"ok"},o.data=m.data,m.evalDaysLeft!=null&&(o.license.evalDaysLeft=m.evalDaysLeft),m.userValidUntil!=null&&(o.license.validUntil=new Date(m.userValidUntil)),m.alerts&&m.alerts.length>0&&(yield hi(l,{type:"message-alert",title:"Authentication Alert",fields:{},alerts:m.alerts})),o}catch(m){if(m instanceof ua)throw yield fa(l,m.title,{type:"error",messageCode:m.messageCode,message:m.message,messageParams:{}}),m;let b="We're having a problem authenticating right now.";throw m instanceof TypeError&&(b=typeof navigator!==void 0&&!navigator.onLine?"You seem to be offline. Please connect to the internet and try again.":Ee.debug||typeof location<"u"&&(location.hostname==="localhost"||location.hostname==="127.0.0.1")?`Could not connect to server. Please verify that your origin '${location.origin}' is whitelisted using \`npx dexie-cloud whitelist\``:"Could not connect to server. Please verify the connection.",yield fa(l,"Authentication Failed",{type:"error",messageCode:"GENERIC_ERROR",message:b,messageParams:{}}).catch(()=>{})),m}})}(e,n,r,i)})}function js(t,e){return te(this,void 0,void 0,function*(){if(!e.refreshToken)throw new Error("Cannot refresh token - refresh token is missing.");if(!e.nonExportablePrivateKey)throw new Error("login.nonExportablePrivateKey is missing - cannot sign refresh token without a private key.");const n=Date.now(),r="RSASSA-PKCS1-v1_5",i=new TextEncoder().encode(e.refreshToken+n),o=yield crypto.subtle.sign(r,e.nonExportablePrivateKey,i),c=wr(o),l={grant_type:"refresh_token",refresh_token:e.refreshToken,scopes:["ACCESS_DB"],signature:c,signing_algorithm:r,time_stamp:n},f=yield fetch(`${t}/token`,{body:JSON.stringify(l),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});if(f.status!==200)throw new Error(`RefreshToken: Status ${f.status} from ${t}/token`);const h=yield f.json();if(h.type==="error")throw new ua(h);return e.accessToken=h.accessToken,e.accessTokenExpiration=h.accessTokenExpiration?new Date(h.accessTokenExpiration):void 0,e.claims=h.claims,e.license={type:h.userType,status:h.claims.license||"ok"},h.evalDaysLeft!=null&&(e.license.evalDaysLeft=h.evalDaysLeft),h.userValidUntil!=null&&(e.license.validUntil=new Date(h.userValidUntil)),h.data&&(e.data=h.data),e})}const{toString:Og}={},ml={replace:function(t){const e=Object.keys(t);let n=null;for(let i=0,o=e.length;i<o;++i)e[i][0]==="$"&&(n=n||[],n.push(e[i]));if(!n)return t;const r={...t};for(const i of n)delete r[i];for(const i of n)r["$"+i]=t[i];return r}};function Ef(...t){const e=t.reduce((r,i)=>({...r,...i}),t.reduce((r,i)=>({...i,...r}),{})),n=new WeakMap;return{stringify(r,i,o){return JSON.stringify(r,function(l){const f=this[l],h=function(d){const g=typeof d;switch(typeof d){case"object":case"function":{if(d===null)return null;const b=Object.getPrototypeOf(d);if(!b)return ml;let k=n.get(b);if(k!==void 0)return k;const C=(m=d,Og.call(m).slice(8,-1)),j=Object.entries(e).find(([F,K])=>{var N,G;return(G=(N=K==null?void 0:K.test)===null||N===void 0?void 0:N.call(K,d,C))!==null&&G!==void 0?G:F===C});return k=j==null?void 0:j[1],k||(k=Array.isArray(d)?null:typeof d=="function"?e.function||null:ml),n.set(b,k),k}default:return e[g]}var m}(f);return h?h.replace(f,i,e):f},o)},parse(r,i){const o=[];return JSON.parse(r,function(c,l){const f=l==null?void 0:l.$t;if(f){const d=e[f];l=d?d.revive(l,i,e):l}let h=o[o.length-1];if(h&&h[0]===l){l={...l};for(const d of h[1])delete l[d];for(const[d,g]of Object.entries(h[2]))l[d]=g;o.pop()}if(l===void 0||c[0]==="$"&&c!=="$t"){let d,g;h=o[o.length-1],h&&h[0]===this?(d=h[1],g=h[2]):o.push([this,d=[],g={}]),c[0]==="$"&&c!=="$t"?(d.push(c),g[c.substr(1)]=l):g[c]=void 0}return l})}}}const Ag={Blob:{test:(t,e)=>e==="Blob",replace:(t,e)=>{const n=e.length;return e.push(t),{$t:"Blob",mimeType:t.type,i:n}},revive:({i:t,mimeType:e},n)=>new Blob([n[t]],{type:e})}};var Dg={number:{replace:t=>{switch(!0){case isNaN(t):return{$t:"number",v:"NaN"};case t===1/0:return{$t:"number",v:"Infinity"};case t===-1/0:return{$t:"number",v:"-Infinity"};default:return t}},revive:({v:t})=>Number(t)}};const Tg={bigint:{replace:t=>({$t:"bigint",v:""+t}),revive:t=>BigInt(t.v)}};var Rg={Date:{replace:t=>({$t:"Date",v:isNaN(t.getTime())?"NaN":t.toISOString()}),revive:({v:t})=>new Date(t==="NaN"?NaN:Date.parse(t))}},Pg={Set:{replace:t=>({$t:"Set",v:Array.from(t.entries())}),revive:({v:t})=>new Set(t)}},Ug={Map:{replace:t=>({$t:"Map",v:Array.from(t.entries())}),revive:({v:t})=>new Map(t)}};const jg=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof global<"u"?global:void 0;var Lg=["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","DataView","BigInt64Array","BigUint64Array"].reduce((t,e)=>({...t,[e]:{replace:(n,r,i)=>({$t:e,v:i.ArrayBuffer.replace(n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength),r,i).v}),revive:({v:n},r,i)=>{const o=jg[e];return o&&new o(i.ArrayBuffer.revive({v:n},r,i))}}}),{});function Cf(t){return function(e){for(var n="",r=0,i=e.length;r<i;r++)n+=If[e[r]];return n}(wr(t))}function Ng(t){return Na(function(e){if(typeof e!="string")throw new Error("invalid decoder input: "+e);for(var n="",r=0,i=e.length;r<i;r++)n+=da[e[r]];return n}(t))}const da={"-":"=",0:"A",1:"B",2:"C",3:"D",4:"E",5:"F",6:"G",7:"H",8:"I",9:"J",A:"K",B:"L",C:"M",D:"N",E:"O",F:"P",G:"Q",H:"R",I:"S",J:"T",K:"U",L:"V",M:"W",N:"X",O:"Y",P:"Z",Q:"a",R:"b",S:"c",T:"d",U:"e",V:"f",W:"g",X:"h",Y:"i",Z:"j",_:"k",a:"l",b:"m",c:"n",d:"o",e:"p",f:"q",g:"r",h:"s",i:"t",j:"u",k:"v",l:"w",m:"x",n:"y",o:"z",p:"0",q:"1",r:"2",s:"3",t:"4",u:"5",v:"6",w:"7",x:"8",y:"9",z:"+","|":"/"},If={};for(const t of Object.keys(da))If[da[t]]=t;var Mg={ArrayBuffer:{replace:t=>({$t:"ArrayBuffer",v:Cf(t)}),revive:({v:t})=>{const e=Ng(t);return e.buffer.byteLength===e.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}}};class Mo{constructor(e,n){this.buf=e,this.type=n}}function Of(t){const e=new XMLHttpRequest;if(e.overrideMimeType("text/plain; charset=x-user-defined"),e.open("GET",URL.createObjectURL(t),!1),e.send(),e.status!==200&&e.status!==0)throw new Error("Bad Blob access: "+e.status);return e.responseText}function Af(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n);return e.buffer}var Kg={Blob:{test:(t,e)=>e==="Blob"||t instanceof Mo,replace:t=>({$t:"Blob",v:wr(t instanceof Mo?t.buf:Af(Of(t))),type:t.type}),revive:({type:t,v:e})=>{const n=Na(e);return typeof Blob!==void 0?new Blob([n]):new Mo(n.buffer,t)}}};const Df={...Dg,...Tg,...Rg,...Pg,...Ug,...Lg,...Mg,...Kg};function vl(t){return new Promise((e,n)=>{const r=new FileReader;r.onabort=i=>n(new Error("file read aborted")),r.onerror=i=>n(i.target.error),r.onload=i=>e(i.target.result),r.readAsArrayBuffer(t)})}var Bg={undefined:{replace:()=>({$t:"undefined"}),revive:()=>{}}},Fg={File:{test:(t,e)=>e==="File",replace:t=>({$t:"File",v:wr(Af(Of(t))),type:t.type,name:t.name,lastModified:new Date(t.lastModified).toISOString()}),revive:({type:t,v:e,name:n,lastModified:r})=>{const i=Na(e);return new File([i],n,{type:t,lastModified:new Date(r).getTime()})}}};const $g=typeof BigInt=="function"&&typeof BigInt(0)=="bigint";class bl{toString(){return this.v}constructor(e){this.v=e}}const qg=$g?{}:{bigint:{test:t=>t instanceof bl,replace:t=>Object.assign({$t:"bigint"},t),revive:({v:t})=>new bl(t)}},Tf=Object.assign(Object.assign(Object.assign(Object.assign({},Bg),qg),Fg),{PropModification:{test:t=>t instanceof Oc,replace:t=>Object.assign({$t:"PropModification"},t["@@propmod"]),revive:t=>{var e=function(n,r){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&r.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var c=0;for(o=Object.getOwnPropertySymbols(n);c<o.length;c++)r.indexOf(o[c])<0&&Object.prototype.propertyIsEnumerable.call(n,o[c])&&(i[o[c]]=n[o[c]])}return i}(t,["$t"]);return new Oc(e)}}}),si=Ef(Df,Tf),Vg=function(...t){const e=Ef(Df,Ag,...t);return{toBinary(n){const[r,i]=this.stringify(n),o=new ArrayBuffer(4);return new DataView(o).setUint32(0,r.size),new Blob([o,r,i])},stringify(n){const r=[],i=e.stringify(n,r);return[new Blob(r.map(c=>{const l=new ArrayBuffer(4);return new DataView(l).setUint32(0,"byteLength"in c?c.byteLength:c.size),new Blob([l,c])})),i]},async parse(n,r){let i=0;const o=[],c=await vl(r),l=new DataView(c);for(;i<c.byteLength;){const f=l.getUint32(i);i+=4;const h=c.slice(i,i+f);i+=f,o.push(h)}return e.parse(n,o)},async fromBinary(n){const r=new DataView(await vl(n.slice(0,4))).getUint32(0),i=n.slice(4,r+4),o=await function(c){return new Promise((l,f)=>{const h=new FileReader;h.onabort=d=>f(new Error("file read aborted")),h.onerror=d=>f(d.target.error),h.onload=d=>l(d.target.result),h.readAsText(c)})}(n.slice(r+4));return await this.parse(o,i)}}}(Tf);class ha extends Error{constructor(e,n){super(n||`${e.status} ${e.statusText}`),this.httpStatus=e.status}get name(){return"HttpError"}}function Wg(t,e,n){const r=[];for(let i of n){const{table:o,muts:c}=i,l=t.tables.find(d=>d.name===o);if(!l)throw new Error(`Internal error: table ${o} not found in DBCore schema`);const{primaryKey:f}=l;let h=i;c.forEach((d,g)=>{const m=!f.outbound&&(d.type==="upsert"||d.type==="insert");d.keys.forEach((b,k)=>{if(Array.isArray(b)){h===i&&(h=wl(i,m));const C=h.muts[g],j=JSON.stringify(b);C.keys[k]=j}else if(b[0]==="#"){h===i&&(h=wl(i,m));const C=h.muts[g];if(!e.isLoggedIn)throw new Error("Internal error: Cannot sync private IDs before authenticated");const j=`${b}:${e.userId}`;C.keys[k]=j,m&&Ee.setByKeyPath(C.values[k],f.keyPath,j)}})}),r.push(h)}return r}function wl(t,e){return Object.assign(Object.assign({},t),{muts:e?t.muts.map(n=>n.type!=="insert"&&n.type!=="upsert"||!n.values?Object.assign(Object.assign({},n),{keys:n.keys.slice()}):Object.assign(Object.assign({},n),{keys:n.keys.slice(),values:n.values.slice()})):t.muts.map(n=>Object.assign(Object.assign({},n),{keys:n.keys.slice()}))})}let pa=new WeakMap;function Rf(t){return te(this,void 0,void 0,function*(){var e,n;const r=((n=(e=pa.get(t))===null||e===void 0?void 0:e.getTime())!==null&&n!==void 0?n:0)-Date.now();r>0&&(yield new Promise(i=>setTimeout(i,r)))})}function Hg(t,e,n,r,i,o,c,l,f){return te(this,void 0,void 0,function*(){const h={Accept:"application/json, application/x-bison, application/x-bison-stream","Content-Type":"application/tson"},d=yield Us(i),g=d==null?void 0:d.accessToken;g&&(h.Authorization=`Bearer ${g}`);const m={v:2,dbID:n==null?void 0:n.remoteDbId,clientIdentity:l,schema:c||{},lastPull:n?{serverRevision:n.serverRevision,yServerRevision:n.yServerRevision,realms:n.realms,inviteRealms:n.inviteRealms}:void 0,baseRevs:r,changes:Wg(i.dx.core.schema,f,t),y:e,dxcv:i.cloud.version};i.syncStateChangedEvent.next({phase:"pushing"});const b=si.stringify(m),k=yield fetch(`${o}/sync`,{method:"post",headers:h,credentials:"include",body:b});if(i.syncStateChangedEvent.next({phase:"pulling"}),function(C,j){const F=j.headers.get("Ratelimit-Limit"),K=j.headers.get("Ratelimit-Remaining"),N=j.headers.get("Ratelimit-Reset");if(F&&K&&N){const G=Number(F),re=Math.max(0,Number(K)),Q=Number(N);if(re<G/2){const oe=Math.ceil(Q/(re+1));pa.set(C,new Date(Date.now()+1e3*oe))}else pa.delete(C)}}(i,k),!k.ok)throw new ha(k);if(k.headers.get("content-type")==="application/x-bison")return Vg.fromBinary(yield k.blob());{const C=yield k.text();return si.parse(C)}})}function Nr(t){if(t!=null&&t.cancelled)throw new Ee.AbortError("Operation was cancelled")}let nr=!1;function Pf(t,e,n,r){return te(this,void 0,void 0,function*(){yield t.$baseRevs.bulkPut(Object.keys(e).filter(i=>e[i].markedForSync).map(i=>({tableName:i,clientRev:(n[i]||0)+1,serverRev:r}))),yield t.$baseRevs.where("tableName").noneOf(Object.keys(e).filter(i=>e[i].markedForSync)).delete()})}function ya(t,e={}){for(const{table:n,muts:r}of t){const i=r.length>0?r[r.length-1].rev:null;e[n]=i||e[n]||0}return e}function zg(t,e,n){return te(this,void 0,void 0,function*(){const r=yield t.bulkGet(e),i=[],o=[];e.forEach((c,l)=>{const f=r[l];if(f){for(const[h,d]of Object.entries(n[l]))if(h===t.schema.primKey.keyPath){if(xs(d,c)!==0)throw new Error("Cannot change primary key")}else Ee.setByKeyPath(f,h,d);i.push(c),o.push(f)}}),yield t.schema.primKey.keyPath==null?t.bulkPut(o,i):t.bulkPut(o)})}function Uf(t,e){return te(this,void 0,void 0,function*(){for(const{table:n,muts:r}of t){if(!e.dx._allTables[n])continue;const i=e.table(n),{primaryKey:o}=i.core.schema,c=l=>{switch(l[0]){case"[":if(l.endsWith("]"))try{return JSON.parse(l)}catch{}return l;case"#":return l.endsWith(":"+e.cloud.currentUserId)?l.substr(0,l.length-e.cloud.currentUserId.length-1):l;default:return l}};for(const l of r){const f=l.keys.map(c);switch(l.type){case"insert":o.outbound?yield i.bulkAdd(l.values,f):(f.forEach((h,d)=>{Ee.setByKeyPath(l.values[d],o.keyPath,h)}),yield i.bulkAdd(l.values));break;case"upsert":o.outbound?yield i.bulkPut(l.values,f):(f.forEach((h,d)=>{Ee.setByKeyPath(l.values[d],o.keyPath,h)}),yield i.bulkPut(l.values));break;case"modify":f.length===1?yield i.update(f[0],l.changeSpec):yield i.where(":id").anyOf(f).modify(l.changeSpec);break;case"update":yield zg(i,f,l.changeSpecs);break;case"delete":yield i.bulkDelete(f)}}}})}typeof self<"u"&&typeof navigator<"u"&&(nr=navigator.onLine,self.addEventListener("online",()=>nr=!0),self.addEventListener("offline",()=>nr=!1));const bn="dexie-cloud-syncer";function jf(t,e){return t.where("i").between(e,1/0,!0).toArray()}function Hr(t,e,n){var r,i,o;if(!t.dx._allTables[e])return;const c=(o=(i=(r=t.table(e))===null||r===void 0?void 0:r.schema.yProps)===null||i===void 0?void 0:i.find(l=>l.prop===n))===null||o===void 0?void 0:o.updatesTable;return c&&t.dx._allTables[c]?t.table(c):void 0}function Lf(t,e){return te(this,void 0,void 0,function*(){var n;const r={};let i,o=!1;for(const c of t)try{switch(c.type){case"u-s":{const l=Hr(e,c.table,c.prop);if(l){const f={k:c.k,u:c.u};c.r&&(f.r=c.r,i=c.r),r[l.name]=yield l.add(f)}break}case"u-ack":{const l=Hr(e,c.table,c.prop);l&&(yield e.transaction("rw",l,f=>te(this,void 0,void 0,function*(){let h=yield f.table(l.name).get(bn);yield f.table(l.name).put(Object.assign(Object.assign({},h||{i:bn}),{unsentFrom:Math.max((h==null?void 0:h.unsentFrom)||1,c.i+1)}))})));break}case"u-reject":{const l=Hr(e,c.table,c.prop);if(!l)break;const f=(n=yield l.get(c.i))===null||n===void 0?void 0:n.k;if(f!=null){yield e.transaction("rw",l,d=>(d.idbtrans._rejecting_y_ypdate=!0,l.where("i").aboveOrEqual(c.i).filter(g=>xs(g.k,f)===0&&(1&(g.f||0))==1).delete()));const h=ut.getDocCache(e.dx).find(c.table,f,c.prop);h&&h.destroy()}break}case"in-sync":{const l=ut.getDocCache(e.dx).find(c.table,c.k,c.prop);l&&!l.isSynced&&l.emit("sync",[!0,l]);break}case"y-complete-sync-done":i=c.yServerRev;break;case"outdated-server-rev":o=!0}}catch{}return{receivedUntils:r,resyncNeeded:o,yServerRevision:i}})}const Yg=1,Gg=2,Jg=3;function Xg(t,e,n){return te(this,arguments,void 0,function*(r,i,{yDownloadedRealms:o,realms:c}){if(o&&c&&c.every(d=>o[d]==="*"))return;const l=yield Us(r),f={"Content-Type":"application/json",Accept:"application/octet-stream"};l&&(f.Authorization=`Bearer ${l.accessToken}`);const h=yield fetch(`${i}/y/download`,{body:si.stringify({downloadedRealms:o||{}}),method:"POST",headers:f,credentials:"include"});if(!h.ok)throw new Error(`Failed to download Yjs documents from server. Status: ${h.status}`);yield async function(d,...g){var m,b,k;let C=d();for(let N=0;N<g.length;N++)C=g[N](C);try{for(var j,F=!0,K=oa(C);!(m=(j=await K.next()).done);F=!0)j.value,F=!1}catch(N){b={error:N}}finally{try{F||m||!(k=K.return)||await k.call(K)}finally{if(b)throw b.error}}}(function(d){return function(){return sa(this,arguments,function*(){if(!d.body)throw new Error("Response body is not readable");const g=d.body.getReader();try{for(;;){const{done:m,value:b}=yield rt(g.read());if(m)return yield rt(void 0);yield yield rt(b)}}finally{g.releaseLock()}})}}(h),Cg,function(d){return sa(this,arguments,function*(){var g,m,b,k;let C=null,j=null,F=null,K=[];function N(oe){return te(this,void 0,void 0,function*(){const Te=K[K.length-1];if(K.length>0){if(!C||!j||!F)throw new Error(`Protocol error from ${i}/y/download`);const fe=Hr(r,j,F);fe&&(yield fe.bulkAdd(K)),K=[]}C&&(j&&F&&Te||oe)&&(yield r.$syncState.update("syncState",fe=>{const De=fe.yDownloadedRealms||{};De[C]=oe?"*":{tbl:j,prop:F,key:Te.k},fe.yDownloadedRealms=De}))})}try{try{for(var G,re=!0,Q=oa(d);!(g=(G=yield rt(Q.next())).done);re=!0){k=G.value,re=!1;const oe=new mr(k);for(;_u(oe);)switch(or(oe)){case Yg:yield rt(N(!0)),C=Ot(oe);break;case Gg:yield rt(N(!1)),j=Ot(oe),F=Ot(oe);break;case Jg:{const Te=vn(oe),fe=nt(oe);K.push({k:Te,u:fe});break}}yield rt(N(!1))}}catch(oe){m={error:oe}}finally{try{re||g||!(b=Q.return)||(yield rt(b.call(Q)))}finally{if(m)throw m.error}}yield rt(N(!0))}catch(oe){throw oe instanceof Ee.DexieError||(yield rt(N(!1))),oe}})})})}const Nf="currentSyncWorker";function Ls(t,e,n,r){return Mf(t,e,n,r).then(i=>(r!=null&&r.justCheckIfNeeded||t.syncStateChangedEvent.next({phase:"in-sync"}),i)).catch(i=>te(this,void 0,void 0,function*(){return r!=null&&r.justCheckIfNeeded?Promise.reject(i):nr&&(r!=null&&r.retryImmediatelyOnFetchError)&&(i==null?void 0:i.name)==="TypeError"&&/fetch/.test(i==null?void 0:i.message)?(t.syncStateChangedEvent.next({phase:"error",error:i}),yield new Promise(o=>setTimeout(o,500)),yield Ls(t,e,n,Object.assign(Object.assign({},r),{retryImmediatelyOnFetchError:!1}))):(yield t.$syncState.update("syncState",{timestamp:new Date,error:""+i}),t.syncStateChangedEvent.next({phase:nr?"error":"offline",error:new Error(""+(i==null?void 0:i.message)||i)}),Promise.reject(i))}))}function Mf(t,e,n){return te(this,arguments,void 0,function*(r,i,o,{isInitialSync:c,cancelToken:l,justCheckIfNeeded:f,purpose:h}={isInitialSync:!1}){var d;if(!(!((d=r.cloud.options)===null||d===void 0)&&d.databaseUrl))throw new Error("Internal error: sync must not be called when no databaseUrl is configured");const{databaseUrl:g}=i,m=yield r.getCurrentUser(),b=m.isLoggedIn?rs(r):[],k=b.map(Z=>r.table(Ma(Z.name))),C=yield r.getPersistedSyncState(),j=m.isLoggedIn,F=j?function(Z,ie){const X=(ie==null?void 0:ie.syncedTables)||[];return rs(Z).filter(de=>!X.includes(de.name))}(r,C):[];Nr(l);const K=F.length>0;if(K){if(f)return!0;yield r.transaction("rw",F,Z=>te(this,void 0,void 0,function*(){Z.idbtrans.disableChangeTracking=!0,Z.idbtrans.disableAccessControl=!0,yield function(ie,X,de){return te(this,void 0,void 0,function*(){const Ae=new Set(de||[]);for(const ce of ie)ce.name==="members"?yield ce.toCollection().modify(ae=>{Ae.has(ae.realmId)||ae.userId&&ae.userId!==ht.userId||(ae.userId=X.userId)}):ce.name==="roles"||(ce.name==="realms"?yield ce.toCollection().modify(ae=>{Ae.has(ae.realmId)||ae.owner!==void 0&&ae.owner!==ht.userId||(ae.owner=X.userId)}):yield ce.toCollection().modify(ae=>{ae.realmId&&Ae.has(ae.realmId)||(ae.owner&&ae.owner!==ht.userId||(ae.owner=X.userId),ae.realmId&&ae.realmId!==ht.userId||(ae.realmId=X.userId))}))})}(F,m,C==null?void 0:C.realms)})),Nr(l)}const[N,G,re,{yMessages:Q,lastUpdateIds:oe}]=yield r.transaction("r",r.tables,()=>te(this,void 0,void 0,function*(){const Z=yield r.getPersistedSyncState();let ie=yield r.$baseRevs.toArray();ie=ie.filter(Ae=>b.some(ce=>ce.name===Ae.tableName));let X=yield la(k,r);const de=yield function(Ae,ce){return te(this,void 0,void 0,function*(){const ae=[],Se={};for(const Ge of ce)if(Ge.schema.yProps)for(const Je of Ge.schema.yProps){const Ke=Ae.table(Je.updatesTable),st=yield Ke.get(bn),qe=(st==null?void 0:st.unsentFrom)||1,ee=(st==null?void 0:st.receivedUntil)||0,Ne=Math.min(qe,ee+1),$e=yield jf(Ke,Ne);$e.length>0&&(Se[Ke.name]=$e[$e.length-1].i);const le={};for(const ke of $e){const Ie=(1&(ke.f||0))==1;if(Ie&&ke.i<qe)continue;const Pe=JSON.stringify(ke.k)+"/"+Ie;let gt=le[Pe];gt?(gt.u.push(ke.u),gt.i=Math.max(ke.i,gt.i)):(le[Pe]=gt={i:ke.i,k:ke.k,isLocal:Ie,u:[]},gt.u.push(ke.u))}for(const{k:ke,isLocal:Ie,u:Pe,i:gt}of Object.values(le)){const Sn=Pe.length===1?Pe[0]:fs(Pe);if(Ie)ae.push({type:"u-c",table:Ge.name,prop:Je.prop,k:ke,u:Sn,i:gt});else{const Rt=Yu(Sn);ae.push({type:"sv",table:Ge.name,prop:Je.prop,k:ke,sv:Rt})}}}return{yMessages:ae,lastUpdateIds:Se}})}(r,b);if(Nr(l),K){const Ae=[...(C==null?void 0:C.realms)||[],...(C==null?void 0:C.inviteRealms)||[]],ce=yield function(ae,Se,Ge,Je){return te(this,void 0,void 0,function*(){const Ke=`upload-${kf(8)}`;if(Se.isLoggedIn&&ae.length>0){const st=new Set(Je||[]);return(yield Promise.all(ae.map(qe=>te(this,void 0,void 0,function*(){const{extractKey:ee}=qe.core.schema.primaryKey;if(!ee)return{table:qe.name,muts:[]};const Ne=Ge[qe.name],$e=Ne!=null&&Ne.generatedGlobalId?qe.filter(ke=>{return ee(ke),!st.has(ke.realmId||"")&&(Ie=ee(ke),!(Pe=Ne==null?void 0:Ne.idPrefix)||typeof Ie=="string"&&Ie.startsWith(Pe));var Ie,Pe}):qe.filter(ke=>{const Ie=ee(ke);return!st.has(ke.realmId||"")&&Ba(Ie)}),le=yield $e.toArray();if(le.length>0){const ke={type:"upsert",values:le,keys:le.map(ee),userId:Se.userId,txid:Ke};return{table:qe.name,muts:[ke]}}return{table:qe.name,muts:[]}})))).filter(qe=>qe.muts.length>0)}return[]})}(F,m,o,Ae);return Nr(l),X=X.concat(ce),[X,Z,ie,de]}return[X,Z,ie,de]})),Te=N.some(Z=>Z.muts.some(ie=>ie.keys.length>0))||Q.some(Z=>Z.type==="u-c");if(f)return Te;if(h==="push"&&!Te)return!1;const fe=ya(N,G==null?void 0:G.latestRevisions),De=(G==null?void 0:G.clientIdentity)||Sf(16);Nr(l);const H=yield Hg(N,Q,G,re,r,g,o,De,m),{done:ue,newSyncState:we}=yield r.transaction("rw",r.tables,Z=>te(this,void 0,void 0,function*(){Z.idbtrans.disableChangeTracking=!0,Z.idbtrans.disableAccessControl=!0;for(const ce of Object.keys(o))H.schema[ce]&&(o[ce]=H.schema[ce]);yield r.$syncState.put(o,"schema");const ie=yield la(k,r,{since:fe});for(const ce of k){const ae=_f(ce.name);if(ie.some(Se=>Se.table===ae&&Se.muts.length>0)){if(fe[ae]){const Se=fe[ae]||0;yield Promise.all([ce.where("rev").belowOrEqual(Se).delete(),r.$baseRevs.where(":id").between([ae,-1/0],[ae,Se+1],!0,!0).reverse().offset(1).delete()])}}else yield Promise.all([ce.clear(),r.$baseRevs.where({tableName:ae}).delete()])}ya(ie,fe),yield Pf(r,o,fe,H.serverRevision);const X=yield r.getPersistedSyncState();yield function(ce,ae,Se){return te(this,void 0,void 0,function*(){const Ge=new Set,Je=new Set,Ke=Se?Se.realms:[],st=Se?Se.inviteRealms:[],qe=new Set(ae.realms),ee=new Set(ae.realms.concat(ae.inviteRealms));for(const Ne of Ke)qe.has(Ne)||(Je.add(Ne),ee.has(Ne)||Ge.add(Ne));for(const Ne of st.concat(Ke))ee.has(Ne)||Ge.add(Ne);if(Ge.size>0||Je.size>0){const Ne=rs(ce);for(const $e of Ne){let le=["realms","members","roles"].includes($e.name)?Ge:Je;le.size!==0&&($e.schema.indexes.some(ke=>ke.keyPath==="realmId"||Array.isArray(ke.keyPath)&&ke.keyPath[0]==="realmId")?yield $e.where("realmId").anyOf([...le]).delete():yield $e.filter(ke=>!!(ke!=null&&ke.realmId)&&le.has(ke.realmId)).delete())}}if(Je.size>0&&(Se!=null&&Se.yDownloadedRealms))for(const Ne of Je)delete Se.yDownloadedRealms[Ne]})}(r,H,X);const de=X||{syncedTables:[],latestRevisions:{},realms:[],inviteRealms:[],clientIdentity:De};j&&(de.syncedTables=b.map(ce=>ce.name).concat(F.map(ce=>ce.name))),de.latestRevisions=fe,de.remoteDbId=H.dbId,de.initiallySynced=!0,de.realms=H.realms,de.inviteRealms=H.inviteRealms,de.serverRevision=H.serverRevision,de.yServerRevision=H.serverRevision,de.timestamp=new Date,delete de.error;const Ae=Kf(H.changes,ie);if(yield Uf(Ae,r),H.yMessages){const{receivedUntils:ce,resyncNeeded:ae,yServerRevision:Se}=yield Lf(H.yMessages,r);Se&&(de.yServerRevision=Se),yield function(Ge,Je,Ke){return te(this,void 0,void 0,function*(){var st,qe,ee,Ne,$e;const le={};for(const[Ie,Pe]of Object.entries(Ge))(st=le[Ie])!==null&&st!==void 0||(le[Ie]={}),le[Ie].unsentFrom=Pe+1;for(const[Ie,Pe]of Object.entries(Je))(qe=le[Ie])!==null&&qe!==void 0||(le[Ie]={}),le[Ie].receivedUntil=Pe;const ke=Object.values(Ke.dx._dbSchema).filter(Ie=>Ie.yProps).map(Ie=>Ie.yProps.map(Pe=>Pe.updatesTable)).flat();for(const Ie of ke){const Pe=le[Ie],gt=(ee=Pe==null?void 0:Pe.unsentFrom)!==null&&ee!==void 0?ee:1,Sn=($e=(Ne=Pe==null?void 0:Pe.receivedUntil)!==null&&Ne!==void 0?Ne:(yield Ke.table(Ie).where("i").between(1,1/0).reverse().limit(1).primaryKeys())[0])!==null&&$e!==void 0?$e:0;yield Ke.transaction("rw",Ie,()=>te(this,void 0,void 0,function*(){const Rt=yield Ke.table(Ie).get(bn);Rt?(Rt.unsentFrom=Math.max(gt,Rt.unsentFrom||1),Rt.receivedUntil=Math.max(Sn,Rt.receivedUntil||0),yield Ke.table(Ie).put(Rt)):yield Ke.table(Ie).add({i:bn,unsentFrom:gt,receivedUntil:Sn})}))}})}(oe,ce,r),ae&&(de.yDownloadedRealms={})}return r.$syncState.put(de,"syncState"),{done:ie.length===0,newSyncState:de}}));if(!ue)return yield Rf(r),yield Mf(r,i,o,{isInitialSync:c,cancelToken:l});const _e=Object.values(o).some(Z=>{var ie;return(ie=Z.yProps)===null||ie===void 0?void 0:ie.length}),ge=!!H.yMessages;if(_e&&ge)try{yield Xg(r,g,we)}catch{}return r.syncCompleteEvent.next(),!1})}function Kf(t,e){const n={};pl(n,t);const r={};return pl(r,e),function(i,o){var c,l,f;for(const[h,d]of Object.entries(o))for(const[g,m]of Object.entries(d))switch(m.type){case"ups":{const b=(c=i[h])===null||c===void 0?void 0:c[g];if(b)switch(b.type){case"ups":case"upd":delete i[h][g]}}break;case"del":(l=i[h])===null||l===void 0||delete l[g];break;case"upd":{const b=(f=i[h])===null||f===void 0?void 0:f[g];if(b)switch(b.type){case"ups":for(const[k,C]of Object.entries(m.mod))vs(b.val,k,C);break;case"del":break;case"upd":for(const k of Object.keys(m.mod))delete b.mod[k]}break}}}(n,r),function(i,o=""){o||(o=Sf(16));const c={};for(const[f,h]of Object.entries(i))for(const[d,g]of Object.entries(h)){const m=c[f]||(c[f]={});(m[g.type]||(m[g.type]=[])).push(Object.assign({key:d},g))}const l=[];for(const[f,h]of Object.entries(c)){const d={table:f,muts:[]};for(const[g,m]of Object.entries(h))switch(g){case"ups":{const b={type:"upsert",keys:m.map(k=>k.key),values:m.map(k=>k.val),txid:o};d.muts.push(b);break}case"upd":{const b={type:"update",keys:m.map(k=>k.key),changeSpecs:m.map(k=>k.mod),txid:o};d.muts.push(b);break}case"del":{const b={type:"delete",keys:m.map(k=>k.key),txid:o};d.muts.push(b);break}}l.push(d)}return l}(n)}const Qg=10,Zg=1e4,em=1e3;function tm(t){const e=[],n=new Tt(!0),r=new Tt(null);let i=!1,o=new Array(Qg).fill(0);return r.subscribe(()=>te(this,void 0,void 0,function*(){if(!i&&e.length>0){i=!0,o.shift(),o.push(Date.now()),n.next(!1);try{yield function(){return te(this,void 0,void 0,function*(){for(var c,l,f,h,d,g;e.length>0;){const m=e.shift();try{yield Un(t.cloud.syncState.pipe(Ct(({phase:k})=>k==="in-sync"||k==="error")));const b=t.cloud.persistedSyncState.value;if(!m)continue;switch(m.type){case"token-expired":const k=t.cloud.currentUser.value,C=yield js(t.cloud.options.databaseUrl,k);yield t.table("$logins").update(k.userId,{accessToken:C.accessToken,accessTokenExpiration:C.accessTokenExpiration,claims:C.claims,license:C.license,data:C.data});break;case"realm-added":!((c=b==null?void 0:b.realms)===null||c===void 0)&&c.includes(m.realm)||!((l=b==null?void 0:b.inviteRealms)===null||l===void 0)&&l.includes(m.realm)||(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-accepted":!((f=b==null?void 0:b.realms)===null||f===void 0)&&f.includes(m.realm)||(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realm-removed":(!((h=b==null?void 0:b.realms)===null||h===void 0)&&h.includes(m.realm)||!((d=b==null?void 0:b.inviteRealms)===null||d===void 0)&&d.includes(m.realm))&&(yield t.cloud.sync({purpose:"pull",wait:!0}));break;case"realms-changed":yield t.cloud.sync({purpose:"pull",wait:!0});break;case"changes":if(((g=t.cloud.syncState.value)===null||g===void 0?void 0:g.phase)==="error"){Jt(t,"pull");break}yield t.transaction("rw",t.dx.tables,j=>te(this,void 0,void 0,function*(){j.idbtrans.disableChangeTracking=!0,j.idbtrans.disableAccessControl=!0;const[F,K,N]=yield Promise.all([t.getSchema(),t.getPersistedSyncState(),t.getCurrentUser()]);if(!K||!F||!N)return;if(m.baseRev!==K.serverRevision)return void(typeof m.baseRev!="string"||typeof K.serverRevision!="bigint"&&typeof K.serverRevision!="object"||Jt(t,"pull"));if((yield Ee.waitFor(ca(K)))!==m.realmSetHash)return void Jt(t,"pull");let G=[];if(N.isLoggedIn){const re=rs(t).map(Q=>t.table(Ma(Q.name)));G=yield la(re,t)}if(m.changes.length>0){const re=Kf(m.changes,G);yield Uf(re,t)}K.latestRevisions=ya(G,K.latestRevisions),K.serverRevision=m.newRev,yield Pf(t,F,K.latestRevisions,m.newRev),yield t.$syncState.put(K,"syncState")}))}}catch{}}})}()}finally{o[o.length-1]-o[0]<Zg&&(yield new Promise(c=>setTimeout(c,em))),i=!1,n.next(!0)}}})),{enqueue:function(c){e.push(c),r.next(null)},readyToServe:n}}const _l=new WeakMap,Hi={members:"@id, [userId+realmId], [email+realmId], realmId",roles:"[realmId+name]",realms:"@realmId",$jobs:"",$syncState:"",$baseRevs:"[tableName+clientRev]",$logins:"claims.sub, lastLogin"};let nm=0;function Nt(t){"vip"in t&&(t=t.vip);let e=_l.get(t.cloud);if(!e){const n=new Nn;let r=new Wi(`syncstatechanged-${t.name}`),i=new Wi(`synccomplete-${t.name}`);n.id=++nm;let o=!1;e={get name(){return t.name},close:()=>t.close(),transaction:t.transaction.bind(t),table:t.table.bind(t),get tables(){return t.tables},cloud:t.cloud,get $jobs(){return t.table("$jobs")},get $syncState(){return t.table("$syncState")},get $baseRevs(){return t.table("$baseRevs")},get $logins(){return t.table("$logins")},get realms(){return t.realms},get members(){return t.members},get roles(){return t.roles},get initiallySynced(){return o},localSyncEvent:n,get syncStateChangedEvent(){return r},get syncCompleteEvent(){return i},dx:t},Object.assign(e,{getCurrentUser:()=>e.$logins.toArray().then(l=>l.find(f=>f.isLoggedIn)||ht),getPersistedSyncState:()=>e.$syncState.get("syncState"),getSchema:()=>e.$syncState.get("schema").then(l=>{if(l)for(const h of e.tables)h.schema.primKey&&h.schema.primKey.keyPath&&l[h.name]&&(l[h.name].primaryKey=typeof(f=h.schema.primKey.keyPath)=="string"?f:f?"["+[].join.call(f,"+")+"]":"");var f;return l}),getOptions:()=>e.$syncState.get("options"),setInitiallySynced(l){o=l},reconfigure(){r=new Wi(`syncstatechanged-${t.name}`),i=new Wi(`synccomplete-${t.name}`)}}),e.messageConsumer=tm(e),e.messageProducer=new Nn,_l.set(t.cloud,e)}return e}const kl=new WeakMap;class Fa{constructor(e,n){kl.set(this,e),Object.assign(this,n)}static load(e,n){return e.table("$logins").get(n).then(r=>new Fa(e,r||{userId:n,claims:{sub:n},lastLogin:new Date(0)}))}save(){return te(this,void 0,void 0,function*(){kl.get(this).table("$logins").put(this)})}}function Bf(t,e){return Un(_t(t).pipe(Ct(e)))}function Ff(t){return te(this,void 0,void 0,function*(){const e=yield ga(t);if(e){if(!(yield function(n,r,i){return te(this,void 0,void 0,function*(){const o=[{type:"warning",messageCode:"LOGOUT_CONFIRMATION",message:`{numUnsyncedChanges} unsynced changes will get lost!
                Logout anyway?`,messageParams:{currentUserId:r,numUnsyncedChanges:i.toString()}}];return yield hi(n,{type:"logout-confirmation",title:"Confirm Logout",alerts:o,fields:{},submitLabel:"Confirm logout",cancelLabel:"Cancel"}).then(()=>!0).catch(()=>!1)})}(t.cloud.userInteraction,t.cloud.currentUserId,e)))throw new Error("User cancelled logout due to unsynced changes");yield ga(t,{deleteUnsyncedData:!0})}})}function ga(t){return te(this,arguments,void 0,function*(e,{deleteUnsyncedData:n=!1}={}){const[r,i]=yield e.dx.transaction("rw",e.dx.tables,o=>te(this,void 0,void 0,function*(){const c=o.idbtrans;c.disableChangeTracking=!0,c.disableAccessControl=!0;const l=o.storeNames.filter(h=>h.endsWith("_mutations")),f=(yield Promise.all(l.map(h=>o.table(h).count()))).reduce((h,d)=>h+d,0);if(f>0&&!n)return[f,!1];e.$syncState.delete("syncState");for(const h of e.dx.tables)h.name!=="$jobs"&&h.name!=="$syncState"&&h.clear();return[f,!0]}));return i&&(yield Bf(e.cloud.currentUser,o=>o.userId===ht.userId),yield e.cloud.sync({purpose:"pull",wait:!0})),r})}function zi(t,...e){globalThis.console[t](...e)}function Ko(t,e){return te(this,void 0,void 0,function*(){var n;const r=yield t.getCurrentUser(),i=r.userId;if(r.isLoggedIn&&(!e||!e.email&&!e.userId)){if((((n=r.license)===null||n===void 0?void 0:n.status)||"ok")==="ok"&&r.accessToken&&(!r.accessTokenExpiration||r.accessTokenExpiration.getTime()>Date.now()))return!1;if(r.refreshToken&&(!r.refreshTokenExpiration||r.refreshTokenExpiration.getTime()>Date.now()))return yield Us(t),!1}const o=new Fa(t,{claims:{},lastLogin:new Date(0)});return yield Ig(t.cloud.options.databaseUrl,o,t.cloud.options.fetchTokens||function(c){const{userInteraction:l}=c.cloud;return function(f){return te(this,arguments,void 0,function*({public_key:h,hints:d}){var g;let m;const b=(g=c.cloud.options)===null||g===void 0?void 0:g.databaseUrl;if(!b)throw new Error("No database URL given.");if((d==null?void 0:d.grant_type)==="demo")m={demo_user:yield yl(l,"Enter a demo user email",(d==null?void 0:d.email)||(d==null?void 0:d.userId)),grant_type:"demo",scopes:["ACCESS_DB"],public_key:h};else if(d!=null&&d.otpId&&d.otp)m={grant_type:"otp",otp_id:d.otpId,otp:d.otp,scopes:["ACCESS_DB"],public_key:h};else{const j=yield yl(l,"Enter email address",d==null?void 0:d.email);m=/@demo.local$/.test(j)?{demo_user:j,grant_type:"demo",scopes:["ACCESS_DB"],public_key:h}:{email:j,grant_type:"otp",scopes:["ACCESS_DB"]}}const k=yield fetch(`${b}/token`,{body:JSON.stringify(m),method:"post",headers:{"Content-Type":"application/json",mode:"cors"}});if(k.status!==200){const j=yield k.text();throw yield fa(l,"Token request failed",{type:"error",messageCode:"GENERIC_ERROR",message:j,messageParams:{}}).catch(()=>{}),new ha(k,j)}const C=yield k.json();if(C.type==="tokens"||C.type==="error")return C;if(m.grant_type==="otp"&&"email"in m){if(C.type!=="otp-sent")throw new Error(`Unexpected response from ${b}/token`);const j=yield gl(l,m.email),F=Object.assign(Object.assign({},m),{otp:j||"",otp_id:C.otp_id,public_key:h});let K=yield fetch(`${b}/token`,{body:JSON.stringify(F),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"});for(;K.status===401;){const N=yield K.text();F.otp=yield gl(l,m.email,{type:"error",messageCode:"INVALID_OTP",message:N,messageParams:{}}),K=yield fetch(`${b}/token`,{body:JSON.stringify(F),method:"post",headers:{"Content-Type":"application/json"},mode:"cors"})}if(K.status!==200){const N=yield K.text();throw new ha(K,N)}return yield K.json()}throw new Error(`Unexpected response from ${b}/token`)})}}(t),t.cloud.userInteraction,e),i!==ht.userId&&o.userId!==i&&(yield Ff(t)),yield function(c,l){return te(this,void 0,void 0,function*(){const f=c.table("$logins");yield c.transaction("rw",f,h=>te(this,void 0,void 0,function*(){const d=yield f.toArray();yield Promise.all(d.filter(g=>g.userId!==l.userId&&g.isLoggedIn).map(g=>(g.isLoggedIn=!1,f.put(g)))),l.isLoggedIn=!0,l.lastLogin=new Date;try{yield l.save()}catch(g){try{g.name==="DataCloneError"&&(zi("debug","Login context property names:",Object.keys(l)),zi("debug","Login context property names:",Object.keys(l)),zi("debug","Login context:",l),zi("debug","Login context JSON:",JSON.stringify(l)))}catch{}throw g}})),yield Bf(c.cloud.currentUser,h=>h.userId===l.userId)})}(t,o),Jt(t,"pull"),o.userId!==i})}const rm=typeof InstallTrigger<"u",$f=typeof navigator<"u"&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\/|Edge\//.test(navigator.userAgent),im=$f?[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]:NaN,qf=$f&&im<=605||rm,sm=typeof self<"u"&&"clients"in self&&!self.document,{toString:om}={};function Sl(t){return om.call(t).slice(8,-1)}function Bo(t,e){var n;return e.type==="delete"?e.keys:((n=e.keys)===null||n===void 0?void 0:n.slice())||e.values.map(t.extractKey)}const am=/b|c|d|f|g|h|j|k|l|m|n|p|q|r|s|t|v|x|y|z/i;let Yt=0;function Vf(t,e){const n=new Uint8Array(18),r=new Uint8Array(n.buffer,0,6),i=Date.now();Yt>=i?++Yt:Yt=i,r[0]=Yt/1099511627776,r[1]=Yt/4294967296,r[2]=Yt/16777216,r[3]=Yt/65536,r[4]=Yt/256,r[5]=Yt;const o=new Uint8Array(n.buffer,6);return crypto.getRandomValues(o),t+Cf(new Uint8Array(n.buffer))+(e||"")}function cm(t){return{stack:"dbcore",name:"idGenerationMiddleware",level:1,create:e=>Object.assign(Object.assign({},e),{table:n=>{const r=e.table(n);return Object.assign(Object.assign({},r),{mutate:i=>{var o,c;const l=i.trans;if(l.mode==="versionchange"&&(l.disableChangeTracking=!0,l.disableAccessControl=!0),l.disableChangeTracking)return r.mutate(i);if(i.type==="add"||i.type==="put"){const f=(o=t.cloud.schema)===null||o===void 0?void 0:o[n];if(f!=null&&f.generatedGlobalId){if(!((c=t.cloud.options)===null||c===void 0)&&c.databaseUrl&&!t.initiallySynced){const h=Bo(r.schema.primaryKey,i);return r.getMany({keys:h,trans:i.trans,cache:"immutable"}).then(d=>{if(d.length<h.length)throw new Error("Unable to create new objects without an initial sync having been performed.");return r.mutate(i)})}return function(h,d){let g=null;const m=Bo(r.schema.primaryKey,h);return m.forEach((b,k)=>{if(b===void 0){const C=h.values[k].realmId||t.cloud.currentUserId,j=C.substr(C.length-3);m[k]=Vf(d,j),r.schema.primaryKey.outbound||(g||(g=h.values.slice()),g[k]=Ee.deepClone(g[k]),Ee.setByKeyPath(g[k],r.schema.primaryKey.keyPath,m[k]))}else if(typeof b!="string"||!b.startsWith(d)&&!b.startsWith("#"+d))throw new Ee.ConstraintError(`The ID "${b}" is not valid for table "${n}". Primary '@' keys requires the key to be prefixed with "${d}" (or "#${d}).
If you want to generate IDs programmatically, remove '@' from the schema to get rid of this constraint. Dexie Cloud supports custom IDs as long as they are random and globally unique.`)}),r.mutate(Object.assign(Object.assign({},h),{keys:m,values:g||h.values}))}(i,f.idPrefix)}f!=null&&f.markedForSync&&Bo(r.schema.primaryKey,i).forEach((h,d)=>{if(!Ba(h)){const g=Array.isArray(h)?h.map(Sl).join(","):Sl(h);throw new Ee.ConstraintError(`Invalid primary key type ${g} for table ${n}. Tables marked for sync has primary keys of type string or Array of string (and optional numbers)`)}})}return r.mutate(i)}})}})}}let lm=0;function Mr(t,e){return function(n){const{readers:r,writers:i}=n.trans[e]||(n.trans[e]={writers:[],readers:[]}),o=i.length,c=(o>0?i[o-1].then(()=>t(n),()=>t(n)):t(n)).finally(()=>{r.splice(r.indexOf(c))});return r.push(c),c}}function um(t,e){return function(n){const{readers:r,writers:i}=n.trans[e]||(n.trans[e]={writers:[],readers:[]});let o=(i.length>0?i[i.length-1].then(()=>t(n),()=>t(n)):r.length>0?(c=r,new Promise(l=>{c.length===0&&l([]);let f=c.length;const h=new Array(f);c.forEach((d,g)=>Promise.resolve(d).then(m=>h[g]={status:"fulfilled",value:m},m=>h[g]={status:"rejected",reason:m}).then(()=>--f||l(h)))})).then(()=>t(n)):t(n)).finally(()=>{i.shift()});var c;return i.push(o),o}}const Jn=new Tt(new Set);function oi(t){var e,n,r,i;return((e=t.cloud.options)===null||e===void 0?void 0:e.disableEagerSync)||((r=(n=t.cloud.currentUser.value)===null||n===void 0?void 0:n.license)===null||r===void 0?void 0:r.status)!=="ok"||!(!((i=t.cloud.options)===null||i===void 0)&&i.databaseUrl)}function fm({currentUserObservable:t,db:e}){return{stack:"dbcore",name:"MutationTrackingMiddleware",level:1,create:n=>{const r=new Set(n.schema.tables.map(c=>c.name)),i=n.schema.tables.filter(c=>!/^\$/.test(c.name)),o=new Map;for(const c of i){const l=`$${c.name}_mutations`;r.has(l)&&o.set(c.name,n.table(l))}return Object.assign(Object.assign({},n),{transaction:(c,l)=>{let f;if(l==="readwrite"){const h=c.filter(d=>{var g,m;return(m=(g=e.cloud.schema)===null||g===void 0?void 0:g[d])===null||m===void 0?void 0:m.markedForSync}).map(d=>Ma(d));f=n.transaction([...c,...h],l)}else f=n.transaction(c,l);if(l==="readwrite"){f.txid=kf(16),f.opCount=0,f.currentUser=t.value,Jn.value.add(f),Jn.next(Jn.value);const h=()=>{f.removeEventListener("complete",d),f.removeEventListener("error",h),f.removeEventListener("abort",h),Jn.value.delete(f),Jn.next(Jn.value)},d=()=>{f.mutationsAdded&&!oi(e)&&Jt(e,"push"),h()};f.addEventListener("complete",d),f.addEventListener("error",h),f.addEventListener("abort",h)}return f},table:c=>{const l=n.table(c);if(/^\$/.test(c))return c.endsWith("_mutations")?Object.assign(Object.assign({},l),{mutate:g=>(g.type!=="add"&&g.type!=="put"||(g.trans.mutationsAdded=!0),l.mutate(g))}):c==="$logins"?Object.assign(Object.assign({},l),{mutate:g=>l.mutate(g).then(m=>(g.trans.mutationsAdded=!0,m)).catch(m=>Promise.reject(m))}):l;const{schema:f}=l,h=o.get(c);return h?function(g){const m="$lock"+ ++lm;return Object.assign(Object.assign({},g),{count:Mr(g.count,m),get:Mr(g.get,m),getMany:Mr(g.getMany,m),openCursor:Mr(g.openCursor,m),query:Mr(g.query,m),mutate:um(g.mutate,m)})}(Object.assign(Object.assign({},l),{mutate:g=>{var m,b,k;const C=g.trans;return C.txid?C.disableChangeTracking?l.mutate(g):!((b=(m=e.cloud.schema)===null||m===void 0?void 0:m[c])===null||b===void 0)&&b.markedForSync&&(!((k=C.currentUser)===null||k===void 0)&&k.isLoggedIn)?g.type==="deleteRange"?l.query({query:{range:g.range,index:f.primaryKey},trans:g.trans,values:!1}).then(j=>d({type:"delete",keys:j.result,trans:g.trans,criteria:{index:null,range:g.range}})):d(g):l.mutate(g):l.mutate(g)}})):l;function d(g){var m,b;const k=g.trans,C=(b=(m=e.cloud.options)===null||m===void 0?void 0:m.unsyncedProperties)===null||b===void 0?void 0:b[c],{txid:j,currentUser:{userId:F}}=k,{type:K}=g,N=++k.opCount;function G(re){if(!C)return re;let Q=re;for(const oe of Object.keys(re))C.some(Te=>oe===Te||oe.startsWith(Te+"."))&&(Q===re&&(Q=Object.assign({},re)),delete Q[oe]);return Q}return l.mutate(g).then(re=>{var Q;const{numFailures:oe,failures:Te}=re;let fe=K==="delete"?g.keys:re.results,De="values"in g?g.values:[],H="changeSpec"in g?g.changeSpec:void 0,ue="updates"in g?g.updates:void 0,we=!(!ue||!("upsert"in g))&&g.upsert;if(oe&&(fe=fe.filter((ie,X)=>!Te[X]),De=De.filter((ie,X)=>!Te[X])),C){if(De=De.map(ie=>{const X=Object.assign({},ie);for(const de of C)delete X[de];return X}),H&&(H=G(H),Object.keys(H).length===0))return re;if(ue){let ie=ue.changeSpecs.map(G),X={keys:[],changeSpecs:[]};const de=new Fd;let Ae=!1;if(!we){for(let ce=0,ae=ie.length;ce<ae;++ce)Object.keys(ie[ce]).length>0?(X.keys.push(ue.keys[ce]),X.changeSpecs.push(ie[ce]),de.addKey(ue.keys[ce])):Ae=!0;if(ue=X,Ae){let ce=[],ae=[];for(let Se=0,Ge=fe.length;Se<Ge;++Se)de.hasKey(fe[Se])&&(ce.push(fe[Se]),ae.push(De[Se]));fe=ce,De=ae}}}}const _e=Date.now();let ge="criteria"in g&&g.criteria?Object.assign(Object.assign({},g.criteria),{index:g.criteria.index===f.primaryKey.keyPath?null:g.criteria.index}):void 0;if(C&&(ge!=null&&ge.index)){const ie=(Q=f.indexes.find(X=>X.name===ge.index))===null||Q===void 0?void 0:Q.keyPath;(ie?typeof ie=="string"?[ie]:ie:[]).some(X=>C==null?void 0:C.includes(X))&&(ge=void 0)}const Z=g.type==="delete"?{type:"delete",ts:_e,opNo:N,keys:fe,criteria:ge,txid:j,userId:F}:g.type==="add"?{type:"insert",ts:_e,opNo:N,keys:fe,txid:j,userId:F,values:De}:we?{type:"upsert",ts:_e,opNo:N,keys:fe,values:De,changeSpecs:ue.changeSpecs.filter((ie,X)=>!Te[X]),txid:j,userId:F}:ge&&H?{type:"modify",ts:_e,opNo:N,keys:fe,criteria:ge,changeSpec:H,txid:j,userId:F}:H?{type:"update",ts:_e,opNo:N,keys:fe,changeSpecs:fe.map(()=>H),txid:j,userId:F}:ue?{type:"update",ts:_e,opNo:N,keys:ue.keys,changeSpecs:ue.changeSpecs,txid:j,userId:F}:{type:"upsert",ts:_e,opNo:N,keys:fe,values:De,txid:j,userId:F};return"isAdditionalChunk"in g&&g.isAdditionalChunk&&(Z.isAdditionalChunk=!0),fe.length>0||ge?h.mutate({type:"add",trans:k,values:[Z]}).then(()=>(k.mutationsAdded=!0,re)):re})}}})}}}function dm(t,e){return function(n,r){var i;const o=Object.assign(Object.assign({},Hi),n);Object.keys(Hi).forEach(h=>{const d=o[h];if(d==null)throw new Error(`Cannot delete table ${h} as it is needed for access control of Dexie Cloud`);if(!n[h])return;const g=d.split(",").map(k=>k.trim()),m=Hi[h].split(",").map(k=>k.trim()),b=new Set(g.map(k=>k.replace(/([&*]|\+\+)/g,"")));if(g[0]!==m[0])throw new Error(`Cannot override primary key of table ${h}. Please declare it as {${h}: ${JSON.stringify(Hi[h])}`);for(let k=1;k<m.length;++k){const C=m[k];b.has(C.replace(/([&*]|\+\+)/g,""))||(o[h]+=`,${C}`)}});const c=e.cloud.schema||(e.cloud.schema={}),l=new Set;Object.keys(o).forEach(h=>{const d=o[h],g=c[h]||(c[h]={});d!=null?(/^\@/.test(d)&&(o[h]=o[h].substr(1),g.generatedGlobalId=!0,g.idPrefix=function(m,b){let k=m[0].toLocaleLowerCase();for(let K=1,N=m.length;K<N&&k.length<3;++K)(am.test(m[K])||(C=m[K])>="A"&&C<="Z")&&(k+=m[K].toLowerCase());for(var C,j,F;b.has(k);){if(/\d/g.test(k)){if(k=k.substr(0,k.length-1)+(k[k.length-1]+1),!(k.length>3))continue;k=k.substr(0,3)}else if(k.length<3){k+="2";continue}let K=1,N=k;for(;b.has(N)&&K<8;)j=k,N=(1&(F=K)?j[0].toUpperCase():j[0].toLowerCase())+(2&F?j[1].toUpperCase():j[1].toLowerCase())+(4&F?j[2].toUpperCase():j[2].toLowerCase()),++K;if(K<8)k=N;else{let G=k.charCodeAt(2)+1&127;k=k.substr(0,2)+String.fromCharCode(G)}}return k}(h,l),l.add(g.idPrefix)),/^\$/.test(h)||(o[`$${h}_mutations`]="++rev",g.markedForSync=!0),g.deleted&&(g.deleted=!1)):(g.deleted=!0,g.markedForSync=!1,o[`$${h}_mutations`]=null)});const f=t.call(this,o,r);for(const[h,d]of Object.entries(r))if(!((i=d.yProps)===null||i===void 0)&&i.length){const g=c[h];g&&(g.yProps=d.yProps.map(m=>m.prop))}return f}}function Wf(t,e,n){return typeof navigator<"u"&&navigator.locks?navigator.locks.request(t.name+"|"+e,()=>n()):n()}const zr=new Tt(!0),ma=new Tt(!0);zr.pipe(lt(t=>t?Xt(!0):Xt(!1).pipe(hu(2e4))),pu()).subscribe(ma);const Hf=typeof document<"u"?Kt(document,"visibilitychange"):Xt({}),hm=Hf.pipe(Ct(()=>document.visibilityState==="hidden")),pm=Hf.pipe(Ct(()=>document.visibilityState==="visible")),zf=typeof window<"u"?Es(pm,Kt(window,"mousedown"),Kt(window,"mousemove"),Kt(window,"keydown"),Kt(window,"wheel"),Kt(window,"touchmove")):Xt({});typeof document<"u"&&Es(Xt(!0),hm,zf).pipe(bt(()=>document.visibilityState==="visible"),Go(t=>{zr.value!==t&&zr.next(t)}),lt(t=>t?Xt(0).pipe(hu(16e4),Go(()=>zr.next(!1))):Xt(0))).subscribe(()=>{});class ym extends Error{constructor(){super(...arguments),this.name="TokenExpiredError"}}const Yf=new WeakMap,xl=new WeakMap;function Gf(t){let e=xl.get(t);return e||(e=new Nn,xl.set(t,e)),e}class gm extends ze{constructor(e,n,r,i,o,c,l,f){super(h=>new vm(e,n,r,i,o,f,h,c,l))}}let mm=0;class vm extends dr{constructor(e,n,r,i,o,c,l,f,h){super(()=>this.teardown()),this.id=++mm,this.subscriptions=new Set,this.reconnecting=!1,this.db=e,this.databaseUrl=e.cloud.options.databaseUrl,this.rev=n,this.yrev=r,this.realmSetHash=i,this.clientIdentity=o,this.user=c,this.subscriber=l,this.lastUserActivity=new Date,this.messageProducer=f,this.webSocketStatus=h,this.connect()}teardown(){this.disconnect()}disconnect(){if(this.webSocketStatus.next("disconnected"),this.pinger&&(clearInterval(this.pinger),this.pinger=null),this.ws)try{this.ws.close()}catch{}this.ws=null;for(const e of this.subscriptions)e.unsubscribe();this.subscriptions.clear()}reconnect(){if(!this.reconnecting){this.reconnecting=!0;try{this.disconnect()}catch{}this.connect().catch(()=>{}).then(()=>this.reconnecting=!1)}}connect(){return te(this,void 0,void 0,function*(){if(this.lastServerActivity=new Date,this.pauseUntil&&this.pauseUntil>new Date)return;if(this.ws)throw new Error("Called connect() when a connection is already open");if(!this.databaseUrl)throw new Error("Cannot connect without a database URL");if(this.closed)return;const e=this.user.accessTokenExpiration;if(e&&e<new Date)return void this.subscriber.error(new ym);this.webSocketStatus.next("connecting"),this.pinger=setInterval(()=>te(this,void 0,void 0,function*(){if(this.closed)this.teardown();else if(this.ws)try{this.ws.send(JSON.stringify({type:"ping"})),setTimeout(()=>{this.pinger&&(this.closed?this.teardown():this.lastServerActivity<new Date(Date.now()-2e4)&&this.reconnect())},2e4)}catch{this.reconnect()}else this.reconnect()}),3e4);const n=new URL(this.databaseUrl);n.protocol=n.protocol==="http:"?"ws":"wss";const r=new URLSearchParams;if(this.subscriber.closed)return;r.set("v","2"),this.rev&&r.set("rev",this.rev),this.yrev&&r.set("yrev",this.yrev),r.set("realmsHash",this.realmSetHash),r.set("clientId",this.clientIdentity),r.set("dxcv",this.db.cloud.version),this.user.accessToken&&r.set("token",this.user.accessToken);const i=this.ws=new WebSocket(`${n}/changes?${r}`);i.binaryType="arraybuffer",i.onclose=o=>{this.pinger&&this.reconnect()},i.onmessage=o=>{if(this.pinger){this.lastServerActivity=new Date;try{const c=typeof o.data=="string"?si.parse(o.data):function(l){const f=new mr(l),h=Ot(f);if(h==="outdated-server-rev")return{type:h};if(h==="y-complete-sync-done")return{type:h,yServerRev:Ot(f)};const d=Ot(f),g=Ot(f);switch(h){case"u-ack":case"u-reject":return{type:h,table:d,prop:g,i:Number(Gc(f))};default:{const m=vn(f);switch(h){case"in-sync":case"doc-close":return{type:h,table:d,prop:g,k:m};case"aware":return{type:h,table:d,prop:g,k:m,u:nt(f)};case"doc-open":return{type:h,table:d,prop:g,k:m,serverRev:vn(f),sv:vn(f)};case"sv":return{type:h,table:d,prop:g,k:m,sv:nt(f)};case"u-c":return{type:h,table:d,prop:g,k:m,u:nt(f),i:Number(Gc(f))};case"u-s":return{type:h,table:d,prop:g,k:m,u:nt(f),r:f.pos<f.arr.length&&Ot(f)||void 0};default:throw new TypeError(`Unknown message type: ${h}`)}}}}(new Uint8Array(o.data));if(c.type==="error")throw new Error(`Error message from dexie-cloud: ${c.error}`);if(c.type==="aware"){const l=ut.getDocCache(this.db.dx).find(c.table,c.k,c.prop);if(l){const f=(h=>Yf.get(h))(l);f&&vg(f,c.u,"server")}}else if(c.type!=="pong")if(c.type==="doc-open"){const l=ut.getDocCache(this.db.dx).find(c.table,c.k,c.prop);l&&Gf(l).next()}else c.type==="u-ack"||c.type==="u-reject"||c.type==="u-s"||c.type==="in-sync"||c.type==="outdated-server-rev"||c.type==="y-complete-sync-done"?Lf([c],this.db).then(l=>te(this,[l],void 0,function*({resyncNeeded:f,yServerRevision:h,receivedUntils:d}){if(h&&(yield this.db.$syncState.update("syncState",{yServerRevision:h})),c.type==="u-s"&&d){const g=Hr(this.db,c.table,c.prop);if(g){const m=d[g.name];m&&(yield g.update(bn,{receivedUntil:m}))}}f&&(yield this.db.cloud.sync({purpose:"pull",wait:!0}))})):this.subscriber.next(c)}catch(c){this.subscriber.error(c)}}};try{let o=!1;yield new Promise((c,l)=>{i.onopen=f=>{o=!0,c(null)},i.onerror=f=>{if(o)this.reconnect();else{const h=f.error||new Error("WebSocket Error");this.subscriber.error(h),this.webSocketStatus.next("error"),l(h)}}}),this.subscriptions.add(this.messageProducer.subscribe(c=>{var l,f;this.closed||(c.type==="ready"&&this.webSocketStatus.value!=="connected"&&this.webSocketStatus.next("connected"),c.type==="ready"?(this.rev=c.rev,(l=this.ws)===null||l===void 0||l.send(si.stringify(c))):(f=this.ws)===null||f===void 0||f.send(function(h){const d=new yr;switch(It(d,h.type),"table"in h&&It(d,h.table),"prop"in h&&It(d,h.prop),h.type){case"u-ack":case"u-reject":Vc(d,BigInt(h.i));break;case"outdated-server-rev":break;case"y-complete-sync-done":It(d,h.yServerRev);break;default:switch(mn(d,h.k),h.type){case"aware":tt(d,h.u);break;case"doc-open":mn(d,h.serverRev),mn(d,h.sv);break;case"doc-close":break;case"sv":tt(d,h.sv);break;case"u-c":tt(d,h.u),Vc(d,BigInt(h.i));break;case"u-s":tt(d,h.u),It(d,h.r||"")}}return wt(d)}(c)))})),this.user.isLoggedIn&&!oi(this.db)&&this.subscriptions.add(function(c){const l=Ka(c.tables.filter(f=>{var h,d;return((d=(h=c.cloud.schema)===null||h===void 0?void 0:h[f.name])===null||d===void 0?void 0:d.markedForSync)&&f.schema.yProps}).map(f=>f.schema.yProps.map(h=>({table:f.name,ydocProp:h.prop,updatesTable:h.updatesTable}))));return Es(...l.map(({table:f,ydocProp:h,updatesTable:d})=>{const g=c.table(d);return _t(g.get(bn)).pipe(lt(m=>{let b=(m==null?void 0:m.unsentFrom)||1;return _t(yn(()=>te(this,void 0,void 0,function*(){return(yield jf(g,b)).filter(k=>k.f&&1&k.f).map(k=>({type:"u-c",table:f,prop:h,k:k.k,u:k.u,i:k.i}))}))).pipe(Go(k=>{k.length>0&&(b=k.at(-1).i+1)}))}))})).pipe(ci(f=>f))}(this.db).subscribe(this.db.messageProducer))}catch{this.pauseUntil=new Date(Date.now()+6e4)}})}}class bm extends Error{constructor(e){super(e==="expired"?"License expired":e==="deactivated"?"User deactivated":"Invalid license"),this.name="InvalidLicenseError",e&&(this.license=e)}}function wm(t){return te(this,void 0,void 0,function*(){var e;yield(e=3e3,new Promise(n=>setTimeout(n,e))),yield Un(zf)})}function El(t){return te(this,void 0,void 0,function*(){var e;return!(!(!((e=t.cloud.options)===null||e===void 0)&&e.databaseUrl)||!t.cloud.schema)&&(yield Ls(t,t.cloud.options,t.cloud.schema,{justCheckIfNeeded:!0}))})}const Yi=new WeakMap;function $a(t,e,n,r){const i=Yi.get(t);if(i){if(i.pull||(r==null?void 0:r.purpose)==="push")return i.promise;{let c=!1;const l=t.cloud.syncState.subscribe(f=>{f.phase==="pulling"&&(c=!0)});return i.promise.then(()=>{l.unsubscribe()}).catch(f=>(l.unsubscribe(),Promise.reject(f))).then(()=>{if(!c)return $a(t,e,n,r)})}}const o=function(){return te(this,void 0,void 0,function*(){try{yield Rf(t),yield Wf(t,Nf,()=>Ls(t,e,n,r)),Yi.delete(t)}catch(c){throw Yi.delete(t),c}})}();return Yi.set(t,{promise:o,pull:(r==null?void 0:r.purpose)!=="push"}),o}const _m=1e3;function km(t,e,n){let r=null,i={cancelled:!1},o=0,c=0;function l(b=1){setTimeout(()=>{const k=f?"pull":"push";c=Date.now(),$a(t,e,n,{cancelToken:i,retryImmediatelyOnFetchError:!0,purpose:k}).then(()=>{if(i.cancelled)m();else if(f||h)return f=!1,h=!1,l();d=!1,o=0,c=0}).catch(C=>{if(i.cancelled)m(),d=!1,o=0,c=0;else if(b<5){const j=[0,20,40,300,900][b]*_m;o=Date.now()+j,c=0,setTimeout(()=>l(b+1),j)}else d=!1,o=0,c=0})},0)}let f=!1,h=!1,d=!1;const g=b=>{i.cancelled||(b==="pull"&&(f=!0),b==="push"&&(h=!0),d?o||c>0&&Date.now():(d=!0,l()))},m=()=>{i.cancelled=!0,r&&r.unsubscribe()};return{start:()=>{r=t.localSyncEvent.subscribe(({purpose:b})=>{g(b||"pull")})},stop:m}}function Fo(t,e){if(t&&e&&e.unsyncedTables)for(const n of e.unsyncedTables)t[n]&&(t[n].markedForSync=!1)}var Ns,ve,Jf,Yr,Cl,bs={},Xf=[],Sm=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function hn(t,e){for(var n in e)t[n]=e[n];return t}function Qf(t){var e=t.parentNode;e&&e.removeChild(t)}function Ve(t,e,n){var r,i,o,c={};for(o in e)o=="key"?r=e[o]:o=="ref"?i=e[o]:c[o]=e[o];if(arguments.length>2&&(c.children=arguments.length>3?Ns.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(o in t.defaultProps)c[o]===void 0&&(c[o]=t.defaultProps[o]);return is(t,c,r,i,null)}function is(t,e,n,r,i){var o={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:i??++Jf};return i==null&&ve.vnode!=null&&ve.vnode(o),o}function ur(t){return t.children}function Gr(t,e){this.props=t,this.context=e}function fr(t,e){if(e==null)return t.__?fr(t.__,t.__.__k.indexOf(t)+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?fr(t):null}function Zf(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Zf(t)}}function Il(t){(!t.__d&&(t.__d=!0)&&Yr.push(t)&&!ws.__r++||Cl!==ve.debounceRendering)&&((Cl=ve.debounceRendering)||setTimeout)(ws)}function ws(){for(var t;ws.__r=Yr.length;)t=Yr.sort(function(e,n){return e.__v.__b-n.__v.__b}),Yr=[],t.some(function(e){var n,r,i,o,c,l;e.__d&&(c=(o=(n=e).__v).__e,(l=n.__P)&&(r=[],(i=hn({},o)).__v=o.__v+1,qa(l,o,i,n.__n,l.ownerSVGElement!==void 0,o.__h!=null?[c]:null,r,c??fr(o),o.__h),rd(r,o),o.__e!=c&&Zf(o)))})}function ed(t,e,n,r,i,o,c,l,f,h){var d,g,m,b,k,C,j,F=r&&r.__k||Xf,K=F.length;for(n.__k=[],d=0;d<e.length;d++)if((b=n.__k[d]=(b=e[d])==null||typeof b=="boolean"?null:typeof b=="string"||typeof b=="number"||typeof b=="bigint"?is(null,b,null,null,b):Array.isArray(b)?is(ur,{children:b},null,null,null):b.__b>0?is(b.type,b.props,b.key,null,b.__v):b)!=null){if(b.__=n,b.__b=n.__b+1,(m=F[d])===null||m&&b.key==m.key&&b.type===m.type)F[d]=void 0;else for(g=0;g<K;g++){if((m=F[g])&&b.key==m.key&&b.type===m.type){F[g]=void 0;break}m=null}qa(t,b,m=m||bs,i,o,c,l,f,h),k=b.__e,(g=b.ref)&&m.ref!=g&&(j||(j=[]),m.ref&&j.push(m.ref,null,b),j.push(g,b.__c||k,b)),k!=null?(C==null&&(C=k),typeof b.type=="function"&&b.__k===m.__k?b.__d=f=td(b,f,t):f=nd(t,b,m,F,k,f),typeof n.type=="function"&&(n.__d=f)):f&&m.__e==f&&f.parentNode!=t&&(f=fr(m))}for(n.__e=C,d=K;d--;)F[d]!=null&&(typeof n.type=="function"&&F[d].__e!=null&&F[d].__e==n.__d&&(n.__d=fr(r,d+1)),sd(F[d],F[d]));if(j)for(d=0;d<j.length;d++)id(j[d],j[++d],j[++d])}function td(t,e,n){for(var r,i=t.__k,o=0;i&&o<i.length;o++)(r=i[o])&&(r.__=t,e=typeof r.type=="function"?td(r,e,n):nd(n,r,r,i,r.__e,e));return e}function nd(t,e,n,r,i,o){var c,l,f;if(e.__d!==void 0)c=e.__d,e.__d=void 0;else if(n==null||i!=o||i.parentNode==null)e:if(o==null||o.parentNode!==t)t.appendChild(i),c=null;else{for(l=o,f=0;(l=l.nextSibling)&&f<r.length;f+=2)if(l==i)break e;t.insertBefore(i,o),c=o}return c!==void 0?c:i.nextSibling}function Ol(t,e,n){e[0]==="-"?t.setProperty(e,n):t[e]=n==null?"":typeof n!="number"||Sm.test(e)?n:n+"px"}function Gi(t,e,n,r,i){var o;e:if(e==="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||Ol(t.style,e,"");if(n)for(e in n)r&&n[e]===r[e]||Ol(t.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")o=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in t?e.toLowerCase().slice(2):e.slice(2),t.l||(t.l={}),t.l[e+o]=n,n?r||t.addEventListener(e,o?Dl:Al,o):t.removeEventListener(e,o?Dl:Al,o);else if(e!=="dangerouslySetInnerHTML"){if(i)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n!=null&&(n!==!1||e[0]==="a"&&e[1]==="r")?t.setAttribute(e,n):t.removeAttribute(e))}}function Al(t){this.l[t.type+!1](ve.event?ve.event(t):t)}function Dl(t){this.l[t.type+!0](ve.event?ve.event(t):t)}function qa(t,e,n,r,i,o,c,l,f){var h,d,g,m,b,k,C,j,F,K,N,G,re,Q=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(f=n.__h,l=e.__e=n.__e,e.__h=null,o=[l]),(h=ve.__b)&&h(e);try{e:if(typeof Q=="function"){if(j=e.props,F=(h=Q.contextType)&&r[h.__c],K=h?F?F.props.value:h.__:r,n.__c?C=(d=e.__c=n.__c).__=d.__E:("prototype"in Q&&Q.prototype.render?e.__c=d=new Q(j,K):(e.__c=d=new Gr(j,K),d.constructor=Q,d.render=Em),F&&F.sub(d),d.props=j,d.state||(d.state={}),d.context=K,d.__n=r,g=d.__d=!0,d.__h=[]),d.__s==null&&(d.__s=d.state),Q.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=hn({},d.__s)),hn(d.__s,Q.getDerivedStateFromProps(j,d.__s))),m=d.props,b=d.state,g)Q.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(Q.getDerivedStateFromProps==null&&j!==m&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(j,K),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(j,d.__s,K)===!1||e.__v===n.__v){d.props=j,d.state=d.__s,e.__v!==n.__v&&(d.__d=!1),d.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(oe){oe&&(oe.__=e)}),d.__h.length&&c.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(j,d.__s,K),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(m,b,k)})}if(d.context=K,d.props=j,d.__v=e,d.__P=t,N=ve.__r,G=0,"prototype"in Q&&Q.prototype.render)d.state=d.__s,d.__d=!1,N&&N(e),h=d.render(d.props,d.state,d.context);else do d.__d=!1,N&&N(e),h=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++G<25);d.state=d.__s,d.getChildContext!=null&&(r=hn(hn({},r),d.getChildContext())),g||d.getSnapshotBeforeUpdate==null||(k=d.getSnapshotBeforeUpdate(m,b)),re=h!=null&&h.type===ur&&h.key==null?h.props.children:h,ed(t,Array.isArray(re)?re:[re],e,n,r,i,o,c,l,f),d.base=e.__e,e.__h=null,d.__h.length&&c.push(d),C&&(d.__E=d.__=null),d.__e=!1}else o==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=xm(n.__e,e,n,r,i,o,c,f);(h=ve.diffed)&&h(e)}catch(oe){e.__v=null,(f||o!=null)&&(e.__e=l,e.__h=!!f,o[o.indexOf(l)]=null),ve.__e(oe,e,n)}}function rd(t,e){ve.__c&&ve.__c(e,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(r){r.call(n)})}catch(r){ve.__e(r,n.__v)}})}function xm(t,e,n,r,i,o,c,l){var f,h,d,g=n.props,m=e.props,b=e.type,k=0;if(b==="svg"&&(i=!0),o!=null){for(;k<o.length;k++)if((f=o[k])&&"setAttribute"in f==!!b&&(b?f.localName===b:f.nodeType===3)){t=f,o[k]=null;break}}if(t==null){if(b===null)return document.createTextNode(m);t=i?document.createElementNS("http://www.w3.org/2000/svg",b):document.createElement(b,m.is&&m),o=null,l=!1}if(b===null)g===m||l&&t.data===m||(t.data=m);else{if(o=o&&Ns.call(t.childNodes),h=(g=n.props||bs).dangerouslySetInnerHTML,d=m.dangerouslySetInnerHTML,!l){if(o!=null)for(g={},k=0;k<t.attributes.length;k++)g[t.attributes[k].name]=t.attributes[k].value;(d||h)&&(d&&(h&&d.__html==h.__html||d.__html===t.innerHTML)||(t.innerHTML=d&&d.__html||""))}if(function(C,j,F,K,N){var G;for(G in F)G==="children"||G==="key"||G in j||Gi(C,G,null,F[G],K);for(G in j)N&&typeof j[G]!="function"||G==="children"||G==="key"||G==="value"||G==="checked"||F[G]===j[G]||Gi(C,G,j[G],F[G],K)}(t,m,g,i,l),d)e.__k=[];else if(k=e.props.children,ed(t,Array.isArray(k)?k:[k],e,n,r,i&&b!=="foreignObject",o,c,o?o[0]:n.__k&&fr(n,0),l),o!=null)for(k=o.length;k--;)o[k]!=null&&Qf(o[k]);l||("value"in m&&(k=m.value)!==void 0&&(k!==t.value||b==="progress"&&!k||b==="option"&&k!==g.value)&&Gi(t,"value",k,g.value,!1),"checked"in m&&(k=m.checked)!==void 0&&k!==t.checked&&Gi(t,"checked",k,g.checked,!1))}return t}function id(t,e,n){try{typeof t=="function"?t(e):t.current=e}catch(r){ve.__e(r,n)}}function sd(t,e,n){var r,i;if(ve.unmount&&ve.unmount(t),(r=t.ref)&&(r.current&&r.current!==t.__e||id(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(o){ve.__e(o,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&sd(r[i],e,typeof t.type!="function");n||t.__e==null||Qf(t.__e),t.__e=t.__d=void 0}function Em(t,e,n){return this.constructor(t,n)}function Tl(t,e,n){var r,i,o;ve.__&&ve.__(t,e),i=(r=!1)?null:e.__k,o=[],qa(e,t=e.__k=Ve(ur,null,[t]),i||bs,bs,e.ownerSVGElement!==void 0,i?null:e.firstChild?Ns.call(e.childNodes):null,o,i?i.__e:e.firstChild,r),rd(o,t)}Ns=Xf.slice,ve={__e:function(t,e,n,r){for(var i,o,c;e=e.__;)if((i=e.__c)&&!i.__)try{if((o=i.constructor)&&o.getDerivedStateFromError!=null&&(i.setState(o.getDerivedStateFromError(t)),c=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,r||{}),c=i.__d),c)return i.__E=i}catch(l){t=l}throw t}},Jf=0,Gr.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=hn({},this.state),typeof t=="function"&&(t=t(hn({},n),this.props)),t&&hn(n,t),t!=null&&this.__v&&(e&&this.__h.push(e),Il(this))},Gr.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),Il(this))},Gr.prototype.render=ur,Yr=[],ws.__r=0;const Mt={Alert:{error:{color:"red",fontWeight:"bold"},warning:{color:"#f80",fontWeight:"bold"},info:{color:"black"}},Darken:{position:"fixed",top:0,left:0,opacity:.5,backgroundColor:"#000",width:"100vw",height:"100vh",zIndex:150,webkitBackdropFilter:"blur(2px)",backdropFilter:"blur(2px)"},DialogOuter:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:150,alignItems:"center",display:"flex",justifyContent:"center",padding:"16px",boxSizing:"border-box"},DialogInner:{position:"relative",color:"#222",backgroundColor:"#fff",padding:"24px",marginBottom:"2em",maxWidth:"400px",width:"100%",maxHeight:"90%",overflowY:"auto",border:"3px solid #3d3d5d",borderRadius:"8px",boxShadow:"0 0 80px 10px #666",fontFamily:"sans-serif",boxSizing:"border-box"},Input:{height:"35px",width:"100%",maxWidth:"100%",borderColor:"#ccf4",outline:"none",fontSize:"16px",padding:"8px",boxSizing:"border-box"},Button:{padding:"10px 20px",margin:"0 4px",border:"1px solid #d1d5db",borderRadius:"6px",backgroundColor:"#ffffff",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#374151",transition:"all 0.2s ease"},PrimaryButton:{padding:"10px 20px",margin:"0 4px",border:"1px solid #3b82f6",borderRadius:"6px",backgroundColor:"#3b82f6",color:"white",cursor:"pointer",fontSize:"14px",fontWeight:"500",transition:"all 0.2s ease"},ButtonsDiv:{display:"flex",justifyContent:"flex-end",gap:"12px",marginTop:"24px",paddingTop:"20px"},Label:{display:"block",marginBottom:"12px",fontSize:"14px",fontWeight:"500",color:"#333"},WindowHeader:{margin:"0 0 20px 0",fontSize:"18px",fontWeight:"600",color:"#333",borderBottom:"1px solid #eee",paddingBottom:"10px"}};function Cm({children:t,className:e}){return Ve("div",{className:`dexie-dialog ${e||""}`},Ve("div",{style:Mt.Darken}),Ve("div",{style:Mt.DialogOuter},Ve("div",{style:Mt.DialogInner},t)))}var Ms,We,$o,Rl,_s=0,od=[],ss=[],Pl=ve.__b,Ul=ve.__r,jl=ve.diffed,Ll=ve.__c,Nl=ve.unmount;function Va(t,e){ve.__h&&ve.__h(We,t,_s||e),_s=0;var n=We.__H||(We.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({__V:ss}),n.__[t]}function Im(t){return _s=1,function(e,n,r){var i=Va(Ms++,2);if(i.t=e,!i.__c&&(i.__=[Kl(void 0,n),function(c){var l=i.__N?i.__N[0]:i.__[0],f=i.t(l,c);l!==f&&(i.__N=[f,i.__[1]],i.__c.setState({}))}],i.__c=We,!We.u)){We.u=!0;var o=We.shouldComponentUpdate;We.shouldComponentUpdate=function(c,l,f){if(!i.__c.__H)return!0;var h=i.__c.__H.__.filter(function(g){return g.__c});if(h.every(function(g){return!g.__N}))return!o||o.call(this,c,l,f);var d=!1;return h.forEach(function(g){if(g.__N){var m=g.__[0];g.__=g.__N,g.__N=void 0,m!==g.__[0]&&(d=!0)}}),!!d&&(!o||o.call(this,c,l,f))}}return i.__N||i.__}(Kl,t)}function Om(t){return _s=5,function(e,n){var r=Va(Ms++,7);return ad(r.__H,n)?(r.__V=e(),r.i=n,r.__h=e,r.__V):r.__}(function(){return{current:t}},[])}function Am(){for(var t;t=od.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(os),t.__H.__h.forEach(va),t.__H.__h=[]}catch(e){t.__H.__h=[],ve.__e(e,t.__v)}}ve.__b=function(t){We=null,Pl&&Pl(t)},ve.__r=function(t){Ul&&Ul(t),Ms=0;var e=(We=t.__c).__H;e&&($o===We?(e.__h=[],We.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=ss,n.__N=n.i=void 0})):(e.__h.forEach(os),e.__h.forEach(va),e.__h=[])),$o=We},ve.diffed=function(t){jl&&jl(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(od.push(e)!==1&&Rl===ve.requestAnimationFrame||((Rl=ve.requestAnimationFrame)||function(n){var r,i=function(){clearTimeout(o),Ml&&cancelAnimationFrame(r),setTimeout(n)},o=setTimeout(i,100);Ml&&(r=requestAnimationFrame(i))})(Am)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==ss&&(n.__=n.__V),n.i=void 0,n.__V=ss})),$o=We=null},ve.__c=function(t,e){e.some(function(n){try{n.__h.forEach(os),n.__h=n.__h.filter(function(r){return!r.__||va(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],ve.__e(r,n.__v)}}),Ll&&Ll(t,e)},ve.unmount=function(t){Nl&&Nl(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{os(r)}catch(i){e=i}}),e&&ve.__e(e,n.__v))};var Ml=typeof requestAnimationFrame=="function";function os(t){var e=We,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),We=e}function va(t){var e=We;t.__c=t.__(),We=e}function ad(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}function Kl(t,e){return typeof e=="function"?e(t):e}function Dm({title:t,type:e,alerts:n,fields:r,submitLabel:i,cancelLabel:o,onCancel:c,onSubmit:l}){const[f,h]=Im({}),d=Om(null);return function(g,m){var b=Va(Ms++,4);!ve.__s&&ad(b.__H,m)&&(b.__=g,b.i=m,We.__h.push(b))}(()=>{var g;return(g=d.current)===null||g===void 0?void 0:g.focus()},[]),Ve(Cm,{className:"dxc-login-dlg"},Ve(ur,null,Ve("h3",{style:Mt.WindowHeader},t),n.map(g=>Ve("p",{style:Mt.Alert[g.type]},function({message:m,messageCode:b,messageParams:k}){return m.replace(/\{\w+\}/gi,C=>k[C.substring(1,C.length-1)])}(g))),Ve("form",{onSubmit:g=>{g.preventDefault(),l(f)}},Object.entries(r).map(([g,{type:m,label:b,placeholder:k}],C)=>Ve("label",{style:Mt.Label,key:C},b?`${b}: `:"",Ve("input",{ref:C===0?d:void 0,type:m,name:g,autoComplete:"on",style:Mt.Input,autoFocus:!0,placeholder:k,value:f[g]||"",onInput:j=>{var F;const K=function(G,re){switch(G){case"email":return re.toLowerCase();case"otp":return re.toUpperCase();default:return re}}(m,(F=j.target)===null||F===void 0?void 0:F.value);let N=Object.assign(Object.assign({},f),{[g]:K});h(N),m==="otp"&&(K==null?void 0:K.trim().length)===8&&l(N)}}))))),Ve("div",{style:Mt.ButtonsDiv},Ve(ur,null,Ve("button",{type:"submit",style:Mt.PrimaryButton,onClick:()=>l(f)},i),o&&Ve("button",{style:Mt.Button,onClick:c},o))))}class Bl extends Gr{constructor(e){super(e),this.observer=n=>this.setState({userInteraction:n}),this.state={userInteraction:void 0}}componentDidMount(){this.subscription=_t(this.props.db.cloud.userInteraction).subscribe(this.observer)}componentWillUnmount(){this.subscription&&(this.subscription.unsubscribe(),delete this.subscription)}render(e,{userInteraction:n}){return n?Ve(Dm,Object.assign({},n)):null}}function pi(t){const e=new WeakMap;return n=>{let r=e.get(n);return r||(r=t(n),e.set(n,r)),r}}const ks=pi(t=>new Tt(ht));function Ks(t,e){let n=e,r=_t(t).pipe(bt(o=>n=o),Wh({resetOnRefCountZero:()=>du(1e3)}));const i=new ze(o=>{let c=!1;const l=r.subscribe({next(f){c=!0,o.next(f)},error(f){o.error(f)},complete(){o.complete()}});return c||l.closed||o.next(n),l});return i.getValue=()=>n,i}const cd=pi(t=>Ks(yn(()=>t.roles.where({realmId:"rlm-public"}).toArray().then(e=>{const n={};for(const r of e.slice().sort((i,o)=>(i.sortOrder||0)-(o.sortOrder||0)))n[r.name]=r;return n})),{})),ld=pi(t=>Ks(ks(t._novip).pipe(lt(e=>yn(()=>t.transaction("r","realms","members",()=>Promise.all([t.members.where({userId:e.userId}).toArray(),t.realms.toArray(),e.userId]).then(([n,r,i])=>({selfMembers:n,realms:r,userId:i})))))),{selfMembers:[],realms:[],get userId(){return t.cloud.currentUserId}}));function Tm(...t){return t.length===0?{}:t.reduce((n,r)=>{const i=Object.assign({},n);for(const[o,c]of Object.entries(r))if(o in i&&i[o]){if(i[o]==="*")continue;if(c==="*")i[o]="*";else if(Array.isArray(c)&&Array.isArray(i[o])){const l=i,f=l[o];l[o]=[...new Set([...f,...c])]}else if(typeof c=="object"&&c&&typeof i[o]=="object"){const l=i[o];for(const[f,h]of Object.entries(c))l[f]!=="*"&&(h==="*"?l[f]="*":Array.isArray(l[f])&&Array.isArray(h)&&(l[f]=[...new Set([...l[f],...h])]))}}else i[o]=r[o];return i})}const ud=pi(t=>function(e,n){let r;const i=e.pipe(bt(o=>r=n(o)));return i.getValue=()=>r!==void 0?r:r=n(e.getValue()),i}(Ks(Xr([ld(t._novip),cd(t._novip)]).pipe(bt(([{selfMembers:e,realms:n,userId:r},i])=>({selfMembers:e,realms:n,userId:r,globalRoles:i}))),{selfMembers:[],realms:[],userId:ht.userId,globalRoles:{}}),({selfMembers:e,realms:n,userId:r,globalRoles:i})=>n.map(c=>{const l=e.filter(d=>d.realmId===c.realmId),f=l.map(d=>d.permissions).filter(d=>d),h=Ka(l.map(d=>d.roles).filter(d=>d)).map(d=>i[d]).filter(d=>d).map(d=>d.permissions);return Object.assign(Object.assign({},c),{permissions:c.owner===r?{manage:"*"}:Tm(...f,...h)})}).reduce((c,l)=>Object.assign(Object.assign({},c),{[l.realmId]:l}),{[r]:{realmId:r,owner:r,name:r,permissions:{manage:"*"}}})));class Fl{constructor(e,n,r){this.permissions=e||{},this.tableName=n,this.isOwner=r}add(...e){var n;return this.permissions.manage==="*"||!!(!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))||this.permissions.add==="*"||!!e.every(r=>{var i;return(i=this.permissions.add)===null||i===void 0?void 0:i.includes(r)})}update(...e){var n,r;if(this.isOwner||this.permissions.manage==="*"||!((n=this.permissions.manage)===null||n===void 0)&&n.includes(this.tableName))return!0;if(this.permissions.update==="*")return e.every(o=>o!=="owner");const i=(r=this.permissions.update)===null||r===void 0?void 0:r[this.tableName];return i==="*"?e.every(o=>o!=="owner"):e.every(o=>i==null?void 0:i.some(c=>c===o||c==="*"&&o!=="owner"))}delete(){var e;return!(!this.isOwner&&this.permissions.manage!=="*")||!!(!((e=this.permissions.manage)===null||e===void 0)&&e.includes(this.tableName))}}const Rm=pi(t=>{const e=ks(t._novip).pipe(lt(i=>yn(()=>t.members.where({email:i.email||""}).toArray()))),n=ud(t._novip),r=ld(t._novip);return Ks(Xr([e,r,n]).pipe(bt(([i,o,c])=>{const l=(d,g)=>Object.assign(Object.assign({},d),{[g.id]:Object.assign(Object.assign({},g),{realm:c[g.realmId]})}),f=i.reduce(l,{}),h=o.selfMembers.reduce(l,f);return Object.values(h).filter(d=>!d.accepted).map(d=>Object.assign(Object.assign({},d),{accept(){return te(this,void 0,void 0,function*(){yield t.members.update(d.id,{accepted:new Date})})},reject(){return te(this,void 0,void 0,function*(){yield t.members.update(d.id,{rejected:new Date})})}}))})),[])});function Pm(t){return e=>{var n;const r=e.doc;if(!r)throw new Error("Internal error: DexieYProvider.createYHandler called without a doc. This is unexpected.");const{parentTable:i}=r.meta||{};if(!(!((n=t.cloud.schema)===null||n===void 0)&&n[i].markedForSync))return;let o;Object.defineProperty(e,"awareness",{get:()=>o||(o=function(c,l,f){const{parentTable:h,parentId:d,parentProp:g,updatesTable:m}=l.meta,b=new gg(l),k=Gf(l);return b.on("update",({added:C,updated:j,removed:F},K)=>{const N=C.concat(j).concat(F),G=c.cloud.currentUser.value;if(K!=="server"&&G.isLoggedIn&&!oi(c)){const re=mg(b,N);c.messageProducer.next({type:"aware",table:h,prop:g,k:l.meta.parentId,u:re}),f.destroyed&&c.messageProducer.next({type:"doc-close",table:h,prop:g,k:l.meta.parentId})}}),b.on("destroy",()=>{bf(b,[l.clientID],"provider destroyed")}),te(this,void 0,void 0,function*(){if(f.destroyed)return;let C=!1,j=1;const F=Xr([c.cloud.webSocketStatus,k.pipe(yu(null))]).subscribe(([N])=>{if(f.destroyed)return;C=N==="connected";const G=c.cloud.currentUser.value;N==="connected"&&G.isLoggedIn&&!oi(c)&&(++j,K().catch(re=>{}))});function K(){return te(this,void 0,void 0,function*(){const N=j,G=c.table(m),re=c.$syncState,[Q,oe]=yield c.transaction("r",re,G,()=>te(this,void 0,void 0,function*(){const De=yield G.get(bn),H=yield re.get("syncState");return[(De==null?void 0:De.receivedUntil)||0,(H==null?void 0:H.yServerRevision)||(H==null?void 0:H.serverRevision)]}));if(f.destroyed||j!==N||!C)return;const Te={type:"doc-open",table:h,prop:g,k:d,serverRev:oe},fe=yield G.where("i").between(Q,1/0,!1).filter(De=>xs(De.k,d)===0&&(1&(De.f||0))==0).toArray();if(!f.destroyed&&j===N&&C){if(fe.length>0){const De=fs(fe.map(ue=>ue.u)),H=Yu(De);Te.sv=H}c.messageProducer.next(Te)}})}f.addCleanupHandler(F)}),b}(t,r,e),Yf.set(r,o),o)})}}const Um={nameSuffix:!0};function ba(t){const e=t.name,n=ks(t),r=[];let i=!1,o=null;t.on("ready",d=>te(this,void 0,void 0,function*(){try{yield function(g){return te(this,void 0,void 0,function*(){var m,b,k,C,j,F,K;c=!1;const N=Nt(g);typeof window<"u"&&typeof document<"u"&&(!((m=N.cloud.options)===null||m===void 0)&&m.customLoginGui||r.push(function(H){let ue=!1;const we=document.createElement("div");return document.body?(document.body.appendChild(we),Tl(Ve(Bl,{db:H.vip}),we)):addEventListener("DOMContentLoaded",()=>{ue||(document.body.appendChild(we),Tl(Ve(Bl,{db:H.vip}),we))}),{unsubscribe(){try{we.remove()}catch{}ue=!0},get closed(){return ue}}}(g))),N.cloud.isServiceWorkerDB||r.push(function(H){let ue=H.cloud.webSocketStatus.value;const we=H.cloud.webSocketStatus.pipe(lt(_e=>{const ge=ue;ue=_e;const Z=Xt(_e);switch(_e){case"disconnected":return zr.value?Z.pipe(Kc(500)):Z;case"connecting":return ge==="not-started"||ge==="error"?Z:Z.pipe(Kc(4e3));default:return Z}}));return Xr([we,H.syncStateChangedEvent.pipe(yu({phase:"initial"})),ks(H.dx._novip),ma]).pipe(bt(([_e,ge,Z,ie])=>{var X;if(!((X=Z.license)===null||X===void 0)&&X.status&&Z.license.status!=="ok")return{phase:"offline",status:"offline",license:Z.license.status};let{phase:de,error:Ae,progress:ce}=ge,ae=_e;return de==="error"&&(ae="error"),_e==="not-started"&&(de!=="pushing"&&de!=="pulling"||(ae="connecting")),H.cloud.syncState.value.phase!=="error"||ge.phase!=="pushing"&&ge.phase!=="pulling"||(ae="connecting"),ie||(ae="disconnected"),{phase:de,error:Ae,progress:ce,status:nr?ae:"offline",license:"ok"}}))}(N).subscribe(g.cloud.syncState)),r.push(N.syncCompleteEvent.subscribe(f)),N.tables.every(H=>H.core)||function(){throw new Ee.SchemaError("Version increment needed to allow dexie-cloud change tracking")}();const G="serviceWorker"in navigator?yield navigator.serviceWorker.getRegistrations():[],[re,Q]=yield N.transaction("rw",N.$syncState,()=>te(this,void 0,void 0,function*(){var H,ue;const{options:we,schema:_e}=N.cloud,[ge,Z,ie]=yield Promise.all([N.getOptions(),N.getSchema(),N.getPersistedSyncState()]);if(i){if(!ge||JSON.stringify(ge)!==JSON.stringify(we)){if(!we)throw new Error("Internal error");const X=Object.assign({},we);delete X.fetchTokens,delete X.awarenessProtocol,yield N.$syncState.put(X,"options")}}else N.cloud.options=ge||null;if(!((H=N.cloud.options)===null||H===void 0)&&H.tryUseServiceWorker&&"serviceWorker"in navigator&&G.length>0&&!qf?N.cloud.usingServiceWorker=!0:(!((ue=N.cloud.options)===null||ue===void 0)&&ue.tryUseServiceWorker&&N.cloud.isServiceWorkerDB,N.cloud.usingServiceWorker=!1),Fo(_e,N.cloud.options),Fo(Z,N.cloud.options),_e){if(!Z||JSON.stringify(Z)!==JSON.stringify(_e)){const X=Z||{};for(const[de,Ae]of Object.entries(_e)){const ce=X[de];ce?(ce.markedForSync=Ae.markedForSync,Ae.deleted=ce.deleted,ce.generatedGlobalId=Ae.generatedGlobalId):X[de]=Object.assign({},Ae)}yield N.$syncState.put(X,"schema"),Object.assign(_e,X)}}else N.cloud.schema=Z||null;return[ie==null?void 0:ie.initiallySynced,ie==null?void 0:ie.realms]}));if(re&&N.setInitiallySynced(!0),function(H){var ue,we;for(const _e of H.tables)if(!((we=(ue=H.cloud.schema)===null||ue===void 0?void 0:ue[_e.name])===null||we===void 0)&&we.markedForSync){if(_e.schema.primKey.auto)throw new Ee.SchemaError(`Table ${_e.name} is both autoIncremented and synced. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(_e.name)}]}) to blacklist it from sync`);if(!_e.schema.primKey.keyPath)throw new Ee.SchemaError(`Table ${_e.name} cannot be both synced and outbound. Use db.cloud.configure({unsyncedTables: [${JSON.stringify(_e.name)}]}) to blacklist it from sync`)}}(N),l(),!N.cloud.isServiceWorkerDB){r.push(yn(()=>N.getCurrentUser()).subscribe(n)),r.push(yn(()=>N.getPersistedSyncState()).subscribe(N.cloud.persistedSyncState)),yield Un(Xr([n.pipe(Bc(1),Xn(1)),N.cloud.persistedSyncState.pipe(Bc(1),Xn(1))]));const H=Pm(N);ut.on.new.subscribe(H),N.dx.once("close",()=>{ut.on.new.unsubscribe(H)})}let oe=!1;const Te=yield N.getCurrentUser(),fe=(b=N.cloud.options)===null||b===void 0?void 0:b.requireAuth;fe&&(N.cloud.isServiceWorkerDB?yield Un(n.pipe(Ct(H=>!!H.isLoggedIn),Xn(1))):typeof fe=="object"?(!Te.isLoggedIn||fe.userId&&Te.userId!==fe.userId||fe.email&&Te.email!==fe.email)&&(oe=yield Ko(N,fe)):Te.isLoggedIn||(oe=yield Ko(N))),!Te.isLoggedIn||Q&&Q.includes(Te.userId)||(oe=!0),o&&o.stop(),o=null,l();const De=((k=N.cloud.options)===null||k===void 0?void 0:k.databaseUrl)&&(!re||oe);De&&(yield function(H,ue,we){return te(this,void 0,void 0,function*(){yield Wf(H,Nf,()=>Ls(H,ue,we,{isInitialSync:!0}))})}(N,N.cloud.options,N.cloud.schema),N.setInitiallySynced(!0)),l(),N.cloud.usingServiceWorker&&(!((C=N.cloud.options)===null||C===void 0)&&C.databaseUrl)?(De||wf(N,"push").catch(()=>{}),function(H){return te(this,void 0,void 0,function*(){var ue;try{const{periodicSync:we}=yield navigator.serviceWorker.ready;if(we)try{yield we.register(`dexie-cloud:${H.name}`,(ue=H.cloud.options)===null||ue===void 0?void 0:ue.periodicSync)}catch{}}catch{}})}(N).catch(()=>{})):!((j=N.cloud.options)===null||j===void 0)&&j.databaseUrl&&N.cloud.schema&&!N.cloud.isServiceWorkerDB&&(o=km(N,N.cloud.options,N.cloud.schema),o.start(),De||Jt(N,"push")),l(),N.cloud.isServiceWorkerDB||r.push(Kt(self,"online").subscribe(()=>{N.syncStateChangedEvent.next({phase:"not-in-sync"}),oi(N)||Jt(N,"push")}),Kt(self,"offline").subscribe(()=>{N.syncStateChangedEvent.next({phase:"offline"})})),!(!((F=N.cloud.options)===null||F===void 0)&&F.databaseUrl)||!((K=N.cloud.options)===null||K===void 0)&&K.disableWebSocket||sm||r.push(function(H){var ue;if(!(!((ue=H.cloud.options)===null||ue===void 0)&&ue.databaseUrl))throw new Error("No database URL to connect WebSocket to");const we=H.messageConsumer.readyToServe.pipe(Ct(ge=>ge),lt(()=>H.getPersistedSyncState()),Ct(ge=>ge&&ge.serverRevision),lt(ge=>te(this,void 0,void 0,function*(){return{type:"ready",rev:ge.serverRevision,realmSetHash:yield ca(ge)}}))),_e=Es(we,H.messageProducer);return function ge(){return H.cloud.persistedSyncState.pipe(Ct(Z=>Z==null?void 0:Z.serverRevision),Xn(1),lt(Z=>H.cloud.currentUser.pipe(bt(ie=>[ie,Z]))),lt(([Z,ie])=>ma.pipe(bt(X=>[X?Z:null,ie]))),lt(([Z,ie])=>Z!=null&&Z.isLoggedIn&&!(ie!=null&&ie.realms.includes(Z.userId))?H.cloud.persistedSyncState.pipe(Ct(X=>(X==null?void 0:X.realms.includes(Z.userId))||!1),Xn(1),bt(X=>[Z,X])):new Tt([Z,ie])),lt(Z=>te(this,[Z],void 0,function*([ie,X]){return[ie,yield ca(X)]})),pu(([Z,ie],[X,de])=>Z===X&&ie===de),lt(([Z,ie])=>{var X;return!((X=H.cloud.persistedSyncState)===null||X===void 0)&&X.value?Z?new gm(H,H.cloud.persistedSyncState.value.serverRevision,H.cloud.persistedSyncState.value.yServerRevision,ie,H.cloud.persistedSyncState.value.clientIdentity,_e,H.cloud.webSocketStatus,Z):_t([]):ge()}),Yo(Z=>(Z==null?void 0:Z.name)==="TokenExpiredError"?Xt(!0).pipe(lt(()=>te(this,void 0,void 0,function*(){const ie=yield H.getCurrentUser(),X=yield js(H.cloud.options.databaseUrl,ie);yield H.table("$logins").update(ie.userId,{accessToken:X.accessToken,accessTokenExpiration:X.accessTokenExpiration,claims:X.claims,license:X.license,data:X.data})})),lt(()=>ge())):jc(()=>Z)),Yo(Z=>(H.cloud.webSocketStatus.next("error"),Z instanceof bm?jc(()=>Z):_t(wm()).pipe(lt(()=>ge())))))}().subscribe({next:ge=>{ge&&H.messageConsumer.enqueue(ge)},error:ge=>{},complete:()=>{}})}(N))})}(d)}catch{}}),!0);let c=!1;function l(){if(c)throw new Ee.DatabaseClosedError}t.once("close",()=>{r.forEach(d=>d.unsubscribe()),r.splice(0,r.length),c=!0,o&&o.stop(),o=null,n.next(ht)});const f=new Nn;var h;t.cloud={version:"4.2.2",options:Object.assign({},Um),schema:null,get currentUserId(){return n.value.userId||ht.userId},currentUser:n,syncState:new Tt({phase:"initial",status:"not-started"}),events:{syncComplete:f},persistedSyncState:new Tt(void 0),userInteraction:new Tt(void 0),webSocketStatus:new Tt("not-started"),login(d){return te(this,void 0,void 0,function*(){const g=Nt(t);yield g.cloud.sync(),yield Ko(g,d)})},invites:Rm(t),roles:cd(t),configure(d){d=t.cloud.options=Object.assign(Object.assign({},t.cloud.options),d),i=!0,d.databaseUrl&&d.nameSuffix&&(t.name=`${e}-${function(g){const m=new URL(g);return m.pathname==="/"?m.hostname.split(".")[0]:m.pathname.split("/")[1]}(d.databaseUrl)}`,Nt(t).reconfigure()),Fo(t.cloud.schema,t.cloud.options)},logout(){return te(this,arguments,void 0,function*({force:d}={}){d?yield ga(Nt(t),{deleteUnsyncedData:!0}):yield Ff(Nt(t))})},sync(){return te(this,arguments,void 0,function*({wait:d,purpose:g}={wait:!0,purpose:"push"}){var m;d===void 0&&(d=!0);const b=Nt(t);if((((m=b.cloud.currentUser.value.license)===null||m===void 0?void 0:m.status)||"ok")!=="ok"&&(yield Us(b)),g==="pull"){const k=b.cloud.persistedSyncState.value;if(Jt(b,g),d){const C=yield Un(b.cloud.persistedSyncState.pipe(Ct(j=>(j==null?void 0:j.timestamp)!=null&&(!k||j.timestamp>k.timestamp))));if(C!=null&&C.error)throw new Error("Sync error: "+C.error)}}else if(yield El(b)){const k=b.cloud.persistedSyncState.value;Jt(b,g),d&&(yield Un(_t(yn(()=>te(this,void 0,void 0,function*(){const C=yield El(b),j=yield b.getPersistedSyncState();if((j==null?void 0:j.timestamp)!==(k==null?void 0:k.timestamp)&&(j!=null&&j.error))throw new Error("Sync error: "+j.error);return C}))).pipe(Ct(C=>!C))))}})},permissions:(d,g)=>function(m,b,k){if(!b)throw new TypeError("Cannot check permissions of undefined or null. A Dexie Cloud object with realmId and owner expected.");const{owner:C,realmId:j}=b;if(!k){if(typeof b.table!="function")throw new TypeError("Missing 'table' argument to permissions and table could not be extracted from entity");k=b.table()}const F=ud(m),K=G=>{const re=G[j||m.cloud.currentUserId];return re?new Fl(re.permissions,k,j===void 0||j===m.cloud.currentUserId||C===m.cloud.currentUserId):new Fl({},k,!C||C===m.cloud.currentUserId)},N=F.pipe(bt(K));return N.getValue=()=>K(F.getValue()),N}(t._novip,d,g)},t.Version.prototype._parseStoresSpec=Ee.override(t.Version.prototype._parseStoresSpec,d=>dm(d,t)),t.Table.prototype.newId=function({colocateWith:d}={}){const g=d&&d.substr(d.length-3);return Vf(t.cloud.schema[this.name].idPrefix||"",g)},t.Table.prototype.idPrefix=function(){var d,g;return((g=(d=this.db.cloud.schema)===null||d===void 0?void 0:d[this.name])===null||g===void 0?void 0:g.idPrefix)||""},t.use(fm({currentUserObservable:t.cloud.currentUser,db:Nt(t)})),t.use((h=Nt(t),{stack:"dbcore",name:"implicitPropSetterMiddleware",level:1,create:d=>Object.assign(Object.assign({},d),{table:g=>{const m=d.table(g);return Object.assign(Object.assign({},m),{mutate:b=>{var k,C,j,F,K,N;const G=b.trans;if(G.disableChangeTracking)return m.mutate(b);const re=(C=(k=G.currentUser)===null||k===void 0?void 0:k.userId)!==null&&C!==void 0?C:ht.userId;if(!((F=(j=h.cloud.schema)===null||j===void 0?void 0:j[g])===null||F===void 0)&&F.markedForSync&&(b.type==="add"||b.type==="put")){if(g==="members")for(const Q of b.values)typeof Q.email=="string"&&(Q.email=Q.email.trim().toLowerCase());for(const Q of b.values){Q.owner||(Q.owner=re),Q.realmId||(Q.realmId=re);const oe=(N=(K=m.schema.primaryKey).extractKey)===null||N===void 0?void 0:N.call(K,Q);typeof oe=="string"&&oe[0]==="#"&&b.type==="put"&&(delete b.criteria,delete b.changeSpec,delete b.updates,Q.$ts=Date.now())}}return m.mutate(b)}})}})})),t.use(cm(Nt(t)))}ba.version="4.2.2",Ee.Cloud=ba;const Kr=new Map;function $l(t){return t.startsWith("dexie-cloud:")&&t.split(":")[1]}const Ji=new Map;function qo(t,e){let n=Ji.get(t+"/"+e);return n||(n=function r(i,o){return te(this,void 0,void 0,function*(){var c;let l=Kr.get(i);if(!l){const h=new Ee(i,{addons:[ba]});if(l=Nt(h),l.cloud.isServiceWorkerDB=!0,h.on("versionchange",f),yield l.dx.open(),Kr.get(i))return l.close(),yield r(i,o);Kr.set(i,l)}if(!((c=l.cloud.options)===null||c===void 0)&&c.databaseUrl&&l.cloud.schema)try{yield $a(l,l.cloud.options,l.cloud.schema,{retryImmediatelyOnFetchError:!0,purpose:o})}catch(h){if(f(),h.name!==Ee.errnames.NoSuchDatabase)throw h}function f(){return l.dx.on.versionchange.unsubscribe(f),Kr.get(l.name)===l&&Kr.delete(l.name),l.dx.close(),!1}})}(t,e).then(()=>{Ji.delete(t+"/"+e)}).catch(r=>(Ji.delete(t+"/"+e),Promise.reject(r))),Ji.set(t+"/"+e,n)),n}qf||(self.addEventListener("sync",t=>{const e=$l(t.tag);e&&t.waitUntil(qo(e,"push"))}),self.addEventListener("periodicsync",t=>{const e=$l(t.tag);e&&t.waitUntil(qo(e,"pull"))}),self.addEventListener("message",t=>{if(t.data.type==="dexie-cloud-sync"){const{dbName:e}=t.data,n=(r=1)=>qo(e,t.data.purpose||"pull").catch(i=>te(void 0,void 0,void 0,function*(){if(r===3)throw i;var o;yield(o=6e4,new Promise(c=>setTimeout(c,o))),n(r+1)}));"waitUntil"in t?t.waitUntil(n().catch(r=>{})):n().catch(r=>{})}}));try{self["workbox:core:7.2.0"]&&_()}catch{}const jm=(t,...e)=>{let n=t;return e.length>0&&(n+=` :: ${JSON.stringify(e)}`),n},Lm=jm;class yt extends Error{constructor(e,n){const r=Lm(e,n);super(r),this.name=e,this.details=n}}const Gt={googleAnalytics:"googleAnalytics",precache:"precache-v2",prefix:"workbox",runtime:"runtime",suffix:typeof registration<"u"?registration.scope:""},Vo=t=>[Gt.prefix,t,Gt.suffix].filter(e=>e&&e.length>0).join("-"),Nm=t=>{for(const e of Object.keys(Gt))t(e)},Bs={updateDetails:t=>{Nm(e=>{typeof t[e]=="string"&&(Gt[e]=t[e])})},getGoogleAnalyticsName:t=>t||Vo(Gt.googleAnalytics),getPrecacheName:t=>t||Vo(Gt.precache),getPrefix:()=>Gt.prefix,getRuntimeName:t=>t||Vo(Gt.runtime),getSuffix:()=>Gt.suffix};function ql(t,e){const n=e();return t.waitUntil(n),n}try{self["workbox:precaching:7.2.0"]&&_()}catch{}const Mm="__WB_REVISION__";function Km(t){if(!t)throw new yt("add-to-cache-list-unexpected-type",{entry:t});if(typeof t=="string"){const o=new URL(t,location.href);return{cacheKey:o.href,url:o.href}}const{revision:e,url:n}=t;if(!n)throw new yt("add-to-cache-list-unexpected-type",{entry:t});if(!e){const o=new URL(n,location.href);return{cacheKey:o.href,url:o.href}}const r=new URL(n,location.href),i=new URL(n,location.href);return r.searchParams.set(Mm,e),{cacheKey:r.href,url:i.href}}class Bm{constructor(){this.updatedURLs=[],this.notUpdatedURLs=[],this.handlerWillStart=async({request:e,state:n})=>{n&&(n.originalRequest=e)},this.cachedResponseWillBeUsed=async({event:e,state:n,cachedResponse:r})=>{if(e.type==="install"&&n&&n.originalRequest&&n.originalRequest instanceof Request){const i=n.originalRequest.url;r?this.notUpdatedURLs.push(i):this.updatedURLs.push(i)}return r}}}class Fm{constructor({precacheController:e}){this.cacheKeyWillBeUsed=async({request:n,params:r})=>{const i=(r==null?void 0:r.cacheKey)||this._precacheController.getCacheKeyForURL(n.url);return i?new Request(i,{headers:n.headers}):n},this._precacheController=e}}let Br;function $m(){if(Br===void 0){const t=new Response("");if("body"in t)try{new Response(t.body),Br=!0}catch{Br=!1}Br=!1}return Br}async function qm(t,e){let n=null;if(t.url&&(n=new URL(t.url).origin),n!==self.location.origin)throw new yt("cross-origin-copy-response",{origin:n});const r=t.clone(),o={headers:new Headers(r.headers),status:r.status,statusText:r.statusText},c=$m()?r.body:await r.blob();return new Response(c,o)}const Vm=t=>new URL(String(t),location.href).href.replace(new RegExp(`^${location.origin}`),"");function Vl(t,e){const n=new URL(t);for(const r of e)n.searchParams.delete(r);return n.href}async function Wm(t,e,n,r){const i=Vl(e.url,n);if(e.url===i)return t.match(e,r);const o=Object.assign(Object.assign({},r),{ignoreSearch:!0}),c=await t.keys(e,o);for(const l of c){const f=Vl(l.url,n);if(i===f)return t.match(l,r)}}class Hm{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}const zm=new Set;async function Ym(){for(const t of zm)await t()}function Gm(t){return new Promise(e=>setTimeout(e,t))}try{self["workbox:strategies:7.2.0"]&&_()}catch{}function Xi(t){return typeof t=="string"?new Request(t):t}class Jm{constructor(e,n){this._cacheKeys={},Object.assign(this,n),this.event=n.event,this._strategy=e,this._handlerDeferred=new Hm,this._extendLifetimePromises=[],this._plugins=[...e.plugins],this._pluginStateMap=new Map;for(const r of this._plugins)this._pluginStateMap.set(r,{});this.event.waitUntil(this._handlerDeferred.promise)}async fetch(e){const{event:n}=this;let r=Xi(e);if(r.mode==="navigate"&&n instanceof FetchEvent&&n.preloadResponse){const c=await n.preloadResponse;if(c)return c}const i=this.hasCallback("fetchDidFail")?r.clone():null;try{for(const c of this.iterateCallbacks("requestWillFetch"))r=await c({request:r.clone(),event:n})}catch(c){if(c instanceof Error)throw new yt("plugin-error-request-will-fetch",{thrownErrorMessage:c.message})}const o=r.clone();try{let c;c=await fetch(r,r.mode==="navigate"?void 0:this._strategy.fetchOptions);for(const l of this.iterateCallbacks("fetchDidSucceed"))c=await l({event:n,request:o,response:c});return c}catch(c){throw i&&await this.runCallbacks("fetchDidFail",{error:c,event:n,originalRequest:i.clone(),request:o.clone()}),c}}async fetchAndCachePut(e){const n=await this.fetch(e),r=n.clone();return this.waitUntil(this.cachePut(e,r)),n}async cacheMatch(e){const n=Xi(e);let r;const{cacheName:i,matchOptions:o}=this._strategy,c=await this.getCacheKey(n,"read"),l=Object.assign(Object.assign({},o),{cacheName:i});r=await caches.match(c,l);for(const f of this.iterateCallbacks("cachedResponseWillBeUsed"))r=await f({cacheName:i,matchOptions:o,cachedResponse:r,request:c,event:this.event})||void 0;return r}async cachePut(e,n){const r=Xi(e);await Gm(0);const i=await this.getCacheKey(r,"write");if(!n)throw new yt("cache-put-with-no-response",{url:Vm(i.url)});const o=await this._ensureResponseSafeToCache(n);if(!o)return!1;const{cacheName:c,matchOptions:l}=this._strategy,f=await self.caches.open(c),h=this.hasCallback("cacheDidUpdate"),d=h?await Wm(f,i.clone(),["__WB_REVISION__"],l):null;try{await f.put(i,h?o.clone():o)}catch(g){if(g instanceof Error)throw g.name==="QuotaExceededError"&&await Ym(),g}for(const g of this.iterateCallbacks("cacheDidUpdate"))await g({cacheName:c,oldResponse:d,newResponse:o.clone(),request:i,event:this.event});return!0}async getCacheKey(e,n){const r=`${e.url} | ${n}`;if(!this._cacheKeys[r]){let i=e;for(const o of this.iterateCallbacks("cacheKeyWillBeUsed"))i=Xi(await o({mode:n,request:i,event:this.event,params:this.params}));this._cacheKeys[r]=i}return this._cacheKeys[r]}hasCallback(e){for(const n of this._strategy.plugins)if(e in n)return!0;return!1}async runCallbacks(e,n){for(const r of this.iterateCallbacks(e))await r(n)}*iterateCallbacks(e){for(const n of this._strategy.plugins)if(typeof n[e]=="function"){const r=this._pluginStateMap.get(n);yield o=>{const c=Object.assign(Object.assign({},o),{state:r});return n[e](c)}}}waitUntil(e){return this._extendLifetimePromises.push(e),e}async doneWaiting(){let e;for(;e=this._extendLifetimePromises.shift();)await e}destroy(){this._handlerDeferred.resolve(null)}async _ensureResponseSafeToCache(e){let n=e,r=!1;for(const i of this.iterateCallbacks("cacheWillUpdate"))if(n=await i({request:this.request,response:n,event:this.event})||void 0,r=!0,!n)break;return r||n&&n.status!==200&&(n=void 0),n}}class Xm{constructor(e={}){this.cacheName=Bs.getRuntimeName(e.cacheName),this.plugins=e.plugins||[],this.fetchOptions=e.fetchOptions,this.matchOptions=e.matchOptions}handle(e){const[n]=this.handleAll(e);return n}handleAll(e){e instanceof FetchEvent&&(e={event:e,request:e.request});const n=e.event,r=typeof e.request=="string"?new Request(e.request):e.request,i="params"in e?e.params:void 0,o=new Jm(this,{event:n,request:r,params:i}),c=this._getResponse(o,r,n),l=this._awaitComplete(c,o,r,n);return[c,l]}async _getResponse(e,n,r){await e.runCallbacks("handlerWillStart",{event:r,request:n});let i;try{if(i=await this._handle(n,e),!i||i.type==="error")throw new yt("no-response",{url:n.url})}catch(o){if(o instanceof Error){for(const c of e.iterateCallbacks("handlerDidError"))if(i=await c({error:o,event:r,request:n}),i)break}if(!i)throw o}for(const o of e.iterateCallbacks("handlerWillRespond"))i=await o({event:r,request:n,response:i});return i}async _awaitComplete(e,n,r,i){let o,c;try{o=await e}catch{}try{await n.runCallbacks("handlerDidRespond",{event:i,request:r,response:o}),await n.doneWaiting()}catch(l){l instanceof Error&&(c=l)}if(await n.runCallbacks("handlerDidComplete",{event:i,request:r,response:o,error:c}),n.destroy(),c)throw c}}class pn extends Xm{constructor(e={}){e.cacheName=Bs.getPrecacheName(e.cacheName),super(e),this._fallbackToNetwork=e.fallbackToNetwork!==!1,this.plugins.push(pn.copyRedirectedCacheableResponsesPlugin)}async _handle(e,n){const r=await n.cacheMatch(e);return r||(n.event&&n.event.type==="install"?await this._handleInstall(e,n):await this._handleFetch(e,n))}async _handleFetch(e,n){let r;const i=n.params||{};if(this._fallbackToNetwork){const o=i.integrity,c=e.integrity,l=!c||c===o;r=await n.fetch(new Request(e,{integrity:e.mode!=="no-cors"?c||o:void 0})),o&&l&&e.mode!=="no-cors"&&(this._useDefaultCacheabilityPluginIfNeeded(),await n.cachePut(e,r.clone()))}else throw new yt("missing-precache-entry",{cacheName:this.cacheName,url:e.url});return r}async _handleInstall(e,n){this._useDefaultCacheabilityPluginIfNeeded();const r=await n.fetch(e);if(!await n.cachePut(e,r.clone()))throw new yt("bad-precaching-response",{url:e.url,status:r.status});return r}_useDefaultCacheabilityPluginIfNeeded(){let e=null,n=0;for(const[r,i]of this.plugins.entries())i!==pn.copyRedirectedCacheableResponsesPlugin&&(i===pn.defaultPrecacheCacheabilityPlugin&&(e=r),i.cacheWillUpdate&&n++);n===0?this.plugins.push(pn.defaultPrecacheCacheabilityPlugin):n>1&&e!==null&&this.plugins.splice(e,1)}}pn.defaultPrecacheCacheabilityPlugin={async cacheWillUpdate({response:t}){return!t||t.status>=400?null:t}};pn.copyRedirectedCacheableResponsesPlugin={async cacheWillUpdate({response:t}){return t.redirected?await qm(t):t}};class Qm{constructor({cacheName:e,plugins:n=[],fallbackToNetwork:r=!0}={}){this._urlsToCacheKeys=new Map,this._urlsToCacheModes=new Map,this._cacheKeysToIntegrities=new Map,this._strategy=new pn({cacheName:Bs.getPrecacheName(e),plugins:[...n,new Fm({precacheController:this})],fallbackToNetwork:r}),this.install=this.install.bind(this),this.activate=this.activate.bind(this)}get strategy(){return this._strategy}precache(e){this.addToCacheList(e),this._installAndActiveListenersAdded||(self.addEventListener("install",this.install),self.addEventListener("activate",this.activate),this._installAndActiveListenersAdded=!0)}addToCacheList(e){const n=[];for(const r of e){typeof r=="string"?n.push(r):r&&r.revision===void 0&&n.push(r.url);const{cacheKey:i,url:o}=Km(r),c=typeof r!="string"&&r.revision?"reload":"default";if(this._urlsToCacheKeys.has(o)&&this._urlsToCacheKeys.get(o)!==i)throw new yt("add-to-cache-list-conflicting-entries",{firstEntry:this._urlsToCacheKeys.get(o),secondEntry:i});if(typeof r!="string"&&r.integrity){if(this._cacheKeysToIntegrities.has(i)&&this._cacheKeysToIntegrities.get(i)!==r.integrity)throw new yt("add-to-cache-list-conflicting-integrities",{url:o});this._cacheKeysToIntegrities.set(i,r.integrity)}if(this._urlsToCacheKeys.set(o,i),this._urlsToCacheModes.set(o,c),n.length>0){const l=`Workbox is precaching URLs without revision info: ${n.join(", ")}
This is generally NOT safe. Learn more at https://bit.ly/wb-precache`;console.warn(l)}}}install(e){return ql(e,async()=>{const n=new Bm;this.strategy.plugins.push(n);for(const[o,c]of this._urlsToCacheKeys){const l=this._cacheKeysToIntegrities.get(c),f=this._urlsToCacheModes.get(o),h=new Request(o,{integrity:l,cache:f,credentials:"same-origin"});await Promise.all(this.strategy.handleAll({params:{cacheKey:c},request:h,event:e}))}const{updatedURLs:r,notUpdatedURLs:i}=n;return{updatedURLs:r,notUpdatedURLs:i}})}activate(e){return ql(e,async()=>{const n=await self.caches.open(this.strategy.cacheName),r=await n.keys(),i=new Set(this._urlsToCacheKeys.values()),o=[];for(const c of r)i.has(c.url)||(await n.delete(c),o.push(c.url));return{deletedURLs:o}})}getURLsToCacheKeys(){return this._urlsToCacheKeys}getCachedURLs(){return[...this._urlsToCacheKeys.keys()]}getCacheKeyForURL(e){const n=new URL(e,location.href);return this._urlsToCacheKeys.get(n.href)}getIntegrityForCacheKey(e){return this._cacheKeysToIntegrities.get(e)}async matchPrecache(e){const n=e instanceof Request?e.url:e,r=this.getCacheKeyForURL(n);if(r)return(await self.caches.open(this.strategy.cacheName)).match(r)}createHandlerBoundToURL(e){const n=this.getCacheKeyForURL(e);if(!n)throw new yt("non-precached-url",{url:e});return r=>(r.request=new Request(e),r.params=Object.assign({cacheKey:n},r.params),this.strategy.handle(r))}}let Wo;const fd=()=>(Wo||(Wo=new Qm),Wo);try{self["workbox:routing:7.2.0"]&&_()}catch{}const dd="GET",Ss=t=>t&&typeof t=="object"?t:{handle:t};class Jr{constructor(e,n,r=dd){this.handler=Ss(n),this.match=e,this.method=r}setCatchHandler(e){this.catchHandler=Ss(e)}}class Zm extends Jr{constructor(e,n,r){const i=({url:o})=>{const c=e.exec(o.href);if(c&&!(o.origin!==location.origin&&c.index!==0))return c.slice(1)};super(i,n,r)}}class ev{constructor(){this._routes=new Map,this._defaultHandlerMap=new Map}get routes(){return this._routes}addFetchListener(){self.addEventListener("fetch",e=>{const{request:n}=e,r=this.handleRequest({request:n,event:e});r&&e.respondWith(r)})}addCacheListener(){self.addEventListener("message",e=>{if(e.data&&e.data.type==="CACHE_URLS"){const{payload:n}=e.data,r=Promise.all(n.urlsToCache.map(i=>{typeof i=="string"&&(i=[i]);const o=new Request(...i);return this.handleRequest({request:o,event:e})}));e.waitUntil(r),e.ports&&e.ports[0]&&r.then(()=>e.ports[0].postMessage(!0))}})}handleRequest({request:e,event:n}){const r=new URL(e.url,location.href);if(!r.protocol.startsWith("http"))return;const i=r.origin===location.origin,{params:o,route:c}=this.findMatchingRoute({event:n,request:e,sameOrigin:i,url:r});let l=c&&c.handler;const f=e.method;if(!l&&this._defaultHandlerMap.has(f)&&(l=this._defaultHandlerMap.get(f)),!l)return;let h;try{h=l.handle({url:r,request:e,event:n,params:o})}catch(g){h=Promise.reject(g)}const d=c&&c.catchHandler;return h instanceof Promise&&(this._catchHandler||d)&&(h=h.catch(async g=>{if(d)try{return await d.handle({url:r,request:e,event:n,params:o})}catch(m){m instanceof Error&&(g=m)}if(this._catchHandler)return this._catchHandler.handle({url:r,request:e,event:n});throw g})),h}findMatchingRoute({url:e,sameOrigin:n,request:r,event:i}){const o=this._routes.get(r.method)||[];for(const c of o){let l;const f=c.match({url:e,sameOrigin:n,request:r,event:i});if(f)return l=f,(Array.isArray(l)&&l.length===0||f.constructor===Object&&Object.keys(f).length===0||typeof f=="boolean")&&(l=void 0),{route:c,params:l}}return{}}setDefaultHandler(e,n=dd){this._defaultHandlerMap.set(n,Ss(e))}setCatchHandler(e){this._catchHandler=Ss(e)}registerRoute(e){this._routes.has(e.method)||this._routes.set(e.method,[]),this._routes.get(e.method).push(e)}unregisterRoute(e){if(!this._routes.has(e.method))throw new yt("unregister-route-but-not-found-with-method",{method:e.method});const n=this._routes.get(e.method).indexOf(e);if(n>-1)this._routes.get(e.method).splice(n,1);else throw new yt("unregister-route-route-not-registered")}}let Fr;const tv=()=>(Fr||(Fr=new ev,Fr.addFetchListener(),Fr.addCacheListener()),Fr);function nv(t,e,n){let r;if(typeof t=="string"){const o=new URL(t,location.href),c=({url:l})=>l.href===o.href;r=new Jr(c,e,n)}else if(t instanceof RegExp)r=new Zm(t,e,n);else if(typeof t=="function")r=new Jr(t,e,n);else if(t instanceof Jr)r=t;else throw new yt("unsupported-route-type",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});return tv().registerRoute(r),r}function rv(t,e=[]){for(const n of[...t.searchParams.keys()])e.some(r=>r.test(n))&&t.searchParams.delete(n);return t}function*iv(t,{ignoreURLParametersMatching:e=[/^utm_/,/^fbclid$/],directoryIndex:n="index.html",cleanURLs:r=!0,urlManipulation:i}={}){const o=new URL(t,location.href);o.hash="",yield o.href;const c=rv(o,e);if(yield c.href,n&&c.pathname.endsWith("/")){const l=new URL(c.href);l.pathname+=n,yield l.href}if(r){const l=new URL(c.href);l.pathname+=".html",yield l.href}if(i){const l=i({url:o});for(const f of l)yield f.href}}class sv extends Jr{constructor(e,n){const r=({request:i})=>{const o=e.getURLsToCacheKeys();for(const c of iv(i.url,n)){const l=o.get(c);if(l){const f=e.getIntegrityForCacheKey(l);return{cacheKey:l,integrity:f}}}};super(r,e.strategy)}}function ov(t){const e=fd(),n=new sv(e,t);nv(n)}const av="-precache-",cv=async(t,e=av)=>{const r=(await self.caches.keys()).filter(i=>i.includes(e)&&i.includes(self.registration.scope)&&i!==t);return await Promise.all(r.map(i=>self.caches.delete(i))),r};function lv(){self.addEventListener("activate",t=>{const e=Bs.getPrecacheName();t.waitUntil(cv(e).then(n=>{}))})}function uv(t){fd().precache(t)}function fv(t,e){uv(t),ov(e)}console.log("🚀 Service Worker starting (built at 2025-10-03T23:41:11.704Z)");fv([{"revision":null,"url":"assets/index-BXYc-Prx.js"},{"revision":null,"url":"assets/index-DVNu3zGM.css"},{"revision":"1f97eec01068f57ce77428470ec566e7","url":"index.html"},{"revision":"0ea25c17ba9443457d913d6be03fea55","url":"dexie-icon-192x192.png"},{"revision":"f1749b24004626d4cb2f90aee4e442d2","url":"dexie-icon-512x512.png"},{"revision":"fc723c843a0b8a137167d3d63dda4e28","url":"dexie-icon-64x64.gif"},{"revision":"2482ade6e4b177e1de1473f83be15e59","url":"manifest.webmanifest"}]);lv();self.addEventListener("install",t=>{self.skipWaiting()});
//# sourceMappingURL=sw.js.map
