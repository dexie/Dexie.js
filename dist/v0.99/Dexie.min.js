(function(e,t,n,r){"use strict";function i(e,t){if(typeof t!=="object")t=t();Object.keys(t).forEach(function(n){e[n]=t[n]});return e}function s(e){return{from:function(t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;return{extend:function(n){i(e.prototype,typeof n!=="object"?n(t.prototype):n)}}}}}function o(e,t){return t(e)}function u(t){function rt(){if(n)Z.on("versionchange",function(t){Z.close();if(t.newVersion){e.location.reload(true)}})}function it(e){this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null};this.stores({})}function st(e,t,n,r){if(e==0){Object.keys(U).forEach(function(e){ut(t,e,U[e].primKey,U[e].indexes)});var i=Z._createTransaction(Y,W,U);i.idbtrans=t;i.idbtrans.onerror=_(n,["populating database"]);i.on("error").subscribe(n);a.newPSD(function(){a.PSD.trans=i;try{Z.on("populate").fire(i)}catch(e){r.onerror=t.onerror=function(e){e.preventDefault()};try{t.abort()}catch(s){}t.db.close();n(e)}})}else{var s=[];var u=z.filter(function(t){return t._cfg.version===e})[0];if(!u)throw new R("Dexie specification of currently installed DB version is missing");U=Z._dbSchema=u._cfg.dbschema;var f=false;var l=z.filter(function(t){return t._cfg.version>e});l.forEach(function(e){var t=U;var r=e._cfg.dbschema;U=Z._dbSchema=r;{var i=ot(t,r);i.add.forEach(function(e){s.push(function(t,n){ut(t,e[0],e[1].primKey,e[1].indexes);n()})});i.change.forEach(function(e){if(e.recreate){throw new R("Not yet support for changing primary key")}else{s.push(function(t,n){var r=t.objectStore(e.name);e.add.forEach(function(e){lt(r,e)});e.change.forEach(function(e){r.deleteIndex(e.name);lt(r,e)});e.del.forEach(function(e){r.deleteIndex(e)});n()})}});if(e._cfg.contentUpgrade){s.push(function(t,i){f=true;var s=Z._createTransaction(Y,[].slice.call(t.db.objectStoreNames,0),r);s.idbtrans=t;var u=0;s._promise=o(s._promise,function(e){return function(t,n,r){function s(e){return function(){e.apply(this,arguments);if(--u==0)i()}}++u;return e.call(this,t,function(e,t,r){arguments[0]=s(e);arguments[1]=s(t);n.apply(this,arguments)},r)}});t.onerror=_(n,["running upgrader function for version",e._cfg.version]);s.on("error").subscribe(n);e._cfg.contentUpgrade(s);if(u===0)i()})}if(!f||!Ct()){s.push(function(e,t){ft(r,e);t()})}}});var c=function(){try{if(s.length)s.shift()(t,c);else at(U,t)}catch(e){r.onerror=t.onerror=function(e){e.preventDefault()};t.abort();t.db.close();n(e)}};c()}}function ot(e,t){var n={del:[],add:[],change:[]};for(var r in e){if(!t[r])n.del.push(r)}for(var r in t){var i=e[r],s=t[r];if(!i)n.add.push([r,s]);else{var o={name:r,def:t[r],recreate:false,del:[],add:[],change:[]};if(i.primKey.src!=s.primKey.src){o.recreate=true;n.change.push(o)}else{var u=i.indexes.reduce(function(e,t){e[t.name]=t;return e},{});var a=s.indexes.reduce(function(e,t){e[t.name]=t;return e},{});for(var f in u){if(!a[f])o.del.push(f)}for(var f in a){var l=u[f],c=a[f];if(!l)o.add.push(c);else if(l.src!=c.src)o.change.push(c)}if(o.recreate||o.del.length>0||o.add.length>0||o.change.length>0){n.change.push(o)}}}}return n}function ut(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});r.forEach(function(e){lt(i,e)});return i}function at(e,t){Object.keys(e).forEach(function(n){if(!t.db.objectStoreNames.contains(n)){ut(t,n,e[n].primKey,e[n].indexes)}})}function ft(e,t){for(var n=0;n<t.db.objectStoreNames.length;++n){var i=t.db.objectStoreNames[n];if(e[i]===null||e[i]===r){t.db.deleteObjectStore(i)}}}function lt(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function ct(e,t){return a.reject(D(new R("Table "+t[0]+" not part of transaction. Original Scope Function Source: "+u.Promise.PSD.trans.scopeFunc.toString())))}function ht(e,t,n,r){this.name=e;this.schema=n;this.hook=X[e]?X[e].hook:b(null,{creating:[p,f],reading:[c,l],updating:[d,f],deleting:[g,f]});this._tpf=t;this._collClass=r||mt}function pt(e,t,n,r){ht.call(this,e,t,n,r||gt)}function dt(e,t,n){function i(e,t,n,i){return r._promise(e,n,i)}var r=this;this.db=Z;this.mode=e;this.storeNames=t;this.idbtrans=null;this.on=b(this,["complete","error"],"abort");this._reculock=0;this._blockedFuncs=[];this._psd=null;this.active=true;this._dbschema=n;this._tpf=i;this.tables=Object.create(V);for(var s=t.length-1;s!==-1;--s){var o=t[s];var u=Z._tableFactory(e,n[o],i);this.tables[o]=u;if(!this[o])this[o]=u}}function vt(e,t,n){this._ctx={table:e,index:t===":id"?null:t,collClass:e._collClass,or:n}}function mt(e,t){var n=e._ctx;this._ctx={table:n.table,index:n.index,isPrimKey:!n.index||n.table.schema.primKey.keyPath&&n.index===n.table.schema.primKey.keyPath,range:t,op:"openCursor",dir:"next",unique:"",algorithm:null,filter:null,isMatch:null,offset:0,limit:Infinity,error:null,or:n.or}}function gt(){mt.apply(this,arguments)}function yt(e,t){return e._cfg.version-t._cfg.version}function bt(e,t,n,r,i,s){n.forEach(function(n){var o=Z._tableFactory(r,i[n],t);e.forEach(function(e){if(!e[n]){if(s){Object.defineProperty(e,n,{configurable:true,enumerable:true,get:function(){if(a.PSD&&a.PSD.trans){return a.PSD.trans.tables[n]}return o}})}else{e[n]=o}}})})}function wt(e){e.forEach(function(e){for(var t in e){if(e[t]instanceof ht)delete e[t]}})}function Et(e,t,n,r,i,s){var o=a.PSD;s=s||l;if(!e.onerror)e.onerror=_(i);if(t){e.onsuccess=x(function(u){var a=e.result;if(a){var f=function(){a.continue()};if(t(a,function(e){f=e},r,i))n(s(a.value),a,function(e){f=e});f()}else{r()}},i,o)}else{e.onsuccess=x(function(i){var o=e.result;if(o){var u=function(){o.continue()};n(s(o.value),o,function(e){u=e});u()}else{r()}},i,o)}}function St(e){var t=[];e.split(",").forEach(function(e){e=e.trim();var n=e.replace("&","").replace("++","").replace("*","");var r=n.indexOf("[")!==0?n:e.substring(1,e.indexOf("]")).split("+");t.push(new B(n,r||null,e.indexOf("&")!=-1,e.indexOf("*")!=-1,e.indexOf("++")!=-1,Array.isArray(r),r.indexOf(".")!=-1))});return t}function xt(e,t){return e<t?-1:e>t?1:0}function Tt(e,t){return e<t?1:e>t?-1:0}function Nt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function Ct(){return navigator.userAgent.indexOf("Trident")>=0||navigator.userAgent.indexOf("MSIE")>=0}function kt(){Z.verno=$.version/10;Z._dbSchema=U={};W=[].slice.call($.objectStoreNames,0);if(W.length==0)return;var e=$.transaction(W,"readonly");W.forEach(function(t){var n=e.objectStore(t);var r=new B(n.keyPath,n.keyPath||"",false,false,!!n.autoIncrement,false,n.keyPath&&n.keyPath.indexOf(".")!=-1);var i=[];for(var s=0;s<n.indexNames.length;++s){var o=n.index(n.indexNames[s]);var u=new B(o.name,o.keyPath,!!o.unique,!!o.multiEntry,false,typeof o.keyPath!=="string",o.keyPath.indexOf(".")!=-1);i.push(u)}U[t]=new j(t,r,i,{})});bt([X],Z._transPromiseFactory,Object.keys(U),Y,U)}var h=u.dependencies;var v=h.indexedDB,w=h.IDBKeyRange,O=h.IDBTransaction;var I=h.DOMError,q=h.TypeError,R=h.Error;var U=this._dbSchema={};var z=[];var W=[];var X={};var V={};var $=null;var J=true;var K=null;var Q=false;var G="readonly",Y="readwrite";var Z=this;var et=[];var tt=function(){function e(){}var t=new e;try{t.__proto__=Object.prototype;return!(t instanceof e)}catch(n){return false}}();var nt=false;this.version=function(e){if($)throw new R("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=z.filter(function(t){return t._cfg.version==e})[0];if(t)return t;t=new it(e);z.push(t);z.sort(yt);return t};i(it.prototype,{stores:function(e){this._cfg.storesSource=this._cfg.storesSource?i(this._cfg.storesSource,e):e;var t={};z.forEach(function(e){i(t,e._cfg.storesSource)});var n=this._cfg.dbschema={};this._parseStoresSpec(t,n);U=Z._dbSchema=n;wt([X,Z,V]);bt([V],ct,Object.keys(n),Y,n);bt([X,Z,this._cfg.tables],Z._transPromiseFactory,Object.keys(n),Y,n,true);W=Object.keys(n);return this},upgrade:function(e){var t=this;S(function(){e(Z._createTransaction(Y,Object.keys(t._cfg.dbschema),t._cfg.dbschema))});this._cfg.contentUpgrade=e;return this},_parseStoresSpec:function(e,t){Object.keys(e).forEach(function(n){if(e[n]!==null){var r={};var i=St(e[n]);var s=i.shift();if(s.multi)throw new R("Primary key cannot be multi-valued");if(s.keyPath&&s.auto)N(r,s.keyPath,0);i.forEach(function(e){if(e.auto)throw new R("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new R("Index must have a name and cannot be an empty string");N(r,e.keyPath,e.compound?e.keyPath.map(function(){return""}):"")});t[n]=new j(n,s,i,r)}})}});this._allTables=X;this._tableFactory=function(t,n,r){if(t===G)return new ht(n.name,r,n,mt);else return new pt(n.name,r,n)};this._createTransaction=function(e,t,n){return new dt(e,t,n)};this._transPromiseFactory=function(t,n,r){if(J&&(!a.PSD||!a.PSD.letThrough)){var i=new a(function(e,s){et.push({resume:function(){var o=Z._transPromiseFactory(t,n,r);i.onuncatched=o.onuncatched;o.then(e,s)}})});return i}else{var s=Z._createTransaction(t,n,U);return s._promise(t,function(e,t){r(function(t){s.complete(function(){e(t)})},t,s)})}};this._whenReady=function(e){if(J&&(!a.PSD||!a.PSD.letThrough)){return new a(function(t,n){S(function(){new a(function(){e(t,n)})});et.push({resume:function(){e(t,n)}})})}return new a(e)},this.verno=0;this.open=function(){return new a(function(e,n){function r(e){Q=false;K=e;J=false;n(K);et.forEach(function(e){e.resume()});et=[]}if($||Q)throw new R("Database already opened or being opened");try{K=null;Q=true;if(z.length==0){nt=true}if(!v)throw new R("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");var i=false;var s=nt?v.open(t):v.open(t,Z.verno*10);s.onerror=_(r,["opening database",t]);s.onblocked=function(e){Z.on("blocked").fire(e)};s.onupgradeneeded=function(e){if(nt&&!Z._allowEmptyDB){s.onerror=function(e){e.preventDefault()};s.transaction.abort();s.result.close();var n=v.deleteDatabase(t);n.onsuccess=n.onerror=function(){r(new R("Database '"+t+"' doesnt exist"))}}else{if(e.oldVersion==0)i=true;s.transaction.onerror=_(r);st(e.oldVersion/10,s.transaction,r,s)}};s.onsuccess=function(n){Q=false;$=s.result;if(nt)kt();$.onversionchange=Z.on("versionchange").fire;H(function(e){if(e.indexOf(t)===-1)return e.push(t)});a.newPSD(function(){function i(){J=false;et.forEach(function(e){e.resume()});et=[];e()}a.PSD.letThrough=true;try{var t=Z.on.ready.fire();if(t&&typeof t.then=="function"){t.then(i,function(e){$.close();$=null;r(e)})}else{E(i)}}catch(n){r(n)}})}}catch(o){r(o)}})};this.close=function(){if($){$.close();$=null;J=true;K=null}};this.delete=function(){var e=arguments;return new a(function(n,r){function i(){Z.close();var e=v.deleteDatabase(t);e.onsuccess=function(){H(function(e){var n=e.indexOf(t);if(n>=0)return e.splice(n,1)});n()};e.onerror=_(r,["deleting",t]);e.onblocked=function(){Z.on("blocked").fire()}}if(e.length>0)throw new R("Arguments not allowed in db.delete()");if(Q){et.push({resume:i})}else{i()}})};this.backendDB=function(){return $};this.isOpen=function(){return $!==null};this.hasFailed=function(){return K!==null};this.name=t;Object.defineProperty(this,"tables",{get:function(){return Object.keys(X).map(function(e){return X[e]})}});this.on=b(this,"error","populate","blocked",{ready:[y,f],versionchange:[m,f]});this.on.ready.subscribe=o(this.on.ready.subscribe,function(e){return function(t,n){function r(){if(!n)Z.on.ready.unsubscribe(r);return t.apply(this,arguments)}e.call(this,r);if(Z.isOpen()){if(J){et.push({resume:r})}else{r()}}}});S(function(){Z.on("populate").fire(Z._createTransaction(Y,W,U));Z.on("error").fire(new R)});this.transaction=function(e,t,n){function l(t,i){var s=null;try{if(u)throw u;s=Z._createTransaction(e,f,U);var l=f.map(function(e){return s.tables[e]});l.push(s);var c;var h=0;a.newPSD(function(){a.PSD.trans=s;s.scopeFunc=n;if(r){s.idbtrans=r.idbtrans;s._promise=o(s._promise,function(e){return function(t,n,r){function i(e){return function(t){var n=e(t);if(--h==0&&s.active)s.on.complete.fire();return n}}++h;return e.call(this,t,function(e,t,r){return n(i(e),i(t),r)},r)}})}s.complete(function(){t(c)});s.error(function(e){s.idbtrans.onerror=P;s.abort();if(r){r.active=false;r.on.error.fire(e)}var t=i(e);if(!r&&!t){Z.on.error.fire(e)}});c=n.apply(s,l)});if(!s.idbtrans||r&&h===0){s.active=false;s.on.complete.fire()}}catch(p){if(s&&s.idbtrans)s.idbtrans.onerror=P;if(s)s.abort();if(r)r.on.error.fire(p);E(function(){if(!i(p))Z.on("error").fire(p)})}}t=[].slice.call(arguments,1,arguments.length-1);n=arguments[arguments.length-1];var r=a.PSD&&a.PSD.trans;if(e.indexOf("!")!==-1)r=null;var i=e.indexOf("?")!==-1;e=e.replace("!","").replace("?","");var s=Array.isArray(t[0])?t.reduce(function(e,t){return e.concat(t)}):t;var u=null;var f=s.map(function(e){if(typeof e=="string"){return e}else{if(!(e instanceof ht))u=u||new q("Invalid type. Arguments following mode must be instances of Table or String");return e.name}});if(e=="r"||e==G)e=G;else if(e=="rw"||e==Y)e=Y;else u=new R("Invalid transaction mode: "+e);if(r){if(!u){if(r.db!=Z){if(i)r=null;else u=new R("Current transaction bound to different database instance")}if(r&&r.mode===G&&e===Y){if(i)r=null;else u=u||new R("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")}if(r){f.forEach(function(e){if(!r.tables.hasOwnProperty(e)){if(i)r=null;else u=u||new R("Table "+e+" not included in parent transaction. Parent Transaction function: "+r.scopeFunc.toString())}})}}}if(r){return r._promise(e,l,"lock")}else{return Z._whenReady(l)}};this.table=function(e){if(!nt&&!X.hasOwnProperty(e)){throw new R("Table does not exist");return{AN_UNKNOWN_TABLE_NAME_WAS_SPECIFIED:1}}return X[e]};i(ht.prototype,function(){function e(){throw new R("Current Transaction is READONLY")}return{_trans:function(t,n,r){return this._tpf(t,[this.name],n,r)},_idbstore:function(t,n,r){var i=this;return this._tpf(t,[this.name],function(e,t,r){n(e,t,r.idbtrans.objectStore(i.name),r)},r)},get:function(e,t){var n=this;S(function(){t(n.schema.instanceTemplate)});return this._idbstore(G,function(t,r,i){var s=i.get(e);s.onerror=_(r,["getting",e,"from",n.name]);s.onsuccess=function(){t(n.hook.reading.fire(s.result))}}).then(t)},where:function(e){return new vt(this,e)},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){var t=this;S(function(){e(t.schema.instanceTemplate)});return this._idbstore(G,function(n,r,i){var s=i.openCursor();s.onerror=_(r,["calling","Table.each()","on",t.name]);Et(s,null,e,n,r,t.hook.reading.fire)})},toArray:function(e){var t=this;S(function(){e([t.schema.instanceTemplate])});return this._idbstore(G,function(e,n,r){var i=[];var s=r.openCursor();s.onerror=_(n,["calling","Table.toArray()","on",t.name]);Et(s,null,function(e){i.push(e)},function(){e(i)},n,t.hook.reading.fire)}).then(e)},orderBy:function(e){return new this._collClass(new vt(this,e))},toCollection:function(){return new this._collClass(new vt(this))},mapToClass:function(e,t){this.schema.mappedClass=e;var n=Object.create(e.prototype);if(this.schema.primKey.keyPath){N(n,this.schema.primKey.keyPath,this.schema.primKey.auto?0:"");C(e.prototype,this.schema.primKey.keyPath)}if(t){M(n,t)}this.schema.instanceTemplate=n;var r=tt?function(n){if(!n)return n;n.__proto__=e.prototype;return n}:function(n){if(!n)return n;var r=Object.create(e.prototype);for(var i in n)if(n.hasOwnProperty(i))r[i]=n[i];return r};if(this.schema.readHook){this.hook.reading.unsubscribe(this.schema.readHook)}this.schema.readHook=r;this.hook("reading",r);return e},defineClass:function(e){return this.mapToClass(u.defineClass(e),e)},add:e,put:e,"delete":e,clear:e,update:e}});s(pt).from(ht).extend(function(){return{add:function(e,t){var n=this,i=this.hook.creating.fire;return this._idbstore(Y,function(s,o,u,a){var l={};if(i!==f){var c=t||(u.keyPath?T(e,u.keyPath):r);var h=i.call(l,c,e,a);if(c===r&&h!==r){if(u.keyPath)N(e,u.keyPath,h);else t=h}}var p=t?u.add(e,t):u.add(e);p.onerror=_(function(e){if(l.onerror)l.onerror(e);return o(e)},["adding",e,"into",n.name]);p.onsuccess=function(t){var n=u.keyPath;if(n)N(e,n,t.target.result);if(l.onsuccess)l.onsuccess(t.target.result);s(p.result)}})},put:function(e,t){var n=this,i=this.hook.creating.fire,s=this.hook.updating.fire;if(i!==f||s!==f){return this._trans(Y,function(i,s,o){var u=t||n.schema.primKey.keyPath&&T(e,n.schema.primKey.keyPath);if(u===r){o.tables[n.name].add(e).then(i,s)}else{o._lock();e=L(e);o.tables[n.name].where(":id").equals(u).modify(function(t){this.value=e}).then(function(r){if(r===0){return o.tables[n.name].add(e,t)}else{return u}}).finally(function(){o._unlock()}).then(i,s)}})}else{return this._idbstore(Y,function(r,i,s){var o=t?s.put(e,t):s.put(e);o.onerror=_(i,["putting",e,"into",n.name]);o.onsuccess=function(t){var n=s.keyPath;if(n)N(e,n,t.target.result);r(o.result)}})}},"delete":function(e){if(this.hook.deleting.subscribers.length){return this.where(":id").equals(e).delete()}else{return this._idbstore(Y,function(t,n,r){var i=r.delete(e);i.onerror=_(n,["deleting",e,"from",r.name]);i.onsuccess=function(e){t(i.result)}})}},clear:function(){if(this.hook.deleting.subscribers.length){this.toCollection().delete()}else{return this._idbstore(Y,function(e,t,n){var r=n.clear();r.onerror=_(t,["clearing",n.name]);r.onsuccess=function(t){e(r.result)}})}},update:function(e,t){if(typeof t!=="object"||Array.isArray(t))throw new R("db.update(keyOrObject, modifications). modifications must be an object.");if(typeof e==="object"&&!Array.isArray(e)){Object.keys(t).forEach(function(n){N(e,n,t[n])});var n=T(e,this.schema.primKey.keyPath);if(n===r)a.reject(new R("Object does not contain its primary key"));return this.where(":id").equals(n).modify(t)}else{return this.where(":id").equals(e).modify(t)}}}});i(dt.prototype,{_lock:function(){++this._reculock;if(this._reculock===1&&a.PSD)a.PSD.lockOwnerFor=this;return this},_unlock:function(){if(--this._reculock===0){if(a.PSD)a.PSD.lockOwnerFor=null;while(this._blockedFuncs.length>0&&!this._locked()){var e=this._blockedFuncs.shift();try{e()}catch(t){}}}return this},_locked:function(){return this._reculock&&(!a.PSD||a.PSD.lockOwnerFor!==this)},_promise:function(e,t,n){var r=this;return a.newPSD(function(){var i;if(!r._locked()){i=r.active?new a(function(i,s){if(!r.idbtrans&&e){if(!$)throw K?new R("Database not open. Following error in populate, ready or upgrade function made Dexie.open() fail: "+K):new R("Database not open");var o=r.idbtrans=$.transaction(r.storeNames,r.mode);o.onerror=function(e){r.on("error").fire(e&&e.target.error);e.preventDefault();r.abort()};o.onabort=function(e){r.active=false;r.on("abort").fire(e)};o.oncomplete=function(e){r.active=false;r.on("complete").fire(e)}}if(n)r._lock();try{t(i,s,r)}catch(a){u.spawn(function(){r.on("error").fire(a)});r.abort();s(a)}}):a.reject(D(new R("Transaction is inactive. Original Scope Function Source: "+r.scopeFunc.toString())));if(r.active&&n)i.finally(function(){r._unlock()})}else{i=new a(function(i,s){r._blockedFuncs.push(function(){r._promise(e,t,n).then(i,s)})})}i.onuncatched=function(e){u.spawn(function(){r.on("error").fire(e)});r.abort()};return i})},complete:function(e){return this.on("complete",e)},error:function(e){return this.on("error",e)},abort:function(){if(this.idbtrans&&this.active)try{this.active=false;this.idbtrans.abort();this.on.error.fire(new R("Transaction Aborted"))}catch(e){}},table:function(e){if(!this.tables.hasOwnProperty(e)){throw new R("Table "+e+" not in transaction");return{AN_UNKNOWN_TABLE_NAME_WAS_SPECIFIED:1}}return this.tables[e]}});i(vt.prototype,function(){function e(e,t){try{throw t}catch(n){e._ctx.error=n}return e}function t(e){return Array.prototype.slice.call(Array.isArray(e[0])?e[0]:e,0).sort(xt)}function n(e){return e==="next"?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}function r(e){return e==="next"?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}function i(e,t,n,r,i,s){var o=Math.min(e.length,r.length);var u=-1;for(var a=0;a<o;++a){var f=t[a];if(f!==r[a]){if(i(e[a],n[a])<0)return e.substr(0,a)+n[a]+n.substr(a+1);if(i(e[a],r[a])<0)return e.substr(0,a)+r[a]+n.substr(a+1);if(u>=0)return e.substr(0,u)+t[u]+n.substr(u+1);return null}if(i(e[a],f)<0)u=a}if(o<r.length&&s==="next")return e+n.substr(e.length);if(o<e.length&&s==="prev")return e.substr(0,n.length);return u<0?null:e.substr(0,u)+r[u]+n.substr(u+1)}function s(e,t,s){function h(e){o=n(e);u=r(e);a=e==="next"?xt:Tt;f=o(s);l=u(s);c=e}var o,u,a,f,l,c;h("next");e._ondirectionchange=function(e){h(e)};e._addAlgorithm(function(e,n,r){var s=e.key;if(typeof s!=="string")return false;var o=u(s);if(t(o,l)){n(function(){e.continue()});return true}else{var h=i(s,o,f,l,a,c);if(h){n(function(){e.continue(h)})}else{n(r)}return false}})}return{between:function(e,t,n,r){n=n!==false;r=r===true;if(e>t||e==t&&(n||r)&&!(n&&r))return(new this._ctx.collClass(this,w.only(e))).limit(0);return new this._ctx.collClass(this,w.bound(e,t,!n,!r))},equals:function(e){return new this._ctx.collClass(this,w.only(e))},above:function(e){return new this._ctx.collClass(this,w.lowerBound(e,true))},aboveOrEqual:function(e){return new this._ctx.collClass(this,w.lowerBound(e))},below:function(e){return new this._ctx.collClass(this,w.upperBound(e,true))},belowOrEqual:function(e){return new this._ctx.collClass(this,w.upperBound(e))},startsWith:function(t){if(typeof t!="string")return e(new this._ctx.collClass(this),new q("String expected"));return this.between(t,t+String.fromCharCode(65535),true,true)},startsWithIgnoreCase:function(t){if(typeof t!="string")return e(new this._ctx.collClass(this),new q("String expected"));if(t==="")return this.startsWith(t);var n=new this._ctx.collClass(this,w.bound(t.toUpperCase(),t.toLowerCase()+String.fromCharCode(65535)));s(n,function(e,t){return e.indexOf(t)===0},t);n._ondirectionchange=function(){e(n,new R("reverse() not supported with WhereClause.startsWithIgnoreCase()"))};return n},equalsIgnoreCase:function(t){if(typeof t!="string")return e(new this._ctx.collClass(this),new q("String expected"));var n=new this._ctx.collClass(this,w.bound(t.toUpperCase(),t.toLowerCase()));s(n,function(e,t){return e===t},t);return n},anyOf:function(e){var n=t(arguments);if(n.length===0)return(new this._ctx.collClass(this,w.only(""))).limit(0);var r=new this._ctx.collClass(this,w.bound(n[0],n[n.length-1]));var i=xt;r._ondirectionchange=function(e){i=e==="next"?xt:Tt;n.sort(i)};var s=0;r._addAlgorithm(function(e,t,r){var o=e.key;while(i(o,n[s])>0){++s;if(s===n.length){t(r);return false}}if(o===n[s]){t(function(){e.continue()});return true}else{t(function(){e.continue(n[s])});return false}});return r}}});i(mt.prototype,function(){function e(e,t){e.filter=Nt(e.filter,t)}function t(e,t){e.isMatch=Nt(e.isMatch,t)}function n(e,t){return e.isPrimKey?t:t.index(e.index)}function r(e,t){return n(e,t)[e.op](e.range||null,e.dir+e.unique)}function i(e,t,n,i,s){if(!e.or){Et(r(e,s),Nt(e.algorithm,e.filter),t,n,i,e.table.hook.reading.fire)}else{(function(){function l(){if(++f===2)n()}function c(e,n,r){if(!o||o(n,r,l,i)){var s=n.primaryKey.toString();if(!u.hasOwnProperty(s)){u[s]=true;t(e,n,r)}}}var o=e.filter;var u={};var a=e.table.schema.primKey.keyPath;var f=0;e.or._iterate(c,l,i,s);Et(r(e,s),e.algorithm,c,l,i,e.table.hook.reading.fire)})()}}function s(e){return e.table.schema.instanceTemplate}return{_read:function(e,t){var n=this._ctx;if(n.error)return n.table._trans(null,function(t,r){r(n.error)});else return n.table._idbstore(G,e).then(t)},_write:function(e){var t=this._ctx;if(t.error)return t.table._trans(null,function(n,r){r(t.error)});else return t.table._idbstore(Y,e,"locked")},_addAlgorithm:function(e){var t=this._ctx;t.algorithm=Nt(t.algorithm,e)},_iterate:function(e,t,n,r){return i(this._ctx,e,t,n,r)},each:function(e){var t=this._ctx;S(function(){e(s(t))});return this._read(function(n,r,s){i(t,e,n,r,s)})},count:function(e){S(function(){e(0)});var t=this,r=this._ctx;if(r.filter||r.algorithm||r.or){var s=0;return this._read(function(e,t,n){i(r,function(){++s;return false},function(){e(s)},t,n)},e)}else{return this._read(function(e,i,s){var o=n(r,s);var u=r.range?o.count(r.range):o.count();u.onerror=_(i,["calling","count()","on",t.name]);u.onsuccess=function(t){e(Math.min(t.target.result,Math.max(0,r.limit-r.offset)))}},e)}},sortBy:function(e,t){function u(e,t){if(t)return u(e[r[t]],t-1);return e[i]}function f(e,t){var n=u(e,o),r=u(t,o);return n<r?-a:n>r?a:0}var n=this._ctx;S(function(){t([s(n)])});var r=e.split(".").reverse(),i=r[0],o=r.length-1;var a=this._ctx.dir==="next"?1:-1;return this.toArray(function(e){return e.sort(f)}).then(t)},toArray:function(e){var t=this._ctx;S(function(){e([s(t)])});return this._read(function(e,n,r){var s=[];i(t,function(e){s.push(e)},function(){e(s)},n,r)},e)},offset:function(t){var n=this._ctx;if(t<=0)return this;n.offset+=t;if(!n.or&&!n.algorithm&&!n.filter){e(n,function(n,r,i){if(t===0)return true;if(t===1){--t;return false}r(function(){n.advance(t);t=0});return false})}else{e(n,function(n,r,i){return--t<0})}return this},limit:function(t){this._ctx.limit=Math.min(this._ctx.limit,t);e(this._ctx,function(e,n,r){if(--t<=0)n(r);return t>=0});return this},until:function(t,n){var r=this._ctx;S(function(){t(s(r))});e(this._ctx,function(e,r,i){if(t(e.value)){r(i);return n}else{return true}});return this},first:function(e){var t=this;S(function(){e(s(t._ctx))});return this.limit(1).toArray(function(e){return e[0]}).then(e)},last:function(e){return this.reverse().first(e)},and:function(n){var r=this;S(function(){n(s(r._ctx))});e(this._ctx,function(e){return n(e.value)});t(this._ctx,n);return this},or:function(e){return new vt(this._ctx.table,e,this)},reverse:function(){this._ctx.dir=this._ctx.dir=="prev"?"next":"prev";if(this._ondirectionchange)this._ondirectionchange(this._ctx.dir);return this},desc:function(){return this.reverse()},eachKey:function(e){var t=this,n=this._ctx;S(function(){e(s(t._ctx)[t._ctx.index])});if(!n.isPrimKey)n.op="openKeyCursor";return this.each(function(t,n){e(n.key,n)})},eachUniqueKey:function(e){this._ctx.unique="unique";return this.eachKey(e)},keys:function(e){S(function(){e([s(n)[t._ctx.index]])});var t=this,n=this._ctx;if(!n.isPrimKey)n.op="openKeyCursor";var r=[];return this.each(function(e,t){r.push(t.key)}).then(function(){return r}).then(e)},uniqueKeys:function(e){this._ctx.unique="unique";return this.keys(e)},firstKey:function(e){var t=this;return this.limit(1).keys(function(e){return e[0]}).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var t={};e(this._ctx,function(e){var n=e.primaryKey.toString();var r=t.hasOwnProperty(n);t[n]=true;return!r});return this}}});s(gt).from(mt).extend({modify:function(e){var t=this,n=this._ctx,r=n.table.hook,s=r.updating.fire,o=r.deleting.fire;S(function(){if(typeof e==="function"){e.call({value:n.table.schema.instanceTemplate},n.table.schema.instanceTemplate)}});return this._write(function(r,u,a,l){function E(e,t,r){w=t.primaryKey;var i={primKey:t.primaryKey,value:e};if(c.call(i,e)!==false){var s=!i.hasOwnProperty("value");var o=s?t.delete():t.update(i.value);++v;o.onerror=_(function(e){y.push(e);b.push(i.primKey);if(i.onerror)i.onerror(e);return true},s?["deleting",e,"from",n.table.name]:["modifying",e,"on",n.table.name]);o.onsuccess=function(e){if(i.onsuccess)i.onsuccess(i.value);++m;x()}}}function S(e){if(e){y.push(e);b.push(w)}return u(new F("Error modifying one or more objects",y,m,b))}function x(){if(g&&m+y.length===v){if(y.length>0)S();else r(m)}}var c;if(typeof e==="function"){if(s===f&&o===f){c=e}else{c=function(t){var n=L(t);if(e.call(this,t)===false)return false;if(!this.hasOwnProperty("value")){o.call(this,this.primKey,t,l)}else{var r=A(n,this.value);var i=s.call(this,r,this.primKey,n,l);if(i){t=this.value;Object.keys(i).forEach(function(e){N(t,e,i[e])})}}}}}else if(s===f){var h=Object.keys(e);var p=h.length;c=function(t){var n=false;for(var r=0;r<p;++r){var i=h[r],s=e[i];if(T(t,i)!==s){N(t,i,s);n=true}}return n}}else{var d=e;e=k(d);c=function(t){var n=false;var r=s.call(this,e,this.primKey,L(t),l);if(r)i(e,r);Object.keys(e).forEach(function(r){var i=e[r];if(T(t,r)!==i){N(t,r,e[r]);n=true}});if(r)e=k(d);return n}}var v=0;var m=0;var g=false;var y=[];var b=[];var w=null;t._iterate(E,function(){g=true;x()},S,a)})},"delete":function(){return this.modify(function(){delete this.value})}});i(this,{Collection:mt,Table:ht,Transaction:dt,Version:it,WhereClause:vt,WriteableCollection:gt,WriteableTable:pt});rt();u.addons.forEach(function(e){e(Z)})}function f(){}function l(e){return e}function c(e,t){if(e===l)return t;return function(n){return t(e(n))}}function h(e,t){return function(){e.apply(this,arguments);t.apply(this,arguments)}}function p(e,t){if(e===f)return t;return function(){var n=e.apply(this,arguments);if(n!==r)arguments[0]=n;var i=this.onsuccess,s=this.onerror;delete this.onsuccess;delete this.onerror;var o=t.apply(this,arguments);if(i)this.onsuccess=this.onsuccess?h(i,this.onsuccess):i;if(s)this.onerror=this.onerror?h(s,this.onerror):s;return o!==r?o:n}}function d(e,t){if(e===f)return t;return function(){var n=e.apply(this,arguments);if(n!==r)i(arguments[0],n);var s=this.onsuccess,o=this.onerror;delete this.onsuccess;delete this.onerror;var u=t.apply(this,arguments);if(s)this.onsuccess=this.onsuccess?h(s,this.onsuccess):s;if(o)this.onerror=this.onerror?h(o,this.onerror):o;return n===r?u===r?r:u:n.extend(u)}}function v(e,t){if(e===f)return t;return function(){if(e.apply(this,arguments)===false)return false;return t.apply(this,arguments)}}function m(e,t){if(e===f)return t;return function(){if(t.apply(this,arguments)===false)return false;return e.apply(this,arguments)}}function g(e,t){if(e===f)return t;return function(){e.apply(this,arguments);t.apply(this,arguments)}}function y(e,t){if(e===f)return t;return function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){var r=this,i=arguments;return n.then(function(){return t.apply(r,i)})}return t.apply(this,arguments)}}function b(t,n){function o(e,t,n){if(Array.isArray(e))return a(e);if(typeof e==="object")return u(e);if(!t)t=v;if(!n)n=f;var r={subscribers:[],fire:n,subscribe:function(e){r.subscribers.push(e);r.fire=t(r.fire,e)},unsubscribe:function(e){r.subscribers=r.subscribers.filter(function(t){return t!==e});r.fire=r.subscribers.reduce(t,n)}};i[e]=s[e]=r;return r}function u(t){Object.keys(t).forEach(function(n){var r=t[n];if(Array.isArray(r)){o(n,t[n][0],t[n][1])}else if(r==="asap"){var i=o(n,null,function(){var n=arguments;i.subscribers.forEach(function(t){E(function(){t.apply(e,n)})})});i.subscribe=function(e){if(i.subscribers.indexOf(e)===-1)i.subscribers.push(e)};i.unsubscribe=function(e){var t=i.subscribers.indexOf(e);if(t!==-1)i.subscribers.splice(t,1)}}else throw new Error("Invalid event config")})}function a(e){function n(){if(t)return false;t=true}var t=false;e.forEach(function(e){o(e).subscribe(n)})}var r=arguments;var i={};var s=function(e,n){if(n){var r=[].slice.call(arguments,1);var s=i[e];s.subscribe.apply(s,r);return t}else if(typeof e==="string"){return i[e]}};s.addEventType=o;for(var l=1,c=r.length;l<c;++l){o(r[l])}return s}function w(e){if(!e)throw new Error("Assertion failed")}function E(t){if(e.setImmediate)setImmediate(t);else setTimeout(t,0)}function S(e){var t=setTimeout(e,1e3);clearTimeout(t)}function x(e,t,n){return function(){var r=a.PSD;a.PSD=n;try{e.apply(this,arguments)}catch(i){t(i)}finally{a.PSD=r}}}function T(e,t){if(e.hasOwnProperty(t))return e[t];if(!t)return e;if(typeof t!=="string"){var n=[];for(var i=0,s=t.length;i<s;++i){var o=T(e,t[i]);if(o===r)return;n.push(o)}return o}var u=t.indexOf(".");if(u!==-1){var a=e[t.substr(0,u)];return a===r?r:T(a,t.substr(u+1))}return r}function N(e,t,n){if(!e||t===r)return;if(Array.isArray(t)){w(Array.isArray(n));for(var i=0,s=t.length;i<s;++i){N(e,t[i],n[i])}}else{var o=t.indexOf(".");if(o!==-1){var u=t.substr(0,o);var a=t.substr(o+1);if(a==="")if(n===r)delete e[u];else e[u]=n;else{var f=e[u];if(!f)f=e[u]={};N(f,a,n)}}else{if(n===r)delete e[t];else e[t]=n}}}function C(e,t){N(e,t,r)}function k(e){var t={};for(var n in e){if(e.hasOwnProperty(n))t[n]=e[n]}return t}function L(e){if(!e||typeof e!=="object")return e;var t;if(Array.isArray(e)){t=[];for(var n=0,r=e.length;n<r;++n){t.push(L(e[n]))}}else if(e instanceof Date){t=new Date;t.setTime(e.getTime())}else{t=e.constructor?Object.create(e.constructor.prototype):{};for(var i in e){if(e.hasOwnProperty(i)){t[i]=L(e[i])}}}return t}function A(e,t){var n={};for(var i in e)if(e.hasOwnProperty(i)){if(!t.hasOwnProperty(i))n[i]=r;else if(e[i]!==t[i]&&JSON.stringify(e[i])!=JSON.stringify(t[i]))n[i]=t[i]}for(var i in t)if(t.hasOwnProperty(i)&&!e.hasOwnProperty(i)){n[i]=t[i]}return n}function O(e){if(typeof e=="function"){return new e}else if(Array.isArray(e)){return[O(e[0])]}else if(e&&typeof e=="object"){var t={};M(t,e);return t}else{return e}}function M(e,t){Object.keys(t).forEach(function(n){var r=O(t[n]);e[n]=r})}function _(e,t){return function(n){var r=n&&n.target.error||new Error;if(t){var i=" occured when "+t.map(function(e){switch(typeof e){case"function":return e();case"string":return e;default:return JSON.stringify(e)}}).join(" ");if(r.name){r.toString=function s(){return r.name+i+(r.message?". "+r.message:"")}}else{r=r+i}}e(r);n.stopPropagation();n.preventDefault();return false}}function D(e){try{throw e}catch(t){return t}}function P(e){e.preventDefault()}function H(e){var t;try{t=JSON.parse(localStorage.getItem("Dexie.DatabaseNames")||"[]")}catch(n){t=[]}if(e(t)){localStorage.setItem("Dexie.DatabaseNames",JSON.stringify(t))}}function B(e,t,n,r,i,s,o){this.name=e;this.keyPath=t;this.unique=n;this.multi=r;this.auto=i;this.compound=s;this.dotted=o;this.src=(n?"&":"")+(r?"*":"")+(i?"++":"")+t}function j(e,t,n,r){this.name=e;this.primKey=t||new B;this.indexes=n||[new B];this.instanceTemplate=r;this.mappedClass=null}function F(e,t,n,r){this.name="ModifyError";this.failures=t;this.failedKeys=r;this.successCount=n;this.message=t.join("\n")}var a=function(){function t(n){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof n!=="function")throw new TypeError("not a function");this._state=null;this._value=null;this._deferreds=[];this._catched=false;var r=this;var o=true;this._PSD=t.PSD;try{a(this,n,function(t){if(o)e(i,r,t);else i(r,t)},function(t){if(o){e(s,r,t);return false}else{return s(r,t)}})}finally{o=false}}function n(e){var t=this;if(this._state===null){this._deferreds.push(e);return}var n=t._state?e.onFulfilled:e.onRejected;if(n===null){return(t._state?e.resolve:e.reject)(t._value)}var i;try{i=n(t._value);if(!t._state&&(!i||typeof i.then!=="function"||i._state!==false))r(t)}catch(s){var o=e.reject(s);if(!o&&t.onuncatched){try{t.onuncatched(s)}catch(s){}}return}e.resolve(i)}function r(e){e._catched=true;if(e._parent)r(e._parent)}function i(e,n){var r=t.PSD;t.PSD=e._PSD;try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&(typeof n==="object"||typeof n==="function")){if(typeof n.then==="function"){a(e,function(e,t){n.then(e,t)},function(t){i(e,t)},function(t){s(e,t)});return}}e._state=true;e._value=n;o.call(e)}catch(u){s(u)}finally{t.PSD=r}}function s(e,n){var r=t.PSD;t.PSD=e._PSD;e._state=false;e._value=n;o.call(e);if(!e._catched&&e.onuncatched){try{e.onuncatched(e._value)}catch(i){}}t.PSD=r;return e._catched}function o(){for(var e=0,t=this._deferreds.length;e<t;e++){n.call(this,this._deferreds[e])}this._deferreds=[]}function u(e,t,n,r){this.onFulfilled=typeof e==="function"?e:null;this.onRejected=typeof t==="function"?t:null;this.resolve=n;this.reject=r}function a(e,t,n,r){var i=false;try{t(function(t){if(i)return;i=true;n(t)},function(n){if(i)return e._catched;i=true;return r(n)})}catch(s){if(i)return;return r(s)}}var e=typeof setImmediate==="undefined"?function(e,t,n,r){var i=arguments;setTimeout(function(){e.apply(this,[].slice.call(i,1))},0)}:function(e,t,n,r){setImmediate.apply(this,arguments)};t.all=function(){var e=Array.prototype.slice.call(arguments.length===1&&Array.isArray(arguments[0])?arguments[0]:arguments);return new t(function(t,n){function i(s,o){try{if(o&&(typeof o==="object"||typeof o==="function")){var u=o.then;if(typeof u==="function"){u.call(o,function(e){i(s,e)},n);return}}e[s]=o;if(--r===0){t(e)}}catch(a){n(a)}}if(e.length===0)return t([]);var r=e.length;for(var s=0;s<e.length;s++){i(s,e[s])}})};t.prototype.then=function(e,r){var i=this;var s=new t(function(t,s){n.call(i,new u(e,r,t,s))});s._PSD=this._PSD;s.onuncatched=this.onuncatched;s._parent=this;return s};t.prototype["catch"]=function(e){if(arguments.length===1)return this.then(null,e);var n=arguments[0],r=arguments[1];if(typeof n==="function")return this.then(null,function(e){if(e instanceof n)return r(e);else return t.reject(e)});else return this.then(null,function(e){if(e&&e.name===n)return r(e);else return t.reject(e)})};t.prototype["finally"]=function(e){return this.then(function(t){e();return t},function(n){e();return t.reject(n)})};t.prototype.onuncatched=null;t.resolve=function(e){var n=new t(function(){});n._state=true;n._value=e;return n};t.reject=function(e){var n=new t(function(){});n._state=false;n._value=e;return n};t.race=function(e){return new t(function(t,n){e.map(function(e){e.then(t,n)})})};t.PSD=null;t.newPSD=function(e){var n=t.PSD;t.PSD=n?Object.create(n):{};try{return e()}finally{t.PSD=n}};return t}();s(F).from(Error);u.delete=function(e){var t=new u(e),n=t.delete();n.onblocked=function(e){t.on("blocked",e);return this};return n};u.getDatabaseNames=function(e){return(new a(function(e,t){if("webkitGetDatabaseNames"in indexedDB||"getDatabaseNames"in indexedDB){var n="getDatabaseNames"in indexedDB?indexedDB.getDatabaseNames():indexedDB.webkitGetDatabaseNames();n.onsuccess=function(t){e([].slice.call(t.target.result,0))};n.onerror=_(t)}else{H(e)}})).then(e)};u.defineClass=function(e){function t(e){if(e)i(this,e)}M(t.prototype,e);return t};u.spawn=function(e){return a.newPSD(function(){a.PSD.trans=null;return e()})};u.vip=function(e){return a.newPSD(function(){a.PSD.letThrough=true;return e()})};Object.defineProperty(u,"currentTransaction",{get:function(){return a.PSD&&a.PSD.trans||null}});u.Promise=a;u.derive=s;u.extend=i;u.override=o;u.events=b;u.getByKeyPath=T;u.setByKeyPath=N;u.delByKeyPath=C;u.shallowClone=k;u.deepClone=L;u.addons=[];u.fakeAutoComplete=S;u.asap=E;u.ModifyError=F;u.MultiModifyError=F;u.IndexSpec=B;u.TableSchema=j;u.dependencies={indexedDB:e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB,IDBKeyRange:e.IDBKeyRange||e.webkitIDBKeyRange,IDBTransaction:e.IDBTransaction||e.webkitIDBTransaction,Error:e.Error||String,SyntaxError:e.SyntaxError||String,TypeError:e.TypeError||String,DOMError:e.DOMError||String};u.version=.99;t("Dexie",u)}).apply(this,typeof module==="undefined"||typeof window!=="undefined"&&this==window?[window,function(e,t){window[e]=t},true]:[global,function(e,t){module.exports=t},false])
