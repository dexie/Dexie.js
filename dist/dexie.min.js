!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.Dexie=t()}(this,function(){"use strict";function n(n,t){return"object"!=typeof t&&(t=t()),tn(t).forEach(function(e){n[e]=t[e]}),n}function t(t){return{from:function(e){return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,{extend:function(r){n(t.prototype,"object"!=typeof r?r(e.prototype):r)}}}}}function e(n,t,e){return on.call(n,t,e)}function r(n,t){return t(n)}function o(n){var t=setTimeout(n,1e3);clearTimeout(t)}function i(n){if(!n)throw new hn.Internal("Assertion failed")}function u(n){rn.setImmediate?setImmediate(n):setTimeout(n,0)}function a(n,t){try{n()}catch(e){t&&t(e)}}function c(n){if(n.stack)return n;try{var t=new Error(n.message||n);if(t.stack)return n.stack=t.stack,n;throw t}catch(e){n.stack=e.stack}return n}function s(n){return T.reject(c(n))}function f(n,t){if(n.hasOwnProperty(t))return n[t];if(!t)return n;if("string"!=typeof t){for(var e=[],r=0,o=t.length;o>r;++r){var i=f(n,t[r]);e.push(i)}return e}var u=t.indexOf(".");if(-1!==u){var a=n[t.substr(0,u)];return void 0===a?void 0:f(a,t.substr(u+1))}}function l(n,t,e){if(n&&void 0!==t&&!("isFrozen"in Object&&Object.isFrozen(n)))if("string"!=typeof t&&"length"in t){i("string"!=typeof e&&"length"in e);for(var r=0,o=t.length;o>r;++r)l(n,t[r],e[r])}else{var u=t.indexOf(".");if(-1!==u){var a=t.substr(0,u),c=t.substr(u+1);if(""===c)void 0===e?delete n[a]:n[a]=e;else{var s=n[a];s||(s=n[a]={}),l(s,c,e)}}else void 0===e?delete n[t]:n[t]=e}}function h(n,t){"string"==typeof t?l(n,t,void 0):"length"in t&&[].map.call(t,function(t){l(n,t,void 0)})}function d(n){var t={};for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function p(n){if(!n||"object"!=typeof n)return n;var t;if(en(n)){t=[];for(var e=0,r=n.length;r>e;++e)t.push(p(n[e]))}else if(n instanceof Date)t=new Date,t.setTime(n.getTime());else{t=n.constructor?Object.create(n.constructor.prototype):{};for(var o in n)n.hasOwnProperty(o)&&(t[o]=p(n[o]))}return t}function v(n,t,e,r){e=e||{},r=r||"";for(var o in n)if(n.hasOwnProperty(o))if(t.hasOwnProperty(o)){var i=n[o],u=t[o];"object"==typeof i&&"object"==typeof u?v(i,u,e,r+o+"."):i!==u&&(e[r+o]=t[o])}else e[r+o]=void 0;for(o in t)t.hasOwnProperty(o)&&!n.hasOwnProperty(o)&&(e[r+o]=t[o]);return e}function y(n,t){this.name=n,this.message=t}function m(n,t){return n+". Errors: "+t.map(function(n){return n.toString()}).filter(function(n,t,e){return e.indexOf(n)===t}).join("\n")}function g(n,t,e,r){this.name="ModifyError",this.failures=t,this.failedKeys=r,this.successCount=e,this.message=m(n,t)}function b(n,t){this.name="BulkError",this.failures=t,this.message=m(n,t)}function w(n,t){var e=n;return n instanceof y||!n.name||!dn[n.name]||(e=new dn[n.name](t||n.message,n),n.stack&&(e.stack=n.stack)),e}function _(){}function x(n){return n}function P(n,t){return null==n||n===x?t:function(e){return t(n(e))}}function k(n,t){return function(){n.apply(this,arguments),t.apply(this,arguments)}}function D(n,t){return n===_?t:function(){var e=n.apply(this,arguments);void 0!==e&&(arguments[0]=e);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var i=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?k(r,this.onsuccess):r),o&&(this.onerror=this.onerror?k(o,this.onerror):o),void 0!==i?i:e}}function S(n,t){return n===_?t:function(){n.apply(this,arguments);var e=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),e&&(this.onsuccess=this.onsuccess?k(e,this.onsuccess):e),r&&(this.onerror=this.onerror?k(r,this.onerror):r)}}function O(t,e){return t===_?e:function(){var r=t.apply(this,arguments);void 0!==r&&n(arguments[0],r);var o=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var u=e.apply(this,arguments);return o&&(this.onsuccess=this.onsuccess?k(o,this.onsuccess):o),i&&(this.onerror=this.onerror?k(i,this.onerror):i),void 0===r?void 0===u?void 0:u:void 0===u?r:n(r,u)}}function I(n,t){return n===_?t:function(){return n.apply(this,arguments)===!1?!1:t.apply(this,arguments)}}function E(n,t){return n===_?t:function(){return t.apply(this,arguments)===!1?!1:n.apply(this,arguments)}}function C(n,t){return n===_?t:function(){var e=n.apply(this,arguments);if(e&&"function"==typeof e.then){var r=this,o=arguments;return e.then(function(){return t.apply(r,o)})}return t.apply(this,arguments)}}function j(n){function t(n,t,e){if(en(n))return o(n);if("object"==typeof n)return r(n);t||(t=I),e||(e=_);var i={subscribers:[],fire:e,subscribe:function(n){i.subscribers.push(n),i.fire=t(i.fire,n)},unsubscribe:function(n){i.subscribers=i.subscribers.filter(function(t){return t!==n}),i.fire=i.subscribers.reduce(t,e)}};return a[n]=c[n]=i,i}function r(n){tn(n).forEach(function(e){var r=n[e];if(en(r))t(e,n[e][0],n[e][1]);else{if("asap"!==r)throw new hn.InvalidArgument("Invalid event config");var o=t(e,null,function(){var n=arguments;o.subscribers.forEach(function(t){u(function(){t.apply(rn,n)})})});o.subscribe=function(n){-1===o.subscribers.indexOf(n)&&o.subscribers.push(n)},o.unsubscribe=function(n){var t=o.subscribers.indexOf(n);-1!==t&&o.subscribers.splice(t,1)}}})}function o(n){function e(){return r?!1:void(r=!0)}var r=!1;n.forEach(function(n){t(n).subscribe(e)})}var i=arguments,a={},c=function(t,r){if(r){var o=e(arguments,1),i=a[t];return i.subscribe.apply(i,o),n}return"string"==typeof t?a[t]:void 0};c.addEventType=t;for(var s=1,f=i.length;f>s;++s)t(i[s]);return c}function A(){var n=gn;gn=[];for(var t=0,e=n.length;e>t;++t){var r=n[t];r[0].apply(rn,r[1])}}function T(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],this._catched=!1;var t=this,e=!0;this._PSD=T.PSD;try{U(this,n,function(n){e?yn(N,t,n):N(t,n)},function(n){return e?(yn(R,t,n),!1):R(t,n)})}finally{e=!1}}function K(n,t){if(null===n._state)return void n._deferreds.push(t);var e=n._state?t.onFulfilled:t.onRejected;if(null===e)return(n._state?t.resolve:t.reject)(n._value);var r,o=mn;mn=!1,yn=wn;try{var i=T.PSD;T.PSD=n._PSD,r=e(n._value),n._state||r&&"function"==typeof r.then&&r._state===!1||B(n),t.resolve(r)}catch(u){t.reject(u)}finally{if(T.PSD=i,o){do{for(;gn.length>0;)A();var a=bn.pop();if(a)try{a()}catch(u){}}while(bn.length>0||gn.length>0);yn=vn,mn=!0}}}function F(n){var t=mn;mn=!1,yn=wn;try{return n()}finally{if(t){do{for(;gn.length>0;)A();var e=bn.pop();if(e)try{e()}catch(r){}}while(bn.length>0||gn.length>0);yn=vn,mn=!0}}}function B(n){n._catched=!0,n._parent&&!n._parent._catched&&B(n._parent)}function N(n,t){var e=T.PSD;T.PSD=n._PSD;try{if(t===n)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then)return t instanceof T&&null!==t._state?(n._state=t._state,n._value=t._value,void q.call(n)):void U(n,function(n,e){t.then(n,e)},function(t){N(n,t)},function(t){R(n,t)});n._state=!0,n._value=t,q.call(n)}catch(r){R(r)}finally{T.PSD=e}}function R(n,t){var e=T.PSD;if(T.PSD=n._PSD,n._state=!1,n._value=t,q.call(n),!n._catched)try{n.onuncatched?n.onuncatched(n._value):T.on.error.fire(n._value)}catch(r){}return T.PSD=e,n._catched}function q(){for(var n=0,t=this._deferreds.length;t>n;n++)K(this,this._deferreds[n]);this._deferreds=[]}function M(n,t,e,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof t?t:null,this.resolve=e,this.reject=r}function U(n,t,e,r){var o=!1;try{t(function(n){o||(o=!0,e(n))},function(t){return o?n._catched:(o=!0,r(t))})}catch(i){if(o)return;return r(i)}}function V(n){console.error("Uncaught Promise: "+(n.stack||n))}function W(o,i){function h(){Xn.on("versionchange",function(n){n.newVersion>0?console.warn("Another connection wants to upgrade database '"+Xn.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+Xn.name+"'. Closing db now to resume the delete request."),Xn.close()}),Xn.on("blocked",function(n){!n.newVersion||n.newVersion<n.oldVersion?console.warn("Dexie.delete('"+Xn.name+"') was blocked"):console.warn("Upgrade '"+Xn.name+"' blocked by other connection holding version "+n.oldVersion/10)})}function y(n){this._cfg={version:n,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function m(n,t,o,i){if(0===n){tn(Mn).forEach(function(n){I(t,n,Mn[n].primKey,Mn[n].indexes)});var u=Xn._createTransaction(Qn,Vn,Mn);u.idbtrans=t,u.idbtrans.onerror=J(o,["populating database"]),u.on("error").subscribe(o),T.newPSD(function(){T.PSD.trans=u;try{Xn.on("populate").fire(u)}catch(n){i.onerror=t.onerror=function(n){n.preventDefault()};try{t.abort()}catch(e){}t.db.close(),o(n)}})}else{var a=[],c=Un.filter(function(t){return t._cfg.version===n})[0];if(!c)throw new hn.Upgrade("Dexie specification of currently installed DB version is missing");Mn=Xn._dbSchema=c._cfg.dbschema;var s=!1,f=Un.filter(function(t){return t._cfg.version>n});f.forEach(function(n){var i=Mn,u=n._cfg.dbschema;An(i,t),An(u,t),Mn=Xn._dbSchema=u;var c=k(i,u);c.add.forEach(function(n){a.push(function(t,e){I(t,n[0],n[1].primKey,n[1].indexes),e()})}),c.change.forEach(function(n){if(n.recreate)throw new hn.Upgrade("Not yet support for changing primary key");a.push(function(t,e){var r=t.objectStore(n.name);n.add.forEach(function(n){F(r,n)}),n.change.forEach(function(n){r.deleteIndex(n.name),F(r,n)}),n.del.forEach(function(n){r.deleteIndex(n)}),e()})}),n._cfg.contentUpgrade&&a.push(function(t,i){s=!0;var a=Xn._createTransaction(Qn,e(t.db.objectStoreNames),u);a.idbtrans=t;var c=0;a._promise=r(a._promise,function(n){return function(t,e,r){function o(n){return function(){n.apply(this,arguments),0===--c&&i()}}return++c,n.call(this,t,function(n,t){arguments[0]=o(n),arguments[1]=o(t),e.apply(this,arguments)},r)}}),t.onerror=J(o,["running upgrader function for version",n._cfg.version]),a.on("error").subscribe(o),n._cfg.contentUpgrade(a),0===c&&i()}),s&&!On||a.push(function(n,t){K(u,n),t()})});var l=function(){try{a.length?a.shift()(t,l):A(Mn,t)}catch(n){i.onerror=t.onerror=function(n){n.preventDefault()};try{t.abort()}catch(e){}t.db.close(),o(n)}};l()}}function k(n,t){var e={del:[],add:[],change:[]};for(var r in n)t[r]||e.del.push(r);for(r in t){var o=n[r],i=t[r];if(o){var u={name:r,def:t[r],recreate:!1,del:[],add:[],change:[]};if(o.primKey.src!==i.primKey.src)u.recreate=!0,e.change.push(u);else{var a=o.indexes.reduce(function(n,t){return n[t.name]=t,n},{}),c=i.indexes.reduce(function(n,t){return n[t.name]=t,n},{});for(var s in a)c[s]||u.del.push(s);for(s in c){var f=a[s],l=c[s];f?f.src!==l.src&&u.change.push(l):u.add.push(l)}(u.recreate||u.del.length>0||u.add.length>0||u.change.length>0)&&e.change.push(u)}}else e.add.push([r,i])}return e}function I(n,t,e,r){var o=n.db.createObjectStore(t,e.keyPath?{keyPath:e.keyPath,autoIncrement:e.auto}:{autoIncrement:e.auto});return r.forEach(function(n){F(o,n)}),o}function A(n,t){tn(n).forEach(function(e){t.db.objectStoreNames.contains(e)||I(t,e,n[e].primKey,n[e].indexes)})}function K(n,t){for(var e=0;e<t.db.objectStoreNames.length;++e){var r=t.db.objectStoreNames[e];null!==n[r]&&void 0!==n[r]||t.db.deleteObjectStore(r)}}function F(n,t){n.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function B(){Zn.forEach(function(n){n.resume()})}function N(n,t){throw new hn.InvalidTable("Table "+t[0]+" not part of transaction. Original Scope Function Source: "+W.Promise.PSD.trans.scopeFunc.toString())}function R(n,t,e,r){this.name=n,this.schema=e,this.hook=Wn[n]?Wn[n].hook:j(null,{creating:[D,_],reading:[P,x],updating:[O,_],deleting:[S,_]}),this._tpf=t,this._collClass=r||un}function q(n,t,e,r){R.call(this,n,t,e,r||an)}function M(n,t){var e=T.PSD;return function(r){try{r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault();var o=r.target.error;n.push(o),r.target._err&&T.usePSD(e,r.target._err.bind(null,o))}finally{t&&t()}}}function U(n){var t=T.PSD;return function(e){var r;try{r=e.target.error,e.target._err&&T.usePSD(t,e.target._err.bind(null,r))}finally{n(r)}}}function V(n,t){var e=T.PSD;return t?function(t){var r;try{r=t.target.result,t.target._suc&&T.usePSD(e,t.target._suc.bind(null,r))}finally{n&&n(r)}}:function(t){n(t.target.result)}}function z(n,t,e,r,o){return new T(function(i,u){var c=e.length,s=c-1;if(0===c)return i();if(r){var f={onsuccess:null,onerror:null},l=U(function(n){return u(w(n))}),h=V(null,!0);a(function(){for(var r=0;c>r;++r){var u=e[r];o.call(f,u[0],u[1],t);var a=n["delete"](u[0]);f.onerror&&(a._err=f.onerror),f.onsuccess&&(a._suc=f.onsuccess),a.onerror=l,r===s?a.onsuccess=V(i,!0):a.onsuccess=h,f.onsuccess=null,f.onerror=null}},function(n){throw f.onerror&&f.onerror(n),n})}else for(var d=0;c>d;++d){var p=n["delete"](e[d]);p.onerror=function(n){return u(w(n.target.error))},d===s&&(p.onsuccess=function(){return i()})}})}function rn(n,t,e,r){function o(n,t,e,r){return i._promise(n,e,r)}var i=this;this.db=Xn,this.mode=n,this.storeNames=t,this.idbtrans=null,this.on=j(this,["complete","error"],"abort"),this._reculock=0,this._blockedFuncs=[],this._psd=null,this.active=!0,this._dbschema=e,r&&(this.parent=r),this._tpf=o,this.tables=Object.create(Ln);for(var u=t.length-1;-1!==u;--u){var a=t[u],c=Xn._tableFactory(n,e[a],o);this.tables[a]=c,this[a]||(this[a]=c)}}function on(n,t,e){this._ctx={table:n,index:":id"===t?null:t,collClass:n._collClass,or:e}}function un(n,t){var e=null,r=null;if(t)try{e=t()}catch(o){r=c(w(o))}var i=n._ctx,u=i.table;this._ctx={table:u,index:i.index,isPrimKey:!i.index||u.schema.primKey.keyPath&&i.index===u.schema.primKey.name,range:e,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueFilter:u.hook.reading.fire}}function an(){un.apply(this,arguments)}function cn(n,t){return n._cfg.version-t._cfg.version}function sn(n,t,e,r,o,i){e.forEach(function(e){var u=Xn._tableFactory(r,o[e],t);n.forEach(function(n){n[e]||(i?Object.defineProperty(n,e,{configurable:!0,enumerable:!0,get:function(){var n=T.PSD&&T.PSD.trans;return n&&n.db===Xn?n.tables[e]:u}}):n[e]=u)})})}function fn(n){n.forEach(function(n){for(var t in n)n[t]instanceof R&&delete n[t]})}function ln(n,t,e,r,o,i){i=i||x,n.onerror||(n.onerror=J(o)),t?n.onsuccess=L(function(){var u=n.result;if(u){var a=function(){u["continue"]()};t(u,function(n){a=n},r,o)&&e(i(u.value),u,function(n){a=n}),a()}else r()},o):n.onsuccess=L(function(){var t=n.result;if(t){var o=function(){t["continue"]()};e(i(t.value),t,function(n){o=n}),o()}else r()},o)}function dn(n){var t=[];return n.split(",").forEach(function(n){n=n.trim();var e=n.replace("&","").replace("++","").replace("*",""),r=0!==e.indexOf("[")?e:n.substring(n.indexOf("[")+1,n.indexOf("]")).split("+");t.push(new X(e,r||null,-1!==n.indexOf("&"),-1!==n.indexOf("*"),-1!==n.indexOf("++"),en(r),-1!==r.indexOf(".")))}),t}function pn(n,t){return Rn.cmp(n,t)}function vn(n,t){return pn(n,t)<0?n:t}function yn(n,t){return pn(n,t)>0?n:t}function mn(n,t){return Rn.cmp(n,t)}function gn(n,t){return Rn.cmp(t,n)}function bn(n,t){return t>n?-1:n===t?0:1}function wn(n,t){return n>t?-1:n===t?0:1}function Sn(n,t){return n?t?function(){return n.apply(this,arguments)&&t.apply(this,arguments)}:n:t}function jn(){if(Xn.verno=zn.version/10,Xn._dbSchema=Mn={},Vn=e(zn.objectStoreNames,0),0!==Vn.length){var n=zn.transaction($(Vn),"readonly");Vn.forEach(function(t){for(var e=n.objectStore(t),r=e.keyPath,o=r&&"string"==typeof r&&-1!==r.indexOf("."),i=new X(r,r||"",!1,!1,!!e.autoIncrement,r&&"string"!=typeof r,o),u=[],a=0;a<e.indexNames.length;++a){var c=e.index(e.indexNames[a]);r=c.keyPath,o=r&&"string"==typeof r&&-1!==r.indexOf(".");var s=new X(c.name,r,!!c.unique,!!c.multiEntry,!1,r&&"string"!=typeof r,o);u.push(s)}Mn[t]=new Z(t,i,u,{})}),sn([Wn],Xn._transPromiseFactory,tn(Mn),Qn,Mn)}}function An(n,t){for(var r=t.db.objectStoreNames,o=0;o<r.length;++o)for(var i=r[o],u=t.objectStore(i),a=0;a<u.indexNames.length;++a){var c=u.indexNames[a],s=u.index(c).keyPath,f="string"==typeof s?s:"["+e(s).join("+")+"]";if(n[i]){var l=n[i].idxByName[f];l&&(l.name=c)}}}function Tn(n){Xn.on("blocked").fire(n),Dn.filter(function(n){return n.name===Xn.name&&n!==Xn&&!n._vcFired}).map(function(t){return t.on("versionchange").fire(n)})}var Kn=W.dependencies,Fn=n({addons:W.addons,autoOpen:!0,indexedDB:Kn.indexedDB,IDBKeyRange:Kn.IDBKeyRange},i||{}),Bn=Fn.addons,Nn=Fn.autoOpen,Rn=Fn.indexedDB,qn=Fn.IDBKeyRange,Mn=this._dbSchema={},Un=[],Vn=[],Wn={},Ln={},zn=null,Hn=!0,Jn=null,Gn=!1,Yn="readonly",Qn="readwrite",Xn=this,Zn=[],$n=!0,nt=!!nn(Rn);this.version=function(n){if(zn||Gn)throw new hn.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var t=Un.filter(function(t){return t._cfg.version===n})[0];return t?t:(t=new y(n),Un.push(t),Un.sort(cn),t)},n(y.prototype,{stores:function(t){this._cfg.storesSource=this._cfg.storesSource?n(this._cfg.storesSource,t):t;var e={};Un.forEach(function(t){n(e,t._cfg.storesSource)});var r=this._cfg.dbschema={};return this._parseStoresSpec(e,r),Mn=Xn._dbSchema=r,fn([Wn,Xn,Ln]),sn([Ln],N,tn(r),Qn,r),sn([Wn,Xn,this._cfg.tables],Xn._transPromiseFactory,tn(r),Qn,r,!0),Vn=tn(r),this},upgrade:function(n){var t=this;return En(function(){n(Xn._createTransaction(Qn,tn(t._cfg.dbschema),t._cfg.dbschema))}),this._cfg.contentUpgrade=n,this},_parseStoresSpec:function(n,t){tn(n).forEach(function(e){if(null!==n[e]){var r={},o=dn(n[e]),i=o.shift();if(i.multi)throw new hn.Schema("Primary key cannot be multi-valued");i.keyPath&&l(r,i.keyPath,i.auto?0:i.keyPath),o.forEach(function(n){if(n.auto)throw new hn.Schema("Only primary key can be marked as autoIncrement (++)");if(!n.keyPath)throw new hn.Schema("Index must have a name and cannot be an empty string");l(r,n.keyPath,n.compound?n.keyPath.map(function(){return""}):"")}),t[e]=new Z(e,i,o,r)}})}}),this._allTables=Wn,this._tableFactory=function(n,t,e){return n===Yn?new R(t.name,e,t,un):new q(t.name,e,t)},this._createTransaction=function(n,t,e,r){return new rn(n,t,e,r)},this._transPromiseFactory=function(n,t,e){if(!Hn||T.PSD&&T.PSD.letThrough){var r=Xn._createTransaction(n,t,Mn);return r._promise(n,function(n,t){r.error(function(n){Xn.on("error").fire(n)}),T.newPSD(function(){T.PSD.trans=r,e(function(t){r.complete(function(){n(t)})},t,r)})})}if(!Gn&&!Nn)return s(new hn.DatabaseClosed);var o=new T(function(r,i){Zn.push({resume:function(){var u=Xn._transPromiseFactory(n,t,e);o.onuncatched=u.onuncatched,u.then(r,i)}})});return Nn&&!Gn&&Xn.open()["catch"](_),o},this._whenReady=function(n){if(!Cn&&Hn&&(!T.PSD||!T.PSD.letThrough)){if(!Gn){if(!Nn)return s(new hn.DatabaseClosed);Xn.open()["catch"](_)}return new T(function(t,e){Zn.push({resume:function(){n(t,e)}})})}return new T(n)},this.verno=0,this.open=function(){return zn?T.resolve(Xn):Gn?new T(function(n,t){return Xn._whenReady(function(){n(Xn)},function(n){t(n)})}):(Jn=null,Gn=!0,Hn=!0,new T(function(n,t){function e(n){try{r.transaction.abort()}catch(e){}if(zn)try{zn.close()}catch(e){}zn=null,Gn=!1,Jn=w(n),Hn=!1,t(Jn),B()}Cn&&n();var r;try{if(Un.length>0&&($n=!1),!Rn)throw new hn.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using Safari, make sure to include indexedDB polyfill.");if(r=$n?Rn.open(o):Rn.open(o,Math.round(10*Xn.verno)),!r)throw new hn.MissingAPI("IndexedDB API not available");r.onerror=J(e,["opening database",o]),r.onblocked=Tn,r.onupgradeneeded=L(function(n){if($n&&!Xn._allowEmptyDB){r.onerror=function(n){n.preventDefault()},r.transaction.abort(),r.result.close();var t=Rn.deleteDatabase(o);t.onsuccess=t.onerror=function(){e(new hn.NoSuchDatabase("Database "+o+" doesnt exist"))}}else{r.transaction.onerror=J(e);var i=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;m(i/10,r.transaction,e,r)}},e),r.onsuccess=L(function(){if(Gn=!1,zn=r.result,$n)jn();else if(zn.objectStoreNames.length>0)try{An(Mn,zn.transaction($(zn.objectStoreNames),Yn))}catch(t){}zn.onversionchange=function(n){Xn._vcFired=!0,Xn.on("versionchange").fire(n)},nt||Y(function(n){return-1===n.indexOf(o)?n.push(o):void 0}),T.newPSD(function(){function t(){Hn=!1,B(),n()}T.PSD.letThrough=!0;try{var r=Xn.on.ready.fire();r&&"function"==typeof r.then?r.then(t,function(n){zn.close(),zn=null,e(n)}):u(t)}catch(o){e(o)}})},e)}catch(i){e(i)}}).then(function(){return Dn.push(Xn),Xn}))},this.close=function(){var n=Dn.indexOf(Xn);n>=0&&Dn.splice(n,1),zn?(zn.close(),zn=null,Nn=!1,Hn&&B(),Hn=!1,Jn=new hn.DatabaseClosed):Gn&&Xn.on("ready",function(){return T.reject(new hn.DatabaseClosed)})},this["delete"]=function(){var n=arguments;return new T(function(t,e){function r(){Xn.close();var n=Rn.deleteDatabase(o);n.onsuccess=function(){nt||Y(function(n){var t=n.indexOf(o);return t>=0?n.splice(t,1):void 0}),t()},n.onerror=J(e,["deleting",o]),n.onblocked=Tn}if(n.length>0)throw new hn.InvalidArgument("Arguments not allowed in db.delete()");Gn?Zn.push({resume:r}):r()})},this.backendDB=function(){return zn},this.isOpen=function(){return null!==zn},this.hasFailed=function(){return null!==Jn},this.dynamicallyOpened=function(){return $n},this.name=o,Object.defineProperty(this,"tables",{get:function(){return tn(Wn).map(function(n){return Wn[n]})}}),this.on=j(this,"error","populate",{blocked:[E,_],ready:[C,_],versionchange:[E,_]}),this.on.ready.subscribe=r(this.on.ready.subscribe,function(n){return function(t,e){function r(){return e||Xn.on.ready.unsubscribe(r),t.apply(this,arguments)}n.call(this,r),Xn.isOpen()&&(Hn?Zn.push({resume:r}):r())}}),En(function(){Xn.on("populate").fire(Xn._createTransaction(Qn,Vn,Mn)),Xn.on("error").fire(new Error)}),this.transaction=function(n,t,o){function i(t,e){var i=null,s=!0;try{if(l)throw l;i=Xn._createTransaction(n,h,Mn,a);var f=h.map(function(n){return i.tables[n]});f.push(i);var d,p=0;T.newPSD(function(){T.PSD.trans=i,i.scopeFunc=o,a&&(i.idbtrans=a.idbtrans,i._promise=r(i._promise,function(n){return function(t,e,r){function o(n){return function(t){var e;return T._rootExec(function(){e=n(t),T._tickFinalize(function(){0===--p&&i.active&&(i.active=!1,i.on.complete.fire())})}),e}}return++p,n.call(this,t,function(n,t,r){return e(o(n),o(t),r)},r)}})),i.complete(function(){t(d)}),i.error(function(n){function t(){var t=e(n);a||t||Xn.on.error.fire(n)}i.idbtrans&&(i.idbtrans.onerror=G);try{i.abort()}catch(r){}a&&(a.active=!1,a.on.error.fire(n)),s?u(t):t()}),T._rootExec(function(){d=o.apply(i,f),d&&("function"==typeof d.next&&"function"==typeof d["throw"]?d=Q(d):"function"!=typeof d.then||d.hasOwnProperty("_PSD")||e(c(new hn.IncompatiblePromise)))})}),(!i.idbtrans||a&&0===p)&&i._nop()}catch(v){i&&i.idbtrans&&(i.idbtrans.onerror=G),i&&i.abort(),a&&a.on.error.fire(v),u(function(){e(v)||Xn.on("error").fire(v)})}s=!1}t=e(arguments,1,arguments.length-1),o=arguments[arguments.length-1];var a=T.PSD&&T.PSD.trans;a&&a.db===Xn&&-1===n.indexOf("!")||(a=null);var s=-1!==n.indexOf("?");n=n.replace("!","").replace("?","");var f=en(t[0])?t.reduce(function(n,t){return n.concat(t)}):t,l=null,h=f.map(function(n){return"string"==typeof n?n:(n instanceof R||(l=l||new TypeError("Invalid type. Arguments following mode must be instances of Table or String")),n.name)});return"r"==n||n==Yn?n=Yn:"rw"==n||n==Qn?n=Qn:l=new hn.InvalidArgument("Invalid transaction mode: "+n),a&&(l||(a&&a.mode===Yn&&n===Qn&&(s?a=null:l=l||new hn.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY")),a&&h.forEach(function(n){a.tables.hasOwnProperty(n)||(s?a=null:l=l||new hn.SubTransaction("Table "+n+" not included in parent transaction. Parent Transaction function: "+a.scopeFunc.toString()))}))),a?a._promise(n,i,"lock"):Xn._whenReady(i)},this.table=function(n){if(Cn&&$n)return new q(n);if(!Wn.hasOwnProperty(n))throw new hn.InvalidTable("Table "+n+" does not exist");return Wn[n]},n(R.prototype,function(){function n(){throw new hn.ReadOnly("Current Transaction is READONLY")}return{_trans:function(n,t,e){return this._tpf(n,[this.name],t,e)},_idbstore:function(n,t,e){if(Cn)return new T(t);var r=this;return this._tpf(n,[this.name],function(n,e,o){t(n,e,o.idbtrans.objectStore(r.name),o)},e)},get:function(n,t){var e=this;return this._idbstore(Yn,function(t,r,o){Cn&&t(e.schema.instanceTemplate);var i=o.get(n);i.onerror=J(r,["getting",n,"from",e.name]),i.onsuccess=function(){t(e.hook.reading.fire(i.result))}}).then(t)},where:function(n){return new on(this,n)},count:function(n){return this.toCollection().count(n)},offset:function(n){return this.toCollection().offset(n)},limit:function(n){return this.toCollection().limit(n)},reverse:function(){return this.toCollection().reverse()},filter:function(n){return this.toCollection().and(n)},each:function(n){return this.toCollection().each(n)},toArray:function(n){return this.toCollection().toArray(n)},orderBy:function(n){return new this._collClass(new on(this,n))},toCollection:function(){return new this._collClass(new on(this))},mapToClass:function(n,t){this.schema.mappedClass=n;var e=Object.create(n.prototype);t&&H(e,t),this.schema.instanceTemplate=e;var r=function(t){if(!t)return t;var e=Object.create(n.prototype);for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),n},defineClass:function(n){return this.mapToClass(W.defineClass(n),n)},add:n,put:n,"delete":n,clear:n,update:n}}),t(q).from(R).extend(function(){return{bulkDelete:function(n){return this.hook.deleting.fire===_?this._idbstore(Qn,function(t,e,r,o){t(z(r,o,n,!1,_))}):this.where(":id").anyOf(n)["delete"]().then(function(){})},bulkPut:function(n,t){var e=this;return this._idbstore(Qn,function(r,o,i,u){if(!i.keyPath&&!e.schema.primKey.auto&&!t)throw new hn.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(i.keyPath&&t)throw new hn.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(t&&t.length!==n.length)throw new hn.InvalidArgument("Arguments objects and keys must have the same length");if(0===n.length)return r();var a,c,s=function(n){0===l.length?r(n):o(new b(e.name+".bulkPut(): "+l.length+" of "+h+" operations failed",l))},l=[],h=n.length,d=u.tables[e.name];if(e.hook.creating.fire===_&&e.hook.updating.fire===_){c=M(l);for(var p=0,v=n.length;v>p;++p)a=t?i.put(n[p],t[p]):i.put(n[p]),a.onerror=c;a.onerror=M(l,s),a.onsuccess=V(s)}else{var y=t||i.keyPath&&n.map(function(n){return f(n,i.keyPath)}),m=y&&y.reduce(function(t,e,r){return null!=e&&(t[e]=n[r]),t},{}),w=y?d.where(":id").anyOf(y.filter(function(n){return null!=n})).modify(function(){this.value=m[this.primKey],m[this.primKey]=null})["catch"](g,function(n){l=n.failures}).then(function(){for(var e=[],r=t&&[],o=y.length-1;o>=0;--o){var i=y[o];(null==i||m[i])&&(e.push(n[o]),t&&r.push(i),null!=i&&(m[i]=null))}return e.reverse(),t&&r.reverse(),d.bulkAdd(e,r)}).then(function(n){var t=y[y.length-1];return null!=t?t:n}):d.bulkAdd(n);w.then(s)["catch"](b,function(n){l=l.concat(n.failures),s()})["catch"](o)}},"locked")},bulkAdd:function(n,t){var e=this,r=this.hook.creating.fire;return this._idbstore(Qn,function(o,i,u,c){function s(n){0===y.length?o(n):i(new b(e.name+".bulkAdd(): "+y.length+" of "+m+" operations failed",y))}if(!u.keyPath&&!e.schema.primKey.auto&&!t)throw new hn.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(u.keyPath&&t)throw new hn.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(t&&t.length!==n.length)throw new hn.InvalidArgument("Arguments objects and keys must have the same length");if(0===n.length)return o();var h,d,v,y=[],m=n.length;if(r!==_){var g=u.keyPath,w={onerror:null,onsuccess:null};d=M(y,null),v=V(null,!0),a(function(){for(var e=0,o=n.length;o>e;++e){var i=t&&t[e],a=n[e],s=t?i:g?f(a,g):void 0,y=r.call(w,s,a,c);null==s&&null!=y&&(g?(a=p(a),l(a,g,y)):i=y),h=null!=i?u.add(a,i):u.add(a),w.onerror&&(h._err=w.onerror),w.onsuccess&&(h._suc=w.onsuccess),o-1>e&&(h.onerror=d,w.onsuccess&&(h.onsuccess=v),w.onerror=null,w.onsuccess=null)}},function(n){throw w.onerror&&w.onerror(n),n}),h.onerror=M(y,s),h.onsuccess=V(s,!0)}else{d=M(y);for(var x=0,P=n.length;P>x;++x)h=t?u.add(n[x],t[x]):u.add(n[x]),h.onerror=d;h.onerror=M(y,s),h.onsuccess=V(s)}})},add:function(n,t){var e=this,r=this.hook.creating.fire;return this._idbstore(Qn,function(o,i,u,a){var c={onsuccess:null,onerror:null};if(r!==_){var s=null!=t?t:u.keyPath?f(n,u.keyPath):void 0,h=r.call(c,s,n,a);null==s&&null!=h&&(u.keyPath?l(n,u.keyPath,h):t=h)}try{var d=null!=t?u.add(n,t):u.add(n),p=T.PSD;d.onerror=J(function(n){return c.onerror&&T.usePSD(p,c.onerror.bind(c,n)),i(n)},["adding",n,"into",e.name]),d.onsuccess=function(t){var e=u.keyPath;e&&l(n,e,t.target.result),c.onsuccess&&T.usePSD(p,c.onsuccess.bind(c,t.target.result)),o(d.result)}}catch(v){throw c.onerror&&c.onerror(v),v}})},put:function(n,t){var e=this,r=this.hook.creating.fire,o=this.hook.updating.fire;return r!==_||o!==_?this._trans(Qn,function(r,o,i){var u=void 0!==t?t:e.schema.primKey.keyPath&&f(n,e.schema.primKey.keyPath);null==u?i.tables[e.name].add(n).then(r,o):(i._lock(),n=p(n),i.tables[e.name].where(":id").equals(u).modify(function(){this.value=n}).then(function(r){return 0===r?i.tables[e.name].add(n,t):u})["finally"](function(){i._unlock()}).then(r,o))}):this._idbstore(Qn,function(r,o,i){var u=void 0!==t?i.put(n,t):i.put(n);u.onerror=J(o,["putting",n,"into",e.name]),u.onsuccess=function(t){var e=i.keyPath;e&&l(n,e,t.target.result),r(u.result)}})},"delete":function(n){return this.hook.deleting.subscribers.length?this.where(":id").equals(n)["delete"]():this._idbstore(Qn,function(t,e,r){var o=r["delete"](n);o.onerror=J(e,["deleting",n,"from",r.name]),o.onsuccess=function(){t(o.result)}})},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection()["delete"]():this._idbstore(Qn,function(n,t,e){var r=e.clear();r.onerror=J(t,["clearing",e.name]),r.onsuccess=function(){n(r.result)}})},update:function(n,t){if("object"!=typeof t||en(t))throw new hn.InvalidArgument("db.update(keyOrObject, modifications). modifications must be an object.");if("object"!=typeof n||en(n))return this.where(":id").equals(n).modify(t);tn(t).forEach(function(e){l(n,e,t[e])});var e=f(n,this.schema.primKey.keyPath);return void 0===e&&T.reject(new hn.InvalidArgument("Given object does not contain its primary key")),this.where(":id").equals(e).modify(t)}}}),n(rn.prototype,{_lock:function(){return++this._reculock,1===this._reculock&&T.PSD&&(T.PSD.lockOwnerFor=this),this},_unlock:function(){if(0===--this._reculock)for(T.PSD&&(T.PSD.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var n=this._blockedFuncs.shift();try{n()}catch(t){}}return this},_locked:function(){return this._reculock&&(!T.PSD||T.PSD.lockOwnerFor!==this)},_nop:function(n){this.tables[this.storeNames[0]].get(0).then(n)},_promise:function(n,t,e){var r=this;return T.newPSD(function(){var o;return r._locked()?o=new T(function(o,i){r._blockedFuncs.push(function(){r._promise(n,t,e).then(o,i)})}):(o=r.active?new T(function(o,i){if(!r.idbtrans&&n){if(!zn)throw!Jn||["DatabaseClosedError","MissingAPIError"].indexOf(Jn.name)>=0?Jn:new hn.OpenFailed(Jn);var a=r.idbtrans=zn.transaction($(r.storeNames),r.mode);a.onerror=function(n){r.on("error").fire(n&&n.target.error),n.preventDefault(),r.abort()},a.onabort=function(n){u(function(){r.on("error").fire(new hn.Abort("Transaction aborted for unknown reason"))}),r.active=!1,r.on("abort").fire(n)},a.oncomplete=function(n){r.active=!1,r.on("complete").fire(n)}}e&&r._lock();try{t(o,i,r)}catch(s){var f=c(w(s));W.ignoreTransaction(function(){r.on("error").fire(f)}),r.abort(),i(f)}}):T.reject(c(new hn.TransactionInactive("Transaction is inactive. Original Scope Function Source: "+r.scopeFunc.toString()))),r.active&&e&&o["finally"](function(){r._unlock()})),
o.onuncatched=function(n){W.ignoreTransaction(function(){r.on("error").fire(n)}),r.abort()},o})},complete:function(n){return this.on("complete",n)},error:function(n){return this.on("error",n)},abort:function(){if(this.idbtrans&&this.active)try{this.active=!1,this.idbtrans.abort(),this.on.error.fire(new hn.Abort("Transaction Aborted"))}catch(n){}},table:function(n){if(!this.tables.hasOwnProperty(n))throw new hn.InvalidTable("Table "+n+" not in transaction");return this.tables[n]}}),n(on.prototype,function(){function n(n,t,e){var r=n instanceof on?new n._ctx.collClass(n):n;try{throw e?new e(t):new TypeError(t)}catch(o){r._ctx.error=o}return r}function t(n){return new n._ctx.collClass(n,function(){return qn.only("")}).limit(0)}function r(n){return e(1===n.length&&en(n[0])?n[0]:n)}function o(n){return"next"===n?function(n){return n.toUpperCase()}:function(n){return n.toLowerCase()}}function i(n){return"next"===n?function(n){return n.toLowerCase()}:function(n){return n.toUpperCase()}}function u(n,t,e,r,o,i){for(var u=Math.min(n.length,r.length),a=-1,c=0;u>c;++c){var s=t[c];if(s!==r[c])return o(n[c],e[c])<0?n.substr(0,c)+e[c]+e.substr(c+1):o(n[c],r[c])<0?n.substr(0,c)+r[c]+e.substr(c+1):a>=0?n.substr(0,a)+t[a]+e.substr(a+1):null;o(n[c],s)<0&&(a=c)}return u<r.length&&"next"===i?n+e.substr(n.length):u<n.length&&"prev"===i?n.substr(0,e.length):0>a?null:n.substr(0,a)+r[a]+e.substr(a+1)}function a(n,t,e,r){function a(n){c=o(n),s=i(n),f="next"===n?bn:wn;var t=e.map(function(n){return{lower:s(n),upper:c(n)}}).sort(function(n,t){return f(n.lower,t.lower)});l=t.map(function(n){return n.upper}),h=t.map(function(n){return n.lower}),d=n,p="next"===n?"":r}var c,s,f,l,h,d,p,v=e.length;a("next");var y=new n._ctx.collClass(n,function(){return qn.bound(l[0],h[v-1]+r)});y._ondirectionchange=function(n){a(n)};var m=0;return y._addAlgorithm(function(n,e,r){var o=n.key;if("string"!=typeof o)return!1;var i=s(o);if(t(i,h,m))return!0;for(var a=null,c=m;v>c;++c){var y=u(o,i,l[c],h[c],f,d);null===y&&null===a?m=c+1:(null===a||f(a,y)>0)&&(a=y)}return e(null!==a?function(){n["continue"](a+p)}:r),!1}),y}return{between:function(e,r,o,i){o=o!==!1,i=i===!0;try{return pn(e,r)>0||0===pn(e,r)&&(o||i)&&(!o||!i)?t(this):new this._ctx.collClass(this,function(){return qn.bound(e,r,!o,!i)})}catch(u){return n(this,Pn)}},equals:function(n){return new this._ctx.collClass(this,function(){return qn.only(n)})},above:function(n){return new this._ctx.collClass(this,function(){return qn.lowerBound(n,!0)})},aboveOrEqual:function(n){return new this._ctx.collClass(this,function(){return qn.lowerBound(n)})},below:function(n){return new this._ctx.collClass(this,function(){return qn.upperBound(n,!0)})},belowOrEqual:function(n){return new this._ctx.collClass(this,function(){return qn.upperBound(n)})},startsWith:function(t){return"string"!=typeof t?n(this,kn):this.between(t,t+_n,!0,!0)},startsWithIgnoreCase:function(t){return"string"!=typeof t?n(this,kn):""===t?this.startsWith(t):a(this,function(n,t){return 0===n.indexOf(t[0])},[t],_n)},equalsIgnoreCase:function(t){return"string"!=typeof t?n(this,kn):a(this,function(n,t){return n===t[0]},[t],"")},anyOfIgnoreCase:function(){var e=r(arguments);return 0===e.length?t(this):e.every(function(n){return"string"==typeof n})?a(this,function(n,t){return-1!==t.indexOf(n)},e,""):n(this,"anyOfIgnoreCase() only works with strings")},startsWithAnyOfIgnoreCase:function(){var e=r(arguments);return 0===e.length?t(this):e.every(function(n){return"string"==typeof n})?a(this,function(n,t){return t.some(function(t){return 0===n.indexOf(t)})},e,_n):n(this,"startsWithAnyOfIgnoreCase() only works with strings")},anyOf:function(){var e=r(arguments),o=mn;try{e.sort(o)}catch(i){return n(this,Pn)}if(0===e.length)return t(this);var u=new this._ctx.collClass(this,function(){return qn.bound(e[0],e[e.length-1])});u._ondirectionchange=function(n){o="next"===n?mn:gn,e.sort(o)};var a=0;return u._addAlgorithm(function(n,t,r){for(var i=n.key;o(i,e[a])>0;)if(++a,a===e.length)return t(r),!1;return 0===o(i,e[a])?!0:(t(function(){n["continue"](e[a])}),!1)}),u},notEqual:function(n){return this.inAnyRange([[-(1/0),n],[n,xn]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var t=r(arguments);if(0===t.length)return new this._ctx.collClass(this);try{t.sort(mn)}catch(e){return n(this,Pn)}var o=t.reduce(function(n,t){return n?n.concat([[n[n.length-1][1],t]]):[[-(1/0),t]]},null);return o.push([t[t.length-1],xn]),this.inAnyRange(o,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(e,r){function o(n,t){for(var e=0,r=n.length;r>e;++e){var o=n[e];if(pn(t[0],o[1])<0&&pn(t[1],o[0])>0){o[0]=vn(o[0],t[0]),o[1]=yn(o[1],t[1]);break}}return e===r&&n.push(t),n}function i(n,t){return l(n[0],t[0])}function u(n){return!p(n)&&!v(n)}var a=this._ctx;if(0===e.length)return t(this);if(!e.every(function(n){return void 0!==n[0]&&void 0!==n[1]&&mn(n[0],n[1])<=0}))return n(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",hn.InvalidArgument);var c,s=!r||r.includeLowers!==!1,f=r&&r.includeUppers===!0,l=mn;try{c=e.reduce(o,[]),c.sort(i)}catch(h){return n(this,Pn)}var d=0,p=f?function(n){return mn(n,c[d][1])>0}:function(n){return mn(n,c[d][1])>=0},v=s?function(n){return gn(n,c[d][0])>0}:function(n){return gn(n,c[d][0])>=0},y=p,m=new a.collClass(this,function(){return qn.bound(c[0][0],c[c.length-1][1],!s,!f)});return m._ondirectionchange=function(n){"next"===n?(y=p,l=mn):(y=v,l=gn),c.sort(i)},m._addAlgorithm(function(n,t,e){for(var r=n.key;y(r);)if(++d,d===c.length)return t(e),!1;return u(r)?!0:0===pn(r,c[d][1])||0===pn(r,c[d][0])?!1:(t(function(){l===mn?n["continue"](c[d][0]):n["continue"](c[d][1])}),!1)}),m},startsWithAnyOf:function(){var e=r(arguments);return e.every(function(n){return"string"==typeof n})?0===e.length?t(this):this.inAnyRange(e.map(function(n){return[n,n+_n]})):n(this,"startsWithAnyOf() only works with strings")}}}),n(un.prototype,function(){function t(n,t){n.filter=Sn(n.filter,t)}function e(n,t){var e=n.replayFilter;n.replayFilter=e?function(){return Sn(e(),t())}:t}function r(n,t){n.isMatch=Sn(n.isMatch,t)}function o(n,t){if(n.isPrimKey)return t;var e=n.table.schema.idxByName[n.index];if(!e)throw new hn.Schema("KeyPath "+n.index+" on object store "+t.name+" is not indexed");return t.index(e.name)}function i(n,t){var e=o(n,t);return n.keysOnly&&"openKeyCursor"in e?e.openKeyCursor(n.range||null,n.dir+n.unique):e.openCursor(n.range||null,n.dir+n.unique)}function u(n,t,e,r,o){var u=n.replayFilter?Sn(n.filter,n.replayFilter()):n.filter;n.or?!function(){function a(){2===++f&&e()}function c(n,e,o){if(!u||u(e,o,a,r)){var i=e.primaryKey.toString();s.hasOwnProperty(i)||(s[i]=!0,t(n,e,o))}}var s={},f=0;n.or._iterate(c,a,r,o),ln(i(n,o),n.algorithm,c,a,r,!n.keysOnly&&n.valueFilter)}():ln(i(n,o),Sn(n.algorithm,u),t,e,r,!n.keysOnly&&n.valueFilter)}function a(n){return n.table.schema.instanceTemplate}return{_read:function(n,t){var e=this._ctx;return e.error?e.table._trans(null,function(n,t){t(e.error)}):e.table._idbstore(Yn,n).then(t)},_write:function(n){var t=this._ctx;return t.error?t.table._trans(null,function(n,e){e(t.error)}):t.table._idbstore(Qn,n,"locked")},_addAlgorithm:function(n){var t=this._ctx;t.algorithm=Sn(t.algorithm,n)},_iterate:function(n,t,e,r){return u(this._ctx,n,t,e,r)},clone:function(t){var e=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return t&&n(r,t),e._ctx=r,e},raw:function(){return this._ctx.valueFilter=null,this},each:function(n){var t=this._ctx;return Cn&&n(a(t)),this._read(function(e,r,o){u(t,n,e,r,o)})},count:function(n){if(Cn)return T.resolve(0).then(n);var t=this,e=this._ctx;if(e.filter||e.algorithm||e.or||e.replayFilter){var r=0;return this._read(function(n,t,o){u(e,function(){return++r,!1},function(){n(r)},t,o)},n)}return this._read(function(n,r,i){var u=o(e,i),a=e.range?u.count(e.range):u.count();a.onerror=J(r,["calling","count()","on",t.name]),a.onsuccess=function(t){n(t.target.result)}},n)},sortBy:function(n,t){function e(n,t){return t?e(n[o[t]],t-1):n[i]}function r(n,t){var r=e(n,u),o=e(t,u);return o>r?-a:r>o?a:0}var o=n.split(".").reverse(),i=o[0],u=o.length-1,a="next"===this._ctx.dir?1:-1;return this.toArray(function(n){return n.sort(r)}).then(t)},toArray:function(n){var t=this._ctx;return this._read(function(n,e,r){Cn&&n([a(t)]);var o=[];u(t,function(n){o.push(n)},function(){n(o)},e,r)},n)},offset:function(n){var t=this._ctx;return 0>=n?this:(t.offset+=n,t.or||t.algorithm||t.filter||t.replayFilter?e(t,function(){var t=n;return function(){return--t<0}}):e(t,function(){var t=n;return function(n,e){return 0===t?!0:1===t?(--t,!1):(e(function(){n.advance(t),t=0}),!1)}}),this)},limit:function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),e(this._ctx,function(){var t=n;return function(n,e,r){return--t<=0&&e(r),t>=0}}),this},until:function(n,e){var r=this._ctx;return Cn&&n(a(r)),t(this._ctx,function(t,r,o){return n(t.value)?(r(o),e):!0}),this},first:function(n){return this.limit(1).toArray(function(n){return n[0]}).then(n)},last:function(n){return this.reverse().first(n)},and:function(n){return Cn&&n(a(this._ctx)),t(this._ctx,function(t){return n(t.value)}),r(this._ctx,n),this},or:function(n){return new on(this._ctx.table,n,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(n){var t=this._ctx;return Cn&&n(f(a(this._ctx),this._ctx.index?this._ctx.table.schema.idxByName[this._ctx.index].keyPath:this._ctx.table.schema.primKey.keyPath)),t.keysOnly=!0,this.each(function(t,e){n(e.key,e)})},eachUniqueKey:function(n){return this._ctx.unique="unique",this.eachKey(n)},keys:function(n){var t=this._ctx;t.keysOnly=!0;var e=[];return Cn?new T(this.eachKey.bind(this)).then(function(n){return[n]}).then(n):this.each(function(n,t){e.push(t.key)}).then(function(){return e}).then(n)},uniqueKeys:function(n){return this._ctx.unique="unique",this.keys(n)},firstKey:function(n){return this.limit(1).keys(function(n){return n[0]}).then(n)},lastKey:function(n){return this.reverse().firstKey(n)},distinct:function(){var n=this._ctx,e=n.index&&n.table.schema.idxByName[n.index];if(!e||!e.multi)return this;var r={};return t(this._ctx,function(n){var t=n.primaryKey.toString(),e=r.hasOwnProperty(t);return r[t]=!0,!e}),this}}}),t(an).from(un).extend({modify:function(t){var e=this,r=this._ctx,o=r.table.hook,i=o.updating.fire,u=o.deleting.fire;return Cn&&"function"==typeof t&&t.call({value:r.table.schema.instanceTemplate},r.table.schema.instanceTemplate),this._write(function(o,c,s,h){function y(n,t){function e(n){return I.push(n),E.push(o.primKey),o.onerror&&T.newPSD(function(){T.PSD.trans=h,o.onerror(n)}),b(),!0}C=t.primaryKey;var o={primKey:t.primaryKey,value:n,onsuccess:null,onerror:null};if(w.call(o,n,o)!==!1){var i=!o.hasOwnProperty("value");++D,a(function(){var u=i?t["delete"]():t.update(o.value);u.onerror=J(e,i?["deleting",n,"from",r.table.name]:["modifying",n,"on",r.table.name]),u.onsuccess=function(){o.onsuccess&&T.newPSD(function(){T.PSD.trans=h,o.onsuccess(o.value)}),++S,b()}},e)}else o.onsuccess&&o.onsuccess(o.value)}function m(n){return n&&(I.push(n),E.push(C)),c(new g("Error modifying one or more objects",I,S,E))}function b(){O&&S+I.length===D&&(I.length>0?m():o(S))}var w;if("function"==typeof t)w=i===_&&u===_?t:function(n){var e=p(n);if(t.call(this,n,this)===!1)return!1;if(this.hasOwnProperty("value")){var r=v(e,this.value),o=i.call(this,r,this.primKey,e,h);o&&(n=this.value,tn(o).forEach(function(t){l(n,t,o[t])}))}else u.call(this,this.primKey,n,h)};else if(i===_){var x=tn(t),P=x.length;w=function(n){for(var e=!1,r=0;P>r;++r){var o=x[r],i=t[o];f(n,o)!==i&&(l(n,o,i),e=!0)}return e}}else{var k=t;t=d(k),w=function(e){var r=!1,o=i.call(this,t,this.primKey,p(e),h);return o&&n(t,o),tn(t).forEach(function(n){var o=t[n];f(e,n)!==o&&(l(e,n,o),r=!0)}),o&&(t=d(k)),r}}var D=0,S=0,O=!1,I=[],E=[],C=null;e.clone().raw()._iterate(y,function(){O=!0,b()},m,s)})},"delete":function(){var n=this,t=this._ctx,e=t.range,r=t.table.hook.deleting.fire,o=r!==_;if(!o&&!t.or&&!t.algorithm&&!t.filter&&!t.replayFilter&&(t.isPrimKey&&!In||!e))return this._write(function(n,r,o){var i=J(r,["deleting range from",t.table.name]),u=e?o.count(e):o.count();u.onerror=i,u.onsuccess=function(){var t=u.result;a(function(){var r=e?o["delete"](e):o.clear();r.onerror=i,r.onsuccess=function(){return n(t)}},function(n){return r(w(n))})}});var i=o?2e3:1e4;return this._write(function(e,u,a,c){var s=0,f=Object.create(t.table);f._tpf=c._tpf;var l=n.clone({table:f,keysOnly:!o}).distinct().limit(i).raw(),h=[],d=function(){return l.each(o?function(n,t){h.push([t.primaryKey,t.value])}:function(n,t){h.push(t.primaryKey)}).then(function(){return o?h.sort(function(n,t){return mn(n[0],t[0])}):h.sort(mn),z(a,c,h,o,r)}).then(function(){var n=h.length;return s+=n,h=[],i>n?s:d()})};e(d())})}}),n(this,{Collection:un,Table:R,Transaction:rn,Version:y,WhereClause:on,WriteableCollection:an,WriteableTable:q}),h(),Bn.forEach(function(n){n(Xn)})}function L(n,t){var e=T.PSD;return function(){var r=T.PSD;T.PSD=e;try{n.apply(this,arguments)}catch(o){t(o)}finally{T.PSD=r}}}function z(n){if("function"==typeof n)return new n;if(en(n))return[z(n[0])];if(n&&"object"==typeof n){var t={};return H(t,n),t}return n}function H(n,t){return tn(t).forEach(function(e){var r=z(t[e]);n[e]=r}),n}function J(n,t){return function(e){var r=e&&e.target.error||new Error("");if(t){var o=" occurred when "+t.map(function(n){switch(typeof n){case"function":return n();case"string":return n;default:return JSON.stringify(n)}}).join(" ");r.message&&r.message!=r.name&&(o+=". "+r.message),r.name?r=w(r,r.name+o):r+=o}return n(r),e&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()),!1}}function G(n){n.preventDefault()}function Y(n){var t,e=W.dependencies.localStorage;if(!e)return n([]);try{t=JSON.parse(e.getItem("Dexie.DatabaseNames")||"[]")}catch(r){t=[]}n(t)&&e.setItem("Dexie.DatabaseNames",JSON.stringify(t))}function Q(n){function t(n){return function(t){var r=n(t),o=r.value;return r.done?o:o&&"function"==typeof o.then?o.then(i,u):Array.isArray(o)?e(o,0):i(o)}}function e(n,t){if(t===n.length)return i(n);var r=n[t];return r.constructor&&"function"==typeof r.constructor.all?r.constructor.all(n).then(i,u):e(n,t+1)}var r=function(t){return n.next(t)},o=function(t){return n["throw"](t)},i=t(r),u=t(o);return t(r)()}function X(n,t,e,r,o,i,u){this.name=n,this.keyPath=t,this.unique=e,this.multi=r,this.auto=o,this.compound=i,this.dotted=u;var a="string"==typeof t?t:t&&"["+[].join.call(t,"+")+"]";this.src=(e?"&":"")+(r?"*":"")+(o?"++":"")+a}function Z(n,t,e,r){this.name=n,this.primKey=t||new X,this.indexes=e||[new X],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=e.reduce(function(n,t){return n[t.name]=t,n},{})}function $(n){return 1===n.length?n[0]:n}function nn(n){var t=n&&(n.getDatabaseNames||n.webkitGetDatabaseNames);return t&&t.bind(n)}var tn=Object.keys,en=Array.isArray,rn="undefined"!=typeof self?self:"undefined"!=typeof window?window:global,on=[].slice,un=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","IncompatiblePromise"],an=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],cn=un.concat(an),sn={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",IncompatiblePromise:"Incompatible Promise used in transaction scope. See http://tinyurl.com/znyqjqc"};t(y).from(Error),t(g).from(y),t(b).from(y);var fn=cn.reduce(function(n,t){return n[t]=t+"Error",n},{}),ln=y,hn=cn.reduce(function(n,e){function r(n,t){this.name=o,"string"==typeof n?(this.message=n,this.inner=t||null):"object"==typeof n?(this.message=n.name+" "+n.message,this.inner=n):(this.message=sn[e],this.inner=null)}var o=e+"Error";return t(r).from(ln),n[e]=r,n},{});hn.Syntax=SyntaxError,hn.Type=TypeError,hn.Range=RangeError;var dn=an.reduce(function(n,t){return n[t+"Error"]=hn[t],n},{}),pn=cn.reduce(function(n,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(n[t+"Error"]=hn[t]),n},{});pn.ModifyError=g,pn.DexieError=y,pn.BulkError=b;var vn=rn.setImmediate||function(n){var t=e(arguments,1);setTimeout(function(){n.apply(rn,t)},0)};o(function(){vn=yn=wn=function(n){var t=arguments;setTimeout(function(){n.apply(rn,e(t,1))},0)}});var yn=vn,mn=!0,gn=[],bn=[],wn=function(n){gn.push([n,e(arguments,1)])};T.all=function(){var n=e(1===arguments.length&&en(arguments[0])?arguments[0]:arguments);return new T(function(t,e){function r(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var a=u.then;if("function"==typeof a)return void a.call(u,function(n){r(i,n)},e)}n[i]=u,0===--o&&t(n)}catch(c){e(c)}}if(0===n.length)return t([]);for(var o=n.length,i=0;i<n.length;i++)r(i,n[i])})},T.prototype.then=function(n,t){var e=this,r=new T(function(r,o){null===e._state?K(e,new M(n,t,r,o)):yn(K,e,new M(n,t,r,o))});return r._PSD=this._PSD,r.onuncatched=this.onuncatched,r._parent=this,r},T.prototype._then=function(n,t){K(this,new M(n,t,_,_))},T.prototype["catch"]=function(n){if(1===arguments.length)return this.then(null,n);var t=arguments[0],e=arguments[1];return"function"==typeof t?this.then(null,function(n){return n instanceof t?e(n):T.reject(n)}):this.then(null,function(n){return n&&n.name===t?e(n):T.reject(n)})},T.prototype["finally"]=function(n){return this.then(function(t){return n(),t},function(t){return n(),T.reject(t)})},T.prototype.onuncatched=null,T.resolve=function(n){if(n&&"function"==typeof n.then)return n;var t=new T(function(){});return t._state=!0,t._value=n,t},T.reject=function(n){var t=new T(function(){});return t._state=!1,t._value=n,t},T.race=function(n){return new T(function(t,e){n.map(function(n){n.then(t,e)})})},T.PSD=null,T.newPSD=function(n){var t=T.PSD;T.PSD=t?Object.create(t):{};try{return n()}finally{T.PSD=t}},T.usePSD=function(n,t){var e=T.PSD;T.PSD=n;try{return t()}finally{T.PSD=e}},T._rootExec=F,T._tickFinalize=function(n){if(mn)throw new Error("Not in a virtual tick");bn.push(n)},T.on=j(null,{error:[function(n,t){return t},V]});var _n=String.fromCharCode(65535),xn=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(n){return _n}}(),Pn="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",kn="String expected.",Dn=[],Sn="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),On=Sn,In=Sn,En=function(){},Cn=!1;W["delete"]=function(n){var t=new W(n),e=t["delete"]();return e.onblocked=function(n){return t.on("blocked",n),this},e},W.exists=function(n){return new W(n).open().then(function(n){return n.close(),!0})["catch"](W.NoSuchDatabaseError,function(){return!1})},W.getDatabaseNames=function(n){return new T(function(n,t){var r=nn(indexedDB);if(r){var o=r();o.onsuccess=function(t){n(e(t.target.result,0))},o.onerror=J(t)}else Y(function(t){return n(t),!1})}).then(n)},W.defineClass=function(t){function e(e){e?n(this,e):Cn&&H(this,t)}return e},W.applyStructure=H,W.ignoreTransaction=function(n){return T.newPSD(function(){return T.PSD.trans=null,n()})},W.vip=function(n){return T.newPSD(function(){return T.PSD.letThrough=!0,n()})},W.async=function(n){return function(){try{var t=Q(n.apply(this,arguments));return t&&"function"==typeof t.then?t:W.Promise.resolve(t)}catch(e){return W.Promise.reject(e)}}},W.spawn=function(n,t,e){try{var r=Q(n.apply(e,t||[]));return r&&"function"==typeof r.then?r:W.Promise.resolve(r)}catch(o){return W.Promise.reject(o)}},Object.defineProperty(W,"currentTransaction",{get:function(){return T.PSD&&T.PSD.trans||null}}),W.Promise=T,W.derive=t,W.extend=n,W.override=r,W.Events=W.events=j,W.getByKeyPath=f,W.setByKeyPath=l,W.delByKeyPath=h,W.shallowClone=d,W.deepClone=p,W.addons=[],W.fakeAutoComplete=En,W.asap=u,W.maxKey=xn,W.connections=Dn,n(W,pn),W.MultiModifyError=W.ModifyError,W.errnames=fn,W.IndexSpec=X,W.TableSchema=Z;var jn=rn.idbModules&&rn.idbModules.shimIndexedDB?rn.idbModules:{};return W.dependencies={indexedDB:jn.shimIndexedDB||rn.indexedDB||rn.mozIndexedDB||rn.webkitIndexedDB||rn.msIndexedDB,IDBKeyRange:jn.IDBKeyRange||rn.IDBKeyRange||rn.webkitIDBKeyRange},a(function(){W.dependencies.localStorage=null!=("undefined"!=typeof chrome&&null!==chrome?chrome.storage:void 0)?null:rn.localStorage}),W.semVer="1.3.6-beta.2",W.version=W.semVer.split(".").map(function(n){return parseInt(n)}).reduce(function(n,t,e){return n+t/Math.pow(10,2*e)}),o(function(){W.fakeAutoComplete=En=o,W.fake=Cn=!0}),W["default"]=W,W});
//# sourceMappingURL=dist/dexie.min.js.map